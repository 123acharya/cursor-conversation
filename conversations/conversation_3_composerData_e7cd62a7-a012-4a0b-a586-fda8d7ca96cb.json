{
  "key": "composerData:e7cd62a7-a012-4a0b-a586-fda8d7ca96cb",
  "data": {
    "_v": 11,
    "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb",
    "richText": "",
    "hasLoaded": true,
    "text": "",
    "fullConversationHeadersOnly": [
      {
        "bubbleId": "19010b73-a5d6-4ecf-8958-a9dadb7fb43e",
        "type": 1
      },
      {
        "bubbleId": "810a52d6-cd50-4b8a-bb13-60927b718007",
        "type": 2,
        "serverBubbleId": "1b6ae280-939d-40c0-8fbb-ab6b800f8101"
      },
      {
        "bubbleId": "2a16b57f-0cd0-4a49-bf29-e1b63427fbac",
        "type": 2
      },
      {
        "bubbleId": "8248b77f-9808-4472-bd4a-600a57973004",
        "type": 2
      },
      {
        "bubbleId": "a6a43b08-3f83-49ec-9899-4ffb874d8810",
        "type": 2
      },
      {
        "bubbleId": "2eb9e7e4-a2e1-4dd6-960c-6a239e2d4205",
        "type": 2
      },
      {
        "bubbleId": "225722bd-0bca-4e59-90c6-fa9113324813",
        "type": 2
      },
      {
        "bubbleId": "8da156e3-aa39-4931-ac49-f232b857ce04",
        "type": 2
      },
      {
        "bubbleId": "7089e6a5-9880-43eb-82c5-bda726d4647d",
        "type": 2
      },
      {
        "bubbleId": "e66a23ef-8d0c-4504-b112-c6083813ee95",
        "type": 2,
        "serverBubbleId": "9c52ef61-cb83-4744-b506-4ebb22304bf1"
      },
      {
        "bubbleId": "68e47479-cd8f-41ac-9eb9-d6dfe8d749b6",
        "type": 2
      },
      {
        "bubbleId": "aabdc45a-853b-4e64-82fe-b459a1502427",
        "type": 2
      },
      {
        "bubbleId": "2343d610-5bc0-4993-9085-d3130d0a32ab",
        "type": 2
      },
      {
        "bubbleId": "4db42268-ab58-4fbb-867e-63cbd59b0783",
        "type": 2
      },
      {
        "bubbleId": "a0b28375-3a7a-458c-b217-00fdff65fa7d",
        "type": 2
      },
      {
        "bubbleId": "83701c58-0ae2-422b-beed-c3cd4f213cab",
        "type": 2,
        "serverBubbleId": "4d0efcdb-0fa9-4962-8c79-5acd8a5656bf"
      },
      {
        "bubbleId": "01ec2b00-77c9-4458-9b42-db64e87b46f4",
        "type": 2
      },
      {
        "bubbleId": "bb2d85d9-fc56-4333-9524-7c6a63c82541",
        "type": 1
      },
      {
        "bubbleId": "d8300ebb-0801-43b1-ac9a-76c8a2272db0",
        "type": 2,
        "serverBubbleId": "7bf09169-530f-4425-85a4-d0b0477fade6"
      },
      {
        "bubbleId": "39381c37-3ddd-4113-ae9c-ff237815d982",
        "type": 2
      },
      {
        "bubbleId": "2ff8c689-3373-4700-8423-24cc40dd5b5a",
        "type": 2
      },
      {
        "bubbleId": "d78e7cc7-caab-4e86-b9dc-72058c0d4866",
        "type": 2
      },
      {
        "bubbleId": "8321750c-0d9f-4929-9af0-f6c784acf527",
        "type": 2
      },
      {
        "bubbleId": "401b26ad-e8aa-4257-b700-30e166e89609",
        "type": 2
      },
      {
        "bubbleId": "1a102e1c-b5fb-4e42-af8d-2b7c36768b9f",
        "type": 2
      },
      {
        "bubbleId": "80a013b3-ff27-405c-b4ef-6a40b4b958f6",
        "type": 2,
        "serverBubbleId": "1cdfb918-8d47-4ecc-af05-51de998dac00"
      },
      {
        "bubbleId": "f2397e0c-99a4-4be7-9e28-bdcff53a023d",
        "type": 2
      },
      {
        "bubbleId": "8481d344-0c25-48c5-8797-07090641b0b2",
        "type": 2
      },
      {
        "bubbleId": "16e41194-05ef-41cb-be80-cb6ef5568185",
        "type": 2
      },
      {
        "bubbleId": "d07ab595-0fd3-43a6-8a8a-28347dc240fe",
        "type": 2
      },
      {
        "bubbleId": "dbb9a360-8221-45aa-8da3-f983effe38df",
        "type": 2
      },
      {
        "bubbleId": "e9a763f5-fd10-41dd-9ce2-ed6c396fd6ef",
        "type": 2,
        "serverBubbleId": "8e956be4-4478-4364-8c67-090b97cbaf3b"
      },
      {
        "bubbleId": "4427cd0e-560f-44e1-9aa6-ed00adda30d0",
        "type": 2
      },
      {
        "bubbleId": "df68ea81-38b6-40cf-9170-0c2e9feda353",
        "type": 2
      },
      {
        "bubbleId": "3a89a0bf-a4dc-4ad3-bf30-b2889dc1d437",
        "type": 2,
        "serverBubbleId": "2f655649-3182-43b6-a478-6e917b6d0bbf"
      },
      {
        "bubbleId": "8d47c05f-58e7-4e2b-b439-f8cdb3f13256",
        "type": 2
      },
      {
        "bubbleId": "8415185a-1326-4f53-930e-0bc71e8387b3",
        "type": 1
      },
      {
        "bubbleId": "0c4ff50f-b03a-406c-9883-f14ee557ace5",
        "type": 2,
        "serverBubbleId": "4aa4426e-b306-4e2c-8af1-b16d1334bde6"
      },
      {
        "bubbleId": "8c8e104d-786b-4273-8d07-de1cca475f7f",
        "type": 2
      },
      {
        "bubbleId": "2bc81aea-0ce4-4e4c-a676-45a8c5bd16dd",
        "type": 2
      },
      {
        "bubbleId": "e8635f47-91c6-4231-b22e-6a9419d4099e",
        "type": 2
      },
      {
        "bubbleId": "249806f9-89df-4ef8-b6e4-5156a809f185",
        "type": 2
      },
      {
        "bubbleId": "34afa532-b80c-4668-b234-a4609724e0ab",
        "type": 2
      },
      {
        "bubbleId": "573a9451-8c05-4aa0-841e-f96cb734af3f",
        "type": 2
      },
      {
        "bubbleId": "62e35bb9-5393-4a93-901f-8e8cd6c4ce49",
        "type": 2
      },
      {
        "bubbleId": "32e198aa-017d-4699-9f76-837257a7e5ed",
        "type": 2
      },
      {
        "bubbleId": "6df79840-eb8b-46e8-bb83-067749f5e195",
        "type": 2
      },
      {
        "bubbleId": "f1d579c0-ec12-4314-af1a-6bf327311bd2",
        "type": 2,
        "serverBubbleId": "05b37700-aa09-45e5-a435-8ac4fe23bf1b"
      },
      {
        "bubbleId": "fb69f4ff-b99d-4e28-8618-286016c57e07",
        "type": 2
      },
      {
        "bubbleId": "a33624ba-e077-493a-9578-9451322f63a6",
        "type": 2
      },
      {
        "bubbleId": "a464bfd4-ab38-4687-9126-33abf95807fa",
        "type": 2
      },
      {
        "bubbleId": "cb849dbc-3d29-4a19-b5e1-f6fc7d43a7fa",
        "type": 2
      },
      {
        "bubbleId": "105f6b43-6da3-4e37-996c-9111243c17ca",
        "type": 2
      },
      {
        "bubbleId": "609274b4-910c-4ef5-b09b-a3ad1bc6c23c",
        "type": 2
      },
      {
        "bubbleId": "f4b51f52-ee47-4562-b471-5fddbc84bac0",
        "type": 2
      },
      {
        "bubbleId": "e697b758-d977-41d5-b5cf-7aadaecccb78",
        "type": 2
      },
      {
        "bubbleId": "3f1659f1-160b-42c8-ad5a-7839b1398596",
        "type": 2,
        "serverBubbleId": "de947c9a-8301-43ad-893d-e688df4d8507"
      },
      {
        "bubbleId": "63f365e4-6608-41c7-9cdd-2a6e959c05e6",
        "type": 2
      },
      {
        "bubbleId": "6d319077-0efc-47dd-a4dc-19259e3486f4",
        "type": 2
      },
      {
        "bubbleId": "c8c1bd46-e6fa-4401-a6b1-41c72546e91a",
        "type": 2
      },
      {
        "bubbleId": "5e5cf8b1-1e81-416e-9d72-fb5f1614aa73",
        "type": 2
      },
      {
        "bubbleId": "4c815bde-fe22-42dd-8ef0-ae7ebe739cad",
        "type": 2
      },
      {
        "bubbleId": "b02b2c07-fd5d-4f6a-8084-0dee6730e833",
        "type": 2
      },
      {
        "bubbleId": "e74221e2-1b01-49f4-bac9-91119b7e74ba",
        "type": 2
      },
      {
        "bubbleId": "9968d426-bbf5-4d44-9ac7-51191b2236d9",
        "type": 2
      },
      {
        "bubbleId": "a3d40a0c-da87-47f8-80e2-0adde95f2b53",
        "type": 2
      },
      {
        "bubbleId": "f94c03ab-535f-4a2b-a49f-04e33e8cceda",
        "type": 2
      },
      {
        "bubbleId": "3d27df3a-c209-4c1a-bdbd-d12fff678ab1",
        "type": 2
      },
      {
        "bubbleId": "c92076d6-ac0f-4233-9b9e-298f626ebb55",
        "type": 2
      },
      {
        "bubbleId": "ee26252b-3b21-4bfb-982a-6e8f357cf5da",
        "type": 2
      },
      {
        "bubbleId": "01e4379a-d6f6-4894-823c-f79f3aa4f140",
        "type": 2
      },
      {
        "bubbleId": "56655fec-792d-4159-ade0-c08e2e0cc0fb",
        "type": 2,
        "serverBubbleId": "202cbf79-0a13-4767-9e80-d8dd89eef402"
      },
      {
        "bubbleId": "40c80f00-d7d1-4a12-953b-4150b3100169",
        "type": 2
      },
      {
        "bubbleId": "494ada55-6a93-44fc-a7ec-105d7aed8763",
        "type": 2
      },
      {
        "bubbleId": "ae82ee61-f2ab-4643-a8f6-0d950c3ed30b",
        "type": 2
      },
      {
        "bubbleId": "0a380fd3-4482-4242-afdb-782440969b18",
        "type": 2
      },
      {
        "bubbleId": "507baef8-700a-4508-87e1-e408330b1bd6",
        "type": 2
      },
      {
        "bubbleId": "e833da1e-2e10-4fde-a9e6-c371a58e0103",
        "type": 2
      },
      {
        "bubbleId": "ed525f5b-b7b8-426c-b603-46a6a5ed46f8",
        "type": 2
      },
      {
        "bubbleId": "647c4030-f208-4c0b-b1ff-5bafa3a029be",
        "type": 2
      },
      {
        "bubbleId": "aaf691d3-77fe-4799-b2b8-fb98567dceea",
        "type": 2
      },
      {
        "bubbleId": "eb1a49ab-85b0-4699-992e-4a7291ba393e",
        "type": 2
      },
      {
        "bubbleId": "415c5a40-68c3-4f48-8304-6499a5ae0347",
        "type": 2
      },
      {
        "bubbleId": "a4e6ea3d-0424-45ec-880b-46a7139275ec",
        "type": 2
      },
      {
        "bubbleId": "71d87455-8295-4ff9-a8ff-6c6b88892654",
        "type": 2,
        "serverBubbleId": "33942a4f-2862-4ed2-958e-5bebf5ac4ebe"
      },
      {
        "bubbleId": "4349a3e5-8046-41a7-87af-03d57c881def",
        "type": 2
      },
      {
        "bubbleId": "9ccdc562-7bc6-48aa-a164-201e06035bfc",
        "type": 2
      },
      {
        "bubbleId": "351311fe-4f5c-4002-9913-77f6eaad7d6f",
        "type": 2
      },
      {
        "bubbleId": "175ef6ac-5076-41ef-9e47-72adca9ead0b",
        "type": 2
      },
      {
        "bubbleId": "9edcec84-1f7d-494f-a9ce-b15cf0f8d0e6",
        "type": 2
      },
      {
        "bubbleId": "0d10a232-9b0a-4a89-b604-15048b14071a",
        "type": 2
      },
      {
        "bubbleId": "a37317cc-1206-427b-8104-61fd1721bfe1",
        "type": 2
      },
      {
        "bubbleId": "a9e8ac2a-2466-4a0a-a4b6-ddecbf18665f",
        "type": 2
      },
      {
        "bubbleId": "98b50a76-ef61-47fb-8327-188bc8a18fdc",
        "type": 2,
        "serverBubbleId": "bddd2811-9883-4ba2-ad0c-ac9d0b5c39d7"
      },
      {
        "bubbleId": "d6065d8f-0d97-4049-ab67-86a882e8592d",
        "type": 2
      },
      {
        "bubbleId": "bcf3ed1c-a4d1-4d2b-bb51-4a8067c9c988",
        "type": 2
      },
      {
        "bubbleId": "6992906b-ba4f-4a23-8ede-761d13b06b28",
        "type": 2
      },
      {
        "bubbleId": "c6e243f2-2226-48e9-8452-91d2001847a9",
        "type": 2
      },
      {
        "bubbleId": "7db677b8-65e4-41c5-a93b-ab071bc14f89",
        "type": 2
      },
      {
        "bubbleId": "04dbf81e-bfbb-4630-86b9-8c914eebbce0",
        "type": 2
      },
      {
        "bubbleId": "fc29934e-2f47-4049-b195-62b19ee7027b",
        "type": 2
      },
      {
        "bubbleId": "d5784ebc-d8d7-48f1-9f7b-e2cdefb54db7",
        "type": 2
      },
      {
        "bubbleId": "e5c4e542-2a29-4a67-a6bc-c1a1f6bfd8f0",
        "type": 2
      },
      {
        "bubbleId": "e638306c-f145-4356-9cae-82a3a05a1500",
        "type": 2
      },
      {
        "bubbleId": "df0341f9-55de-4f24-8c6d-87a887fbee8b",
        "type": 2,
        "serverBubbleId": "c861670e-a3c9-4090-bfe5-8f6aa79f7e6e"
      },
      {
        "bubbleId": "a0f479e5-8dae-45b2-91fa-6a9dae59fb07",
        "type": 2
      },
      {
        "bubbleId": "40e9bd01-866c-46d7-a119-7b5d979e1f5e",
        "type": 2
      },
      {
        "bubbleId": "cb271990-8ca0-4e62-a0c3-4df3ca73aa25",
        "type": 2
      },
      {
        "bubbleId": "95f26d68-6d17-4de1-b367-0876883d53a1",
        "type": 2
      },
      {
        "bubbleId": "fc58027e-2798-49a7-b0ab-639d940cef92",
        "type": 2,
        "serverBubbleId": "61a94f4e-c837-4b96-b160-6826a37879ea"
      },
      {
        "bubbleId": "41958b09-be8b-4ee4-90f3-2189822c1aae",
        "type": 2
      },
      {
        "bubbleId": "ec50dbc0-dbd9-4836-96b1-aef4b58dbe5e",
        "type": 2
      },
      {
        "bubbleId": "3ecec6f3-a3d5-412c-8372-46d786cacd51",
        "type": 2,
        "serverBubbleId": "fe14f136-6f2e-44af-bec1-7710d11c8a6f"
      },
      {
        "bubbleId": "703e5ec1-dfa8-4038-ba5c-e19a9999a138",
        "type": 2
      },
      {
        "bubbleId": "aad2a871-7cd6-4724-a407-db7cdf106f4a",
        "type": 1
      },
      {
        "bubbleId": "8c2900c5-ca9d-41b2-90f1-b28485baaf79",
        "type": 2,
        "serverBubbleId": "566670a1-aea4-4c56-bc70-f064697878ba"
      },
      {
        "bubbleId": "6d3f9921-29c2-4204-949d-1cb5760391a4",
        "type": 2
      },
      {
        "bubbleId": "d4f56efc-6b49-460d-bfaa-3f1e1e2c02af",
        "type": 2
      },
      {
        "bubbleId": "8d9b4389-8320-4a00-8202-3e294f9a341b",
        "type": 2,
        "serverBubbleId": "f6ba51d7-6645-4bcb-bec7-1716a1a2ee48"
      },
      {
        "bubbleId": "5d3b1525-4822-449d-8c12-926891ad7d3d",
        "type": 2
      },
      {
        "bubbleId": "bb98f152-a9f5-414e-9446-2ab797f417a2",
        "type": 2
      },
      {
        "bubbleId": "b921defc-6373-4b1d-88a4-6b72fee460c1",
        "type": 2,
        "serverBubbleId": "652b70e6-c8f2-4d86-a18d-8826ac324789"
      },
      {
        "bubbleId": "7af6d270-572f-48fb-a75d-c13dc819c567",
        "type": 2
      },
      {
        "bubbleId": "6a103967-fc39-4914-aff7-258af2e67620",
        "type": 2
      },
      {
        "bubbleId": "e5e4f7af-7464-47ba-b880-f49c63c93cfd",
        "type": 2,
        "serverBubbleId": "059fe6cc-94a1-41de-9f47-5edff54ffa36"
      },
      {
        "bubbleId": "6ccfc7ac-fd06-43b2-87d5-7348ba62f770",
        "type": 2
      },
      {
        "bubbleId": "9c14244a-a3ad-4edc-a5d5-6186d6e6b8f2",
        "type": 1
      },
      {
        "bubbleId": "2281b0be-4c18-479d-b543-96893df5979e",
        "type": 2,
        "serverBubbleId": "28927bdd-e615-4449-be28-839a74404623"
      },
      {
        "bubbleId": "fc478fd4-3a66-41ad-af46-e214b51ace8e",
        "type": 2
      },
      {
        "bubbleId": "08b64155-172f-402a-8270-51bb453cf01c",
        "type": 2
      },
      {
        "bubbleId": "41acd770-fcc9-4afa-b0df-ebb05818e823",
        "type": 2
      },
      {
        "bubbleId": "3a23f1ad-60a6-451e-a9dd-e9895f780114",
        "type": 2
      },
      {
        "bubbleId": "44c86156-7def-4471-95fd-c99e8995e15a",
        "type": 2
      },
      {
        "bubbleId": "2185881c-9792-406b-8f4f-285c816260ef",
        "type": 2,
        "serverBubbleId": "f3c49a26-0a8a-45c6-8263-d3982096c479"
      },
      {
        "bubbleId": "89175495-c9d5-458d-81e4-696ba8da601d",
        "type": 2
      },
      {
        "bubbleId": "90f906b2-1d28-495b-8972-30113df0ef01",
        "type": 2
      },
      {
        "bubbleId": "bc15500a-ba9d-4e88-bde1-eb45a8177350",
        "type": 2
      },
      {
        "bubbleId": "e73c48a3-fc7b-4e96-8423-e63a01e659da",
        "type": 2
      },
      {
        "bubbleId": "f667d22c-8e2b-42ea-b2c4-f0b8432f6779",
        "type": 2
      },
      {
        "bubbleId": "d9acfaf9-e5fa-47fc-b21e-da933433ed90",
        "type": 2,
        "serverBubbleId": "791b6a16-cf9c-4afc-ba32-3dd0d00fe4a2"
      },
      {
        "bubbleId": "a8492e91-3a67-4459-87a1-1a8bb07ee1cf",
        "type": 2
      },
      {
        "bubbleId": "286b17df-418d-44e0-a416-8d359ebba644",
        "type": 2
      },
      {
        "bubbleId": "e00f399b-9347-45f8-9c78-53d3b7cab7bf",
        "type": 2
      },
      {
        "bubbleId": "7827ddb4-adf3-4e89-ba6e-7671b0fb129d",
        "type": 2
      },
      {
        "bubbleId": "35dab041-ae5d-4194-8a42-3b1b53893914",
        "type": 2
      },
      {
        "bubbleId": "217385eb-54fc-43bf-b8b2-98f529a009a4",
        "type": 2
      },
      {
        "bubbleId": "06e7f50b-ec6b-4967-9e5d-05cb65688480",
        "type": 2
      },
      {
        "bubbleId": "df2304d4-8120-4ce9-8c03-a50c597a2ca8",
        "type": 2,
        "serverBubbleId": "7c6ba2f1-852d-4b58-abd1-f9e916da74b1"
      },
      {
        "bubbleId": "9f0c6167-f983-4e88-af6a-80a6e4100d68",
        "type": 2
      },
      {
        "bubbleId": "0d0e4d81-db4c-43c8-8a15-1775e40f9692",
        "type": 2
      },
      {
        "bubbleId": "51c3768f-6c12-4ad9-958b-2e0862daab70",
        "type": 2
      },
      {
        "bubbleId": "35fe2f5c-d4e3-4236-8f1d-22c821836392",
        "type": 2
      },
      {
        "bubbleId": "1ad87727-4871-4443-a88f-7f1400c6e62d",
        "type": 2
      },
      {
        "bubbleId": "ce8caf5a-4738-49ac-bc3b-8ae40f6f64da",
        "type": 2,
        "serverBubbleId": "9578eb69-bb7f-4732-9be0-b44b0de3b14a"
      },
      {
        "bubbleId": "5757c968-8089-417d-9bb8-bf567d4d706a",
        "type": 2
      },
      {
        "bubbleId": "4c4b2815-e6cf-47b1-9e6d-888af05c440a",
        "type": 2
      },
      {
        "bubbleId": "de751228-5c61-4896-a8eb-3654b9a0f5fa",
        "type": 2
      },
      {
        "bubbleId": "dae47d9d-51af-425f-9216-c4e06aea0c79",
        "type": 2
      },
      {
        "bubbleId": "67b6e937-f956-42bd-a891-9752eca680f2",
        "type": 2,
        "serverBubbleId": "52053d8c-64d6-4fd5-9c64-39c6336efddd"
      },
      {
        "bubbleId": "3224ce4e-a203-4549-bfce-491bb77f28d5",
        "type": 2
      },
      {
        "bubbleId": "3300f0b0-0db2-428f-b906-c5c383af9546",
        "type": 1
      },
      {
        "bubbleId": "876c2939-3065-44a5-b39e-40a529e22354",
        "type": 2,
        "serverBubbleId": "56c88235-841a-4c34-ab2e-836014eae9e4"
      },
      {
        "bubbleId": "a88e5562-f345-4384-8afc-f571823ffdad",
        "type": 2
      },
      {
        "bubbleId": "26416aee-08b9-4fb4-95d3-08472af7108b",
        "type": 2
      },
      {
        "bubbleId": "3aa3ad3e-8267-4eb5-8fc0-86b5ced5c289",
        "type": 2,
        "serverBubbleId": "ca46f2c9-4b92-4060-975c-34b6b1e7e45b"
      },
      {
        "bubbleId": "fa13ee16-f537-485f-9ef6-8389d2ba5869",
        "type": 2
      },
      {
        "bubbleId": "5100cd63-b6fb-41e5-9c20-48db17ed585b",
        "type": 1
      },
      {
        "bubbleId": "7a537ba7-56be-4011-b003-767f7ed05d55",
        "type": 2,
        "serverBubbleId": "eafffb83-31a9-4773-a2e4-97f9a7196d75"
      },
      {
        "bubbleId": "1d091167-a8ad-4e72-b946-45c55f620050",
        "type": 2
      },
      {
        "bubbleId": "8bc7be5e-5435-4027-b953-faf4eb77cdb6",
        "type": 2
      },
      {
        "bubbleId": "62a30311-ab97-4fdf-a4ea-c506d6d7a30b",
        "type": 2,
        "serverBubbleId": "f97949d3-8639-4ed0-bd92-2ddc228bb180"
      },
      {
        "bubbleId": "2a47fb25-84e0-4a04-810d-33ccddb8af12",
        "type": 2
      },
      {
        "bubbleId": "4a5c1606-6636-4f46-81c2-b4ffd35edb97",
        "type": 2
      },
      {
        "bubbleId": "1c586415-819e-4c5c-9929-8a2eac064e1c",
        "type": 2,
        "serverBubbleId": "21bff84d-8a7b-4f35-a79a-b973cc662ac0"
      },
      {
        "bubbleId": "27136101-f942-4c4c-ab86-c267be52a373",
        "type": 2
      },
      {
        "bubbleId": "34a36751-07b9-416d-91ca-7069d3ca3f2c",
        "type": 2
      },
      {
        "bubbleId": "522eafd5-1e84-4bee-b54f-1b293d6e6162",
        "type": 2,
        "serverBubbleId": "2f7ed461-fc03-4011-bf68-a43b6868aa5f"
      },
      {
        "bubbleId": "5a66fe98-964d-4979-9d70-b11eb5a1b830",
        "type": 2
      },
      {
        "bubbleId": "893cd925-efa7-4c48-9761-a469525a32c9",
        "type": 1
      },
      {
        "bubbleId": "102b22b0-d028-479a-889e-882f448baab9",
        "type": 2,
        "serverBubbleId": "5c4e406e-d6ae-4da4-aaac-328d23b3077b"
      },
      {
        "bubbleId": "513ce353-9602-42bd-be32-0b6c4d1d1f2f",
        "type": 2
      },
      {
        "bubbleId": "fedb5eed-0505-4720-af42-841dcd811c3c",
        "type": 2
      },
      {
        "bubbleId": "b2d2cc78-dba6-40b8-9599-f24b4b1b597f",
        "type": 2
      },
      {
        "bubbleId": "4088a3bc-d0ec-4be7-bd25-6d22495717eb",
        "type": 2
      },
      {
        "bubbleId": "6951e542-8800-4686-ae74-6084de56efb7",
        "type": 2
      },
      {
        "bubbleId": "5fcff397-c353-4bb8-bb85-334206a1ab6d",
        "type": 2,
        "serverBubbleId": "ea4e2547-52ad-4640-9037-9bf537540574"
      },
      {
        "bubbleId": "8e89dfa0-c012-46f8-a57d-7a68f271bc8e",
        "type": 2
      },
      {
        "bubbleId": "3804118e-970e-45b1-b7cc-5cded47b19c5",
        "type": 2
      },
      {
        "bubbleId": "a9aa18bd-c6ff-492e-9189-3c288ee485c4",
        "type": 2
      },
      {
        "bubbleId": "17e64213-4dd9-4230-a2a6-ea2fcdd8be99",
        "type": 2
      },
      {
        "bubbleId": "2270ada2-e529-4560-9806-e8bc0dc04e59",
        "type": 2
      },
      {
        "bubbleId": "e3f595ed-9845-40ca-97da-29f94432a823",
        "type": 2
      },
      {
        "bubbleId": "7c0e0259-21cb-4688-a772-3a95777e0ade",
        "type": 2,
        "serverBubbleId": "28a50271-4ac8-46a0-a67b-867a94f6044b"
      },
      {
        "bubbleId": "9feef77e-0fe2-4a7a-b314-a7d899f3db0e",
        "type": 2
      },
      {
        "bubbleId": "4dc40218-58f2-4777-ac80-3fecafd0c964",
        "type": 2
      },
      {
        "bubbleId": "622c482a-7bf9-43e5-8763-362162452c8c",
        "type": 2
      },
      {
        "bubbleId": "1af5d968-6455-4e0c-8e39-05b8d5586ef1",
        "type": 2
      },
      {
        "bubbleId": "c66e79c6-c2ba-4bde-b440-70872e20dd70",
        "type": 2,
        "serverBubbleId": "8d34d383-b9a1-4586-8f3b-9dd9680c193b"
      },
      {
        "bubbleId": "a7f2d5da-c48d-4f7f-aa3e-589f4e7f9905",
        "type": 2
      },
      {
        "bubbleId": "3df4fa01-88e0-4241-8e0f-1ed4c1136620",
        "type": 1
      },
      {
        "bubbleId": "fbfdd99d-ad35-475e-87e3-8c0713d6db2b",
        "type": 2,
        "serverBubbleId": "51bbd557-b2ab-4be9-a6a1-f6ef5bf6a2ce"
      },
      {
        "bubbleId": "7d2892f4-2ee4-4cef-a8e0-af4f25d7439c",
        "type": 2
      },
      {
        "bubbleId": "9e2e9ab7-45ef-46cb-a3c3-3bff082b7822",
        "type": 2
      },
      {
        "bubbleId": "dfd5f7b6-bf28-4b03-80de-c4c72065f88b",
        "type": 2,
        "serverBubbleId": "b5b36240-7d19-4a27-b4cc-cd93b398ff28"
      },
      {
        "bubbleId": "18c84e32-30c8-41f0-a5e8-f8004db1764a",
        "type": 2
      },
      {
        "bubbleId": "75a1ca41-25d4-43a6-be47-a1ba00052d15",
        "type": 1
      },
      {
        "bubbleId": "fe16180a-9d64-4a48-8ffe-da1843aaaaaf",
        "type": 2,
        "serverBubbleId": "b43f02a1-ba10-4ce7-8f63-383b5fc7c511"
      },
      {
        "bubbleId": "b821e9b5-dc6a-4ad6-a2c8-7e6c43e1cae0",
        "type": 2
      },
      {
        "bubbleId": "31307a59-d7f9-4a9f-b989-d49e6350bbab",
        "type": 2
      },
      {
        "bubbleId": "d27cb7a1-4ad3-41a8-94f2-21e8a3282941",
        "type": 2
      },
      {
        "bubbleId": "1a02fa32-a648-4705-83e1-6c2fdd6378ab",
        "type": 2,
        "serverBubbleId": "505648a3-730f-4979-bb0a-9843eef09ef7"
      },
      {
        "bubbleId": "c4eda769-76c0-4b7e-88d0-a727d6b421e3",
        "type": 2
      },
      {
        "bubbleId": "b953a246-269c-4129-941a-c82e56288fe2",
        "type": 2
      },
      {
        "bubbleId": "ba94e587-55cc-4b77-9dc4-11a5e4dccc1c",
        "type": 2,
        "serverBubbleId": "61f1dec1-88c1-4987-a920-c40c588d97e9"
      },
      {
        "bubbleId": "ee3e0315-46d9-41f1-af0a-50c3c0cefe77",
        "type": 2
      },
      {
        "bubbleId": "7b43f1e2-4c54-4b12-9590-29b4d330e434",
        "type": 2
      },
      {
        "bubbleId": "bdbf975a-83f6-4ab4-8a1d-32d50ba6b5f6",
        "type": 2,
        "serverBubbleId": "8d9c9e82-b0e1-4a15-9355-b442caa2f8e8"
      },
      {
        "bubbleId": "7ac7196e-5029-4aaf-b9db-34180e202595",
        "type": 2
      },
      {
        "bubbleId": "0fc7d883-9273-4969-961d-d57e119083cd",
        "type": 1
      },
      {
        "bubbleId": "7e61e788-7c98-4acc-ab14-671b6a86650d",
        "type": 2,
        "serverBubbleId": "4a612124-2ece-4898-be14-5a80cec626e8"
      },
      {
        "bubbleId": "26e73b2d-125d-4f4f-939a-813603ad192b",
        "type": 2
      },
      {
        "bubbleId": "a099ea57-e703-4d74-9475-24d03781023c",
        "type": 2
      },
      {
        "bubbleId": "1fe73808-983c-4874-875e-411f9daaf0b0",
        "type": 2
      },
      {
        "bubbleId": "b53b32aa-5d50-455a-a1bf-174ff9dd2052",
        "type": 2
      },
      {
        "bubbleId": "36ce44af-435e-4aa0-b537-21f51da7ef3e",
        "type": 2,
        "serverBubbleId": "9feb93e9-f7de-4f8d-8095-b0b5e3491076"
      },
      {
        "bubbleId": "45b27021-cb5c-481c-a989-9d127f5002ba",
        "type": 2
      },
      {
        "bubbleId": "426ff598-173c-48fd-a966-fdb55624c2c2",
        "type": 2
      },
      {
        "bubbleId": "f170b7db-1b6d-49fa-a382-a183670fcbdf",
        "type": 2
      },
      {
        "bubbleId": "16a810d4-49fc-453d-aaed-15a60cc16adc",
        "type": 2
      },
      {
        "bubbleId": "ff827f69-2707-4648-a28b-0e50bbc2d999",
        "type": 2,
        "serverBubbleId": "0b10b760-efa8-4102-be11-e268a4f63583"
      },
      {
        "bubbleId": "582c1b78-e924-4577-bc69-4eede81479a3",
        "type": 2
      },
      {
        "bubbleId": "1094e051-d7cc-4d67-a55b-ad7683e42670",
        "type": 2
      },
      {
        "bubbleId": "1288741c-e14d-4c31-b5ff-46949e2b820f",
        "type": 2,
        "serverBubbleId": "703656e6-4e33-4da4-b2de-72a20710d5f2"
      },
      {
        "bubbleId": "7bda2397-d019-4145-8e62-37929571f045",
        "type": 2
      },
      {
        "bubbleId": "44aaea86-c8ef-4cbe-9f05-a777f6f1ebb8",
        "type": 2
      },
      {
        "bubbleId": "d3558d91-6393-478e-9b29-9a44bf354d4d",
        "type": 2
      },
      {
        "bubbleId": "fcc6d510-e784-4db4-8e8e-691fa801a113",
        "type": 2,
        "serverBubbleId": "b6a63463-9e2b-4cf0-bc92-775a2de84b48"
      },
      {
        "bubbleId": "af5d25be-647f-45d5-b730-20437086a7f5",
        "type": 2
      },
      {
        "bubbleId": "f73df333-4f7a-431b-a5a1-71d26cb5fbd4",
        "type": 2
      },
      {
        "bubbleId": "9d8b2269-45f1-4765-b3b9-deef1631e0e1",
        "type": 2,
        "serverBubbleId": "59c576f5-03f4-430a-9aee-f301cb29d470"
      },
      {
        "bubbleId": "85651a4c-b2c2-4eff-9a13-4a58baedcc20",
        "type": 2
      },
      {
        "bubbleId": "f5156c45-cdf1-4030-81a9-389b70f4d9ab",
        "type": 2
      },
      {
        "bubbleId": "dfffe786-a238-413f-b285-0261b68891be",
        "type": 2,
        "serverBubbleId": "ebc60695-ab37-4fd3-819a-c18a6ed4f5fc"
      },
      {
        "bubbleId": "d8cfd1df-dea3-425b-9f63-73e2d1adad11",
        "type": 2
      },
      {
        "bubbleId": "85f2291b-4e35-44c5-9814-25fbe815d851",
        "type": 2
      },
      {
        "bubbleId": "a0505f35-115d-45b4-ae2b-8cb9ef025c34",
        "type": 2,
        "serverBubbleId": "90e77db5-f0c8-44d4-b80c-ab4408897d6f"
      },
      {
        "bubbleId": "55d4fb25-d892-4d9f-b6a7-3006c1c8d28b",
        "type": 2
      },
      {
        "bubbleId": "ccbdd537-bad8-4a4c-b2f2-c777fb5891c1",
        "type": 2
      },
      {
        "bubbleId": "6b9a699f-c0da-4c98-a5d6-e48217b6b378",
        "type": 2,
        "serverBubbleId": "ebd8c176-12af-49d0-b03b-5184e32b11e5"
      },
      {
        "bubbleId": "eb5e09cf-4543-4506-a111-f2cefa2dd5b4",
        "type": 2
      },
      {
        "bubbleId": "7957074e-f274-446e-8d70-4b2dedffe68f",
        "type": 2
      },
      {
        "bubbleId": "b0dbb9e5-d8e0-4f25-96ae-ce46ccec7257",
        "type": 2,
        "serverBubbleId": "6e2c11f3-b827-43ae-a74a-a3754cd54035"
      },
      {
        "bubbleId": "749895cf-1002-407d-8417-9a6fb6f7588a",
        "type": 2
      },
      {
        "bubbleId": "bd3ba23f-dc5f-41ee-84ae-81185af0491c",
        "type": 2
      },
      {
        "bubbleId": "741215d5-0f1d-49ab-9d45-673f3513ffa0",
        "type": 2
      },
      {
        "bubbleId": "8461b377-26d2-4de3-870a-d1b4c1589203",
        "type": 2,
        "serverBubbleId": "ebf7d3c5-a1f1-4460-a689-f96aaf549086"
      },
      {
        "bubbleId": "32c1fd2a-ec89-4f10-89d9-19307b96b39d",
        "type": 2
      },
      {
        "bubbleId": "6e4dd5bf-ed44-4af6-ab3f-151a9ee987f0",
        "type": 2
      },
      {
        "bubbleId": "60f42b3f-a2fc-47c4-a631-3b4fe0517698",
        "type": 2,
        "serverBubbleId": "1c9b2150-02e3-4d5d-b825-410f87bf8a6f"
      },
      {
        "bubbleId": "75c7d385-a8b8-4310-8cd5-95e5089fe089",
        "type": 2
      },
      {
        "bubbleId": "cb5c8cd7-c20c-4757-ba41-2da4d2e1ce83",
        "type": 2
      },
      {
        "bubbleId": "669eb96f-b368-44f0-bc89-21060566afd7",
        "type": 2,
        "serverBubbleId": "5c67048f-cb6e-4eed-9e02-37aaeddab1e1"
      },
      {
        "bubbleId": "05d46bb7-2991-406a-a7b4-57357764d8e3",
        "type": 2
      },
      {
        "bubbleId": "4c753dd6-8adc-4be7-85ef-3df7d158ef8f",
        "type": 2
      },
      {
        "bubbleId": "c172999c-1bfe-4e3c-8673-133c14ed3065",
        "type": 2,
        "serverBubbleId": "724fb943-cff6-4f5b-9f5d-1f13275a04db"
      },
      {
        "bubbleId": "c9a35f4b-5e57-4952-95d6-d89818962ced",
        "type": 2
      },
      {
        "bubbleId": "d4c91eb9-9f84-4fb6-bf7f-64e9e7edb5de",
        "type": 2
      },
      {
        "bubbleId": "c9a5b5d8-4a39-4753-8501-de5074a57fec",
        "type": 2,
        "serverBubbleId": "bc15a384-5f60-46ea-8430-b0c6b2a0e2ce"
      },
      {
        "bubbleId": "1af6fa78-5f8e-4af0-9b39-fc5dd4d50c2e",
        "type": 2
      },
      {
        "bubbleId": "146e58f8-e5b5-4045-939f-562e91bdd11f",
        "type": 2
      },
      {
        "bubbleId": "ca3951df-1677-43e1-bf9a-d7135b89abb0",
        "type": 2,
        "serverBubbleId": "6d2c89ce-8099-4fd7-ac76-c5fe48d70004"
      },
      {
        "bubbleId": "50889d8a-25cd-404d-b927-32c3eab576f8",
        "type": 2
      },
      {
        "bubbleId": "efa77db9-00f0-4cba-9fa1-d2ac245976ce",
        "type": 1
      },
      {
        "bubbleId": "e50a8bc7-f8f5-49d4-b5a3-d8ea2c1d66f1",
        "type": 2,
        "serverBubbleId": "abdde3f0-8645-45c2-b3ac-18302a906291"
      },
      {
        "bubbleId": "e67e2ed1-e1e5-472b-a3ef-556052768d35",
        "type": 2
      },
      {
        "bubbleId": "89060807-6f73-4e8b-b629-53257384c16e",
        "type": 2
      },
      {
        "bubbleId": "6c5bdca7-51ae-4481-9861-38bd09ad147e",
        "type": 2
      },
      {
        "bubbleId": "4d957daf-b3d9-4ee4-9382-9bf0cb94df4d",
        "type": 2,
        "serverBubbleId": "e8adf558-faef-43d1-ab97-2801dc069972"
      },
      {
        "bubbleId": "3679aa1d-9720-4d75-aa00-5c77418d39f0",
        "type": 2
      },
      {
        "bubbleId": "b4fb2198-7c58-468a-93dc-67f12c5061dc",
        "type": 2
      },
      {
        "bubbleId": "4387bf54-7d4e-4db1-8ed8-65de53e393ef",
        "type": 2
      },
      {
        "bubbleId": "65fe044d-1b55-4e2a-b379-77c05e1b3ef9",
        "type": 2,
        "serverBubbleId": "60b46014-d63f-4016-89cf-fe9ec7d9d16e"
      },
      {
        "bubbleId": "407b125d-eefe-4ea0-886a-b21fe9635d5f",
        "type": 2
      },
      {
        "bubbleId": "3044f6d9-f23a-4b10-8daf-590a3d8b58ab",
        "type": 2
      },
      {
        "bubbleId": "81f674d8-8d4f-499a-808e-11b2d3b29462",
        "type": 2
      },
      {
        "bubbleId": "00016469-3827-496a-b50b-132b32b5bfcf",
        "type": 2,
        "serverBubbleId": "068f068a-e7cb-4236-8164-b4021dc42932"
      },
      {
        "bubbleId": "fb41efc9-b6ca-42a7-9645-b74326e49c76",
        "type": 2
      },
      {
        "bubbleId": "f5dee448-d37e-43da-972e-ee687db917b7",
        "type": 2
      },
      {
        "bubbleId": "7ce863a9-ce68-4eb1-a595-0e8f12594c77",
        "type": 2
      },
      {
        "bubbleId": "1f1b3283-76a4-43e2-b1ee-afd53fdfedec",
        "type": 2,
        "serverBubbleId": "59aa52f7-f4c0-436d-b131-a7d82ef0c759"
      },
      {
        "bubbleId": "53c65e22-d2e5-48f0-be84-8db58b922b93",
        "type": 2
      },
      {
        "bubbleId": "93782c5f-eb7e-4b8c-90e8-d143ba0de28d",
        "type": 2
      },
      {
        "bubbleId": "91c6ffff-e85b-435d-b532-c45b6c32151f",
        "type": 2
      },
      {
        "bubbleId": "5da0cf04-e7ba-4ef8-8719-ff3d8a719706",
        "type": 2,
        "serverBubbleId": "4e8f72d9-26b5-42dc-8ccc-c61c9daee434"
      },
      {
        "bubbleId": "2853aa06-9038-494d-9870-6b263df287a5",
        "type": 2
      },
      {
        "bubbleId": "1e8c200f-d705-4b27-b278-bc6e8b07988a",
        "type": 2
      },
      {
        "bubbleId": "25068672-3503-427d-bab9-598548020e5c",
        "type": 2
      },
      {
        "bubbleId": "6935d107-fe81-4272-9bfd-098f5fbc8be6",
        "type": 2,
        "serverBubbleId": "4eb9495d-0d63-4010-9346-b1b67ab50b00"
      },
      {
        "bubbleId": "dc0a2103-4e7b-44ed-9354-ee0daaa9e749",
        "type": 2
      },
      {
        "bubbleId": "d0320e1c-b660-4b34-8335-be5767ffba0f",
        "type": 2
      },
      {
        "bubbleId": "b238af48-2c1c-4655-8fa6-9dfd2c4ce5e0",
        "type": 2
      },
      {
        "bubbleId": "1328c69e-8712-4ca8-a259-284275006414",
        "type": 2,
        "serverBubbleId": "75a53914-d24e-48e2-abb4-bcbc91067463"
      },
      {
        "bubbleId": "cd1c91e5-0796-482e-a056-a3eda7e7133e",
        "type": 2
      },
      {
        "bubbleId": "49f8b1f5-c962-4220-a70c-b27004d72b93",
        "type": 2
      },
      {
        "bubbleId": "d96c9d32-af53-4e8e-9b5b-4a1a63ca6d7a",
        "type": 2
      },
      {
        "bubbleId": "40191e67-8225-414f-95f0-31999c44a539",
        "type": 2,
        "serverBubbleId": "6ce15ae2-2bd6-4c30-942e-6186e56bbece"
      },
      {
        "bubbleId": "2ead1848-121c-4152-9a82-afb025f4f41a",
        "type": 2
      },
      {
        "bubbleId": "addec977-c25e-4f90-95a4-430371fe874e",
        "type": 2
      },
      {
        "bubbleId": "28bb1924-ad1c-4bea-a043-e56230910239",
        "type": 2
      },
      {
        "bubbleId": "3f252497-c391-486d-b50f-1979dd81f3f2",
        "type": 2
      },
      {
        "bubbleId": "1b03aa3e-f0e6-46f2-8410-d274b99f2277",
        "type": 2,
        "serverBubbleId": "29fc0d83-0fcf-47e3-b37c-177d6f3ce4c3"
      },
      {
        "bubbleId": "1437cea3-1ca8-4a98-a276-c56ec20e8947",
        "type": 2
      },
      {
        "bubbleId": "1b51dd6d-e1f4-46c9-908a-4ad194a40139",
        "type": 2
      },
      {
        "bubbleId": "6b0504a8-8239-4d4e-b09a-64af084099df",
        "type": 2
      },
      {
        "bubbleId": "0e4eed24-2315-4f01-a186-beaad43c216f",
        "type": 2
      },
      {
        "bubbleId": "2903c7a0-9256-4c19-98c7-0106e1469f38",
        "type": 2,
        "serverBubbleId": "fadc77dc-b481-4419-939f-b2706c204e6e"
      },
      {
        "bubbleId": "7944b389-524b-44c2-a285-aadbf0b21f5b",
        "type": 2
      },
      {
        "bubbleId": "affae711-e5f0-4a17-b236-6ad127e5414f",
        "type": 2
      },
      {
        "bubbleId": "b5537258-10ce-4675-b181-ca7cbcddb4c4",
        "type": 2
      },
      {
        "bubbleId": "8949887e-2b78-4741-9ae5-350fadc93032",
        "type": 2,
        "serverBubbleId": "0b5883b1-3399-4c58-b3a0-471a19ebce97"
      },
      {
        "bubbleId": "bcf87f6f-c759-4bce-9043-54ae516625c3",
        "type": 2
      },
      {
        "bubbleId": "0db19650-c308-46df-bdf4-9f64335d4913",
        "type": 2
      },
      {
        "bubbleId": "c07111c8-f9ec-460b-9a02-3aa5b8bdcad6",
        "type": 2,
        "serverBubbleId": "29f5a8ed-2dec-4f76-a5e6-3ad3c24ede26"
      },
      {
        "bubbleId": "ea27382e-27d3-4ddc-9a14-e49f4b12ae76",
        "type": 2
      },
      {
        "bubbleId": "f3710312-388e-434b-b654-5b53f3c36fe8",
        "type": 2
      },
      {
        "bubbleId": "82a2c6dc-a917-4da2-b13e-63f28b3fdc11",
        "type": 2
      },
      {
        "bubbleId": "663f68c4-2fb3-4e12-99de-36eb23bc37bd",
        "type": 2,
        "serverBubbleId": "30f10c30-55a1-4be8-a96c-20c76bef3820"
      },
      {
        "bubbleId": "5e021c4f-442d-4b4d-ae8a-77fc74748f23",
        "type": 2
      },
      {
        "bubbleId": "8f58c367-d4b9-4cc5-8a1d-d806abe58f74",
        "type": 2
      },
      {
        "bubbleId": "8828dfd1-8778-4909-a69a-f98c10e63402",
        "type": 2,
        "serverBubbleId": "bd8be482-b2b2-4b19-b92a-74baf1b4bfa6"
      },
      {
        "bubbleId": "938f7872-9ce8-4efe-a613-183a1cdb74c8",
        "type": 2
      },
      {
        "bubbleId": "daeac9d3-036f-4e9e-b18d-37606f2e21d2",
        "type": 2
      },
      {
        "bubbleId": "3d99d67f-1832-4b09-a20c-0971d706efe2",
        "type": 2,
        "serverBubbleId": "d50cb4c6-3b86-4f99-ba1a-fd122aa37f45"
      },
      {
        "bubbleId": "b779eded-3c03-490f-8951-1dd174b487e3",
        "type": 2
      },
      {
        "bubbleId": "24afac70-a2b5-4071-9f84-5121fb50072a",
        "type": 2
      },
      {
        "bubbleId": "cd4d3025-203c-4b76-b476-4090019f099b",
        "type": 2
      },
      {
        "bubbleId": "935d6128-9617-4763-b7b6-a06778d28d8f",
        "type": 2,
        "serverBubbleId": "979d2ecb-e2df-46a2-8231-41471f3079c8"
      },
      {
        "bubbleId": "0b118787-c3c2-44bd-bca7-be3847dd8863",
        "type": 2
      },
      {
        "bubbleId": "3b3de2cc-5033-4b1c-83e3-d654d6487a6f",
        "type": 1
      },
      {
        "bubbleId": "005502ac-80ac-454f-ab02-2846c20031df",
        "type": 2,
        "serverBubbleId": "3946673b-9d22-41ec-bb51-6080839fd7bb"
      },
      {
        "bubbleId": "50970b5e-6aaa-49dc-b3bd-79938614e054",
        "type": 2
      },
      {
        "bubbleId": "309fb9e5-64ee-45e9-8c47-166336cfd1cd",
        "type": 2
      },
      {
        "bubbleId": "56514414-cb53-4aeb-8a85-8998b5980eb1",
        "type": 2
      },
      {
        "bubbleId": "8a3f15b1-f6f7-473f-944a-71c9faf94ef7",
        "type": 2,
        "serverBubbleId": "b3e92ae6-927f-4269-bf15-95f1ada46e87"
      },
      {
        "bubbleId": "10d7780b-d97e-4397-a980-de7062816b2a",
        "type": 2
      },
      {
        "bubbleId": "a349c2da-756c-4a7c-9fb2-ba8a341adcc2",
        "type": 2
      },
      {
        "bubbleId": "e1bfb623-c8df-4e65-aa11-1150d093a668",
        "type": 2
      },
      {
        "bubbleId": "9c2bd283-0113-4acf-9674-8832b4658e05",
        "type": 2
      },
      {
        "bubbleId": "d5a19399-4b36-4c9b-ba64-7c541229b1c4",
        "type": 2,
        "serverBubbleId": "06457dea-27bd-4927-b57a-64478f590238"
      },
      {
        "bubbleId": "df9a655a-3dc9-4520-be4f-733f04460973",
        "type": 2
      },
      {
        "bubbleId": "f3e3a882-7c0b-4f9b-bae6-e0d2c82fc8cd",
        "type": 2
      },
      {
        "bubbleId": "2e424fde-ab20-4ee7-a25d-366166fa398b",
        "type": 2
      },
      {
        "bubbleId": "6624aa1a-7b37-4d25-b341-2ee7493d3bbe",
        "type": 2,
        "serverBubbleId": "72d6a899-7f89-4947-8ff2-04f5a674d1ca"
      },
      {
        "bubbleId": "3c3491a3-8899-4b01-807b-f3886fb07de4",
        "type": 2
      },
      {
        "bubbleId": "9ea60aa3-7ac3-4d59-91f7-fce766e319dd",
        "type": 1
      },
      {
        "bubbleId": "17fc5a44-0b03-4a3f-a4e2-a7647e4d5d5f",
        "type": 2,
        "serverBubbleId": "4a6a07b8-a043-44de-8730-31dd6d403afc"
      },
      {
        "bubbleId": "c5bb214e-2732-4c1b-b0f7-a38f2ed17612",
        "type": 2
      },
      {
        "bubbleId": "dc938b1e-b372-46af-b0bf-41be41803eb0",
        "type": 2
      },
      {
        "bubbleId": "087ad1cd-1b94-44be-b354-cd3d097b2a18",
        "type": 2
      },
      {
        "bubbleId": "4a6b587d-43d8-4b52-8b0c-27b2c9cbc829",
        "type": 2,
        "serverBubbleId": "8041d8fa-c169-4d1d-a3a5-b7bb9394c8d2"
      },
      {
        "bubbleId": "d861a305-e11f-48e7-8d3c-88710b04218f",
        "type": 2
      },
      {
        "bubbleId": "e15e1d1d-861b-4e66-8c5d-f374007d22cb",
        "type": 2
      },
      {
        "bubbleId": "bc6a4760-7ecd-4810-9eb2-6ca461695f84",
        "type": 2
      },
      {
        "bubbleId": "c5798b78-c5e2-44b6-a805-6925fc7947a0",
        "type": 2,
        "serverBubbleId": "4a5101b2-ee44-448c-ab2c-8b43d589ea1c"
      },
      {
        "bubbleId": "127e2297-bc85-4812-bd62-9ae9bd301a4a",
        "type": 2
      },
      {
        "bubbleId": "85069e90-d3da-4df1-ab9b-4f3a69759654",
        "type": 2
      },
      {
        "bubbleId": "9c933d80-56ae-41e4-9f7e-a19610e0f67e",
        "type": 2
      },
      {
        "bubbleId": "abed4230-7226-44f7-a8ff-0abf87f7a581",
        "type": 2,
        "serverBubbleId": "8f74f8c5-d2b7-4c10-aadd-cbee66a7a4ac"
      },
      {
        "bubbleId": "02754064-c1f9-4796-b62e-c2677dd43dab",
        "type": 2
      },
      {
        "bubbleId": "7307493e-5ca3-433f-94e4-fc9e5d12fd78",
        "type": 2
      },
      {
        "bubbleId": "a18dbaff-696d-4ce8-9099-7122f9a1ca10",
        "type": 2
      },
      {
        "bubbleId": "de843899-1049-4ca7-9825-3470467e359b",
        "type": 2
      },
      {
        "bubbleId": "207c6674-e7a7-4ac3-a120-e658900d18e9",
        "type": 2,
        "serverBubbleId": "07542857-09b1-4289-9e19-a746b0f58110"
      },
      {
        "bubbleId": "968bbc05-df8e-4532-8d9a-8624968b28ce",
        "type": 2
      },
      {
        "bubbleId": "b4fcf342-8e5c-4606-a173-c7962cbe7598",
        "type": 2
      },
      {
        "bubbleId": "48df736a-a70d-42f2-b719-d51cf31426b4",
        "type": 2
      },
      {
        "bubbleId": "df06cb8f-e855-4dc9-af36-196436a8ffe0",
        "type": 2
      },
      {
        "bubbleId": "c6131852-0353-4659-b696-23c131313a61",
        "type": 2,
        "serverBubbleId": "e76ef2ca-ca2d-4e4e-a747-6be0b86bcbbe"
      },
      {
        "bubbleId": "302a4fa8-812c-4707-933f-52290231aa87",
        "type": 2
      },
      {
        "bubbleId": "267e3245-5b8b-4fa3-bb89-8a07d371c9cd",
        "type": 2
      },
      {
        "bubbleId": "97bcc578-d52d-4089-bdf5-1d81b8f09689",
        "type": 2
      },
      {
        "bubbleId": "5c31ab3a-33e0-432c-b5c0-e12f3ef915fe",
        "type": 2,
        "serverBubbleId": "a29101da-2642-4c87-83ce-e9e32b2fb57a"
      },
      {
        "bubbleId": "22898cf1-9f3c-47e2-86d2-2252712577f4",
        "type": 2
      },
      {
        "bubbleId": "c40f5d69-0480-4a6f-ae2d-e4da0a7c3996",
        "type": 2
      },
      {
        "bubbleId": "00ae8ede-8f86-4fb5-8c65-bccfd4a50ad7",
        "type": 2
      },
      {
        "bubbleId": "a2044556-0a80-41cc-8d29-dbf74c944577",
        "type": 2,
        "serverBubbleId": "1d379bc9-1821-4590-9b4a-d409970cea36"
      },
      {
        "bubbleId": "c796c1cf-df11-4124-a1c6-216e74fc0b62",
        "type": 2
      },
      {
        "bubbleId": "dbf3cbc5-ebc2-43bf-8e39-e40cf9f2de88",
        "type": 2
      },
      {
        "bubbleId": "e52553ff-2381-4727-adea-d1735cbe7548",
        "type": 2
      },
      {
        "bubbleId": "77ef33c7-7c4d-463f-aea0-aaf674ee0294",
        "type": 2
      },
      {
        "bubbleId": "4c11c5a7-4fb0-40f8-a6a6-a7abb3d26505",
        "type": 2,
        "serverBubbleId": "9b167ff0-5bbc-4148-a68a-664efaeb8301"
      },
      {
        "bubbleId": "868c1d83-09f2-46b7-b451-df327da6eaf7",
        "type": 2
      },
      {
        "bubbleId": "d49016a7-bb17-4f2d-b911-2b3f66ada2c7",
        "type": 2
      },
      {
        "bubbleId": "795bb79b-cf8a-45ad-b627-79e15066c3f3",
        "type": 2,
        "serverBubbleId": "7831d06d-5d1e-408c-a71c-34b59558e723"
      },
      {
        "bubbleId": "e953490d-8027-4a77-a97d-26a5a9f0a04b",
        "type": 2
      },
      {
        "bubbleId": "7cd299f5-7aa9-4412-b73a-b70833662fc5",
        "type": 2
      },
      {
        "bubbleId": "b5ab68ac-9d6d-4cb9-9d7c-18618aeb6fd2",
        "type": 2,
        "serverBubbleId": "44bfa2cd-1e42-4243-9c62-0c6c8404e703"
      },
      {
        "bubbleId": "1d36f7c0-97ec-49e1-a1ba-85562695963e",
        "type": 2
      },
      {
        "bubbleId": "3f6d1e3a-c982-40dd-93aa-23c184426c38",
        "type": 2
      },
      {
        "bubbleId": "96a141a0-61f2-4038-a14f-605d04421dca",
        "type": 2
      },
      {
        "bubbleId": "89353818-548d-46d3-bfd6-64941f4f4531",
        "type": 2
      },
      {
        "bubbleId": "7d412934-b1c2-4a23-945e-53787d18a669",
        "type": 2,
        "serverBubbleId": "236b4f29-c672-44d4-aa7f-358299fc72fb"
      },
      {
        "bubbleId": "d5c01129-ff7c-4c9c-85a1-44199125bf12",
        "type": 2
      },
      {
        "bubbleId": "087d2ba7-f69d-4c5b-bc66-f7fc4a966388",
        "type": 1
      },
      {
        "bubbleId": "dffc2d62-ff00-452a-8fb7-6fcc0b5dfe0c",
        "type": 2,
        "serverBubbleId": "87fbb0f3-2232-47b8-b603-1b526587976a"
      },
      {
        "bubbleId": "ebdca2b5-ae95-4728-b8b0-9cf85cbecfa8",
        "type": 2
      },
      {
        "bubbleId": "d2fc7f6d-e6c1-4791-a785-0721eaa4b6ef",
        "type": 2
      },
      {
        "bubbleId": "df93ad5a-6b3f-4d25-8d79-cb8a5be9c4ca",
        "type": 2
      },
      {
        "bubbleId": "8d2b1826-a6d2-4632-b300-5369bcd9d808",
        "type": 2
      },
      {
        "bubbleId": "2bc8dfe8-e561-47d3-8f05-8f319dc86c27",
        "type": 2,
        "serverBubbleId": "7ef81cf6-4ce7-48c3-9895-61794767cc74"
      },
      {
        "bubbleId": "588c67ee-d3ad-448c-aa20-b51398d5cd2c",
        "type": 2
      },
      {
        "bubbleId": "484072ec-18ef-4dcb-bcbe-be499800a91c",
        "type": 2
      },
      {
        "bubbleId": "fbfc979c-ffde-4efa-bc2e-e20dd3bb5152",
        "type": 2
      },
      {
        "bubbleId": "2b1872bf-f23e-4274-9467-3692e4a03600",
        "type": 2
      },
      {
        "bubbleId": "b5e737d1-41ad-4e8c-8f10-7be346da8150",
        "type": 2,
        "serverBubbleId": "e1c253ea-85d1-4607-a4dc-b03fd56bb8d5"
      },
      {
        "bubbleId": "8e7ec7ed-86cb-4367-ac70-a2e280a5a3a6",
        "type": 2
      },
      {
        "bubbleId": "620fc29b-1e27-4fec-a2e0-b172116a8c4c",
        "type": 2
      },
      {
        "bubbleId": "7e3ae49c-6782-45a7-a044-ecad65c5dc13",
        "type": 2
      },
      {
        "bubbleId": "2aabfeaa-7d19-4301-9731-ba89b08aa0b2",
        "type": 2
      },
      {
        "bubbleId": "3421d88d-b84b-4edc-8278-710bd8335d35",
        "type": 2,
        "serverBubbleId": "a33aa70a-641b-4092-bf2b-4a58c7d3dabe"
      },
      {
        "bubbleId": "d81e24c9-5a95-4cf6-a890-ea4383d2cf10",
        "type": 2
      },
      {
        "bubbleId": "37ab66e3-76fa-4714-8652-c6d07b175289",
        "type": 2
      },
      {
        "bubbleId": "4e36c972-c352-4b7e-b53e-3b43bb612d03",
        "type": 2
      },
      {
        "bubbleId": "8ebd2580-8fa5-4d5c-bcc1-77748dd4335d",
        "type": 2
      },
      {
        "bubbleId": "675dc779-67fe-46ac-abdb-aa7e90d43132",
        "type": 2,
        "serverBubbleId": "db5712b5-6774-4d5d-bbe1-498c47ea0378"
      },
      {
        "bubbleId": "5adb1c87-5e78-428e-a604-352fe674de26",
        "type": 2
      },
      {
        "bubbleId": "73d6c2b5-a72f-4e01-95a4-01500f78379b",
        "type": 2
      },
      {
        "bubbleId": "6e16a4c9-660d-47ea-bacd-6eb9568298c5",
        "type": 2
      },
      {
        "bubbleId": "3e1226cd-2d52-4bbf-a1f1-d7c739ed9481",
        "type": 2
      },
      {
        "bubbleId": "aa771660-deb9-4e48-8129-ca0612ad5ea7",
        "type": 2,
        "serverBubbleId": "4c16031c-cffd-41c5-8683-def3c2225efc"
      },
      {
        "bubbleId": "d1519d1a-d058-464e-9dca-98c429e913b7",
        "type": 2
      },
      {
        "bubbleId": "6f161756-97d0-4a45-adc9-b0989cbde9b5",
        "type": 2
      },
      {
        "bubbleId": "60bb02bf-88cf-4e1b-b585-e80dbc699e73",
        "type": 2
      },
      {
        "bubbleId": "473625d1-faf4-4736-8537-a210eb6b6333",
        "type": 2
      },
      {
        "bubbleId": "2185b21c-d742-4a48-8f63-e08070e42723",
        "type": 2,
        "serverBubbleId": "e99126b2-a9dc-4ce4-8a1d-8591daf73595"
      },
      {
        "bubbleId": "260a9475-6772-4a28-99a0-557fe22df72b",
        "type": 2
      },
      {
        "bubbleId": "a801e4c7-630a-4e1c-a361-4bfbd5937ca3",
        "type": 2
      },
      {
        "bubbleId": "b31eb927-78a4-4ab1-ae05-2318e69c10cc",
        "type": 2
      },
      {
        "bubbleId": "7217700d-2fba-486a-b11b-59ccdfd820ab",
        "type": 2,
        "serverBubbleId": "ee9919f8-0d97-48ba-a160-d32e71b7060c"
      },
      {
        "bubbleId": "9a5544cb-1c7a-4cc7-9607-524dc3d8669c",
        "type": 2
      },
      {
        "bubbleId": "1bebd284-52ed-4dfa-a919-9b462c3dc785",
        "type": 2
      },
      {
        "bubbleId": "fb587cce-45f0-4751-bfd7-e9ed14527eef",
        "type": 2
      },
      {
        "bubbleId": "0a52835a-01f4-458e-9a1b-ebc713bb4cc5",
        "type": 2,
        "serverBubbleId": "ef2e99d4-8144-4971-8072-95321bbbe443"
      },
      {
        "bubbleId": "2ad97dad-6757-43ce-bd94-cd7f442b935d",
        "type": 2
      },
      {
        "bubbleId": "61db128e-67af-4d6e-98b3-09aba4aa5444",
        "type": 2
      },
      {
        "bubbleId": "c4430f86-d133-4b18-b21f-e916a427ce2d",
        "type": 1
      },
      {
        "bubbleId": "f939cf51-eb74-4cc8-8248-915e09ede73c",
        "type": 2,
        "serverBubbleId": "c9da8a9e-6623-4ad3-beb6-314568384c0f"
      },
      {
        "bubbleId": "9afbda3f-e68e-435b-bca7-61c8db9e444b",
        "type": 2
      },
      {
        "bubbleId": "c443c1f5-5c2f-4554-9e58-a945d5d832f2",
        "type": 2
      },
      {
        "bubbleId": "002ebfaa-a1f5-4cb5-87d8-7d5b9b8e4bb3",
        "type": 2
      },
      {
        "bubbleId": "df27f835-6c1e-4052-b8a1-46014ba2b01a",
        "type": 2
      },
      {
        "bubbleId": "e4bbc3f5-dbd0-4797-90b9-b36923bd6e01",
        "type": 2,
        "serverBubbleId": "83837616-08cd-411d-a999-0f54ca1b414a"
      },
      {
        "bubbleId": "09d7f088-3d97-431f-b9fd-228dda9b08e3",
        "type": 2
      },
      {
        "bubbleId": "14afd5de-fc80-430c-9970-bbc36a0f86e8",
        "type": 2
      },
      {
        "bubbleId": "a0c3a29a-33d8-49aa-8e3a-0196cf8ea7b0",
        "type": 2
      },
      {
        "bubbleId": "dd041a53-c3ee-400b-91ae-dd520b814c83",
        "type": 2
      },
      {
        "bubbleId": "41c580bd-ad41-4b1e-9cad-6c85db341ada",
        "type": 2,
        "serverBubbleId": "0c831383-fa6a-45d3-896b-1e6b9ad66031"
      },
      {
        "bubbleId": "e4b925b8-4774-4692-bdf2-2fe2764cbc73",
        "type": 2
      },
      {
        "bubbleId": "7a989b09-bbc3-4569-9571-a7975c4bd5d6",
        "type": 2
      },
      {
        "bubbleId": "40689a77-fd3b-4989-9102-4a5bf33625e6",
        "type": 2
      },
      {
        "bubbleId": "56f8888f-0e32-480f-b496-3913cb06fee7",
        "type": 2,
        "serverBubbleId": "ebaeec32-f6eb-403f-beda-3da64e76aed2"
      },
      {
        "bubbleId": "94a76748-ead4-4cfc-8702-bfb03b9b2235",
        "type": 2
      },
      {
        "bubbleId": "85a56e49-f9b1-42c3-b991-538d10fb8f2d",
        "type": 2
      },
      {
        "bubbleId": "dd60fbbc-7ca2-4f95-afd7-8e03897f3dfd",
        "type": 2
      },
      {
        "bubbleId": "bb2ef90c-faf9-46f6-9e4a-ce38d0c4c42c",
        "type": 2,
        "serverBubbleId": "ee1eae15-5a42-447c-81a0-cdd497ac7b9e"
      },
      {
        "bubbleId": "da4884e0-dcb2-4fed-95e7-4836d3732133",
        "type": 2
      },
      {
        "bubbleId": "bf1e70eb-35ca-4e4e-94a7-f0cc609124c6",
        "type": 2
      },
      {
        "bubbleId": "a517ca9f-9bcb-4795-92e6-0a042c0c42a8",
        "type": 2
      },
      {
        "bubbleId": "14c3e7ec-d129-4f38-b6f5-b4e2f2f58fdf",
        "type": 2,
        "serverBubbleId": "a7d29ca4-16d1-4876-a6bb-64b034eeaba1"
      },
      {
        "bubbleId": "e2133366-b5f6-41a1-a615-ccd04b2a6d09",
        "type": 2
      },
      {
        "bubbleId": "075a9931-0238-4958-8ef9-65dcd6a9f49c",
        "type": 2
      },
      {
        "bubbleId": "a7c8f98e-5ae2-43ed-9747-86ce3c0906c6",
        "type": 2
      },
      {
        "bubbleId": "b856f560-1065-4c5a-be57-0fdca8b8ddd4",
        "type": 2
      },
      {
        "bubbleId": "0598c8b7-f445-4cf2-a1a5-d7fd8636bc93",
        "type": 2,
        "serverBubbleId": "2766a5f6-f97e-42bb-a399-ad3c43345782"
      },
      {
        "bubbleId": "e9e88443-356a-43fb-82e1-372824964252",
        "type": 2
      },
      {
        "bubbleId": "1400c89d-d5ca-4486-8cfc-6c864af1a23a",
        "type": 2
      },
      {
        "bubbleId": "8aec50c0-8a20-4157-9245-7be9ad8b5784",
        "type": 2
      },
      {
        "bubbleId": "a5b46721-1f88-4e9b-87f2-2911c369a17e",
        "type": 2
      },
      {
        "bubbleId": "c82411ed-aeb9-4d64-9292-ace878c637ae",
        "type": 2,
        "serverBubbleId": "7ea21270-6ab6-40cf-b6c7-f7ef954d631d"
      },
      {
        "bubbleId": "fa442926-1503-4bbb-a721-1d2d1ffa9a45",
        "type": 2
      },
      {
        "bubbleId": "668a4fd4-d578-4212-8bf6-6824fe95d68d",
        "type": 2
      },
      {
        "bubbleId": "a97a581e-d19b-48ca-ac7d-180af5ab9331",
        "type": 2
      },
      {
        "bubbleId": "c55750bb-b853-4889-9336-cb4f96d4e73c",
        "type": 2
      },
      {
        "bubbleId": "fa33aae4-4f14-4c45-91ef-fcf34d92b897",
        "type": 2,
        "serverBubbleId": "c3e42a3f-c68b-48b3-a0a6-fa981a330b0f"
      },
      {
        "bubbleId": "9cba61ad-4c4b-4eea-a41b-3a7adeed79fd",
        "type": 2
      },
      {
        "bubbleId": "d275ac68-0e51-4f84-90d8-44eb5ef9b294",
        "type": 2
      },
      {
        "bubbleId": "01e34f40-b068-4b3f-bbd3-5c09c1cc5fa8",
        "type": 2
      },
      {
        "bubbleId": "0eb505b4-c715-4141-b3d4-4f8b8972c437",
        "type": 2
      },
      {
        "bubbleId": "e32a1d22-dee0-4ed8-a5d2-be067182721c",
        "type": 2,
        "serverBubbleId": "000baa67-d176-47a2-895a-2f8ceeac3a49"
      },
      {
        "bubbleId": "ac31973e-bc1c-4156-8bb0-f8322208cd8c",
        "type": 2
      },
      {
        "bubbleId": "c344bf7a-b24c-4afe-821e-c2b06d78c10b",
        "type": 2
      },
      {
        "bubbleId": "d9cc7222-9b6e-4335-b42a-7ab314fb1dcc",
        "type": 2
      },
      {
        "bubbleId": "ec20e40d-d64c-4f11-b524-0ad899dede9a",
        "type": 2,
        "serverBubbleId": "9c5a7768-76ca-48c1-9c83-876a5f333fb1"
      },
      {
        "bubbleId": "8cc5c4c7-53bf-46b8-a749-7a11e2b7db5e",
        "type": 2
      },
      {
        "bubbleId": "a723bfba-31b1-421b-8407-37a94f9b81bc",
        "type": 2
      },
      {
        "bubbleId": "8bfc49c9-2f76-4fda-bc7f-6448a72d640f",
        "type": 2
      },
      {
        "bubbleId": "d8da415a-4bea-43c8-96fb-f30ed83c000b",
        "type": 2,
        "serverBubbleId": "58a46dbf-2e5f-4635-9d77-92813fd7a958"
      },
      {
        "bubbleId": "a424b0d8-4e57-4e9c-9897-9d74f32a6fcd",
        "type": 2
      },
      {
        "bubbleId": "fcd688bf-d69c-4cee-9998-ea961c924d2c",
        "type": 2
      },
      {
        "bubbleId": "40858265-0da9-430b-bdff-08013cae9c57",
        "type": 2
      },
      {
        "bubbleId": "990277d9-5f51-49a9-97bb-8db480519de4",
        "type": 2
      },
      {
        "bubbleId": "2dd9174f-c8fa-4f29-8ae6-7d85efcbbf8c",
        "type": 2,
        "serverBubbleId": "0f43d1e7-e2cb-4fc9-a11c-984cbfc4358f"
      },
      {
        "bubbleId": "5a12806c-8185-4941-8792-e5b9da15fd20",
        "type": 2
      },
      {
        "bubbleId": "56e78a6e-95ad-4141-8042-a90a1f5800d2",
        "type": 2
      },
      {
        "bubbleId": "c51f57f6-14d6-4c4b-a611-6150e886531f",
        "type": 2
      },
      {
        "bubbleId": "670383d2-4c2b-40d9-9535-611300ab026c",
        "type": 2
      },
      {
        "bubbleId": "6308bf5a-603e-47eb-b235-76d38365298c",
        "type": 2
      },
      {
        "bubbleId": "c39a1b3b-2ae4-4167-b912-396e50b83629",
        "type": 2,
        "serverBubbleId": "6921f744-f4e8-4aa3-b3ee-c26a137c3d44"
      },
      {
        "bubbleId": "054d472d-5fcb-479e-a120-0fb9e190af00",
        "type": 2
      },
      {
        "bubbleId": "6348acec-fa1c-4b5b-a3df-ec752d72fa70",
        "type": 2
      },
      {
        "bubbleId": "623f085c-52a8-4994-88b1-7c596837788e",
        "type": 2
      },
      {
        "bubbleId": "2179e58e-018c-48a8-98e6-088ff1849acb",
        "type": 2
      },
      {
        "bubbleId": "682fb7f8-f968-4b25-a6f5-f3df916bc5ab",
        "type": 2,
        "serverBubbleId": "ddeea5f2-0d8b-4697-96c2-6fe59dc33ebe"
      },
      {
        "bubbleId": "585fda90-8036-4003-91cd-ebe7c00db3a0",
        "type": 2
      },
      {
        "bubbleId": "5c8a698e-e420-47f0-a0a3-4d989cbbe7c1",
        "type": 2
      },
      {
        "bubbleId": "6eefe998-8efc-4c93-b60c-473b9dafc6fb",
        "type": 2
      },
      {
        "bubbleId": "b97a4c11-7b09-4bb4-990c-7084856ecc36",
        "type": 2,
        "serverBubbleId": "d820700c-9d16-4ca4-aac3-15ec53cdab36"
      },
      {
        "bubbleId": "a9c2394b-a850-426d-a6aa-1b7f9a0540cd",
        "type": 2
      },
      {
        "bubbleId": "19a5cf3e-3bd5-4a13-8d42-f956516c6e73",
        "type": 1
      },
      {
        "bubbleId": "0a69dc7d-cec9-4509-a5a6-8e4903b6fa75",
        "type": 2,
        "serverBubbleId": "620f0781-2167-4728-bd42-74738cbb831f"
      },
      {
        "bubbleId": "7e5f01e3-78f0-4c75-820e-1d2355478822",
        "type": 2
      },
      {
        "bubbleId": "0e6bcb3c-eea0-4d7e-af66-ccf38c66ed3f",
        "type": 2
      },
      {
        "bubbleId": "8684d0d8-888f-4f29-b0da-7aa59a2a30c5",
        "type": 2
      },
      {
        "bubbleId": "919b9a59-48f3-402b-b0c9-5859373a168d",
        "type": 2
      },
      {
        "bubbleId": "0001e209-313c-44f1-81dc-6f4bb7609412",
        "type": 2,
        "serverBubbleId": "52e8c8dd-ca86-46d4-a9dd-3c3576bf814d"
      },
      {
        "bubbleId": "acd44b57-3d94-4c59-b823-a33072d9e4dc",
        "type": 2
      },
      {
        "bubbleId": "8f4df155-24b8-4159-a4bf-d757de650c0e",
        "type": 2
      },
      {
        "bubbleId": "5a89660f-7930-4295-865d-f704de71121c",
        "type": 2
      },
      {
        "bubbleId": "d33cab98-bd7f-408f-8a20-2f1c522b3ed3",
        "type": 2
      },
      {
        "bubbleId": "058dbf7b-a7ee-4734-84db-4b21372e6128",
        "type": 2,
        "serverBubbleId": "4428f177-bc50-4ead-a731-3adacfd57605"
      },
      {
        "bubbleId": "1c85de73-4307-4379-853b-c5734ef41862",
        "type": 2
      },
      {
        "bubbleId": "02f458fb-b04f-40ad-a8f4-1fd9f2240de6",
        "type": 2
      },
      {
        "bubbleId": "12c009fa-92cc-454b-82e3-005be8cebd1f",
        "type": 2
      },
      {
        "bubbleId": "aa11b402-74de-4f0e-95cd-73e639737563",
        "type": 2
      },
      {
        "bubbleId": "4faff04e-2239-45a6-9470-66bbc1b88884",
        "type": 2,
        "serverBubbleId": "55c7b6c6-27a4-4a6e-8d99-99a7834faa1e"
      },
      {
        "bubbleId": "1cdb6002-1925-4f95-95e9-2fd5e8c9e877",
        "type": 2
      },
      {
        "bubbleId": "73855d90-647b-4fbe-8459-e76ea3c58a2b",
        "type": 2
      },
      {
        "bubbleId": "e24c503a-6b61-480e-849e-9ec381872a13",
        "type": 2
      },
      {
        "bubbleId": "8252d876-0478-4170-b5e8-08561498f35b",
        "type": 2
      },
      {
        "bubbleId": "67ba8b3f-38e5-4c3c-812e-3cf4c5d5c921",
        "type": 2,
        "serverBubbleId": "10e9fa86-e55a-4a70-9519-17f7951bd13e"
      },
      {
        "bubbleId": "761bd124-791a-48a3-ac3d-c479219fcfd5",
        "type": 2
      },
      {
        "bubbleId": "f45ad287-b3c3-4453-b5d1-d901664b614c",
        "type": 2
      },
      {
        "bubbleId": "a907ddd0-a6c1-409a-b442-2df2cc3a9264",
        "type": 2
      },
      {
        "bubbleId": "03d07776-376f-4ca2-a0cf-a7ee6bfb1bc2",
        "type": 2,
        "serverBubbleId": "778f9a39-2ef8-4bd4-b8f5-f1e9ad18e7fc"
      },
      {
        "bubbleId": "166d3616-2c6a-4957-a6d3-e25587194fa1",
        "type": 2
      },
      {
        "bubbleId": "cf7a1170-32c0-43a2-92b2-2e22ef79bd72",
        "type": 1
      },
      {
        "bubbleId": "4d91429f-74d7-4a08-b0ff-87ffb806b4b8",
        "type": 2,
        "serverBubbleId": "d9f035d7-822c-4d23-ba33-5245156ae337"
      },
      {
        "bubbleId": "3a1911ae-9ff0-49e4-a859-d48c6e7f6535",
        "type": 2
      },
      {
        "bubbleId": "377e8247-e384-4be2-a736-6f4b1e28a568",
        "type": 2
      },
      {
        "bubbleId": "d3c088c5-19a5-4607-b1cb-e9dd2a41aa09",
        "type": 2
      },
      {
        "bubbleId": "eadcb65d-c9a5-438a-83ef-f7cb23641d74",
        "type": 2
      },
      {
        "bubbleId": "2cfaef3d-45ae-448b-8056-3b20c56da68d",
        "type": 2,
        "serverBubbleId": "7fae2b05-e585-4419-a408-9fa0e3b71654"
      },
      {
        "bubbleId": "f528bf88-d57d-47c0-88c5-9663711f3304",
        "type": 2
      },
      {
        "bubbleId": "f1a87fe8-25a6-4ea5-9ece-73c599604e72",
        "type": 2
      },
      {
        "bubbleId": "3c34df1f-8822-4b3f-9f57-31ddc7e94944",
        "type": 2
      },
      {
        "bubbleId": "f01c548b-321e-4571-b9d2-d4a5b306f165",
        "type": 2
      },
      {
        "bubbleId": "bc1282ac-cdf1-483f-b09e-8edeaf1d30cd",
        "type": 2,
        "serverBubbleId": "ffaa991f-4109-49da-8c0f-1b73bc0ee8cf"
      },
      {
        "bubbleId": "f2f1e3a7-f77a-4907-8bc7-46a198431d30",
        "type": 2
      },
      {
        "bubbleId": "e66f9709-496d-43bd-a306-029c265dcf7e",
        "type": 2
      },
      {
        "bubbleId": "c69aae9a-6367-40ce-b64f-44f98b42c5ec",
        "type": 2
      },
      {
        "bubbleId": "04e6899f-73c3-4654-9347-814a658de9d8",
        "type": 2
      },
      {
        "bubbleId": "ac3e6a15-3d82-462c-8e06-4c2d06b484e7",
        "type": 2,
        "serverBubbleId": "aa88c88e-265b-4c51-bb1f-99c8a638ef91"
      },
      {
        "bubbleId": "acd64bf6-0104-4add-98c9-a41a82fc1acf",
        "type": 2
      },
      {
        "bubbleId": "2e50f6d8-c09b-4c98-a67e-b3d1ca9ffe40",
        "type": 2
      },
      {
        "bubbleId": "defee6e9-ba50-4732-8808-487a16f017a8",
        "type": 2
      },
      {
        "bubbleId": "78435557-7489-4fb8-bc35-393d2fddcbd6",
        "type": 2
      },
      {
        "bubbleId": "f7f6ba24-fae7-4edd-bcb0-ca272245349e",
        "type": 2,
        "serverBubbleId": "111f1561-0c75-4929-a94f-bc2c920ebf55"
      },
      {
        "bubbleId": "dd748075-0b79-4b61-9125-8cca3584cc89",
        "type": 2
      },
      {
        "bubbleId": "36b77122-9967-4d0a-97a6-cfa7389ffbf6",
        "type": 2
      },
      {
        "bubbleId": "b3bafef8-aeee-4b60-90b6-bd515a9eb312",
        "type": 2
      },
      {
        "bubbleId": "f50ca1e5-6aff-4051-b382-127a9d93b492",
        "type": 2
      },
      {
        "bubbleId": "b6e1c411-a8ab-48b8-8702-da0d336b2dbd",
        "type": 2
      },
      {
        "bubbleId": "8cb5e435-f382-4d06-a46c-2e00908d0a05",
        "type": 2
      },
      {
        "bubbleId": "bbb5ea55-d8d8-4cbf-a7ac-24a6a68102cf",
        "type": 2,
        "serverBubbleId": "d8cbae63-e78c-4a6a-8786-7745e1c0dee8"
      },
      {
        "bubbleId": "21505a15-408c-42f8-90b9-68aceab9df50",
        "type": 2
      },
      {
        "bubbleId": "4036e4ca-cae1-4f11-9271-63d97d2beb9a",
        "type": 2
      },
      {
        "bubbleId": "f9faed4d-6be6-4b0f-ad15-a5df33b1d6a0",
        "type": 2
      },
      {
        "bubbleId": "75c54763-506f-467b-884c-74b7fd66badd",
        "type": 2,
        "serverBubbleId": "a9f54055-5352-4272-95f7-32c5868a2505"
      },
      {
        "bubbleId": "3c59c806-16c8-4f00-8cae-318502092aca",
        "type": 2
      },
      {
        "bubbleId": "89bb4f9b-0896-4898-ac24-fe9082ad1404",
        "type": 2
      },
      {
        "bubbleId": "d2725f23-8e07-4ad4-948e-2c032462cad8",
        "type": 2,
        "serverBubbleId": "10449bdf-61b7-48ee-ab72-4e3ab539f074"
      },
      {
        "bubbleId": "3d0f758a-f932-45ed-aab8-1b61581d5579",
        "type": 2
      },
      {
        "bubbleId": "15f3574c-4bd8-4cc8-ba3c-27f195826b7f",
        "type": 1
      },
      {
        "bubbleId": "2324f4ee-0ed9-4064-ad66-8ee7ca443fd3",
        "type": 2,
        "serverBubbleId": "244f435d-e46e-413b-9d6a-1166af0641da"
      },
      {
        "bubbleId": "8e2e4ff6-7fae-4d17-9a54-4141fc1bb99a",
        "type": 2
      },
      {
        "bubbleId": "3814659f-ce81-4858-a669-268e391fa98c",
        "type": 2
      },
      {
        "bubbleId": "8c360595-88f4-4b10-ba21-581135fbca96",
        "type": 2
      },
      {
        "bubbleId": "28681284-e963-4eae-ba1a-c801bd503ce3",
        "type": 2
      },
      {
        "bubbleId": "1f40d459-d8e1-4fad-b5fd-d42864ba43be",
        "type": 1
      },
      {
        "bubbleId": "2b4c5655-23b5-409d-acc9-40aea7eceefc",
        "type": 2,
        "serverBubbleId": "737a24b0-88ac-4c24-a8d3-292cfcbe865d"
      },
      {
        "bubbleId": "cb30d274-35bd-4d0e-9823-e7733b044245",
        "type": 2
      },
      {
        "bubbleId": "deddb2a0-da97-4488-b2e4-fdba41ba8aaf",
        "type": 2
      },
      {
        "bubbleId": "543f86e2-d2b4-4ee8-91cd-4ac4657d46ba",
        "type": 2,
        "serverBubbleId": "33f30993-a012-4350-915c-2fa50ed0316f"
      },
      {
        "bubbleId": "7d0afbed-2a81-4e7d-bcff-a6c53488c8a1",
        "type": 2
      },
      {
        "bubbleId": "51f8ad28-ccb1-4153-a948-2bc74c7df992",
        "type": 1
      },
      {
        "bubbleId": "dc86a618-a313-4060-846a-1d0257e6bfc3",
        "type": 2,
        "serverBubbleId": "6f5a62ab-c2bb-4097-84cd-f9549b34c21c"
      },
      {
        "bubbleId": "4b6e9341-530c-42c6-9423-325ee66f66ad",
        "type": 2
      },
      {
        "bubbleId": "ff4eaebf-d4ca-4b36-9f90-6b1caf0d0329",
        "type": 2
      },
      {
        "bubbleId": "b4962dfc-b022-4ffe-8cb6-138136974674",
        "type": 2
      },
      {
        "bubbleId": "78cfcffd-026c-4a16-bda9-8f311cc04949",
        "type": 2,
        "serverBubbleId": "f7663b23-5599-42e8-afe4-09a5fb08e759"
      },
      {
        "bubbleId": "dd1fbb22-10ec-4bab-97fd-13d044fd3a25",
        "type": 2
      },
      {
        "bubbleId": "f5ff2ad5-9b3b-4a3f-b3bb-6e5b09d94ee8",
        "type": 2
      },
      {
        "bubbleId": "eb38fee8-4525-4e96-828d-4e03eb567d57",
        "type": 2
      },
      {
        "bubbleId": "511141f5-7533-4ed4-825c-913ac8728ad3",
        "type": 2,
        "serverBubbleId": "5047b2b7-4ad2-41a4-bb98-f7c52fa28932"
      },
      {
        "bubbleId": "39dae65a-37f4-47fd-9e62-98177fb2f9b9",
        "type": 2
      },
      {
        "bubbleId": "9977e644-b6cb-4704-81ae-c5c66e38e10f",
        "type": 2
      },
      {
        "bubbleId": "fa3fc38f-4b6a-4933-8b73-70835d17d864",
        "type": 2
      },
      {
        "bubbleId": "0900949f-22a0-4e23-be5d-5d08423a5948",
        "type": 2
      },
      {
        "bubbleId": "8f796151-b563-4350-9cd8-32eb21ada885",
        "type": 2,
        "serverBubbleId": "eb894fd9-7e22-43b0-945a-735e65c1a0d2"
      },
      {
        "bubbleId": "16a404db-1bda-4d00-879c-db3cf4b3c488",
        "type": 2
      },
      {
        "bubbleId": "164283aa-96a7-407f-988c-240b0d191396",
        "type": 2
      },
      {
        "bubbleId": "e7725694-acbc-420a-a2ce-43049846fac9",
        "type": 2
      },
      {
        "bubbleId": "2c45ec9d-0c2b-49a7-abd4-d0c36ede0735",
        "type": 2
      },
      {
        "bubbleId": "d9e245ef-b283-4ce5-b294-0387bd7fdf9c",
        "type": 2,
        "serverBubbleId": "520a43b1-2c86-4d8a-8ae7-cb3794700543"
      },
      {
        "bubbleId": "4134cfc1-1d2b-4364-8a74-c883ce7af2d0",
        "type": 2
      },
      {
        "bubbleId": "23b157bc-ca5e-4e93-923c-01347e4b994d",
        "type": 1
      },
      {
        "bubbleId": "7c4181c6-eaff-4ced-bc24-1716c26f23b1",
        "type": 2,
        "serverBubbleId": "580ad222-1bd6-420e-bd9a-d10c5ce83202"
      },
      {
        "bubbleId": "b2a88bb9-4378-4b36-8b52-6bd11a1bf4d5",
        "type": 2
      },
      {
        "bubbleId": "8f735833-3ea2-4d8c-9b1a-3e6ec68ad832",
        "type": 2
      },
      {
        "bubbleId": "eaa601d2-98a8-43c3-b700-349533ca35af",
        "type": 2
      },
      {
        "bubbleId": "665b63e5-3cfa-4f01-88fb-2b1d45cdded6",
        "type": 2
      },
      {
        "bubbleId": "59ffc1a3-6736-4610-a0db-5b2f0c019f43",
        "type": 2,
        "serverBubbleId": "9ea0d3d8-bd4b-4cf4-82ee-53f913829924"
      },
      {
        "bubbleId": "1ef1e1fa-96f9-4e68-9824-2945cd3ffb14",
        "type": 2
      },
      {
        "bubbleId": "626623dd-899e-4afe-9ba9-a542a97e3f26",
        "type": 2
      },
      {
        "bubbleId": "00277358-fac7-4c2a-b877-f03da11b277d",
        "type": 2
      },
      {
        "bubbleId": "f127a0ec-3043-4a9b-9a45-66d9e860ca7d",
        "type": 2
      },
      {
        "bubbleId": "ba67524b-b35c-478e-9b25-31d4ab2562f2",
        "type": 2,
        "serverBubbleId": "4fbe95d7-b535-4fdb-931f-395d0cd07b5f"
      },
      {
        "bubbleId": "2494ccdb-14e5-4866-b3ec-a550fd7078eb",
        "type": 2
      },
      {
        "bubbleId": "67849957-6c7b-49f6-a19a-f333f3bac834",
        "type": 2
      },
      {
        "bubbleId": "74439e49-90b6-4647-a7c6-184db22cb397",
        "type": 2
      },
      {
        "bubbleId": "b055ab10-6a51-40ee-a1e1-08fd63bba695",
        "type": 2
      },
      {
        "bubbleId": "ec961c3d-a988-4cd3-891a-8da2c2168785",
        "type": 2,
        "serverBubbleId": "5769f700-b1c6-4a16-889f-f2d2de8f31a5"
      },
      {
        "bubbleId": "de0a13de-f4f7-49c1-9aa2-11edf6e0b2cb",
        "type": 2
      },
      {
        "bubbleId": "92a78116-64f6-4e24-8bea-04170a33400e",
        "type": 2
      },
      {
        "bubbleId": "362e3795-6c98-44b9-876e-190240c36be0",
        "type": 2
      },
      {
        "bubbleId": "eeb4cbe8-8c21-40d2-9dfc-e339b836306b",
        "type": 2
      },
      {
        "bubbleId": "895596aa-0610-41b7-8df5-81f0e5847475",
        "type": 2,
        "serverBubbleId": "d32ae352-1eca-4992-93eb-02bbdf433b08"
      },
      {
        "bubbleId": "8001cdeb-4d06-4fed-a498-e8e857442a21",
        "type": 2
      },
      {
        "bubbleId": "65ff8ab1-b392-40f4-8018-9b02b9764347",
        "type": 1
      },
      {
        "bubbleId": "3c2f7e3b-82cd-4ab8-a4ef-13e92e35c886",
        "type": 2,
        "serverBubbleId": "728f8d67-74f8-44c0-a0ee-7b821e38dd02"
      },
      {
        "bubbleId": "37acd9ef-85df-41c9-99e4-9f51da72c871",
        "type": 2
      },
      {
        "bubbleId": "57342638-e4f9-45c5-a093-2618a1131094",
        "type": 2
      },
      {
        "bubbleId": "80ff8f9f-14c0-47e0-8f7f-ee6c74bcd728",
        "type": 2
      },
      {
        "bubbleId": "bd9990a3-c63e-4665-9f3e-973b8e45d5ce",
        "type": 2
      },
      {
        "bubbleId": "9e4c1e7d-d93a-4727-ba1d-f0ac623eb2e2",
        "type": 2,
        "serverBubbleId": "34df409d-bd5b-470d-a5f5-d5380ef97a49"
      },
      {
        "bubbleId": "56954dec-4dba-477c-b072-45237cdf157c",
        "type": 2
      },
      {
        "bubbleId": "f4b36b37-e5a1-4259-9c91-0d74163efee2",
        "type": 2
      },
      {
        "bubbleId": "54a06910-8cc0-44aa-9235-4e7e813ce632",
        "type": 2
      },
      {
        "bubbleId": "065995f1-63e3-43ce-9ea2-4ebf17802d3d",
        "type": 2
      },
      {
        "bubbleId": "66614195-3a0a-4aaa-82c3-adcd63bb7b97",
        "type": 2
      },
      {
        "bubbleId": "bc44861f-a89b-45c3-954f-0bd0330ea71c",
        "type": 2
      },
      {
        "bubbleId": "fd9fb212-cd69-48ae-908c-15782494c4c0",
        "type": 2
      },
      {
        "bubbleId": "589d6bc6-e78a-4606-b630-5cf942dc6653",
        "type": 2
      },
      {
        "bubbleId": "bc2a2ebc-df60-4423-82c7-54505e8228e0",
        "type": 2
      },
      {
        "bubbleId": "b4d50c85-4dee-4f64-a738-7f6f4206c59a",
        "type": 2,
        "serverBubbleId": "af6a9570-99ef-4380-b591-45f6becb6652"
      },
      {
        "bubbleId": "6ac1741f-d98b-48b6-9e92-da7e596438bb",
        "type": 2
      },
      {
        "bubbleId": "fc989602-cb9d-4819-9933-e14b70d75680",
        "type": 2
      },
      {
        "bubbleId": "9159ca52-7b6e-4817-92bf-3b05b292f0f4",
        "type": 2
      },
      {
        "bubbleId": "4d73370b-8778-4a64-9bac-6cf02ae924f9",
        "type": 2
      },
      {
        "bubbleId": "f8a2b0ec-8329-40f6-ae1b-dbd0fb4493db",
        "type": 2,
        "serverBubbleId": "f9a3ba5f-2b01-47dd-9c95-b2a13d599002"
      },
      {
        "bubbleId": "4fb5241f-4711-482b-877d-1ace749d8404",
        "type": 2
      },
      {
        "bubbleId": "49a590f2-fb41-47f8-9a76-d01dc94b8d30",
        "type": 2
      },
      {
        "bubbleId": "fc6beafd-fc0e-42a2-a753-b4a3c3263f65",
        "type": 2
      },
      {
        "bubbleId": "e239afde-b506-4dee-99d0-7e48429a4980",
        "type": 2,
        "serverBubbleId": "5a75c3d8-1dbb-47cd-8477-c8f2dbab640c"
      },
      {
        "bubbleId": "47355564-33fe-47fe-830b-a33e9b221915",
        "type": 2
      },
      {
        "bubbleId": "d98b51a4-cae0-41fd-b623-5a957f054e1b",
        "type": 2
      },
      {
        "bubbleId": "eee1041d-646d-41a4-8ca9-551d37e40a08",
        "type": 2
      },
      {
        "bubbleId": "44c0f44b-bc8b-44f2-9778-fc6fdfef57a0",
        "type": 2
      },
      {
        "bubbleId": "954b540b-6814-4169-a137-07b87391e6f1",
        "type": 2,
        "serverBubbleId": "04de3c6e-9537-4447-8054-dd1a79f621d4"
      },
      {
        "bubbleId": "348be71b-0c0e-4a9c-86f5-f4035a3f04d9",
        "type": 2
      },
      {
        "bubbleId": "cdc950b0-32ad-4957-b5a7-3eed2ddf2b91",
        "type": 2
      },
      {
        "bubbleId": "6cca4e3b-75db-45d4-873e-6af52b824bfb",
        "type": 2
      },
      {
        "bubbleId": "13a44906-4e95-4464-adb1-1cc039735e57",
        "type": 2
      },
      {
        "bubbleId": "85c13e74-cec4-4422-a5cd-d4ba45f32f9a",
        "type": 2
      },
      {
        "bubbleId": "807bf547-b367-4c2d-af1d-15ebe90fda22",
        "type": 2
      },
      {
        "bubbleId": "43c645b2-ae9b-4158-bb37-9fac2b1a8118",
        "type": 2
      },
      {
        "bubbleId": "92d223e6-291d-49f9-9bca-8006f7f9fb1b",
        "type": 2,
        "serverBubbleId": "e03b6e7d-2031-4948-9d15-77493cd1fc50"
      },
      {
        "bubbleId": "fe607abd-6610-45c9-b7b9-9d5fc14e4b36",
        "type": 2
      },
      {
        "bubbleId": "46687c37-7e70-4418-a9dc-7c3907dcb99f",
        "type": 2
      },
      {
        "bubbleId": "0f7dc3e7-8a63-4efd-a9d7-dc235f15636e",
        "type": 2
      },
      {
        "bubbleId": "a7db86f4-1593-4f70-b96f-ce95634574e0",
        "type": 2
      },
      {
        "bubbleId": "398c7fef-58e3-4d9e-bf27-6e1adf9dd948",
        "type": 2,
        "serverBubbleId": "11f1442e-9b7e-4b1a-9853-688f2b28dae4"
      },
      {
        "bubbleId": "2a5016c8-0b7e-4815-b20b-7d34a0e9db61",
        "type": 2
      },
      {
        "bubbleId": "e4a66e48-e8cf-4fc7-8288-d536c3b6872a",
        "type": 1
      },
      {
        "bubbleId": "001c4a39-c729-4fbd-980e-b1c61b93fd06",
        "type": 2,
        "serverBubbleId": "c996f371-a8c8-4363-b8cb-5174ed202f90"
      },
      {
        "bubbleId": "1c121199-d18c-4789-8495-1762f5c03d33",
        "type": 2
      },
      {
        "bubbleId": "ec9830bc-d589-43a4-9d4f-e4f63a753d2e",
        "type": 2
      },
      {
        "bubbleId": "91cf3858-7791-4f78-9eda-ee06389dde81",
        "type": 2
      },
      {
        "bubbleId": "35c346de-46fd-4fc6-8003-6674f1663771",
        "type": 2
      },
      {
        "bubbleId": "faf84fc8-d9fb-4922-b043-10fc0f7d1566",
        "type": 2
      },
      {
        "bubbleId": "2b73f08c-dfc7-4b62-8e63-475165d9b6a6",
        "type": 2,
        "serverBubbleId": "79a4ae2b-19b7-421d-8e9f-761d66057db1"
      },
      {
        "bubbleId": "01962b68-d4c4-4e7c-8ecf-069c40728f58",
        "type": 2
      },
      {
        "bubbleId": "0b1dc0eb-9acc-4745-9671-714886a453c8",
        "type": 2
      },
      {
        "bubbleId": "4134c9aa-ca28-44b7-93ad-34ab48b452d2",
        "type": 2
      },
      {
        "bubbleId": "9f22ec87-b339-4e59-82d9-939ae4ae51dd",
        "type": 2
      },
      {
        "bubbleId": "ea4e42bb-abad-4eab-8976-07b020567930",
        "type": 2,
        "serverBubbleId": "601fbd35-3c5f-44ee-a379-b19db56b4084"
      },
      {
        "bubbleId": "0c01a20a-b343-45e5-943c-349a7436ba83",
        "type": 2
      },
      {
        "bubbleId": "9a8f4c31-1b64-4766-985c-01b16a673798",
        "type": 2
      },
      {
        "bubbleId": "89123487-85d8-4682-bb44-cd77d0701683",
        "type": 2
      },
      {
        "bubbleId": "1998b7a3-e207-455c-869e-41ca06bdc335",
        "type": 2
      },
      {
        "bubbleId": "b753c342-4866-40e5-bec3-175bd05214ad",
        "type": 2,
        "serverBubbleId": "3c2acd35-c79f-4dc3-8352-2e25b721c917"
      },
      {
        "bubbleId": "216c5c3a-58bf-4572-af30-1916a8ca229e",
        "type": 2
      },
      {
        "bubbleId": "cc589ef0-a639-4271-b91e-68ea4f9e947a",
        "type": 2
      },
      {
        "bubbleId": "7c1b2cbf-7bb4-4ef2-8ab7-aaf799ab0c23",
        "type": 2
      },
      {
        "bubbleId": "c15081b9-4ab9-4a75-a842-633929b5b864",
        "type": 2
      },
      {
        "bubbleId": "510fc820-998d-4b18-a01f-e0bf304501d7",
        "type": 2,
        "serverBubbleId": "1e9612a2-7e13-4eea-bad7-43ccf2e00a89"
      },
      {
        "bubbleId": "0dca699b-ca44-4cf7-87b5-8fc9da57e127",
        "type": 2
      },
      {
        "bubbleId": "5b343c40-b7f7-439c-8424-0fd1f5dd59a6",
        "type": 2
      },
      {
        "bubbleId": "66ee676e-428d-4152-9ed3-e88b418df3d2",
        "type": 2
      },
      {
        "bubbleId": "c44a8253-a635-46e3-9218-9686469bc09f",
        "type": 2
      },
      {
        "bubbleId": "5b86bfba-f61e-4b38-9d0c-45b8ac10398e",
        "type": 2,
        "serverBubbleId": "3dcf0bb1-6b17-4b73-bb3a-d3b03681b854"
      },
      {
        "bubbleId": "03541b33-ee27-4226-8d56-1945a4e37e1a",
        "type": 2
      },
      {
        "bubbleId": "53eac5f0-2776-4036-964c-cc3fea371b74",
        "type": 2
      },
      {
        "bubbleId": "b7c71d88-bc91-4055-93a4-a3764f80eadc",
        "type": 2
      },
      {
        "bubbleId": "0b34b12a-7b7b-4d90-a85f-880339220589",
        "type": 2
      },
      {
        "bubbleId": "bb8e7246-e43f-4329-9a06-d05610113921",
        "type": 2,
        "serverBubbleId": "d9f1ad23-5752-4041-9779-a0cd72e645d2"
      },
      {
        "bubbleId": "68fc6098-c477-41be-8636-e5a6a5e7dd85",
        "type": 2
      },
      {
        "bubbleId": "b0509958-3d19-4ed4-92fa-7768f26805ef",
        "type": 2
      },
      {
        "bubbleId": "992e9f79-457c-417d-86cb-6caefc632f10",
        "type": 2
      },
      {
        "bubbleId": "094bd81d-7498-4289-99c4-36e59202434e",
        "type": 2,
        "serverBubbleId": "5594d8f2-0ae8-44ac-8617-89b87ae1f611"
      },
      {
        "bubbleId": "74ccabf5-3da7-4601-98cd-f6e0a944a339",
        "type": 2
      },
      {
        "bubbleId": "6c52edbd-fc54-4cd3-a1b6-7c1c6e0d6fbd",
        "type": 2
      },
      {
        "bubbleId": "394b8156-ba4b-41df-ba3a-f88cdd8e2aff",
        "type": 2
      },
      {
        "bubbleId": "5bbef203-4b0e-4b97-afa1-42bb6b353a64",
        "type": 2,
        "serverBubbleId": "fe175347-817d-4c6e-8dce-061a7f96e729"
      },
      {
        "bubbleId": "db8114ac-21ae-4a0f-a7ef-7710f8b8d09a",
        "type": 2
      },
      {
        "bubbleId": "1c69a70f-f047-43b9-bb01-743c2605038f",
        "type": 2
      },
      {
        "bubbleId": "07178bac-c045-444c-b69b-12360a37d295",
        "type": 2
      },
      {
        "bubbleId": "9ed2dfdf-059f-4424-a26a-f235bcea7c9c",
        "type": 2
      },
      {
        "bubbleId": "ed3a8487-d18c-4429-9daf-c7088312d653",
        "type": 2
      },
      {
        "bubbleId": "47f7683d-a708-4378-9100-e8ca731af9e2",
        "type": 2
      },
      {
        "bubbleId": "83e01b94-8e9d-4d34-87e7-d598ecd65968",
        "type": 2,
        "serverBubbleId": "1752e084-ee05-4405-b883-66582d2f5557"
      },
      {
        "bubbleId": "67a79d85-4c4c-4e4f-8983-a4234ddb563c",
        "type": 2
      },
      {
        "bubbleId": "18af43eb-eed0-4009-aa35-6aff27e57994",
        "type": 2
      },
      {
        "bubbleId": "66eeb39d-e7a9-4c2a-95c5-f6e94984d7c0",
        "type": 2
      },
      {
        "bubbleId": "00a6898d-5fef-4429-aa8d-831825488f34",
        "type": 2
      },
      {
        "bubbleId": "425fc1e2-272e-4619-a08b-7947afe8db32",
        "type": 2,
        "serverBubbleId": "376b0c7f-0b3a-41b6-8783-e028e18a8e3c"
      },
      {
        "bubbleId": "cc4c9244-34cb-4fa8-877e-434f3256f310",
        "type": 2
      },
      {
        "bubbleId": "d64d9f59-bd88-493f-9fc4-f5977d31ae36",
        "type": 1
      },
      {
        "bubbleId": "19caeeba-a55f-4df7-bc36-341119466da6",
        "type": 2,
        "serverBubbleId": "747edc7f-f732-4be1-99d6-65a1ab0df65a"
      },
      {
        "bubbleId": "1a484dc3-a85e-4c52-8fdf-57955e3f5d10",
        "type": 2
      },
      {
        "bubbleId": "d848fd53-2874-4500-8bab-3914e26efabe",
        "type": 2
      },
      {
        "bubbleId": "d0c5b252-4b52-4004-80e7-fe42680d7c7e",
        "type": 2
      },
      {
        "bubbleId": "098a9e83-c823-425f-bf22-123d68537949",
        "type": 2,
        "serverBubbleId": "5d4b24cb-c67d-4793-9abc-0311e1bf8df6"
      },
      {
        "bubbleId": "bb399fea-408d-4679-b97d-eb494b0f7689",
        "type": 2
      },
      {
        "bubbleId": "9236b098-c26d-4566-be1d-d23c841e23df",
        "type": 2
      },
      {
        "bubbleId": "3d7a2aab-64b5-4faa-8abc-5f7e5234f4d5",
        "type": 2
      },
      {
        "bubbleId": "b358e79c-aca5-42d1-9f60-d2868913dfda",
        "type": 2,
        "serverBubbleId": "a0b5d6eb-1bd0-4c98-b24a-742fc5037c56"
      },
      {
        "bubbleId": "e7a06afd-8648-4e79-9ed4-c56dc39df04e",
        "type": 2
      },
      {
        "bubbleId": "efb28dc6-1ca8-4d0a-9224-303fb5eda63a",
        "type": 1
      },
      {
        "bubbleId": "cf9e6482-1446-4db3-86be-dae207bc9a75",
        "type": 2,
        "serverBubbleId": "e6124f70-0886-426b-b691-335e1b875f99"
      },
      {
        "bubbleId": "89622e4b-4165-4e87-8cd3-c1773540cc0a",
        "type": 2
      },
      {
        "bubbleId": "b07206bf-c17a-4884-9466-4f1537931d4c",
        "type": 2
      },
      {
        "bubbleId": "01ddfeb9-6d1a-4fc7-9a8e-f5fed29d1722",
        "type": 2
      },
      {
        "bubbleId": "db7670a0-3928-4dd9-b8d7-27f8861d9b79",
        "type": 2,
        "serverBubbleId": "c7bdf8ed-781c-473d-9b70-f89769159c3c"
      },
      {
        "bubbleId": "bd1aa88e-5ce1-4462-9faa-7c33388edf6a",
        "type": 2
      },
      {
        "bubbleId": "047fa397-20ea-48f0-a3e4-e61e8780c58f",
        "type": 2
      },
      {
        "bubbleId": "a29b22a7-bbbe-4d3b-a91e-db1f51894e02",
        "type": 2
      },
      {
        "bubbleId": "2d43d1af-5e12-4ffb-a4f8-29aed24918da",
        "type": 2
      },
      {
        "bubbleId": "1363ff0a-ff55-4ddb-8698-87040f7efc0d",
        "type": 2,
        "serverBubbleId": "dbaf2072-049d-4d5b-9d40-10a01ccb3223"
      },
      {
        "bubbleId": "d238bd5c-b7ed-4b93-96b4-7fc208f95300",
        "type": 2
      },
      {
        "bubbleId": "1371ab17-9f9e-4e58-9f0f-7818967446f6",
        "type": 2
      },
      {
        "bubbleId": "9ca6d707-9c6c-4ebf-80d1-946ae295626d",
        "type": 2
      },
      {
        "bubbleId": "5945934c-4084-4bbb-a00d-2a7f9325fece",
        "type": 2,
        "serverBubbleId": "370d7789-e160-4a35-a4c6-bed81eb966a9"
      },
      {
        "bubbleId": "eb84991d-284c-4711-bea2-0bc400e54cb5",
        "type": 2
      },
      {
        "bubbleId": "61522521-2e35-4179-9685-234957817187",
        "type": 2
      },
      {
        "bubbleId": "90a3521d-2e59-4956-8f5f-fc4d28dbca72",
        "type": 2
      },
      {
        "bubbleId": "bfc09ef6-f6a8-4502-affd-095c05fb9791",
        "type": 2,
        "serverBubbleId": "33282aad-cc86-4926-af78-5b49253e741c"
      },
      {
        "bubbleId": "1d2bfec2-8b9f-4374-adb7-6ef845571cbc",
        "type": 2
      },
      {
        "bubbleId": "e4ffff45-5d37-4302-8cb9-e72ba019ec01",
        "type": 2
      },
      {
        "bubbleId": "38119f2f-514d-4142-96ff-9df7ef395fb2",
        "type": 2
      },
      {
        "bubbleId": "9ff1b9e3-0849-44dc-9ce5-4dc38d43d4e4",
        "type": 2,
        "serverBubbleId": "e6ea3fa9-202b-4659-8013-a9adec465a71"
      },
      {
        "bubbleId": "3d561f54-bbd8-41b8-ad40-279eb354dc90",
        "type": 2
      },
      {
        "bubbleId": "cc6c6093-9fea-4130-86f4-7e1e3e8b8466",
        "type": 2
      },
      {
        "bubbleId": "7249ac50-d2ac-4e65-b8f5-90bf698969ee",
        "type": 2
      },
      {
        "bubbleId": "d71c631f-e6bd-40a4-b6c8-d83f4e518d98",
        "type": 2,
        "serverBubbleId": "12f28a0c-ebf3-43cb-aa8c-9b3aef18241c"
      },
      {
        "bubbleId": "d8c8ac83-6f43-4d01-9372-a4cf136e96e1",
        "type": 2
      },
      {
        "bubbleId": "ed13af39-b2e5-4f25-95f7-3717069852e7",
        "type": 2
      },
      {
        "bubbleId": "0efdabec-7702-4a15-82ae-2755e3a794f1",
        "type": 2
      },
      {
        "bubbleId": "3257fb1a-ead0-4fa7-9e77-db0fd3565faa",
        "type": 2,
        "serverBubbleId": "686dc293-f40c-4ee9-9dcb-5432eb4da749"
      },
      {
        "bubbleId": "3dc83595-f082-4012-aa9f-8d975ce29324",
        "type": 2
      },
      {
        "bubbleId": "e733085a-2de8-40e8-b0b4-7820b9f7bdb7",
        "type": 2
      },
      {
        "bubbleId": "0b09ffb3-7afd-4050-8fc2-9faa76d4db29",
        "type": 2
      },
      {
        "bubbleId": "070ce970-ca87-438e-b3f9-f5754223a7b8",
        "type": 2,
        "serverBubbleId": "247f5766-fe46-4bec-aa43-f43d51ad39e9"
      },
      {
        "bubbleId": "9948d76e-9e0e-44f8-a18c-aad375a26180",
        "type": 2
      },
      {
        "bubbleId": "2c29ad00-0e5f-4379-87a1-2697bda94225",
        "type": 2
      },
      {
        "bubbleId": "1ed8a15c-bf05-4602-9334-61e45d3a1bbf",
        "type": 2,
        "serverBubbleId": "f4540d85-6aec-4f8a-8c54-413d60fdbf68"
      },
      {
        "bubbleId": "b8eef503-ad9f-4cf6-ad13-17a5ecdaa2df",
        "type": 2
      },
      {
        "bubbleId": "d54e23ff-16f8-4ee1-841d-d4b96bd3c561",
        "type": 2
      },
      {
        "bubbleId": "78ef762a-bf69-4067-a813-076bd22e4b32",
        "type": 2
      },
      {
        "bubbleId": "ba8c23b8-ed78-43bb-96c6-676f937326f8",
        "type": 2,
        "serverBubbleId": "1a5629ab-41cc-4fec-886f-a51f5fb9399b"
      },
      {
        "bubbleId": "e6901655-37c1-4c1b-8301-cf2545f7d996",
        "type": 2
      },
      {
        "bubbleId": "7d35b63f-fd70-4898-99f2-20f002d2788f",
        "type": 2
      },
      {
        "bubbleId": "51ba0bdb-d6a0-40d6-88dc-c37a33083394",
        "type": 2
      },
      {
        "bubbleId": "af571940-8835-469e-ac12-ffaaf417a8a3",
        "type": 2,
        "serverBubbleId": "358bc6a9-6706-45b4-bc18-2b1308ebecc5"
      },
      {
        "bubbleId": "881d3653-8f4a-41a1-843f-7d56c324ee04",
        "type": 2
      },
      {
        "bubbleId": "23bca848-cef5-47cf-aa0d-bd22cdf2f199",
        "type": 2
      },
      {
        "bubbleId": "e5bbece2-121a-4c8e-bcab-c0d855e8fca9",
        "type": 2,
        "serverBubbleId": "b4345805-8be1-4c61-b7b7-8036a8d2297d"
      },
      {
        "bubbleId": "720c7dad-ec90-4c1b-9204-bc015a3037fe",
        "type": 2
      },
      {
        "bubbleId": "205413a2-230a-44ef-8842-e4cc55b84378",
        "type": 2
      },
      {
        "bubbleId": "fc6a5748-832c-4bfd-a86b-e7be4bab8b4c",
        "type": 2
      },
      {
        "bubbleId": "0e2704cb-6e64-4e72-9412-eb551c5fd143",
        "type": 2
      },
      {
        "bubbleId": "4dd4f18a-859d-496e-96a4-80e4d002eca2",
        "type": 2,
        "serverBubbleId": "54fda625-277e-4315-9c38-9ef4b5894866"
      },
      {
        "bubbleId": "1949fb24-8e08-47b7-901b-4bb90935124e",
        "type": 2
      },
      {
        "bubbleId": "cb2a5b8c-a84a-4097-b5e9-7596de9cb528",
        "type": 2
      },
      {
        "bubbleId": "4e0640b0-ab3c-4542-ac08-9f079b5fbabb",
        "type": 2
      },
      {
        "bubbleId": "06e24231-18f0-42f3-b825-ac690bdda0c0",
        "type": 2,
        "serverBubbleId": "3e56bb8d-7bdd-41a9-9d26-12836081ba7d"
      },
      {
        "bubbleId": "5730ebe2-3fc1-4e06-97e9-fa67304d561c",
        "type": 2
      },
      {
        "bubbleId": "14349977-dd10-403b-bb7a-b78589f39af1",
        "type": 1
      },
      {
        "bubbleId": "70d54e7d-f9eb-4039-9a1f-8e089d482344",
        "type": 2,
        "serverBubbleId": "37a70b71-17e0-4530-b4b3-54bb32779c8d"
      },
      {
        "bubbleId": "a41ffc29-b95c-4298-8c54-a6ecc68363e9",
        "type": 2
      },
      {
        "bubbleId": "47871374-53b4-4f0c-984e-a774459d80ff",
        "type": 2
      },
      {
        "bubbleId": "7156ee4e-0b07-4afc-8f99-9cb1f279ec6a",
        "type": 2
      },
      {
        "bubbleId": "86f15e2f-93ca-4de0-88c8-a11f2cce1d47",
        "type": 2,
        "serverBubbleId": "facc9acf-075c-4284-9f80-13674128bd30"
      },
      {
        "bubbleId": "6f46c4fe-4baf-42d3-a68e-0345a8bfb72a",
        "type": 2
      },
      {
        "bubbleId": "8ca7841f-9732-4f20-8dd0-9223e6c014e7",
        "type": 2
      },
      {
        "bubbleId": "42b594ac-025f-4363-bb84-70672e9bbfc9",
        "type": 2
      },
      {
        "bubbleId": "7468c528-05b9-445b-bb2d-a86dc9ec1dca",
        "type": 2,
        "serverBubbleId": "b23e56e3-ef1f-4a12-b2bc-089fffae1f16"
      },
      {
        "bubbleId": "accd1681-b5dd-485f-9b81-fe887fcee947",
        "type": 2
      },
      {
        "bubbleId": "7b9b0393-69ff-4734-a895-360c90e40660",
        "type": 2
      },
      {
        "bubbleId": "9e580791-6c43-4bcd-9eef-c23b2fbdfa7e",
        "type": 2
      },
      {
        "bubbleId": "7b465ae2-97ed-4512-add6-588e3f42f7c4",
        "type": 2,
        "serverBubbleId": "d2d886fd-f796-4b29-aa46-329380768f41"
      },
      {
        "bubbleId": "826c62ec-3fc2-46b5-bb78-601ce4449514",
        "type": 2
      },
      {
        "bubbleId": "5e4667aa-1f80-4035-afdf-c83ec0d89cee",
        "type": 2
      },
      {
        "bubbleId": "e3c2475a-5077-4650-813f-0787c9813beb",
        "type": 2
      },
      {
        "bubbleId": "a710b8a2-3a15-4905-bab8-2aa4e5a94ee9",
        "type": 2,
        "serverBubbleId": "a0c4f5f8-3939-4b7c-8070-b70a219df5dd"
      },
      {
        "bubbleId": "89a42b25-905a-4336-b1bd-f0ebcd7c7bdf",
        "type": 2
      },
      {
        "bubbleId": "4969d2d2-0036-4783-adcf-c854dce1c650",
        "type": 2
      },
      {
        "bubbleId": "5d9e9e71-5a13-4bf1-a3f1-d34313d0cc5f",
        "type": 2,
        "serverBubbleId": "0d8440b7-6bdc-4903-8e1d-a8eaafc2da0d"
      },
      {
        "bubbleId": "a63bd98a-e751-4783-9afa-8cb493c8c2dd",
        "type": 2
      },
      {
        "bubbleId": "47b9050e-4d99-44f7-adad-9feace756c72",
        "type": 2
      },
      {
        "bubbleId": "fe0a70b2-3532-4f4c-b570-b5ab3e87581c",
        "type": 2
      },
      {
        "bubbleId": "ac7b1704-4126-493e-88f8-4ecdfe03398c",
        "type": 2,
        "serverBubbleId": "04b45964-9ba6-47fa-98ee-6d430517974b"
      },
      {
        "bubbleId": "31f5d06a-2af0-4125-9958-b2ba7fd2b751",
        "type": 2
      },
      {
        "bubbleId": "345f544d-1473-4dc3-a14c-0c3df6f6ac61",
        "type": 2
      },
      {
        "bubbleId": "5ad2d114-dcf5-4460-9550-b7c9ad82b82d",
        "type": 2,
        "serverBubbleId": "16528fee-04c5-4413-86f2-5a662456e16a"
      },
      {
        "bubbleId": "9e1670d8-39e3-4660-ad49-52942be2691e",
        "type": 2
      },
      {
        "bubbleId": "6c39148d-6c91-42b7-b403-265f26fa5f32",
        "type": 2
      },
      {
        "bubbleId": "822b32b7-c832-405f-aa7b-6c72c7a88fc1",
        "type": 2
      },
      {
        "bubbleId": "c269ba81-d141-47a3-b752-3b5432fdb5d0",
        "type": 2,
        "serverBubbleId": "955d7d20-49ce-400a-82c8-19ed5f381265"
      },
      {
        "bubbleId": "95107a9e-249b-4b14-b9ed-851a12b2243f",
        "type": 2
      },
      {
        "bubbleId": "c3fdf858-6c93-4503-ad80-42ba7b689f05",
        "type": 2
      },
      {
        "bubbleId": "2d6e76bc-6aa7-4aba-ae9e-45617a3e558b",
        "type": 2
      },
      {
        "bubbleId": "fa3a84d2-39ed-4fb2-8e3a-037334b204fd",
        "type": 2,
        "serverBubbleId": "27c0f645-bad3-4b06-87f3-f6588bc8dc0c"
      },
      {
        "bubbleId": "0a10c7fc-32c8-4c86-bd3a-b68bf1cf32e7",
        "type": 2
      },
      {
        "bubbleId": "1ea233ac-3505-4c5d-ac4e-2512990c0dea",
        "type": 2
      },
      {
        "bubbleId": "62f35747-61de-419c-a587-73ca8a7a2114",
        "type": 2
      },
      {
        "bubbleId": "48a48930-31fe-4f99-ad9a-6d04158ef62e",
        "type": 2
      },
      {
        "bubbleId": "aeddb3eb-f02f-4f52-bfa2-2866d806ea32",
        "type": 2,
        "serverBubbleId": "3c02e205-98f9-4252-988d-c16e98ea6b48"
      },
      {
        "bubbleId": "c785ec99-f37c-44e7-9a64-c80ebf6196b1",
        "type": 2
      },
      {
        "bubbleId": "6d1a319b-3b27-4c8e-9061-9cb2ebb4b6e4",
        "type": 2
      },
      {
        "bubbleId": "e7955151-66e8-47aa-8e18-2687ebf694b7",
        "type": 2
      },
      {
        "bubbleId": "fff19ac1-3a47-4812-bd51-6b37e7bcd777",
        "type": 2,
        "serverBubbleId": "35954e8b-6120-4e78-88b3-b5ef61decc77"
      },
      {
        "bubbleId": "a8ccbed2-7d98-478c-9310-052f7cc77299",
        "type": 2
      },
      {
        "bubbleId": "de709984-9465-4dba-b832-5379bc9d5ded",
        "type": 2
      },
      {
        "bubbleId": "c25749c4-dd6f-4354-bdf4-71f2e2b14613",
        "type": 2,
        "serverBubbleId": "b845cc7e-2bf9-4e52-973a-bc07baecf58d"
      },
      {
        "bubbleId": "06634790-4426-4a6f-996f-74a99821eb78",
        "type": 2
      },
      {
        "bubbleId": "d703a755-7888-4282-a6d1-f155cd8c20ec",
        "type": 2
      },
      {
        "bubbleId": "ec22eab8-ebd9-40eb-bd30-6f826b474412",
        "type": 2
      },
      {
        "bubbleId": "60002faf-8ba8-49d9-ab9c-b56bda7281bb",
        "type": 2
      },
      {
        "bubbleId": "e6c7592f-39b9-4e26-b13a-095e8a466d74",
        "type": 2
      },
      {
        "bubbleId": "ba82022a-7229-4508-b6cf-53e940e27d0b",
        "type": 1
      },
      {
        "bubbleId": "2dffd9ea-9129-4273-a1e7-46aa142987f3",
        "type": 2
      },
      {
        "bubbleId": "f0544b30-a481-48d4-ace1-014d6cac3f0f",
        "type": 2
      },
      {
        "bubbleId": "c2928f40-04d4-4d3d-a60b-a0eb0b280a04",
        "type": 2
      }
    ],
    "conversationMap": {},
    "status": "aborted",
    "context": {
      "composers": [],
      "quotes": [],
      "selectedCommits": [],
      "selectedPullRequests": [],
      "selectedImages": [],
      "folderSelections": [],
      "fileSelections": [],
      "selections": [],
      "terminalSelections": [],
      "selectedDocs": [],
      "externalLinks": [],
      "cursorRules": [],
      "cursorCommands": [],
      "ideEditorsState": true,
      "gitPRDiffSelections": [],
      "mentions": {
        "composers": {},
        "quotes": {},
        "selectedCommits": {},
        "selectedPullRequests": {},
        "gitDiff": [],
        "gitDiffFromBranchToMain": [],
        "selectedImages": {},
        "useWeb": [],
        "folderSelections": {},
        "fileSelections": {},
        "terminalFiles": {},
        "selections": {},
        "terminalSelections": {},
        "selectedDocs": {},
        "externalLinks": {},
        "useLinterErrors": [],
        "useDiffReview": [],
        "useGenerateRules": [],
        "useContextPicking": [],
        "useRememberThis": [],
        "diffHistory": [],
        "cursorRules": {},
        "cursorCommands": {},
        "autoContext": [],
        "uiElementSelections": [],
        "consoleLogs": [],
        "ideEditorsState": [],
        "gitPRDiffSelections": {}
      }
    },
    "gitGraphFileSuggestions": [],
    "generatingBubbleIds": [],
    "isReadingLongFile": false,
    "codeBlockData": {
      "file:///k%3A/FQC-Tracking-App/PROJECT_STATUS_SUMMARY.md": {
        "d0d5344d-682e-42dd-a05f-019f58c3c8cb": {
          "_v": 3,
          "bubbleId": "963fb43d-d7b3-4b68-ae48-4cae2ba7413d",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\PROJECT_STATUS_SUMMARY.md",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/PROJECT_STATUS_SUMMARY.md",
            "path": "/K:/FQC-Tracking-App/PROJECT_STATUS_SUMMARY.md",
            "scheme": "file"
          },
          "codeblockId": "d0d5344d-682e-42dd-a05f-019f58c3c8cb",
          "status": "completed",
          "languageId": "markdown",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767866902089,
          "composerChatGenerationUuid": "fe998a77-e9d2-40b2-a086-41ae1ca79682",
          "diffId": "dc38e861-b2fb-42bc-a65b-4a2a9c7f27c6",
          "lastDiffId": "ffa84e91-9d5d-4786-8d88-0e392add9cf0",
          "lastAppliedAt": 1767866912180
        }
      },
      "file:///k%3A/FQC-Tracking-App/COMPREHENSIVE_ANALYSIS.md": {
        "52e590ce-a069-4216-a209-9f21dba38ce2": {
          "_v": 3,
          "bubbleId": "9d88ecc3-ba4c-487f-848c-4d6dc7b3143c",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\COMPREHENSIVE_ANALYSIS.md",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/COMPREHENSIVE_ANALYSIS.md",
            "path": "/K:/FQC-Tracking-App/COMPREHENSIVE_ANALYSIS.md",
            "scheme": "file"
          },
          "codeblockId": "52e590ce-a069-4216-a209-9f21dba38ce2",
          "status": "completed",
          "languageId": "markdown",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767867141987,
          "composerChatGenerationUuid": "064b9136-4526-4475-9637-f6df8c88ea26",
          "diffId": "b84c2b16-a61d-4778-8ccc-1f6cf74cf3b0",
          "lastDiffId": "3dd56a7f-9c2d-4c62-8e69-14dece7928e5",
          "lastAppliedAt": 1767867153769
        }
      },
      "file:///k%3A/FQC-Tracking-App/COMPLETE_SCREEN_DATA_FLOW.md": {
        "7efbecc8-46b2-4b21-beae-8207f67348b9": {
          "_v": 3,
          "bubbleId": "2499932b-bbc7-4b9b-b8f7-05e01dc8053d",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\COMPLETE_SCREEN_DATA_FLOW.md",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/COMPLETE_SCREEN_DATA_FLOW.md",
            "path": "/K:/FQC-Tracking-App/COMPLETE_SCREEN_DATA_FLOW.md",
            "scheme": "file"
          },
          "codeblockId": "7efbecc8-46b2-4b21-beae-8207f67348b9",
          "status": "accepted",
          "languageId": "markdown",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767867683805,
          "composerChatGenerationUuid": "40312887-01a3-47c1-ae72-f20247f7a1d9",
          "diffId": "0d2c3fa1-6455-4833-bad2-32be4d499b57",
          "lastDiffId": "843a76cc-dab0-4bd6-8050-af4dbd140f65",
          "lastAppliedAt": 1767867695221,
          "partialInlineDiffFatesId": "8945f22d-f469-42d0-97ce-1590e5045231"
        }
      },
      "file:///k%3A/FQC-Tracking-App/WORKFLOW_REQUIREMENTS_SUMMARY.md": {
        "bf370054-66cc-4fe8-bbbf-a412cf1a4abd": {
          "_v": 3,
          "bubbleId": "aa5a7f74-0aab-49dc-afcc-7f169e1244c5",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\WORKFLOW_REQUIREMENTS_SUMMARY.md",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/WORKFLOW_REQUIREMENTS_SUMMARY.md",
            "path": "/K:/FQC-Tracking-App/WORKFLOW_REQUIREMENTS_SUMMARY.md",
            "scheme": "file"
          },
          "codeblockId": "bf370054-66cc-4fe8-bbbf-a412cf1a4abd",
          "status": "accepted",
          "languageId": "markdown",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767882669545,
          "composerChatGenerationUuid": "1e036db2-1607-4a54-b71b-d2884c39a7c0",
          "diffId": "98d8d4c7-0acb-44bf-8f4e-ccde67c211d5",
          "lastDiffId": "a9a6a8da-ae43-4f70-861b-67cff8098b30",
          "lastAppliedAt": 1767882689076,
          "partialInlineDiffFatesId": "7ebe8632-7dd2-4bbb-86f0-66d5c3ed2a2f"
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt": {
        "d84ff257-52b1-4fb8-b55a-1d4390aef82e": {
          "_v": 3,
          "bubbleId": "d5282fb6-a292-4bf4-b53f-cb450c30fb18",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "d84ff257-52b1-4fb8-b55a-1d4390aef82e",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946591881,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "35c21d4e-8103-49ea-8a55-6e968aefbca7",
          "lastDiffId": "f9bfc110-6773-485b-9f64-0236a8a379c4",
          "lastAppliedAt": 1767946602226
        },
        "09cb8edc-e99e-4e8e-a702-83ee6c50cb97": {
          "_v": 3,
          "bubbleId": "0ce521dd-5f11-4770-8bf3-953c93d9cebf",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "09cb8edc-e99e-4e8e-a702-83ee6c50cb97",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "d84ff257-52b1-4fb8-b55a-1d4390aef82e",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946645488,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "774e2f3e-594e-4a27-8b25-ec2cc450a427",
          "lastDiffId": "3acd4567-e2f2-4eaa-b8df-17e8c54b17b0",
          "lastAppliedAt": 1767946651948
        },
        "69e31821-109c-4571-bf4e-c49139905e45": {
          "_v": 3,
          "bubbleId": "cd71c795-89d2-4bac-bfd8-cefe1157cfce",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "69e31821-109c-4571-bf4e-c49139905e45",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "09cb8edc-e99e-4e8e-a702-83ee6c50cb97",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946655174,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "d7ca56e2-fc9b-403d-b780-f08ff0236309",
          "lastDiffId": "da7fdcc8-b3df-4db6-bc47-225bde67a330",
          "lastAppliedAt": 1767946661661
        },
        "39687eac-498a-483f-b6ae-d44635e8f69e": {
          "_v": 3,
          "bubbleId": "2601dd43-850f-4a8a-8928-e33b3efe3818",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "39687eac-498a-483f-b6ae-d44635e8f69e",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "69e31821-109c-4571-bf4e-c49139905e45",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946664827,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "f790a1df-95fa-495a-9dde-c193f04626ea",
          "lastDiffId": "199d015b-6a61-46b4-86f0-35555abd1ec1",
          "lastAppliedAt": 1767946671264
        },
        "0c19b3c8-bf30-47ae-8f36-58ffceb0856e": {
          "_v": 3,
          "bubbleId": "632f1f91-ebae-452e-a40c-27bc558fad7c",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "0c19b3c8-bf30-47ae-8f36-58ffceb0856e",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "39687eac-498a-483f-b6ae-d44635e8f69e",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946674435,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "ca603d3e-63f4-4573-b01f-2154ff305435",
          "lastDiffId": "7e6599ad-a9fd-4c6c-81f4-70c7b7246040",
          "lastAppliedAt": 1767946681051
        },
        "b4ed5995-54a8-430f-b5ce-b1d2ef2e6693": {
          "_v": 3,
          "bubbleId": "c3067181-89b0-44d7-b9c8-c367ecfbe625",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "b4ed5995-54a8-430f-b5ce-b1d2ef2e6693",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "0c19b3c8-bf30-47ae-8f36-58ffceb0856e",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946684286,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "de50d7c8-558e-4443-b7d8-9f6c382e5908",
          "lastDiffId": "502e95c6-ebfb-4a26-ba13-2fd232c80554",
          "lastAppliedAt": 1767946690769
        },
        "5391a3bb-44e9-45dc-a749-998a4827a102": {
          "_v": 3,
          "bubbleId": "582a3c6d-a2d5-4e31-9b7b-f566cce92d00",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "5391a3bb-44e9-45dc-a749-998a4827a102",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "b4ed5995-54a8-430f-b5ce-b1d2ef2e6693",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946694107,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "b039fb1e-70e5-4e4f-a64d-c367ed2281b5",
          "lastDiffId": "27ad93a4-f055-4468-8843-6244b67631aa",
          "lastAppliedAt": 1767946700792
        },
        "77feaf1e-09bb-4ae9-904c-86af286de3e2": {
          "_v": 3,
          "bubbleId": "d1b23f81-9c0c-4e55-931a-2de5d068c3a9",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "77feaf1e-09bb-4ae9-904c-86af286de3e2",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "5391a3bb-44e9-45dc-a749-998a4827a102",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946704198,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "815bfed6-e64f-4cd5-9bfa-44753c011838",
          "lastDiffId": "6e3e57db-d802-4b66-9cda-b0f4d6fdfb23",
          "lastAppliedAt": 1767946710847
        },
        "67e4681b-d272-46c8-b358-35675c996f75": {
          "_v": 3,
          "bubbleId": "cf290dcd-bab5-415b-b853-44a63b0df99c",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "67e4681b-d272-46c8-b358-35675c996f75",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "77feaf1e-09bb-4ae9-904c-86af286de3e2",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946714260,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "bc253e7a-ed5e-4618-8b92-bbc8bef4d0fd",
          "lastDiffId": "bb415b99-1efe-4e1c-b8f5-02f4eaf3cf73",
          "lastAppliedAt": 1767946720863
        },
        "a1741667-d07d-41e1-8ac2-833444ab7208": {
          "_v": 3,
          "bubbleId": "cb963b03-bef2-420f-b17c-d193ea7708ee",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "a1741667-d07d-41e1-8ac2-833444ab7208",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "67e4681b-d272-46c8-b358-35675c996f75",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946724174,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "2987c8cf-c113-4dba-9481-e86603a271d9",
          "lastDiffId": "71b3a4f7-3133-4ec2-864c-83dc19111872",
          "lastAppliedAt": 1767946730931
        },
        "9c6423fe-670d-4a95-b90b-3351721f8e77": {
          "_v": 3,
          "bubbleId": "0454acd9-5f1f-48b9-9a29-87e00948b450",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "9c6423fe-670d-4a95-b90b-3351721f8e77",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "a1741667-d07d-41e1-8ac2-833444ab7208",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946734241,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "002856bb-ac6c-49ba-86e0-ab854441d35f",
          "lastDiffId": "98466020-e947-4735-ba2d-35019bf0927b",
          "lastAppliedAt": 1767946740869
        },
        "a1df6c75-debe-4191-9c7e-005a62dfeb68": {
          "_v": 3,
          "bubbleId": "2ede80b1-968e-4268-99d4-6f793d57c9bf",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "a1df6c75-debe-4191-9c7e-005a62dfeb68",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "9c6423fe-670d-4a95-b90b-3351721f8e77",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946778779,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "84813703-6b0c-41d9-9dae-d6ffa16c4623",
          "lastDiffId": "e3a20960-7ebc-478b-a491-39f10c68e678",
          "lastAppliedAt": 1767946785867
        },
        "a15fe1c4-8d58-4a5b-bc56-620df41b99e6": {
          "_v": 3,
          "bubbleId": "3f5f2d57-00f1-481a-b6df-ba88af566e46",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "a15fe1c4-8d58-4a5b-bc56-620df41b99e6",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "a1df6c75-debe-4191-9c7e-005a62dfeb68",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946789182,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "076f91a1-c818-40f4-87e3-11947c6c178f",
          "lastDiffId": "bfe5173d-40ec-4cf1-a15b-7f53c53f4672",
          "lastAppliedAt": 1767946795769
        },
        "f28e7cce-3d5d-4553-b2c7-16530c5d37b3": {
          "_v": 3,
          "bubbleId": "945acf21-df3a-4221-b4a1-a6341f7b20d7",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "f28e7cce-3d5d-4553-b2c7-16530c5d37b3",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946799078,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0"
        },
        "6faec19c-03f4-4cf9-a549-3a6c0c88fbbe": {
          "_v": 3,
          "bubbleId": "0db6626c-fcab-4074-bf54-60c3d87679fb",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "6faec19c-03f4-4cf9-a549-3a6c0c88fbbe",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "a15fe1c4-8d58-4a5b-bc56-620df41b99e6",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946805729,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "270eceb1-36bd-416a-b18d-ecf2532ef4a9",
          "lastDiffId": "059d31ae-51dc-4fa5-9d9e-96b8bea21502",
          "lastAppliedAt": 1767946812467
        },
        "64183f14-068d-485c-a541-5368f8d329d1": {
          "_v": 3,
          "bubbleId": "230c17d3-9350-4357-a19e-5ece09dfe809",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "64183f14-068d-485c-a541-5368f8d329d1",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "6faec19c-03f4-4cf9-a549-3a6c0c88fbbe",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946815860,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "60e2a962-b5a4-47ae-8f91-8b846f1507ce",
          "lastDiffId": "6b14a409-8aba-45b7-9158-a395cec6d320",
          "lastAppliedAt": 1767946822609
        },
        "58af36c8-409c-4668-90a1-1290001f4700": {
          "_v": 3,
          "bubbleId": "71e50d9c-6798-4527-b96b-a2fa0d137630",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "58af36c8-409c-4668-90a1-1290001f4700",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "64183f14-068d-485c-a541-5368f8d329d1",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952315835,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "c8aacbde-3502-444d-ba44-5bf6ee35c242",
          "lastDiffId": "6c034fd2-5fbd-42de-a008-36ef5d6a721e",
          "lastAppliedAt": 1767952322651
        },
        "b36dde56-abdc-445e-bfce-4a033f5b26ba": {
          "_v": 3,
          "bubbleId": "9ea22b01-cd94-4d9b-9c78-1681e31690d0",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "b36dde56-abdc-445e-bfce-4a033f5b26ba",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "58af36c8-409c-4668-90a1-1290001f4700",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952352443,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "1e21ee29-7392-403f-b316-e0f70d5a96ac",
          "lastDiffId": "604daa35-c350-4341-8a60-b54c43557404",
          "lastAppliedAt": 1767952363592
        },
        "88f60e69-46ea-451a-8a96-f063e4658b59": {
          "_v": 3,
          "bubbleId": "22245c4b-96d9-47ff-a864-da46dcca085e",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "88f60e69-46ea-451a-8a96-f063e4658b59",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "b36dde56-abdc-445e-bfce-4a033f5b26ba",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952429583,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "b357710e-0f90-4b70-b27a-d7b2f93f77bc",
          "lastDiffId": "841d4b97-54bb-4022-8ac7-d2c32fbcd0b2",
          "lastAppliedAt": 1767952440422
        },
        "818d5f39-9d9f-4d12-ad0b-5c3914fc6745": {
          "_v": 3,
          "bubbleId": "f7583ffb-0d98-4fbb-9b09-b67e6241fa1b",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\UnsyncedDataSyncService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
            "scheme": "file"
          },
          "codeblockId": "818d5f39-9d9f-4d12-ad0b-5c3914fc6745",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "88f60e69-46ea-451a-8a96-f063e4658b59",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952443799,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "72cf800d-87bf-40e8-8c31-0e25cf2e10b5",
          "lastDiffId": "f12a21fc-d19f-48ed-821a-14c686ef6f26",
          "lastAppliedAt": 1767952450765
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt": {
        "de932b63-56cd-4a84-b98e-30e2e1f1134d": {
          "_v": 3,
          "bubbleId": "68481205-c629-4aa8-8be6-8da4ed2dbbcc",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\LandingScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "de932b63-56cd-4a84-b98e-30e2e1f1134d",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946858348,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "19e93055-9a43-48cc-9bfe-1b296cf2a5a5",
          "lastDiffId": "17b9b8b0-028a-463b-83c9-96f0460bed3a",
          "lastAppliedAt": 1767946865816
        },
        "1a382976-ba7f-4d3a-b7de-012f87e43f20": {
          "_v": 3,
          "bubbleId": "1ba73d95-8e48-4a48-8807-730b44b6704f",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\LandingScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "1a382976-ba7f-4d3a-b7de-012f87e43f20",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "de932b63-56cd-4a84-b98e-30e2e1f1134d",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946869080,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "26aa7b02-90da-4b61-826f-d4e5b0ffa3d8",
          "lastDiffId": "9d7b4db6-b565-4ac2-99ff-dd2ff4f2bd56",
          "lastAppliedAt": 1767946875983
        },
        "4971eaca-eea4-4174-8b83-2d54331b0e92": {
          "_v": 3,
          "bubbleId": "25334020-98e7-4b1b-a7f1-2c7974cad632",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\LandingScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "4971eaca-eea4-4174-8b83-2d54331b0e92",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "1a382976-ba7f-4d3a-b7de-012f87e43f20",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946888373,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "4169feab-1140-4126-a58c-3862943453ef",
          "lastDiffId": "498b1505-106a-4629-bc5c-7fac99c35134",
          "lastAppliedAt": 1767946895727
        },
        "7c1c75a4-3e36-4310-b82a-0237e4053893": {
          "_v": 3,
          "bubbleId": "b86ac482-cc8a-45ee-b74c-92696a4dfb62",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\LandingScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "7c1c75a4-3e36-4310-b82a-0237e4053893",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "4971eaca-eea4-4174-8b83-2d54331b0e92",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767946899048,
          "composerChatGenerationUuid": "5dd23d05-c303-4105-b5bb-83125a077eb0",
          "diffId": "1b512544-028b-424e-a8a9-d0167e289298",
          "lastDiffId": "b7a7481e-af64-4cc2-b3e3-d8934f1739fc",
          "lastAppliedAt": 1767946905915
        },
        "9525c1d5-3495-4500-b533-72c58f3e1d39": {
          "_v": 3,
          "bubbleId": "235ca038-8f09-41e9-b8f1-48cc48c77f0f",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\LandingScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "9525c1d5-3495-4500-b533-72c58f3e1d39",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "7c1c75a4-3e36-4310-b82a-0237e4053893",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952251096,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "5ba71c8b-7a5b-454f-adc7-81a8cacf191c",
          "lastDiffId": "206c6102-871f-4483-a71b-ccd9226c81be",
          "lastAppliedAt": 1767952257685
        },
        "55fb3d0d-b6db-4a9f-bfc8-9dc56f351aab": {
          "_v": 3,
          "bubbleId": "9b8295c5-63f0-45c7-85c2-e7ed019841b0",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\LandingScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "55fb3d0d-b6db-4a9f-bfc8-9dc56f351aab",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "9525c1d5-3495-4500-b533-72c58f3e1d39",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952260986,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "c3e96645-5dcc-4552-8cd8-b648a3b95422",
          "lastDiffId": "55ab6b06-ab41-4400-bf00-2f8ef5a20479",
          "lastAppliedAt": 1767952267704
        },
        "9a6b6957-998f-4784-898d-f9c4d9440e5e": {
          "_v": 3,
          "bubbleId": "217385eb-54fc-43bf-b8b2-98f529a009a4",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\LandingScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "9a6b6957-998f-4784-898d-f9c4d9440e5e",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "55fb3d0d-b6db-4a9f-bfc8-9dc56f351aab",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767963826089,
          "composerChatGenerationUuid": "b5b14bd6-6927-48d6-b565-d9a3c04c10ea",
          "diffId": "0194854f-590e-49ad-862e-a54a24c5593b",
          "lastDiffId": "b49ec1c2-caf5-4bdc-905d-371b9fd659e7",
          "lastAppliedAt": 1767963833312
        },
        "1df48f70-76c8-4db8-b246-3cb4830d1854": {
          "_v": 3,
          "bubbleId": "4c4b2815-e6cf-47b1-9e6d-888af05c440a",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\LandingScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "1df48f70-76c8-4db8-b246-3cb4830d1854",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "9a6b6957-998f-4784-898d-f9c4d9440e5e",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767963857039,
          "composerChatGenerationUuid": "b5b14bd6-6927-48d6-b565-d9a3c04c10ea",
          "diffId": "8a72bb22-4fc3-4096-96e4-f3dbe8c76106",
          "lastDiffId": "3624c22a-d624-4fac-8b4b-6d4234ef91e5",
          "lastAppliedAt": 1767963866042
        },
        "4c0520a2-5c68-4668-88b4-7e4686f3486c": {
          "_v": 3,
          "bubbleId": "de751228-5c61-4896-a8eb-3654b9a0f5fa",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\LandingScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "4c0520a2-5c68-4668-88b4-7e4686f3486c",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "1df48f70-76c8-4db8-b246-3cb4830d1854",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767963869526,
          "composerChatGenerationUuid": "b5b14bd6-6927-48d6-b565-d9a3c04c10ea",
          "diffId": "aca2eb82-48a5-4fc4-815d-ce9a6593f8c0",
          "lastDiffId": "3f838710-c092-400e-8554-233bfa826429",
          "lastAppliedAt": 1767963876441
        },
        "d5995d57-9472-4c82-bb37-7c54fb838bb3": {
          "_v": 3,
          "bubbleId": "622c482a-7bf9-43e5-8763-362162452c8c",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\LandingScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "d5995d57-9472-4c82-bb37-7c54fb838bb3",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "4c0520a2-5c68-4668-88b4-7e4686f3486c",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767967736455,
          "composerChatGenerationUuid": "037b7284-30dc-4fe8-8ef4-a8455cfa4f1c",
          "diffId": "953efce0-07fa-4ce1-a5d1-3d5439841546",
          "lastDiffId": "03102ca0-1ab2-4979-9f8f-e29f40d645b5",
          "lastAppliedAt": 1767967743865
        },
        "38ad3600-1917-4a66-93a1-ae8172072b5a": {
          "_v": 3,
          "bubbleId": "7957074e-f274-446e-8d70-4b2dedffe68f",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\LandingScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "38ad3600-1917-4a66-93a1-ae8172072b5a",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "d5995d57-9472-4c82-bb37-7c54fb838bb3",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768028898720,
          "composerChatGenerationUuid": "160a5a6f-71c5-4784-815d-cfd31be33ae3",
          "diffId": "94998ad8-2914-48f6-b8b8-a97798551094",
          "lastDiffId": "9f9fb5ff-99c6-4151-82bb-d23a07700e6c",
          "lastAppliedAt": 1768028906246
        },
        "a24999ac-ab29-4b7d-8292-8ba1d0a25bf9": {
          "_v": 3,
          "bubbleId": "e52553ff-2381-4727-adea-d1735cbe7548",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\LandingScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "a24999ac-ab29-4b7d-8292-8ba1d0a25bf9",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "38ad3600-1917-4a66-93a1-ae8172072b5a",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768038198818,
          "composerChatGenerationUuid": "c251c5f3-0079-43fb-bca8-3dab5a346cd7",
          "diffId": "cba32ccf-5a15-4072-b308-7d39181c731e",
          "lastDiffId": "76b8638c-01ba-48fa-b21a-0cd79e607f00",
          "lastAppliedAt": 1768038212653
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/entities/Device.kt": {
        "577d81e1-7c12-4219-9c5a-0c6352cf0be8": {
          "_v": 3,
          "bubbleId": "23ab48e2-7f50-4d55-8b59-4583378ac2aa",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\entities\\Device.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/entities/Device.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/entities/Device.kt",
            "scheme": "file"
          },
          "codeblockId": "577d81e1-7c12-4219-9c5a-0c6352cf0be8",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947025783,
          "composerChatGenerationUuid": "73ea6a36-60ae-4f7e-b604-b4d56241f7d3",
          "diffId": "33272c88-ebd2-44ee-9244-92d4590b97a5",
          "lastDiffId": "cf1cfc95-2e37-4a58-b845-cfb775c42137",
          "lastAppliedAt": 1767947033397
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt": {
        "a3c67615-fdcc-4f8a-a5a9-353485af2eb2": {
          "_v": 3,
          "bubbleId": "306972da-bdef-4c7b-b54f-9cb9307d1cfa",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\AppDatabase.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt",
            "scheme": "file"
          },
          "codeblockId": "a3c67615-fdcc-4f8a-a5a9-353485af2eb2",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947062259,
          "composerChatGenerationUuid": "73ea6a36-60ae-4f7e-b604-b4d56241f7d3",
          "diffId": "849280f7-3529-44ee-bbaf-feeaf58d2116",
          "lastDiffId": "8955a5e7-9a07-4612-bc8e-8249ef01a754",
          "lastAppliedAt": 1767947069143
        },
        "9143270c-451f-4dcf-a34c-cb8dbe6f71e8": {
          "_v": 3,
          "bubbleId": "9640a20e-205b-4316-9a16-5fbaf15523ad",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\AppDatabase.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt",
            "scheme": "file"
          },
          "codeblockId": "9143270c-451f-4dcf-a34c-cb8dbe6f71e8",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "a3c67615-fdcc-4f8a-a5a9-353485af2eb2",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947072334,
          "composerChatGenerationUuid": "73ea6a36-60ae-4f7e-b604-b4d56241f7d3",
          "diffId": "db9fa76d-a9bd-4965-99e0-64377b2cb0fd",
          "lastDiffId": "46be1b1b-f008-4271-89bf-46743eeab46a",
          "lastAppliedAt": 1767947078786
        },
        "5b105cb9-22a3-4554-b7e4-622d7245ebc4": {
          "_v": 3,
          "bubbleId": "36fde9b0-a722-4e7b-9e1a-922004969dc0",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\AppDatabase.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt",
            "scheme": "file"
          },
          "codeblockId": "5b105cb9-22a3-4554-b7e4-622d7245ebc4",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "9143270c-451f-4dcf-a34c-cb8dbe6f71e8",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947087500,
          "composerChatGenerationUuid": "73ea6a36-60ae-4f7e-b604-b4d56241f7d3",
          "diffId": "274fc255-e2e8-40c4-b5a6-a795a85920b0",
          "lastDiffId": "ed768942-1848-472c-8b1f-0c56d326ea2c",
          "lastAppliedAt": 1767947094061
        },
        "f2caa8c4-af27-4ad4-8bda-5b71e8b6d8d0": {
          "_v": 3,
          "bubbleId": "d5329024-c5ec-448a-aaaf-719aabdeeb2b",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\AppDatabase.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt",
            "scheme": "file"
          },
          "codeblockId": "f2caa8c4-af27-4ad4-8bda-5b71e8b6d8d0",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "5b105cb9-22a3-4554-b7e4-622d7245ebc4",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952228848,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "5f811523-2515-4cd3-8687-5475ca59fcc6",
          "lastDiffId": "26e48486-08fb-4426-97e6-49a1dff0f801",
          "lastAppliedAt": 1767952235452
        },
        "49cbbf21-193d-449a-85be-765092d39a6f": {
          "_v": 3,
          "bubbleId": "8d27f709-e90f-4054-8b76-6f665346d181",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\AppDatabase.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt",
            "scheme": "file"
          },
          "codeblockId": "49cbbf21-193d-449a-85be-765092d39a6f",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952715096,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060"
        },
        "2fd133f7-c69c-440d-b114-f4dca73182e4": {
          "_v": 3,
          "bubbleId": "7b042612-7edf-4b29-a930-bfb9fcc4d475",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\AppDatabase.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt",
            "scheme": "file"
          },
          "codeblockId": "2fd133f7-c69c-440d-b114-f4dca73182e4",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "f2caa8c4-af27-4ad4-8bda-5b71e8b6d8d0",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952796865,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "81678a58-6677-41ca-ab84-00f79ae5dbaa",
          "lastDiffId": "ce9232cf-e190-46c6-88a4-4984139dbfaf",
          "lastAppliedAt": 1767952804887
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt": {
        "14aacaa0-584b-4c41-a66f-09842ce551a3": {
          "_v": 3,
          "bubbleId": "8cf24150-25fd-438d-97b8-557b658cb8de",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "14aacaa0-584b-4c41-a66f-09842ce551a3",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947136387,
          "composerChatGenerationUuid": "73ea6a36-60ae-4f7e-b604-b4d56241f7d3",
          "diffId": "5fb84b46-4543-499b-bbd3-bfb8b5ada1a7",
          "lastDiffId": "2d9a0525-d5b8-46e0-a6f3-fbccc4b7ce20",
          "lastAppliedAt": 1767947144352
        },
        "715f8382-34c6-4f48-9993-6f21a777d666": {
          "_v": 3,
          "bubbleId": "27ce4ce5-a4d4-4399-b8b2-272f520e6fb9",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "715f8382-34c6-4f48-9993-6f21a777d666",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "14aacaa0-584b-4c41-a66f-09842ce551a3",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947379008,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "e2354d75-fccc-437f-bf0a-9a25d04aa9db",
          "lastDiffId": "593b1f46-78a7-4675-ac28-ec1b7f3bef1f",
          "lastAppliedAt": 1767947386754
        },
        "9e9a0211-a29c-4ecc-a8b4-5e744979e277": {
          "_v": 3,
          "bubbleId": "ce157343-52b8-4b43-9ff8-a99a85e1376e",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "9e9a0211-a29c-4ecc-a8b4-5e744979e277",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947471843,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5"
        },
        "77020bfb-00ad-40d4-ab35-d01f8825e602": {
          "_v": 3,
          "bubbleId": "1582aecf-b9ad-435f-b689-83063715df80",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "77020bfb-00ad-40d4-ab35-d01f8825e602",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "715f8382-34c6-4f48-9993-6f21a777d666",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947489840,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "c4c425e2-95e2-495c-a149-612462073f3f",
          "lastDiffId": "742d7c1a-2708-4fa9-bf3c-f0846c5f429a",
          "lastAppliedAt": 1767947497224
        },
        "15f46c37-fa19-4abd-b9ee-de54e7df96a9": {
          "_v": 3,
          "bubbleId": "677baa09-ba64-4d35-b431-b8365960d9d0",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "15f46c37-fa19-4abd-b9ee-de54e7df96a9",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "77020bfb-00ad-40d4-ab35-d01f8825e602",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947560938,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "7c169c98-3505-465f-856b-fe1706c37e8a",
          "lastDiffId": "3ec47a31-198b-4cf2-a6d5-c8703c2a3305",
          "lastAppliedAt": 1767947576995
        },
        "a5ac1650-6c98-4f28-afe9-15f72f7b0c7e": {
          "_v": 3,
          "bubbleId": "67048797-6b46-4f82-9b2a-4c88ff816f92",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "a5ac1650-6c98-4f28-afe9-15f72f7b0c7e",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947580425,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5"
        },
        "0192ff78-a885-47fd-94e4-c1052a7defb9": {
          "_v": 3,
          "bubbleId": "24ba5222-27ad-492f-89cd-19af4b1ce94c",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "0192ff78-a885-47fd-94e4-c1052a7defb9",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947598481,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5"
        },
        "ae4ad20d-07ff-433d-8d9e-e4d1635824f6": {
          "_v": 3,
          "bubbleId": "d3a22116-750c-495e-91cc-9a007035e4f1",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "ae4ad20d-07ff-433d-8d9e-e4d1635824f6",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947609655,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5"
        },
        "974e93fe-c0e1-472c-8fd6-11864c62f6e3": {
          "_v": 3,
          "bubbleId": "74dac5a1-a0ea-464a-8f6a-69471bf7fc55",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "974e93fe-c0e1-472c-8fd6-11864c62f6e3",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947628251,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5"
        },
        "d8593b17-c4de-4855-be81-14a3e11194a8": {
          "_v": 3,
          "bubbleId": "1e61e4e9-a67d-4dc4-8104-08d25dd58b10",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "d8593b17-c4de-4855-be81-14a3e11194a8",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "15f46c37-fa19-4abd-b9ee-de54e7df96a9",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947648775,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "b6f30cf5-6e2c-49e8-bdce-eacda486977a",
          "lastDiffId": "cdc5e561-ac3f-40cd-a763-b12c4eb116db",
          "lastAppliedAt": 1767947656911
        },
        "ab13df82-53e9-4247-aaea-fc7b517dae70": {
          "_v": 3,
          "bubbleId": "7d78bd7f-165c-48b7-96fc-74a72ec82b24",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "ab13df82-53e9-4247-aaea-fc7b517dae70",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947774704,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5"
        },
        "15e74283-ecb8-44a4-be34-9c01cc8d138e": {
          "_v": 3,
          "bubbleId": "0b55c5bd-d6fb-45c9-b939-8b3f95c191c0",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "15e74283-ecb8-44a4-be34-9c01cc8d138e",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947800133,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5"
        },
        "7c8d9b4e-2f14-4641-a7c8-63d3ae130b17": {
          "_v": 3,
          "bubbleId": "a574e74c-fec6-41f0-a68f-cd66020a2c84",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "7c8d9b4e-2f14-4641-a7c8-63d3ae130b17",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947834862,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5"
        },
        "f2eebed2-c0e9-4f24-b2d3-38b1271def6e": {
          "_v": 3,
          "bubbleId": "263dfaf6-477b-473b-ba27-eb19b10f43d4",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "f2eebed2-c0e9-4f24-b2d3-38b1271def6e",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "d8593b17-c4de-4855-be81-14a3e11194a8",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947880287,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "13a25fa1-490c-49b5-99e7-6de911c6380e",
          "lastDiffId": "804df0f5-1214-4617-aacc-db849366c0bc",
          "lastAppliedAt": 1767947887584
        },
        "3ce03651-bc67-4132-a315-3167c846d58d": {
          "_v": 3,
          "bubbleId": "31833740-2000-46e6-9203-d91943957399",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "3ce03651-bc67-4132-a315-3167c846d58d",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "f2eebed2-c0e9-4f24-b2d3-38b1271def6e",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767951645706,
          "composerChatGenerationUuid": "dc27992e-0d22-4f07-9cf9-3444598c3bf8",
          "diffId": "6ed51d07-9b1f-4b9f-935c-1398768f5874",
          "lastDiffId": "7ab521e6-f031-4d1a-b7c2-89f896cf8533",
          "lastAppliedAt": 1767951661856
        },
        "11a9856a-d258-40b5-a571-845be81abeca": {
          "_v": 3,
          "bubbleId": "202d6a33-84d3-4732-8b0b-691d6ab34805",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "11a9856a-d258-40b5-a571-845be81abeca",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "3ce03651-bc67-4132-a315-3167c846d58d",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952186324,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "c87d0a66-c5af-4427-94a2-babc7347c796",
          "lastDiffId": "95afc45e-1dd0-4f23-a85c-2db804bf900a",
          "lastAppliedAt": 1767952201234
        },
        "55ae74c2-e878-4a52-86dd-90bcca1a010b": {
          "_v": 3,
          "bubbleId": "c2b216d5-9a86-42f5-b3a9-4ef09746523e",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "55ae74c2-e878-4a52-86dd-90bcca1a010b",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "11a9856a-d258-40b5-a571-845be81abeca",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952291757,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "7ee60351-1239-45ad-9a0d-38b833f5dca2",
          "lastDiffId": "63b51095-3839-4a93-a304-e7fbc31ae33c",
          "lastAppliedAt": 1767952298665
        },
        "77c6d610-d4c2-4387-93ac-ffa85a61ce99": {
          "_v": 3,
          "bubbleId": "6d319077-0efc-47dd-a4dc-19259e3486f4",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "77c6d610-d4c2-4387-93ac-ffa85a61ce99",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "55ae74c2-e878-4a52-86dd-90bcca1a010b",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767954874722,
          "composerChatGenerationUuid": "dc37224e-54d6-489e-9ab3-052000b47502",
          "diffId": "95969447-8092-41bf-ae2d-738c1649f525",
          "lastDiffId": "868f7833-9492-4953-94ec-7f499e88e29b",
          "lastAppliedAt": 1767954885459
        },
        "36ced607-b5bb-40a2-9628-1163bc1bc062": {
          "_v": 3,
          "bubbleId": "c8c1bd46-e6fa-4401-a6b1-41c72546e91a",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "36ced607-b5bb-40a2-9628-1163bc1bc062",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "77c6d610-d4c2-4387-93ac-ffa85a61ce99",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767954888782,
          "composerChatGenerationUuid": "dc37224e-54d6-489e-9ab3-052000b47502",
          "diffId": "8fbaf649-d391-43c5-9ad3-bb1079179a95",
          "lastDiffId": "92751fee-8709-4eee-a473-ec7d916b3844",
          "lastAppliedAt": 1767954895901
        },
        "01b5389b-9f60-497d-b657-14dcead264a2": {
          "_v": 3,
          "bubbleId": "5e5cf8b1-1e81-416e-9d72-fb5f1614aa73",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "01b5389b-9f60-497d-b657-14dcead264a2",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "36ced607-b5bb-40a2-9628-1163bc1bc062",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767954901130,
          "composerChatGenerationUuid": "dc37224e-54d6-489e-9ab3-052000b47502",
          "diffId": "a5dc09c7-e43f-499d-a12f-97711994907c",
          "lastDiffId": "7994492b-0839-4ac6-8f59-4f3f4572fb0e",
          "lastAppliedAt": 1767954907964
        },
        "8a5b5fab-6ec0-4032-9bf2-982e53eacdf0": {
          "_v": 3,
          "bubbleId": "4c815bde-fe22-42dd-8ef0-ae7ebe739cad",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "8a5b5fab-6ec0-4032-9bf2-982e53eacdf0",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "01b5389b-9f60-497d-b657-14dcead264a2",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767954911196,
          "composerChatGenerationUuid": "dc37224e-54d6-489e-9ab3-052000b47502",
          "diffId": "45c64c7b-f482-4cd1-9a86-ba301715bfda",
          "lastDiffId": "d086aae3-f729-4e49-b675-9f00e505219a",
          "lastAppliedAt": 1767954917577
        },
        "f764f50c-43fe-4805-839d-c6ced2375d20": {
          "_v": 3,
          "bubbleId": "b02b2c07-fd5d-4f6a-8084-0dee6730e833",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "f764f50c-43fe-4805-839d-c6ced2375d20",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "8a5b5fab-6ec0-4032-9bf2-982e53eacdf0",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767954920929,
          "composerChatGenerationUuid": "dc37224e-54d6-489e-9ab3-052000b47502",
          "diffId": "ec8e3059-5760-4867-b286-e9f88831b2f2",
          "lastDiffId": "e1704cae-c52a-44f0-b182-8d3cf4046abf",
          "lastAppliedAt": 1767954927677
        },
        "4dcf1472-d0c5-4d02-a86a-0b189bc9dfc0": {
          "_v": 3,
          "bubbleId": "9968d426-bbf5-4d44-9ac7-51191b2236d9",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "4dcf1472-d0c5-4d02-a86a-0b189bc9dfc0",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "f764f50c-43fe-4805-839d-c6ced2375d20",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767954931073,
          "composerChatGenerationUuid": "dc37224e-54d6-489e-9ab3-052000b47502",
          "diffId": "fd139d25-6c20-41b1-9319-512caa3a5bec",
          "lastDiffId": "e6a02a7a-15f5-4cc6-8f4b-de9a9784d8e4",
          "lastAppliedAt": 1767954941009
        },
        "09dc0775-103c-4654-834e-ebe3c1642553": {
          "_v": 3,
          "bubbleId": "507baef8-700a-4508-87e1-e408330b1bd6",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "09dc0775-103c-4654-834e-ebe3c1642553",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "4dcf1472-d0c5-4d02-a86a-0b189bc9dfc0",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767955005963,
          "composerChatGenerationUuid": "dc37224e-54d6-489e-9ab3-052000b47502",
          "diffId": "26926103-e524-4208-bf11-a71e7d8c9762",
          "lastDiffId": "eab27d3c-838a-4631-8022-12a55b4acedd",
          "lastAppliedAt": 1767955023752
        },
        "6fc9d1d7-7f0f-4258-a88a-6c11c1c06da4": {
          "_v": 3,
          "bubbleId": "e833da1e-2e10-4fde-a9e6-c371a58e0103",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "6fc9d1d7-7f0f-4258-a88a-6c11c1c06da4",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "09dc0775-103c-4654-834e-ebe3c1642553",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767955027214,
          "composerChatGenerationUuid": "dc37224e-54d6-489e-9ab3-052000b47502",
          "diffId": "e2233786-5c28-4957-85d6-eee9de8d55e3",
          "lastDiffId": "d80b17b1-7319-487a-b185-880ed9af0489",
          "lastAppliedAt": 1767955034077
        },
        "8ae22628-9043-4643-82bf-bb64a5c009f7": {
          "_v": 3,
          "bubbleId": "7827ddb4-adf3-4e89-ba6e-7671b0fb129d",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "8ae22628-9043-4643-82bf-bb64a5c009f7",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "6fc9d1d7-7f0f-4258-a88a-6c11c1c06da4",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767963801464,
          "composerChatGenerationUuid": "b5b14bd6-6927-48d6-b565-d9a3c04c10ea",
          "diffId": "91150320-6121-4577-a3c0-3a1e28541b49",
          "lastDiffId": "f59ccd6b-30b8-4626-b96d-fc5ed6d068c8",
          "lastAppliedAt": 1767963808936
        },
        "585939eb-e6b7-41ab-aa9d-080c08cd836b": {
          "_v": 3,
          "bubbleId": "35dab041-ae5d-4194-8a42-3b1b53893914",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "585939eb-e6b7-41ab-aa9d-080c08cd836b",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "8ae22628-9043-4643-82bf-bb64a5c009f7",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767963812855,
          "composerChatGenerationUuid": "b5b14bd6-6927-48d6-b565-d9a3c04c10ea",
          "diffId": "8aa4697f-688c-4fe3-b52f-7b15782fe509",
          "lastDiffId": "a72aca47-ee44-44d4-8e7d-cca43762d7d0",
          "lastAppliedAt": 1767963820648
        },
        "b1bbce3a-0279-4423-9e98-e25b009b841d": {
          "_v": 3,
          "bubbleId": "25068672-3503-427d-bab9-598548020e5c",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "b1bbce3a-0279-4423-9e98-e25b009b841d",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "585939eb-e6b7-41ab-aa9d-080c08cd836b",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768034587811,
          "composerChatGenerationUuid": "cc0039a6-b8a0-4de7-9fa6-ec1148e68cf5",
          "diffId": "fc5e3d4b-3dd8-4368-abb5-50cbf54eb182",
          "lastDiffId": "5ac57dd8-0743-4c6c-bc30-abd13f967b44",
          "lastAppliedAt": 1768034595352
        },
        "4bb8129a-f894-4347-bcdf-00599f8a95f1": {
          "_v": 3,
          "bubbleId": "d0320e1c-b660-4b34-8335-be5767ffba0f",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "4bb8129a-f894-4347-bcdf-00599f8a95f1",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768034599922,
          "composerChatGenerationUuid": "cc0039a6-b8a0-4de7-9fa6-ec1148e68cf5"
        },
        "3cade520-ea46-4252-8265-c28f078b5a30": {
          "_v": 3,
          "bubbleId": "49f8b1f5-c962-4220-a70c-b27004d72b93",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "3cade520-ea46-4252-8265-c28f078b5a30",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "b1bbce3a-0279-4423-9e98-e25b009b841d",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768034611111,
          "composerChatGenerationUuid": "cc0039a6-b8a0-4de7-9fa6-ec1148e68cf5",
          "diffId": "82fc08b7-2967-4e27-a2a5-7e7362765824",
          "lastDiffId": "0435236c-28bf-43aa-a91d-704fa0a4a31b",
          "lastAppliedAt": 1768034619695
        },
        "78508883-77dc-4950-99ca-909cb3384463": {
          "_v": 3,
          "bubbleId": "addec977-c25e-4f90-95a4-430371fe874e",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "78508883-77dc-4950-99ca-909cb3384463",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "3cade520-ea46-4252-8265-c28f078b5a30",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768034627575,
          "composerChatGenerationUuid": "cc0039a6-b8a0-4de7-9fa6-ec1148e68cf5",
          "diffId": "fd37787f-3eee-48da-8dde-a859b73d9de3",
          "lastDiffId": "6b82eadf-901d-4da7-ba50-a6da8d6835f6",
          "lastAppliedAt": 1768034634717
        },
        "9eba79e8-c9c3-44c6-b4dd-7654c435259c": {
          "_v": 3,
          "bubbleId": "28bb1924-ad1c-4bea-a043-e56230910239",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "9eba79e8-c9c3-44c6-b4dd-7654c435259c",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "78508883-77dc-4950-99ca-909cb3384463",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768034638091,
          "composerChatGenerationUuid": "cc0039a6-b8a0-4de7-9fa6-ec1148e68cf5",
          "diffId": "fe22abff-2e7d-49f5-a77d-2b2446ac3105",
          "lastDiffId": "866c1e23-3b0b-4b19-b5ce-b85bf8f1d569",
          "lastAppliedAt": 1768034645521
        },
        "31bb7893-c5fa-45da-8357-4c4f954e7415": {
          "_v": 3,
          "bubbleId": "1b51dd6d-e1f4-46c9-908a-4ad194a40139",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "31bb7893-c5fa-45da-8357-4c4f954e7415",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "9eba79e8-c9c3-44c6-b4dd-7654c435259c",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768034653085,
          "composerChatGenerationUuid": "cc0039a6-b8a0-4de7-9fa6-ec1148e68cf5",
          "diffId": "5bb64c7d-6450-41fc-8de8-86b6d40c5630",
          "lastDiffId": "6a04bd85-49bb-4695-95cd-c1b61623f174",
          "lastAppliedAt": 1768034660337
        },
        "0f3eba9f-22e7-43e5-b69f-974b03620d95": {
          "_v": 3,
          "bubbleId": "6b0504a8-8239-4d4e-b09a-64af084099df",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "0f3eba9f-22e7-43e5-b69f-974b03620d95",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "31bb7893-c5fa-45da-8357-4c4f954e7415",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768034663570,
          "composerChatGenerationUuid": "cc0039a6-b8a0-4de7-9fa6-ec1148e68cf5",
          "diffId": "926b59a2-fce9-4023-bd86-c58b8e5fd0c5",
          "lastDiffId": "c19254d8-36a7-404a-9292-1433e6105f9d",
          "lastAppliedAt": 1768034670904
        },
        "7895482d-6889-45f9-935e-3423e09f0199": {
          "_v": 3,
          "bubbleId": "0eb505b4-c715-4141-b3d4-4f8b8972c437",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "7895482d-6889-45f9-935e-3423e09f0199",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "0f3eba9f-22e7-43e5-b69f-974b03620d95",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039362956,
          "composerChatGenerationUuid": "8516e614-40cd-46fa-bbfb-d33abe1788f4",
          "diffId": "6470e6ff-bfae-4dd9-b415-8abb6f34c913",
          "lastDiffId": "b3127a4e-7667-4329-87a0-d701fd923266",
          "lastAppliedAt": 1768039370398
        },
        "e177d90c-e67e-4d41-bfab-29b46da46c19": {
          "_v": 3,
          "bubbleId": "6c39148d-6c91-42b7-b403-265f26fa5f32",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "e177d90c-e67e-4d41-bfab-29b46da46c19",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768051950096,
          "composerChatGenerationUuid": "ec10b3b9-03ab-4d4d-8086-8cb963d74723"
        },
        "f09cea31-5966-46b2-bd9f-f007f2dd3623": {
          "_v": 3,
          "bubbleId": "1ea233ac-3505-4c5d-ac4e-2512990c0dea",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "f09cea31-5966-46b2-bd9f-f007f2dd3623",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "7895482d-6889-45f9-935e-3423e09f0199",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768051986252,
          "composerChatGenerationUuid": "ec10b3b9-03ab-4d4d-8086-8cb963d74723",
          "diffId": "5ecb0089-b88d-4e4c-85e1-5908f5081ae7",
          "lastDiffId": "451402f4-b7a1-4418-8db3-c44b487c1570",
          "lastAppliedAt": 1768052009234
        },
        "08d28e42-e2af-4217-a752-aa9fca665aae": {
          "_v": 3,
          "bubbleId": "62f35747-61de-419c-a587-73ca8a7a2114",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\FQCRepository.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
            "scheme": "file"
          },
          "codeblockId": "08d28e42-e2af-4217-a752-aa9fca665aae",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "f09cea31-5966-46b2-bd9f-f007f2dd3623",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768052014703,
          "composerChatGenerationUuid": "ec10b3b9-03ab-4d4d-8086-8cb963d74723",
          "diffId": "873e5bc3-bf46-4e12-93ad-11070ffb7bbc",
          "lastDiffId": "bce88bae-1726-4a01-88b6-5f4d3a3dac29",
          "lastAppliedAt": 1768052048238
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ScannerScreen.kt": {
        "51c4bce7-0611-4b4b-a9d4-8b16b6d25b3d": {
          "_v": 3,
          "bubbleId": "1c5524ff-22c8-4aef-af09-e634a8563953",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ScannerScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ScannerScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ScannerScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "51c4bce7-0611-4b4b-a9d4-8b16b6d25b3d",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947193442,
          "composerChatGenerationUuid": "73ea6a36-60ae-4f7e-b604-b4d56241f7d3",
          "diffId": "89ff821e-acac-47b6-9a99-6a0d3735ac83",
          "lastDiffId": "6b6789c3-0868-47e5-ae83-112cb7e59741",
          "lastAppliedAt": 1767947200553
        },
        "2be98d12-667e-4d53-b876-ee99f44fb91b": {
          "_v": 3,
          "bubbleId": "d4465a88-8c9a-4b12-97aa-346bbd522be4",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ScannerScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ScannerScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ScannerScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "2be98d12-667e-4d53-b876-ee99f44fb91b",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947209366,
          "composerChatGenerationUuid": "73ea6a36-60ae-4f7e-b604-b4d56241f7d3"
        },
        "1fa26303-42aa-4379-a6f6-1bb9a276b0c8": {
          "_v": 3,
          "bubbleId": "a146a0bc-91c1-43e3-9e98-cfce828d79a8",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ScannerScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ScannerScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ScannerScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "1fa26303-42aa-4379-a6f6-1bb9a276b0c8",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "51c4bce7-0611-4b4b-a9d4-8b16b6d25b3d",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947342612,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "25e0061d-b6c3-4a87-8268-da8d9c11afbc",
          "lastDiffId": "4ac3d733-d61d-4994-a86d-e9e7296f56cf",
          "lastAppliedAt": 1767947354977
        }
      },
      "file:///k%3A/FQC-Tracking-App/IMPLEMENTATION_PROGRESS.md": {
        "e5324172-6a44-49fc-be4e-1f04413c72a7": {
          "_v": 3,
          "bubbleId": "1bdaa99d-dd33-401c-a61a-262cf0dcbf4b",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\IMPLEMENTATION_PROGRESS.md",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/IMPLEMENTATION_PROGRESS.md",
            "path": "/K:/FQC-Tracking-App/IMPLEMENTATION_PROGRESS.md",
            "scheme": "file"
          },
          "codeblockId": "e5324172-6a44-49fc-be4e-1f04413c72a7",
          "status": "completed",
          "languageId": "markdown",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947252838,
          "composerChatGenerationUuid": "73ea6a36-60ae-4f7e-b604-b4d56241f7d3",
          "diffId": "c46a4086-5604-4f75-99aa-1db54af99771",
          "lastDiffId": "25fedd09-413a-4713-90f0-98258adabf9a",
          "lastAppliedAt": 1767947260559
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt": {
        "eb379c77-f9ee-48db-a464-676881c8fd1d": {
          "_v": 3,
          "bubbleId": "42abb5bd-eef9-4406-9d96-2180791f678f",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FrequencyGeneratorScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "eb379c77-f9ee-48db-a464-676881c8fd1d",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947427878,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "40fbf987-b42f-4783-a374-524fac93e463",
          "lastDiffId": "2b22e744-f273-45e1-ae27-b02b83db68e2",
          "lastAppliedAt": 1767947441491
        },
        "6167b57e-53ff-4e40-b31f-755f9eab90c8": {
          "_v": 3,
          "bubbleId": "351ebcc6-75e2-40f7-8500-b3d191eee823",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FrequencyGeneratorScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "6167b57e-53ff-4e40-b31f-755f9eab90c8",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947500648,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5"
        },
        "01a42859-899f-417d-bae7-ac33173abd6a": {
          "_v": 3,
          "bubbleId": "1a1e05fc-07f4-44da-b75b-f495cd5391fd",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FrequencyGeneratorScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "01a42859-899f-417d-bae7-ac33173abd6a",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "eb379c77-f9ee-48db-a464-676881c8fd1d",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947510505,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "f9b933b6-783d-4dc9-b901-6dce72159ce0",
          "lastDiffId": "9aeeeb23-d702-4b69-b276-c8dd76719afd",
          "lastAppliedAt": 1767947520881
        },
        "826fddbd-ad1f-4319-bcb6-487c98030cf8": {
          "_v": 3,
          "bubbleId": "0771714f-d757-4a84-a998-8860bd016070",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FrequencyGeneratorScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "826fddbd-ad1f-4319-bcb6-487c98030cf8",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "01a42859-899f-417d-bae7-ac33173abd6a",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947540502,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "ba018b66-54cc-4c1c-8726-a89e2d9e5585",
          "lastDiffId": "54091193-af4b-472b-9f50-ad4d27eb93e3",
          "lastAppliedAt": 1767947547971
        },
        "c65b1650-74b2-4aac-9973-50908820a32d": {
          "_v": 3,
          "bubbleId": "d9960ef3-6c61-4aec-83e0-9897c40759e5",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FrequencyGeneratorScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "c65b1650-74b2-4aac-9973-50908820a32d",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "826fddbd-ad1f-4319-bcb6-487c98030cf8",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952386041,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "76c4e0c5-ac99-4718-97a4-c3c993e78ebf",
          "lastDiffId": "ea99dc5e-72c6-4e5f-99e0-f7412ad6a534",
          "lastAppliedAt": 1767952394504
        },
        "c5158486-2833-4f27-bfd3-53650b39edb2": {
          "_v": 3,
          "bubbleId": "14bf1db9-3445-4bfe-8449-fe1609132977",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FrequencyGeneratorScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "c5158486-2833-4f27-bfd3-53650b39edb2",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "c65b1650-74b2-4aac-9973-50908820a32d",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952627863,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "05211c3e-0657-4bbc-ad52-428b4d3d5019",
          "lastDiffId": "e99ba4f8-e34a-4ae9-8ab8-39228caa606d",
          "lastAppliedAt": 1767952634970
        },
        "b226d3d1-60bf-494c-bef7-e80808059fb9": {
          "_v": 3,
          "bubbleId": "24afac70-a2b5-4071-9f84-5121fb50072a",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FrequencyGeneratorScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "b226d3d1-60bf-494c-bef7-e80808059fb9",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "c5158486-2833-4f27-bfd3-53650b39edb2",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768034711440,
          "composerChatGenerationUuid": "cc0039a6-b8a0-4de7-9fa6-ec1148e68cf5",
          "diffId": "2f7912ea-da53-4d08-a165-2a18c2eda140",
          "lastDiffId": "35f4ae36-9dd0-4308-9022-e73f5d8460ab",
          "lastAppliedAt": 1768034720811
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/FrequencyTestDao.kt": {
        "88f14af2-995e-4fb6-8f86-392921e910cd": {
          "_v": 3,
          "bubbleId": "d3a09ef7-3a82-40e5-a45e-ab0e487d3284",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\dao\\FrequencyTestDao.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/FrequencyTestDao.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/FrequencyTestDao.kt",
            "scheme": "file"
          },
          "codeblockId": "88f14af2-995e-4fb6-8f86-392921e910cd",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947461170,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "ac1ff35c-4cec-4eb8-9539-dc3dc4a741d3",
          "lastDiffId": "704d4a6a-b6a7-4bfc-b076-f767234b2a06",
          "lastAppliedAt": 1767947468379
        },
        "cd1f16a8-8eba-4d02-9f2c-ebb3c464f690": {
          "_v": 3,
          "bubbleId": "d275ac68-0e51-4f84-90d8-44eb5ef9b294",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\dao\\FrequencyTestDao.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/FrequencyTestDao.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/FrequencyTestDao.kt",
            "scheme": "file"
          },
          "codeblockId": "cd1f16a8-8eba-4d02-9f2c-ebb3c464f690",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "88f14af2-995e-4fb6-8f86-392921e910cd",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039340660,
          "composerChatGenerationUuid": "8516e614-40cd-46fa-bbfb-d33abe1788f4",
          "diffId": "c8880347-e416-4a79-9bf5-614c863dec7e",
          "lastDiffId": "6302d6fd-a972-4d9c-8d6f-557a358e5eb6",
          "lastAppliedAt": 1768039349353
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt": {
        "df01237d-365b-4678-85eb-815326f4e1c3": {
          "_v": 3,
          "bubbleId": "f8fd79be-4fa1-40db-8405-505bf320f5f8",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "df01237d-365b-4678-85eb-815326f4e1c3",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947703416,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "66d6823c-42b4-4dc6-b9ae-cb8464b0b2ae",
          "lastDiffId": "3bef04c3-aad0-4122-b7af-06cecae6b22d",
          "lastAppliedAt": 1767947711896
        },
        "573e636f-f1f5-4ca1-a9b1-48214a1e5e2a": {
          "_v": 3,
          "bubbleId": "3a6ab05a-bf22-43d7-8855-6af5f131446b",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "573e636f-f1f5-4ca1-a9b1-48214a1e5e2a",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947715583,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5"
        },
        "7d87d70b-8272-48b4-926c-268fa187504d": {
          "_v": 3,
          "bubbleId": "f12565e2-e70c-4e29-9424-103c3f69803c",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "7d87d70b-8272-48b4-926c-268fa187504d",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947784392,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5"
        },
        "d46e94a1-a8d6-4141-bee0-7ed4d44b862e": {
          "_v": 3,
          "bubbleId": "7e4bcda6-2d0b-44fe-84bd-b57ce077b85f",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "d46e94a1-a8d6-4141-bee0-7ed4d44b862e",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "df01237d-365b-4678-85eb-815326f4e1c3",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947902995,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "97f3adc2-02ac-4bd9-8092-a48cedd8e089",
          "lastDiffId": "c0653a54-9d70-4a23-830a-e326b9506a8c",
          "lastAppliedAt": 1767947910169
        },
        "bbcb5371-e571-46e4-8c36-e68f60ef4be9": {
          "_v": 3,
          "bubbleId": "a55b15c9-6434-42f1-846c-cc1fe8c4a00b",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "bbcb5371-e571-46e4-8c36-e68f60ef4be9",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "d46e94a1-a8d6-4141-bee0-7ed4d44b862e",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952271021,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "b36d6ad1-2f0e-43a5-adc5-71c00e631d9c",
          "lastDiffId": "841acb63-8606-4bad-8883-10125045882e",
          "lastAppliedAt": 1767952278927
        },
        "65dffbbf-3e4b-4c75-baa6-0a3b51d73517": {
          "_v": 3,
          "bubbleId": "466cc3ce-cbf9-470b-abd7-20233b456e71",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "65dffbbf-3e4b-4c75-baa6-0a3b51d73517",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952326206,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060"
        },
        "187cdbf8-b0ca-470f-852b-ae69e08e44d7": {
          "_v": 3,
          "bubbleId": "e73387b9-0d00-4f49-8db7-982acf25a695",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "187cdbf8-b0ca-470f-852b-ae69e08e44d7",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952398105,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060"
        },
        "f23766d9-8dad-4cfb-9083-fe1b4a7d6103": {
          "_v": 3,
          "bubbleId": "dc0200ef-acd1-4f92-a148-53906ea205d2",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "f23766d9-8dad-4cfb-9083-fe1b4a7d6103",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "bbcb5371-e571-46e4-8c36-e68f60ef4be9",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952469132,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "0de57425-5489-4ccd-a3df-38071f6b72f5",
          "lastDiffId": "6ff32234-72b0-4bc4-a12a-f4ab99f3e56d",
          "lastAppliedAt": 1767952484205
        },
        "0785c4b0-f315-4479-9f2d-c94fd01165ea": {
          "_v": 3,
          "bubbleId": "e241c549-2bbe-4d2c-8ecf-0eed13bbd632",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "0785c4b0-f315-4479-9f2d-c94fd01165ea",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "f23766d9-8dad-4cfb-9083-fe1b4a7d6103",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952497719,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "95cf69c4-0612-4124-9066-aa872b104c0e",
          "lastDiffId": "856719ad-aa58-4665-a466-72e45618d36e",
          "lastAppliedAt": 1767952509006
        },
        "08e0c88c-b1fb-495d-8349-da1470900864": {
          "_v": 3,
          "bubbleId": "402000b9-5fcb-466a-bf14-f1a4f20d8ad4",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "08e0c88c-b1fb-495d-8349-da1470900864",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952512547,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060"
        },
        "9b25e11c-1def-4240-9c51-0ba8dbfe0c72": {
          "_v": 3,
          "bubbleId": "c06242f9-f97d-4106-9305-847e282c029b",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "9b25e11c-1def-4240-9c51-0ba8dbfe0c72",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "0785c4b0-f315-4479-9f2d-c94fd01165ea",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952549406,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "6b365333-44f2-4073-8dbc-b36ce9f27754",
          "lastDiffId": "68ef36da-e3e1-4c3a-acb3-350fb3d441a3",
          "lastAppliedAt": 1767952556668
        },
        "6c6825b3-30e9-40be-9f35-8efc414878d2": {
          "_v": 3,
          "bubbleId": "715bc000-bbe3-480c-95d7-71d8786f5e1c",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "6c6825b3-30e9-40be-9f35-8efc414878d2",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "9b25e11c-1def-4240-9c51-0ba8dbfe0c72",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952615906,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "9fd1f9a1-4c38-4259-9df4-52646f5284e6",
          "lastDiffId": "434e142e-34c6-4d40-a75b-76c1fd812ad9",
          "lastAppliedAt": 1767952624480
        },
        "2308d7b8-6db4-4dac-8bab-80f029f7e593": {
          "_v": 3,
          "bubbleId": "30c34e8e-aa8f-4e58-ae92-f199b8f32df4",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "2308d7b8-6db4-4dac-8bab-80f029f7e593",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952638685,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060"
        },
        "4727bc8c-2b8b-49ee-bfb5-a6b01fd92778": {
          "_v": 3,
          "bubbleId": "405b6d46-1957-4017-a82a-e5a6b88a176c",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "4727bc8c-2b8b-49ee-bfb5-a6b01fd92778",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952705327,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060"
        },
        "477558e3-615d-4d9b-b997-c2259976c99f": {
          "_v": 3,
          "bubbleId": "a8675496-f0b6-47f0-872c-5ab28b15a065",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\ui\\TestSongScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "477558e3-615d-4d9b-b997-c2259976c99f",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "6c6825b3-30e9-40be-9f35-8efc414878d2",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952840725,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "619e3032-18e8-4c99-8af0-9c2149f623c5",
          "lastDiffId": "4aaa8a1c-1ec0-43a3-8dbf-0658455cc180",
          "lastAppliedAt": 1767952857761
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/SongTestDao.kt": {
        "c1fb9f5d-b7c0-4bae-9ac1-340f5bbe5448": {
          "_v": 3,
          "bubbleId": "31073f6e-da4c-487c-ba3e-7d192e4e5a03",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\dao\\SongTestDao.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/SongTestDao.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/SongTestDao.kt",
            "scheme": "file"
          },
          "codeblockId": "c1fb9f5d-b7c0-4bae-9ac1-340f5bbe5448",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947764097,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "e9b2cd16-e095-4905-802a-6e2737d15a1d",
          "lastDiffId": "5e94ee01-9e08-4d26-949f-8697f753b171",
          "lastAppliedAt": 1767947771296
        },
        "21ad5abc-edad-42e4-bce9-b3daa0a97191": {
          "_v": 3,
          "bubbleId": "18bb7ebb-243a-43f9-875a-286d38ed0301",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\dao\\SongTestDao.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/SongTestDao.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/SongTestDao.kt",
            "scheme": "file"
          },
          "codeblockId": "21ad5abc-edad-42e4-bce9-b3daa0a97191",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "c1fb9f5d-b7c0-4bae-9ac1-340f5bbe5448",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767947824509,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5",
          "diffId": "3969893b-9cb8-4602-943f-3ebe0f282e6d",
          "lastDiffId": "a1a1a18f-a553-41a0-a69d-c0bbcb153337",
          "lastAppliedAt": 1767947831526
        },
        "1583dec7-0772-435a-9e22-ff4052fcbd50": {
          "_v": 3,
          "bubbleId": "01e34f40-b068-4b3f-bbd3-5c09c1cc5fa8",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\dao\\SongTestDao.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/SongTestDao.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/SongTestDao.kt",
            "scheme": "file"
          },
          "codeblockId": "1583dec7-0772-435a-9e22-ff4052fcbd50",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "21ad5abc-edad-42e4-bce9-b3daa0a97191",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039352574,
          "composerChatGenerationUuid": "8516e614-40cd-46fa-bbfb-d33abe1788f4",
          "diffId": "afb2db60-b3e5-4dc8-86a3-d4e374486b3d",
          "lastDiffId": "8190df8e-04cf-42ed-a8e5-094d25132170",
          "lastAppliedAt": 1768039359470
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt": {
        "ab6105c6-4c21-4107-9afe-766bb71805f1": {
          "_v": 3,
          "bubbleId": "a607948c-0cda-4128-b4bc-e1f8230c336a",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FQCReviewScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "ab6105c6-4c21-4107-9afe-766bb71805f1",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767951445818,
          "composerChatGenerationUuid": "7b92402d-1e99-4a18-b808-469faf49dea5"
        },
        "493f08df-4415-4b18-9a01-1db66805f9db": {
          "_v": 3,
          "bubbleId": "5cb30d0f-d9dc-4b72-809a-09f8ffe35844",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FQCReviewScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "493f08df-4415-4b18-9a01-1db66805f9db",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767951502855,
          "composerChatGenerationUuid": "dc27992e-0d22-4f07-9cf9-3444598c3bf8",
          "diffId": "77287594-ea73-49bf-aab3-01d5811e4b61",
          "lastDiffId": "5b7a653c-8b27-447e-9f9d-58dd1c4a5368",
          "lastAppliedAt": 1767951510740
        },
        "8518a79d-030f-468e-8151-ff91bdf39936": {
          "_v": 3,
          "bubbleId": "a841b471-2cd8-47ac-b150-5f505d04da5d",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FQCReviewScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "8518a79d-030f-468e-8151-ff91bdf39936",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "493f08df-4415-4b18-9a01-1db66805f9db",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767951523613,
          "composerChatGenerationUuid": "dc27992e-0d22-4f07-9cf9-3444598c3bf8",
          "diffId": "10b29c0a-9841-462b-9424-0df648de51a6",
          "lastDiffId": "b16cd166-9166-4f23-9763-02414ffd079e",
          "lastAppliedAt": 1767951533640
        },
        "714c50d4-d0c2-43d9-a96d-7164565a7040": {
          "_v": 3,
          "bubbleId": "af6be5ec-761b-4bb3-8e45-6c38f4693b34",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FQCReviewScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "714c50d4-d0c2-43d9-a96d-7164565a7040",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "8518a79d-030f-468e-8151-ff91bdf39936",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767951560482,
          "composerChatGenerationUuid": "dc27992e-0d22-4f07-9cf9-3444598c3bf8",
          "diffId": "d1107b2d-0b41-4aee-b03e-a54ab1e7de27",
          "lastDiffId": "8b03829c-d26f-48a8-8ad4-faba28050e6a",
          "lastAppliedAt": 1767951567443
        },
        "19ee5382-b6d6-4ee4-b772-ff31f794c90b": {
          "_v": 3,
          "bubbleId": "d5c89996-9289-4417-a54e-9c16918dce21",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FQCReviewScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "19ee5382-b6d6-4ee4-b772-ff31f794c90b",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "714c50d4-d0c2-43d9-a96d-7164565a7040",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767951570901,
          "composerChatGenerationUuid": "dc27992e-0d22-4f07-9cf9-3444598c3bf8",
          "diffId": "98eb07fe-d472-4103-b8f3-b43d59733bad",
          "lastDiffId": "b49f2ba8-5668-4f13-97b4-d37456a90091",
          "lastAppliedAt": 1767951577765
        },
        "3067657a-1230-4576-b601-2bffc22d430c": {
          "_v": 3,
          "bubbleId": "80bceec4-1f8c-481b-9a6b-c356b5321e15",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FQCReviewScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "3067657a-1230-4576-b601-2bffc22d430c",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "19ee5382-b6d6-4ee4-b772-ff31f794c90b",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767951615228,
          "composerChatGenerationUuid": "dc27992e-0d22-4f07-9cf9-3444598c3bf8",
          "diffId": "8db80c11-1635-45b5-94c3-731fd3976213",
          "lastDiffId": "35443231-0ca3-4570-b1dd-1d578332d4d1",
          "lastAppliedAt": 1767951626666
        },
        "dced74f0-f66a-4599-9ee6-866fd65fdaea": {
          "_v": 3,
          "bubbleId": "ad0da23d-0275-42a2-9ba1-6cde5faa88b5",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FQCReviewScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "dced74f0-f66a-4599-9ee6-866fd65fdaea",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767951665210,
          "composerChatGenerationUuid": "dc27992e-0d22-4f07-9cf9-3444598c3bf8"
        },
        "45233700-3b7a-4e4a-b6ab-89ff70c586c7": {
          "_v": 3,
          "bubbleId": "07c2d4b2-b6b8-4ebe-9b7e-e9c4d7396d2d",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FQCReviewScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "45233700-3b7a-4e4a-b6ab-89ff70c586c7",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "3067657a-1230-4576-b601-2bffc22d430c",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952216348,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "ead9884b-f026-42b2-8cd6-4f8b58d78066",
          "lastDiffId": "60381281-91a0-40ae-b865-506d119ddc98",
          "lastAppliedAt": 1767952225590
        },
        "662995f5-01f9-4491-90d7-bcf462cc7a16": {
          "_v": 3,
          "bubbleId": "d5f15fa6-a54d-4231-8d93-ac0793935b67",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\FQCReviewScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "662995f5-01f9-4491-90d7-bcf462cc7a16",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "45233700-3b7a-4e4a-b6ab-89ff70c586c7",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952673022,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "9922313b-996a-48a9-bdfa-ec1cb2f75596",
          "lastDiffId": "9a8ac795-8f6f-4225-8e60-dd47a625a165",
          "lastAppliedAt": 1767952681558
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/FQCRecordDao.kt": {
        "059e0580-76d8-439e-bd82-4cf65469b1cc": {
          "_v": 3,
          "bubbleId": "15a95336-6704-4093-a671-3d3be5c30eec",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\data\\dao\\FQCRecordDao.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/FQCRecordDao.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/FQCRecordDao.kt",
            "scheme": "file"
          },
          "codeblockId": "059e0580-76d8-439e-bd82-4cf65469b1cc",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767951703954,
          "composerChatGenerationUuid": "dc27992e-0d22-4f07-9cf9-3444598c3bf8",
          "diffId": "dc4373b9-b584-4e14-a2cd-bf07ba2f1f5d",
          "lastDiffId": "dfa8063c-3845-44f0-9abf-20c9c2a52ac1",
          "lastAppliedAt": 1767951711185
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt": {
        "12f0ddd3-c119-4306-bac7-de37a216f0a8": {
          "_v": 3,
          "bubbleId": "22ab7cb9-184b-4bb6-954d-07a2d11911ec",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "12f0ddd3-c119-4306-bac7-de37a216f0a8",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767951742451,
          "composerChatGenerationUuid": "dc27992e-0d22-4f07-9cf9-3444598c3bf8",
          "diffId": "51406e86-1d33-4855-bcfe-c0f0a0c264c9",
          "lastDiffId": "13319741-8f63-4963-86d3-e6a177658131",
          "lastAppliedAt": 1767951749674
        },
        "3ed0fa62-c098-4873-8cc8-c045782b0c06": {
          "_v": 3,
          "bubbleId": "450926f5-b6a8-4b43-8a4c-00c24e129457",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "3ed0fa62-c098-4873-8cc8-c045782b0c06",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "12f0ddd3-c119-4306-bac7-de37a216f0a8",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767952107604,
          "composerChatGenerationUuid": "e0f06c07-db56-4ecd-a7e3-0caeae28c060",
          "diffId": "6647e04e-6c19-4b06-85e6-f4ca950892e4",
          "lastDiffId": "c969243f-2dc4-4d84-af91-de2972ce7471",
          "lastAppliedAt": 1767952116775
        },
        "a3c612eb-0306-497d-bd91-f7cf6bb4699d": {
          "_v": 3,
          "bubbleId": "85f2291b-4e35-44c5-9814-25fbe815d851",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "a3c612eb-0306-497d-bd91-f7cf6bb4699d",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "3ed0fa62-c098-4873-8cc8-c045782b0c06",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768028881236,
          "composerChatGenerationUuid": "160a5a6f-71c5-4784-815d-cfd31be33ae3",
          "diffId": "c7ef29af-282f-471e-8d33-8d7465642c0a",
          "lastDiffId": "a99619fc-b2b3-4622-a180-3ab9287d2917",
          "lastAppliedAt": 1768028890350
        },
        "04e24dad-19b3-4d19-b6ba-514a3d0ccd6f": {
          "_v": 3,
          "bubbleId": "cb5c8cd7-c20c-4757-ba41-2da4d2e1ce83",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "04e24dad-19b3-4d19-b6ba-514a3d0ccd6f",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "a3c612eb-0306-497d-bd91-f7cf6bb4699d",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768028922012,
          "composerChatGenerationUuid": "160a5a6f-71c5-4784-815d-cfd31be33ae3",
          "diffId": "022b59a8-fc40-40ea-9eb6-16d86caa272c",
          "lastDiffId": "53354b69-6799-426a-b571-ef323002d687",
          "lastAppliedAt": 1768028929029
        },
        "a2413dee-27ec-45d8-bea1-ae55db26dcc5": {
          "_v": 3,
          "bubbleId": "1bebd284-52ed-4dfa-a919-9b462c3dc785",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "a2413dee-27ec-45d8-bea1-ae55db26dcc5",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "04e24dad-19b3-4d19-b6ba-514a3d0ccd6f",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768038945967,
          "composerChatGenerationUuid": "7f92556b-aecd-41e6-8e08-26b135d8a45f",
          "diffId": "b864aea2-0a79-44ff-956a-310ca3c8d207",
          "lastDiffId": "f0216861-483a-4982-ba7a-0c0aba44fdf5",
          "lastAppliedAt": 1768038958758
        },
        "a18e2825-49d4-4506-a5c4-6dbd66088942": {
          "_v": 3,
          "bubbleId": "61db128e-67af-4d6e-98b3-09aba4aa5444",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "a18e2825-49d4-4506-a5c4-6dbd66088942",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768038968125,
          "composerChatGenerationUuid": "7f92556b-aecd-41e6-8e08-26b135d8a45f"
        },
        "6c9a8f6f-8e16-41be-b7b3-0bb9c2ac0995": {
          "_v": 3,
          "bubbleId": "002ebfaa-a1f5-4cb5-87d8-7d5b9b8e4bb3",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "6c9a8f6f-8e16-41be-b7b3-0bb9c2ac0995",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "a2413dee-27ec-45d8-bea1-ae55db26dcc5",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039208721,
          "composerChatGenerationUuid": "8516e614-40cd-46fa-bbfb-d33abe1788f4",
          "diffId": "63671283-93a2-41d8-a128-2118ad476fb1",
          "lastDiffId": "633348e3-cb38-433f-9d60-a68f4da43cb1",
          "lastAppliedAt": 1768039221880
        },
        "1f121db1-b7a4-42ec-ab0a-5e844c4a2231": {
          "_v": 3,
          "bubbleId": "df27f835-6c1e-4052-b8a1-46014ba2b01a",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "1f121db1-b7a4-42ec-ab0a-5e844c4a2231",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "6c9a8f6f-8e16-41be-b7b3-0bb9c2ac0995",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039225496,
          "composerChatGenerationUuid": "8516e614-40cd-46fa-bbfb-d33abe1788f4",
          "diffId": "53821688-a139-459e-b07f-7262bfe197fe",
          "lastDiffId": "aac5c25f-f6e7-4c72-98b0-eea4523256fa",
          "lastAppliedAt": 1768039232842
        },
        "0bfdbe76-b409-4660-b44c-80d148a2bc53": {
          "_v": 3,
          "bubbleId": "a0c3a29a-33d8-49aa-8e3a-0196cf8ea7b0",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "0bfdbe76-b409-4660-b44c-80d148a2bc53",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "1f121db1-b7a4-42ec-ab0a-5e844c4a2231",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039241165,
          "composerChatGenerationUuid": "8516e614-40cd-46fa-bbfb-d33abe1788f4",
          "diffId": "91ab50df-d216-46fb-bc68-da1dea269474",
          "lastDiffId": "a4599598-8412-4d3f-a1ec-f6d9095ee55d",
          "lastAppliedAt": 1768039251197
        },
        "c12881ac-7080-4076-9ff0-3dc0c3417705": {
          "_v": 3,
          "bubbleId": "85a56e49-f9b1-42c3-b991-538d10fb8f2d",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "c12881ac-7080-4076-9ff0-3dc0c3417705",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "0bfdbe76-b409-4660-b44c-80d148a2bc53",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039270246,
          "composerChatGenerationUuid": "8516e614-40cd-46fa-bbfb-d33abe1788f4",
          "diffId": "2d0659a6-f578-4058-82f9-cd8f677a0361",
          "lastDiffId": "eec95027-5457-45e7-8259-db06141228ad",
          "lastAppliedAt": 1768039277336
        },
        "8a9e37d5-e3ed-4caa-a3c6-2740fdcdc8b0": {
          "_v": 3,
          "bubbleId": "dd60fbbc-7ca2-4f95-afd7-8e03897f3dfd",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "8a9e37d5-e3ed-4caa-a3c6-2740fdcdc8b0",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "c12881ac-7080-4076-9ff0-3dc0c3417705",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039281186,
          "composerChatGenerationUuid": "8516e614-40cd-46fa-bbfb-d33abe1788f4",
          "diffId": "168d4674-b226-4fc4-86b9-9fc45c4b93a1",
          "lastDiffId": "d7b6caa6-8c6f-4b82-8f06-7d9f545bb818",
          "lastAppliedAt": 1768039288469
        },
        "06385e7a-613c-45d6-a75a-93083f865485": {
          "_v": 3,
          "bubbleId": "670383d2-4c2b-40d9-9535-611300ab026c",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "06385e7a-613c-45d6-a75a-93083f865485",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039558998,
          "composerChatGenerationUuid": "8516e614-40cd-46fa-bbfb-d33abe1788f4"
        },
        "ae859fc7-d058-48c1-8716-79421bb66890": {
          "_v": 3,
          "bubbleId": "623f085c-52a8-4994-88b1-7c596837788e",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "ae859fc7-d058-48c1-8716-79421bb66890",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "8a9e37d5-e3ed-4caa-a3c6-2740fdcdc8b0",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039574949,
          "composerChatGenerationUuid": "8516e614-40cd-46fa-bbfb-d33abe1788f4",
          "diffId": "2918140c-0cdc-4c6f-a1fb-9cf527c947b7",
          "lastDiffId": "40e0f6eb-e46f-49da-b418-ca9b47ae0af3",
          "lastAppliedAt": 1768039587254
        },
        "5270be3d-b37d-465a-bf04-41cf515ed04b": {
          "_v": 3,
          "bubbleId": "fa3fc38f-4b6a-4933-8b73-70835d17d864",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "5270be3d-b37d-465a-bf04-41cf515ed04b",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "ae859fc7-d058-48c1-8716-79421bb66890",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768043123520,
          "composerChatGenerationUuid": "1c6bd2be-ae3d-40e3-9b52-e2aa6f38de11",
          "diffId": "28242773-19d5-40e6-96a0-c084b1942116",
          "lastDiffId": "389ea737-74ec-44f2-b5d8-3abeb01e9cbc",
          "lastAppliedAt": 1768043136326
        },
        "18727a6f-2d92-4d25-a764-42c453f26992": {
          "_v": 3,
          "bubbleId": "67849957-6c7b-49f6-a19a-f333f3bac834",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "18727a6f-2d92-4d25-a764-42c453f26992",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "5270be3d-b37d-465a-bf04-41cf515ed04b",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768043802899,
          "composerChatGenerationUuid": "bf74cdbc-998a-488f-8a0b-f64379e7effa",
          "diffId": "795d5e3a-a4f2-470f-ba17-081c230159f3",
          "lastDiffId": "e16aad6b-39f0-4e7d-9479-d04511af90ef",
          "lastAppliedAt": 1768043814314
        },
        "05e6ce8d-ee47-4584-a2c3-9551b0b6bfe5": {
          "_v": 3,
          "bubbleId": "362e3795-6c98-44b9-876e-190240c36be0",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "05e6ce8d-ee47-4584-a2c3-9551b0b6bfe5",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "18727a6f-2d92-4d25-a764-42c453f26992",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768043911564,
          "composerChatGenerationUuid": "bf74cdbc-998a-488f-8a0b-f64379e7effa",
          "diffId": "bdbe7286-08c9-416d-b368-0ced6d2cc806",
          "lastDiffId": "81a4cc09-fc2a-4937-bf38-eb9110aae465",
          "lastAppliedAt": 1768043922750
        },
        "6d41f9e4-9486-4919-8aac-b5582ae35370": {
          "_v": 3,
          "bubbleId": "f4b36b37-e5a1-4259-9c91-0d74163efee2",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "6d41f9e4-9486-4919-8aac-b5582ae35370",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "05e6ce8d-ee47-4584-a2c3-9551b0b6bfe5",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050189180,
          "composerChatGenerationUuid": "c852a23e-b7b5-42eb-aa7c-e79357a86beb",
          "diffId": "c69a7440-1ef5-4bec-986f-dbf6096b4a8f",
          "lastDiffId": "738b7efd-5828-4178-a7cf-1d13f9eb510e",
          "lastAppliedAt": 1768050198378
        },
        "5dd4381f-a356-4a40-9486-b4c3bbf8dcea": {
          "_v": 3,
          "bubbleId": "065995f1-63e3-43ce-9ea2-4ebf17802d3d",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "5dd4381f-a356-4a40-9486-b4c3bbf8dcea",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050206218,
          "composerChatGenerationUuid": "c852a23e-b7b5-42eb-aa7c-e79357a86beb"
        },
        "e4b35026-55f3-48f0-9768-1525f76e01ec": {
          "_v": 3,
          "bubbleId": "66614195-3a0a-4aaa-82c3-adcd63bb7b97",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "e4b35026-55f3-48f0-9768-1525f76e01ec",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "6d41f9e4-9486-4919-8aac-b5582ae35370",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050216619,
          "composerChatGenerationUuid": "c852a23e-b7b5-42eb-aa7c-e79357a86beb",
          "diffId": "b7a89278-5f40-4a9b-89a7-9198838e7088",
          "lastDiffId": "075ac7be-9d69-4394-ae36-eff3a0e00564",
          "lastAppliedAt": 1768050229632
        },
        "a35197cc-1f90-474a-a412-8761e2a65714": {
          "_v": 3,
          "bubbleId": "bc44861f-a89b-45c3-954f-0bd0330ea71c",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "a35197cc-1f90-474a-a412-8761e2a65714",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "e4b35026-55f3-48f0-9768-1525f76e01ec",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050234174,
          "composerChatGenerationUuid": "c852a23e-b7b5-42eb-aa7c-e79357a86beb",
          "diffId": "deac0ca2-404b-4747-b8e7-bdfed38011f8",
          "lastDiffId": "84a5eee4-7e47-48d1-b40b-c438940c7315",
          "lastAppliedAt": 1768050244956
        },
        "efa51a95-1c65-43e4-b1fa-5e1b119daa2e": {
          "_v": 3,
          "bubbleId": "fd9fb212-cd69-48ae-908c-15782494c4c0",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "efa51a95-1c65-43e4-b1fa-5e1b119daa2e",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "a35197cc-1f90-474a-a412-8761e2a65714",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050249723,
          "composerChatGenerationUuid": "c852a23e-b7b5-42eb-aa7c-e79357a86beb",
          "diffId": "41c67755-ceac-48f8-9138-ab5cfd8611ab",
          "lastDiffId": "3ab7206f-784b-44e0-83c8-472e5aab999d",
          "lastAppliedAt": 1768050259675
        },
        "6fe4270f-1dab-41fc-94e2-2abf9fcd0eed": {
          "_v": 3,
          "bubbleId": "9159ca52-7b6e-4817-92bf-3b05b292f0f4",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "6fe4270f-1dab-41fc-94e2-2abf9fcd0eed",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "efa51a95-1c65-43e4-b1fa-5e1b119daa2e",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050322060,
          "composerChatGenerationUuid": "c852a23e-b7b5-42eb-aa7c-e79357a86beb",
          "diffId": "a863c2c5-3b0c-4c99-a9a9-9ab9295bba67",
          "lastDiffId": "7b458d13-9ad5-4a93-adeb-8ee607b23967",
          "lastAppliedAt": 1768050333753
        },
        "3b9cee00-9140-42e5-973d-58a70ca584e8": {
          "_v": 3,
          "bubbleId": "cdc950b0-32ad-4957-b5a7-3eed2ddf2b91",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "3b9cee00-9140-42e5-973d-58a70ca584e8",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "6fe4270f-1dab-41fc-94e2-2abf9fcd0eed",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050372945,
          "composerChatGenerationUuid": "c852a23e-b7b5-42eb-aa7c-e79357a86beb",
          "diffId": "8f5ce49c-a46c-4280-b2a2-339247f26735",
          "lastDiffId": "cd6d9d3e-031a-419f-a112-9f243fd0110f",
          "lastAppliedAt": 1768050380363
        },
        "a1946990-975e-4b39-9d9c-fca3fbbb3b81": {
          "_v": 3,
          "bubbleId": "13a44906-4e95-4464-adb1-1cc039735e57",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "a1946990-975e-4b39-9d9c-fca3fbbb3b81",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050384280,
          "composerChatGenerationUuid": "c852a23e-b7b5-42eb-aa7c-e79357a86beb"
        },
        "cb541b6f-2a8b-4338-987c-3a36a22f18c2": {
          "_v": 3,
          "bubbleId": "85c13e74-cec4-4422-a5cd-d4ba45f32f9a",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "cb541b6f-2a8b-4338-987c-3a36a22f18c2",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "3b9cee00-9140-42e5-973d-58a70ca584e8",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050394036,
          "composerChatGenerationUuid": "c852a23e-b7b5-42eb-aa7c-e79357a86beb",
          "diffId": "3480d734-7af3-4ba9-a2ac-2c8af75816de",
          "lastDiffId": "03f4b2eb-4a7d-4296-820d-506af83e2181",
          "lastAppliedAt": 1768050404416
        },
        "e2007b28-9ef3-47e5-acd0-5530e6807975": {
          "_v": 3,
          "bubbleId": "807bf547-b367-4c2d-af1d-15ebe90fda22",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "e2007b28-9ef3-47e5-acd0-5530e6807975",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "cb541b6f-2a8b-4338-987c-3a36a22f18c2",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050408166,
          "composerChatGenerationUuid": "c852a23e-b7b5-42eb-aa7c-e79357a86beb",
          "diffId": "4998a570-f4cb-4c31-9337-96df4a5dd721",
          "lastDiffId": "67b9f15a-97ef-4081-a4c9-edd3aa7acd33",
          "lastAppliedAt": 1768050415636
        },
        "49e48eb2-2a42-4281-9cab-0c3f653d1337": {
          "_v": 3,
          "bubbleId": "0f7dc3e7-8a63-4efd-a9d7-dc235f15636e",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "49e48eb2-2a42-4281-9cab-0c3f653d1337",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "e2007b28-9ef3-47e5-acd0-5530e6807975",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050436421,
          "composerChatGenerationUuid": "c852a23e-b7b5-42eb-aa7c-e79357a86beb",
          "diffId": "42b368e2-5b2d-4482-b5bb-ffa6098005d2",
          "lastDiffId": "f51e73e4-b080-4156-b03b-142ce6335b3a",
          "lastAppliedAt": 1768050446980
        },
        "f67af055-0ab6-4a0d-a1ee-7b166a22b62a": {
          "_v": 3,
          "bubbleId": "9236b098-c26d-4566-be1d-d23c841e23df",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\Navigation.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
            "scheme": "file"
          },
          "codeblockId": "f67af055-0ab6-4a0d-a1ee-7b166a22b62a",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "49e48eb2-2a42-4281-9cab-0c3f653d1337",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768051198805,
          "composerChatGenerationUuid": "2e0c7ea1-9a39-4540-a108-80e0c3f722a4",
          "diffId": "bf84e15a-e255-4d9f-8137-51b8ac9c1434",
          "lastDiffId": "79265500-3c47-4cbf-89de-729992add3fc",
          "lastAppliedAt": 1768051212663
        }
      },
      "file:///k%3A/FQC-Tracking-App/IMPLEMENTATION_VERIFICATION.md": {
        "d0f907d6-7bac-4434-99f3-260d90bb14f7": {
          "_v": 3,
          "bubbleId": "cdc18af7-6d4b-4fc7-8fff-825e841f5b35",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\IMPLEMENTATION_VERIFICATION.md",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/IMPLEMENTATION_VERIFICATION.md",
            "path": "/K:/FQC-Tracking-App/IMPLEMENTATION_VERIFICATION.md",
            "scheme": "file"
          },
          "codeblockId": "d0f907d6-7bac-4434-99f3-260d90bb14f7",
          "status": "completed",
          "languageId": "markdown",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767951894382,
          "composerChatGenerationUuid": "ce74b523-ae08-4089-97f1-f9b5ca3f2610",
          "diffId": "5e7e0b5f-5842-40cc-a3df-e0d31de05f42",
          "lastDiffId": "6655e3a9-3fd2-4c37-9543-5f79822bfeae",
          "lastAppliedAt": 1767951917064
        }
      },
      "file:///k%3A/FQC-Tracking-App/SUPABASE_API_REQUESTS_EXPLANATION.md": {
        "86edeb18-9467-4ceb-abd7-934f9e46ca56": {
          "_v": 3,
          "bubbleId": "df68ea81-38b6-40cf-9170-0c2e9feda353",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\SUPABASE_API_REQUESTS_EXPLANATION.md",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/SUPABASE_API_REQUESTS_EXPLANATION.md",
            "path": "/K:/FQC-Tracking-App/SUPABASE_API_REQUESTS_EXPLANATION.md",
            "scheme": "file"
          },
          "codeblockId": "86edeb18-9467-4ceb-abd7-934f9e46ca56",
          "status": "completed",
          "languageId": "markdown",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767954482021,
          "composerChatGenerationUuid": "3c64b196-606e-49f5-97ae-44ea8a962623",
          "diffId": "95b63114-a015-450f-854e-9b3e4ccaae62",
          "lastDiffId": "6862a471-6604-4ba2-8c06-7f3cae8b7237",
          "lastAppliedAt": 1767954491928
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt": {
        "64d37fc7-97d6-420a-8801-ecaa531fd35b": {
          "_v": 3,
          "bubbleId": "f94c03ab-535f-4a2b-a49f-04e33e8cceda",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\DeviceWorkflowService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt",
            "scheme": "file"
          },
          "codeblockId": "64d37fc7-97d6-420a-8801-ecaa531fd35b",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767954976466,
          "composerChatGenerationUuid": "dc37224e-54d6-489e-9ab3-052000b47502",
          "diffId": "5a5435f4-35a7-4833-81b7-db74cd9f894a",
          "lastDiffId": "058264fc-2f53-4b3d-8e1a-c8be455025f4",
          "lastAppliedAt": 1767954985430
        },
        "c620c7f1-fc62-4de2-80d4-0fe9fdd55c6f": {
          "_v": 3,
          "bubbleId": "647c4030-f208-4c0b-b1ff-5bafa3a029be",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\DeviceWorkflowService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt",
            "scheme": "file"
          },
          "codeblockId": "c620c7f1-fc62-4de2-80d4-0fe9fdd55c6f",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767955037698,
          "composerChatGenerationUuid": "dc37224e-54d6-489e-9ab3-052000b47502"
        },
        "b257aa03-08ec-4a44-a8d1-3dbe8f367023": {
          "_v": 3,
          "bubbleId": "9ccdc562-7bc6-48aa-a164-201e06035bfc",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\DeviceWorkflowService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt",
            "scheme": "file"
          },
          "codeblockId": "b257aa03-08ec-4a44-a8d1-3dbe8f367023",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "64d37fc7-97d6-420a-8801-ecaa531fd35b",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767955066734,
          "composerChatGenerationUuid": "dc37224e-54d6-489e-9ab3-052000b47502",
          "diffId": "f307ff10-733d-4187-9b18-4aefe7ebf101",
          "lastDiffId": "33d5c863-2944-45bf-98e4-23aa51a3bc44",
          "lastAppliedAt": 1767955076829
        },
        "de01574b-bbaf-46a7-9ba9-c44a60360432": {
          "_v": 3,
          "bubbleId": "351311fe-4f5c-4002-9913-77f6eaad7d6f",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\DeviceWorkflowService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt",
            "scheme": "file"
          },
          "codeblockId": "de01574b-bbaf-46a7-9ba9-c44a60360432",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "b257aa03-08ec-4a44-a8d1-3dbe8f367023",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767955080139,
          "composerChatGenerationUuid": "dc37224e-54d6-489e-9ab3-052000b47502",
          "diffId": "2562d885-49b3-4bec-953e-83e66e263d82",
          "lastDiffId": "f10727f3-be26-4017-95d6-31985886f2f4",
          "lastAppliedAt": 1767955086758
        },
        "3d479ebc-8cca-448f-8ebe-87136a307c50": {
          "_v": 3,
          "bubbleId": "b0509958-3d19-4ed4-92fa-7768f26805ef",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\DeviceWorkflowService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt",
            "scheme": "file"
          },
          "codeblockId": "3d479ebc-8cca-448f-8ebe-87136a307c50",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "de01574b-bbaf-46a7-9ba9-c44a60360432",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050792545,
          "composerChatGenerationUuid": "69e60308-35bd-4074-8411-b585563fa57e",
          "diffId": "639fc9da-23ec-422e-a2c5-9de08847e676",
          "lastDiffId": "87b41ddc-99f0-441a-ad7b-0d98f6d23b6e",
          "lastAppliedAt": 1768050802070
        }
      },
      "file:///k%3A/FQC-Tracking-App/SUPABASE_SYNC_REMOVAL_SUMMARY.md": {
        "25b22a23-d8e7-4db7-9533-5ccf5e311050": {
          "_v": 3,
          "bubbleId": "ec50dbc0-dbd9-4836-96b1-aef4b58dbe5e",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\SUPABASE_SYNC_REMOVAL_SUMMARY.md",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/SUPABASE_SYNC_REMOVAL_SUMMARY.md",
            "path": "/K:/FQC-Tracking-App/SUPABASE_SYNC_REMOVAL_SUMMARY.md",
            "scheme": "file"
          },
          "codeblockId": "25b22a23-d8e7-4db7-9533-5ccf5e311050",
          "status": "completed",
          "languageId": "markdown",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767955281263,
          "composerChatGenerationUuid": "dc37224e-54d6-489e-9ab3-052000b47502",
          "diffId": "4517bf15-b45d-4f46-9ca8-7e0f814f3d99",
          "lastDiffId": "8d6f759d-62c5-4788-ba07-0ef4fa04cde7",
          "lastAppliedAt": 1767955288814
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt": {
        "f00e6855-97c1-4450-84b8-b6c299dcee37": {
          "_v": 3,
          "bubbleId": "286b17df-418d-44e0-a416-8d359ebba644",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "f00e6855-97c1-4450-84b8-b6c299dcee37",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767963775857,
          "composerChatGenerationUuid": "b5b14bd6-6927-48d6-b565-d9a3c04c10ea",
          "diffId": "6429c98e-7283-44b8-a2b7-750f997cd6a3",
          "lastDiffId": "546b71ec-07da-480b-8904-7aaae43f47af",
          "lastAppliedAt": 1767963786627
        },
        "b36eef59-4602-4cb5-bef9-f92f8877d376": {
          "_v": 3,
          "bubbleId": "e00f399b-9347-45f8-9c78-53d3b7cab7bf",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "b36eef59-4602-4cb5-bef9-f92f8877d376",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "f00e6855-97c1-4450-84b8-b6c299dcee37",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767963790159,
          "composerChatGenerationUuid": "b5b14bd6-6927-48d6-b565-d9a3c04c10ea",
          "diffId": "d49e65b5-3d16-4db1-9508-41fc73f6b463",
          "lastDiffId": "2992965c-537a-4eca-96c1-1cd2113b8cdf",
          "lastAppliedAt": 1767963797983
        },
        "8181ba5f-fd1f-41ca-8ef6-975ff50be473": {
          "_v": 3,
          "bubbleId": "a9aa18bd-c6ff-492e-9189-3c288ee485c4",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "8181ba5f-fd1f-41ca-8ef6-975ff50be473",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "b36eef59-4602-4cb5-bef9-f92f8877d376",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767967687758,
          "composerChatGenerationUuid": "037b7284-30dc-4fe8-8ef4-a8455cfa4f1c",
          "diffId": "d2f1f273-b005-4543-9d05-9c4fe690594f",
          "lastDiffId": "9e5b0dd5-345a-4515-901d-7db60d5dd5be",
          "lastAppliedAt": 1767967701226
        },
        "2b705f74-1850-464c-8394-4a83c059fc4f": {
          "_v": 3,
          "bubbleId": "4dc40218-58f2-4777-ac80-3fecafd0c964",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "2b705f74-1850-464c-8394-4a83c059fc4f",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "8181ba5f-fd1f-41ca-8ef6-975ff50be473",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767967721503,
          "composerChatGenerationUuid": "037b7284-30dc-4fe8-8ef4-a8455cfa4f1c",
          "diffId": "efafdea9-56ee-4a36-9c95-a700f5e0ab68",
          "lastDiffId": "5faeae9b-ef34-42de-a3b3-459500950747",
          "lastAppliedAt": 1767967732662
        },
        "b590b0e9-5b62-445b-b9a1-a105a2dfa458": {
          "_v": 3,
          "bubbleId": "7307493e-5ca3-433f-94e4-fc9e5d12fd78",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "b590b0e9-5b62-445b-b9a1-a105a2dfa458",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "2b705f74-1850-464c-8394-4a83c059fc4f",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768038112558,
          "composerChatGenerationUuid": "c251c5f3-0079-43fb-bca8-3dab5a346cd7",
          "diffId": "65ff6e06-f509-4fe0-8193-b3953efbb847",
          "lastDiffId": "258f6c9c-5f95-4b72-9d40-6983ad4c3fea",
          "lastAppliedAt": 1768038120177
        },
        "11ca7705-04b4-4652-8172-11ad43764b30": {
          "_v": 3,
          "bubbleId": "a18dbaff-696d-4ce8-9099-7122f9a1ca10",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "11ca7705-04b4-4652-8172-11ad43764b30",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "b590b0e9-5b62-445b-b9a1-a105a2dfa458",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768038123504,
          "composerChatGenerationUuid": "c251c5f3-0079-43fb-bca8-3dab5a346cd7",
          "diffId": "64b53f71-d15b-438c-951f-ea358b24c8d3",
          "lastDiffId": "02063f4b-3fa9-4381-87cc-fb6a5e0b9997",
          "lastAppliedAt": 1768038130294
        },
        "e3e8c8a0-b224-4618-b7df-3028d0d2e718": {
          "_v": 3,
          "bubbleId": "3f6d1e3a-c982-40dd-93aa-23c184426c38",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "e3e8c8a0-b224-4618-b7df-3028d0d2e718",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "11ca7705-04b4-4652-8172-11ad43764b30",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768038247714,
          "composerChatGenerationUuid": "c251c5f3-0079-43fb-bca8-3dab5a346cd7",
          "diffId": "42fdeea9-2d98-4b4e-8f9c-8d84a02d5128",
          "lastDiffId": "df23efaf-af2d-4c9c-affb-8dcea3c47202",
          "lastAppliedAt": 1768038254770
        },
        "3b73bd5c-0e5a-4b13-a0d6-8b19045fd960": {
          "_v": 3,
          "bubbleId": "96a141a0-61f2-4038-a14f-605d04421dca",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "3b73bd5c-0e5a-4b13-a0d6-8b19045fd960",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "e3e8c8a0-b224-4618-b7df-3028d0d2e718",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768038258156,
          "composerChatGenerationUuid": "c251c5f3-0079-43fb-bca8-3dab5a346cd7",
          "diffId": "77aeeb84-a4cc-4bc3-af52-3fad2863431d",
          "lastDiffId": "7ccdd43b-3d16-4302-9f81-fe17b712b873",
          "lastAppliedAt": 1768038265061
        },
        "e8c8c045-f723-4ea5-b87b-b6804b2a067e": {
          "_v": 3,
          "bubbleId": "36b77122-9967-4d0a-97a6-cfa7389ffbf6",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "e8c8c045-f723-4ea5-b87b-b6804b2a067e",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "3b73bd5c-0e5a-4b13-a0d6-8b19045fd960",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039911957,
          "composerChatGenerationUuid": "3dc1626d-7681-49d8-84ec-a610da47bfa8",
          "diffId": "ee4e71ba-82eb-4019-b7dd-40d49f3daca1",
          "lastDiffId": "2b5b4938-d766-4128-a65a-b4badaff03b6",
          "lastAppliedAt": 1768039921582
        },
        "46ccebda-38ce-45f2-960a-85f0cf155e22": {
          "_v": 3,
          "bubbleId": "b3bafef8-aeee-4b60-90b6-bd515a9eb312",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "46ccebda-38ce-45f2-960a-85f0cf155e22",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "e8c8c045-f723-4ea5-b87b-b6804b2a067e",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039925135,
          "composerChatGenerationUuid": "3dc1626d-7681-49d8-84ec-a610da47bfa8",
          "diffId": "7bcfd12c-77da-4e7b-b850-a167a4ab7ba6",
          "lastDiffId": "94737ac1-f0a2-45ac-a087-42f93ecb3a71",
          "lastAppliedAt": 1768039931905
        },
        "1d650d3a-639c-4e82-b109-59fce66e6be7": {
          "_v": 3,
          "bubbleId": "f50ca1e5-6aff-4051-b382-127a9d93b492",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "1d650d3a-639c-4e82-b109-59fce66e6be7",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039935500,
          "composerChatGenerationUuid": "3dc1626d-7681-49d8-84ec-a610da47bfa8"
        },
        "017e1936-bd06-4a02-843a-4cad2a141f33": {
          "_v": 3,
          "bubbleId": "b6e1c411-a8ab-48b8-8702-da0d336b2dbd",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "017e1936-bd06-4a02-843a-4cad2a141f33",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "46ccebda-38ce-45f2-960a-85f0cf155e22",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039942158,
          "composerChatGenerationUuid": "3dc1626d-7681-49d8-84ec-a610da47bfa8",
          "diffId": "20fc745c-7ca8-47a0-b49d-782411439860",
          "lastDiffId": "f58a3930-8619-4fa1-824e-d75e07d209ae",
          "lastAppliedAt": 1768039949671
        },
        "77844191-e108-43fc-ab58-6ebba84aef14": {
          "_v": 3,
          "bubbleId": "f5ff2ad5-9b3b-4a3f-b3bb-6e5b09d94ee8",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "77844191-e108-43fc-ab58-6ebba84aef14",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "017e1936-bd06-4a02-843a-4cad2a141f33",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768043102066,
          "composerChatGenerationUuid": "1c6bd2be-ae3d-40e3-9b52-e2aa6f38de11",
          "diffId": "f9678e5c-acb9-4b3e-bf02-0d61bf97a6af",
          "lastDiffId": "72940551-71eb-4f8b-b54e-3dd22334ce6d",
          "lastAppliedAt": 1768043111513
        },
        "fe4fbeea-9f3e-4113-829c-fd5edc80ed70": {
          "_v": 3,
          "bubbleId": "e7725694-acbc-420a-a2ce-43049846fac9",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\MacIdCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "fe4fbeea-9f3e-4113-829c-fd5edc80ed70",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "77844191-e108-43fc-ab58-6ebba84aef14",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768043154115,
          "composerChatGenerationUuid": "1c6bd2be-ae3d-40e3-9b52-e2aa6f38de11",
          "diffId": "2ea901d3-8047-4943-a311-91b6b4d14a11",
          "lastDiffId": "64ed2b47-f43f-4817-bb40-902343e44296",
          "lastAppliedAt": 1768043166225
        }
      },
      "file:///k%3A/FQC-Tracking-App/RELIABILITY_FIXES_SUMMARY.md": {
        "024cc5c6-1ecd-4625-b546-5a17d5a3d087": {
          "_v": 3,
          "bubbleId": "dae47d9d-51af-425f-9216-c4e06aea0c79",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\RELIABILITY_FIXES_SUMMARY.md",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/RELIABILITY_FIXES_SUMMARY.md",
            "path": "/K:/FQC-Tracking-App/RELIABILITY_FIXES_SUMMARY.md",
            "scheme": "file"
          },
          "codeblockId": "024cc5c6-1ecd-4625-b546-5a17d5a3d087",
          "status": "completed",
          "languageId": "markdown",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1767963884164,
          "composerChatGenerationUuid": "b5b14bd6-6927-48d6-b565-d9a3c04c10ea",
          "diffId": "b3ec69aa-dd4e-4917-9b57-9a506a10881e",
          "lastDiffId": "7a16824c-d025-4d34-a5d0-d279360f2093",
          "lastAppliedAt": 1767963892033
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DriverPairingCacheManager.kt": {
        "1cc55332-f266-4732-9560-07b5f513f142": {
          "_v": 3,
          "bubbleId": "b4fcf342-8e5c-4606-a173-c7962cbe7598",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\DriverPairingCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DriverPairingCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DriverPairingCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "1cc55332-f266-4732-9560-07b5f513f142",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768038144415,
          "composerChatGenerationUuid": "c251c5f3-0079-43fb-bca8-3dab5a346cd7",
          "diffId": "8bcd71cb-d8aa-4a9e-9045-9d1762a8105e",
          "lastDiffId": "3fc921fb-fe5b-4c00-8791-8ca66b12ab0d",
          "lastAppliedAt": 1768038151113
        },
        "1370d5f4-ec94-416b-b3e8-c6b48c241c3d": {
          "_v": 3,
          "bubbleId": "48df736a-a70d-42f2-b719-d51cf31426b4",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\DriverPairingCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DriverPairingCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DriverPairingCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "1370d5f4-ec94-416b-b3e8-c6b48c241c3d",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "1cc55332-f266-4732-9560-07b5f513f142",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768038154454,
          "composerChatGenerationUuid": "c251c5f3-0079-43fb-bca8-3dab5a346cd7",
          "diffId": "b943e705-9339-4908-bb5d-8a19e2283b4b",
          "lastDiffId": "c9404846-a4bd-4423-9b24-851b1aee79b5",
          "lastAppliedAt": 1768038160727
        },
        "554049da-755b-4412-95c9-5bce3bcc27f7": {
          "_v": 3,
          "bubbleId": "df06cb8f-e855-4dc9-af36-196436a8ffe0",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\DriverPairingCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DriverPairingCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DriverPairingCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "554049da-755b-4412-95c9-5bce3bcc27f7",
          "status": "aborted",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768038164107,
          "composerChatGenerationUuid": "c251c5f3-0079-43fb-bca8-3dab5a346cd7"
        },
        "68507963-83f3-419b-b448-c6c269050002": {
          "_v": 3,
          "bubbleId": "c40f5d69-0480-4a6f-ae2d-e4da0a7c3996",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\services\\DriverPairingCacheManager.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DriverPairingCacheManager.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DriverPairingCacheManager.kt",
            "scheme": "file"
          },
          "codeblockId": "68507963-83f3-419b-b448-c6c269050002",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "1370d5f4-ec94-416b-b3e8-c6b48c241c3d",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768038180640,
          "composerChatGenerationUuid": "c251c5f3-0079-43fb-bca8-3dab5a346cd7",
          "diffId": "68736344-9419-4908-b7b1-6bc36b305a1c",
          "lastDiffId": "fdd176e5-997a-4bf9-b21f-6cdb6daaf05b",
          "lastAppliedAt": 1768038187467
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/DriverPairingScreen.kt": {
        "3bd155cd-6362-40f2-ab96-1f65b639ee77": {
          "_v": 3,
          "bubbleId": "56e78a6e-95ad-4141-8042-a90a1f5800d2",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\DriverPairingScreen.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/DriverPairingScreen.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/DriverPairingScreen.kt",
            "scheme": "file"
          },
          "codeblockId": "3bd155cd-6362-40f2-ab96-1f65b639ee77",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768039546418,
          "composerChatGenerationUuid": "8516e614-40cd-46fa-bbfb-d33abe1788f4",
          "diffId": "903bd10c-bf9b-4bc7-b48a-16efa6de1360",
          "lastDiffId": "ae69ca26-8de3-4371-9b85-437a225b5985",
          "lastAppliedAt": 1768039555397
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseSongTestService.kt": {
        "3dd5ef2c-aedb-413e-876f-1462d6fd1f34": {
          "_v": 3,
          "bubbleId": "1c69a70f-f047-43b9-bb01-743c2605038f",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\supabase\\SupabaseSongTestService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseSongTestService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseSongTestService.kt",
            "scheme": "file"
          },
          "codeblockId": "3dd5ef2c-aedb-413e-876f-1462d6fd1f34",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050834562,
          "composerChatGenerationUuid": "69e60308-35bd-4074-8411-b585563fa57e",
          "diffId": "18ea77ad-63c2-45a5-a883-fb76579db368",
          "lastDiffId": "e39b51d4-3e01-46dc-ba54-d9f36029966f",
          "lastAppliedAt": 1768050844547
        },
        "997ec303-897f-43f1-9f51-8d7052a50c1e": {
          "_v": 3,
          "bubbleId": "07178bac-c045-444c-b69b-12360a37d295",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\supabase\\SupabaseSongTestService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseSongTestService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseSongTestService.kt",
            "scheme": "file"
          },
          "codeblockId": "997ec303-897f-43f1-9f51-8d7052a50c1e",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "3dd5ef2c-aedb-413e-876f-1462d6fd1f34",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050848069,
          "composerChatGenerationUuid": "69e60308-35bd-4074-8411-b585563fa57e",
          "diffId": "e0ddedb7-c95a-4f0c-951a-05ce9e814f87",
          "lastDiffId": "565ddf72-f461-40bc-ae9e-f4862deaa42e",
          "lastAppliedAt": 1768050855399
        },
        "0ae8ce61-590f-4cbf-923a-d9b3aa91d4fd": {
          "_v": 3,
          "bubbleId": "66eeb39d-e7a9-4c2a-95c5-f6e94984d7c0",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\supabase\\SupabaseSongTestService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseSongTestService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseSongTestService.kt",
            "scheme": "file"
          },
          "codeblockId": "0ae8ce61-590f-4cbf-923a-d9b3aa91d4fd",
          "status": "completed",
          "languageId": "plaintext",
          "chainedInfo": {
            "chainedFromCodeblockId": "997ec303-897f-43f1-9f51-8d7052a50c1e",
            "composerId": "e7cd62a7-a012-4a0b-a586-fda8d7ca96cb"
          },
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768050885968,
          "composerChatGenerationUuid": "69e60308-35bd-4074-8411-b585563fa57e",
          "diffId": "717405d6-7162-46c1-a703-651a66eec37d",
          "lastDiffId": "721dcdd7-a951-4576-9414-20ea9dd31ef6",
          "lastAppliedAt": 1768050895950
        }
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseFrequencyTestService.kt": {
        "acc7341e-721c-4996-ad6a-0d2d1a8d5d10": {
          "_v": 3,
          "bubbleId": "d703a755-7888-4282-a6d1-f155cd8c20ec",
          "codeBlockIdx": 0,
          "uri": {
            "$mid": 1,
            "fsPath": "k:\\FQC-Tracking-App\\app\\src\\main\\java\\com\\example\\fqcapp\\supabase\\SupabaseFrequencyTestService.kt",
            "_sep": 1,
            "external": "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseFrequencyTestService.kt",
            "path": "/K:/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseFrequencyTestService.kt",
            "scheme": "file"
          },
          "codeblockId": "acc7341e-721c-4996-ad6a-0d2d1a8d5d10",
          "status": "completed",
          "languageId": "plaintext",
          "codeBlockDisplayPreference": "collapsed",
          "createdAt": 1768052122133,
          "composerChatGenerationUuid": "ec10b3b9-03ab-4d4d-8086-8cb963d74723",
          "diffId": "dc9b8d4e-7e7a-4384-ad08-26a144189bad",
          "lastDiffId": "d76d7baf-166b-49e9-ae90-d4d68e4042e5",
          "lastAppliedAt": 1768052137028
        }
      }
    },
    "originalFileStates": {
      "file:///k%3A/FQC-Tracking-App/PROJECT_STATUS_SUMMARY.md": {
        "content": "",
        "firstEditBubbleId": "963fb43d-d7b3-4b68-ae48-4cae2ba7413d",
        "isNewlyCreated": true,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/COMPREHENSIVE_ANALYSIS.md": {
        "content": "",
        "firstEditBubbleId": "9d88ecc3-ba4c-487f-848c-4d6dc7b3143c",
        "isNewlyCreated": true,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/COMPLETE_SCREEN_DATA_FLOW.md": {
        "content": "",
        "firstEditBubbleId": "2499932b-bbc7-4b9b-b8f7-05e01dc8053d",
        "isNewlyCreated": true,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/WORKFLOW_REQUIREMENTS_SUMMARY.md": {
        "content": "",
        "firstEditBubbleId": "aa5a7f74-0aab-49dc-afcc-7f169e1244c5",
        "isNewlyCreated": true,
        "newlyCreatedFolders": []
      },
      "file:///c%3A/Users/pc/Desktop/RECOVERY_SUMMARY_FRAPPE_FQC5.md": {
        "content": "# Recovery Summary: Frappe Docker & FQC5 Conversations\n\n##  **Recovery Status**\n\nI've searched all Cursor databases for \"Frappe Docker port and login issues\" and \"FQC5\" conversations.\n\n### **What Was Found:**\n\n1. **Frappe/Docker Conversation:**\n   - Composer ID: `11b622ee-1cd8-478e-89c0-a5e470f25415`\n   - **Status:**  **RECOVERED** (102 messages)\n   - **File:** `RECOVERED_FRAPPE_1_11b622ee.txt`\n   - **Note:** This is the same conversation as \"Lost chat recovery\" - it contains discussions about Frappe, Docker, ports, and login issues\n\n2. **FQC5 Conversation:**\n   - Composer ID: `20e7a53f-33e9-40e9-9237-a8f5ded267e0`\n   - **Status:**  **EMPTY** (0 messages found)\n   - This conversation container exists but has no message content\n\n##  **Recovered Files Location**\n\nAll files are in: `C:\\Users\\pc\\Desktop\\recovered_cursor_chats\\`\n\n### **Key Files:**\n\n1. **`RECOVERED_FRAPPE_1_11b622ee.txt`**\n   - Contains 102 messages\n   - Includes Frappe and Docker discussions\n   - Same as \"Lost chat recovery\" conversation\n\n2. **`RECOVERED_DOCKER_1_11b622ee.txt`**\n   - Same conversation as above (different extraction method)\n   - 102 messages\n\n3. **`RECONSTRUCTED_11b622ee-1cd8-478e-8.txt`**\n   - Full reconstructed conversation\n   - 71 messages (from earlier recovery)\n   - This is your main conversation\n\n##  **Important Finding**\n\n**The conversation titles shown in Cursor's UI are stored separately from the actual conversation data.**\n\n- The titles (\"Frappe Docker port and login issues\", \"FQC5\") are UI metadata\n- The actual conversations are stored by composer ID\n- The conversation `11b622ee-1cd8-478e-89c0-a5e470f25415` contains content about:\n  - Frappe\n  - Docker\n  - Port issues\n  - Login problems\n  - FQC topics\n\n**This means:** The conversation you see as \"Frappe Docker port and login issues\" in Cursor's UI is likely the same conversation we've already recovered (`11b622ee-1cd8-478e-89c0-a5e470f25415`).\n\n##  **How to Access Your Conversations**\n\n1. **Open:** `C:\\Users\\pc\\Desktop\\recovered_cursor_chats\\RECOVERED_FRAPPE_1_11b622ee.txt`\n   - This contains the Frappe/Docker conversation with 102 messages\n\n2. **Or open:** `C:\\Users\\pc\\Desktop\\recovered_cursor_chats\\RECONSTRUCTED_11b622ee-1cd8-478e-8.txt`\n   - This is the same conversation, reconstructed earlier\n\n3. **For FQC5:**\n   - The FQC5 conversation container exists but appears to be empty\n   - It's possible the conversation was cleared or never had content\n   - Check if FQC5 content might be in the main conversation file\n\n##  **Why You Can't Open Them in Cursor**\n\nThe conversations are visible in Cursor's history panel but won't open because:\n- Database structure may be corrupted\n- Conversation links are broken\n- Titles are stored separately from conversation data\n\n**Solution:** Use the recovered text files - they contain all the conversation content!\n\n##  **Summary**\n\n **Frappe Docker conversation:** RECOVERED (102 messages)  \n **FQC5 conversation:** Container found but empty  \n **All content saved to:** `C:\\Users\\pc\\Desktop\\recovered_cursor_chats\\`\n\nYour conversations are recovered and saved as readable text files!\n\n\n\n\n",
        "firstEditBubbleId": "9eaec6ed-fce4-4f54-ad36-bd6f0026df6e",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///c%3A/Users/pc/Desktop/create_scheduled_task.bat": {
        "content": "@echo off\necho ================================================================================\necho Creating Scheduled Task for Auto-Backup\necho ================================================================================\necho.\necho This will create a scheduled task that runs every 5 minutes.\necho You may need to run this as Administrator.\necho.\npause\n\nset BACKUP_DIR=%USERPROFILE%\\Desktop\\cursor-chat-backups\nset TASK_NAME=CursorChatAutoBackup\n\necho.\necho Creating scheduled task: %TASK_NAME%\necho Task will run: %BACKUP_DIR%\\auto-backup.bat\necho Frequency: Every 5 minutes\necho.\n\nschtasks /Create /TN \"%TASK_NAME%\" /TR \"%BACKUP_DIR%\\auto-backup.bat\" /SC MINUTE /MO 5 /F /RL HIGHEST\nif errorlevel 1 (\n    echo.\n    echo [ERROR] Could not create scheduled task automatically.\n    echo.\n    echo You need to create it manually:\n    echo   1. Press Win+R\n    echo   2. Type: taskschd.msc\n    echo   3. Click \"Create Basic Task\"\n    echo   4. Name: CursorChatAutoBackup\n    echo   5. Trigger: Recurring, Every 5 minutes\n    echo   6. Action: Start a program\n    echo   7. Program: %BACKUP_DIR%\\auto-backup.bat\n    echo   8. Finish\n    echo.\n) else (\n    echo.\n    echo [SUCCESS] Scheduled task created!\n    echo.\n    echo Task details:\n    schtasks /Query /TN \"%TASK_NAME%\" /FO LIST | findstr /C:\"Status\" /C:\"Next Run Time\" /C:\"Task To Run\"\n)\n\necho.\npause\n",
        "firstEditBubbleId": "9eaec6ed-fce4-4f54-ad36-bd6f0026df6e",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt": {
        "content": "",
        "firstEditBubbleId": "d5282fb6-a292-4bf4-b53f-cb450c30fb18",
        "isNewlyCreated": true,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt": {
        "content": "package com.example.fqcapp\n\nimport androidx.compose.foundation.layout.*\nimport androidx.compose.foundation.shape.RoundedCornerShape\nimport androidx.compose.foundation.clickable\nimport androidx.compose.foundation.rememberScrollState\nimport androidx.compose.foundation.verticalScroll\nimport androidx.compose.material.icons.Icons\nimport androidx.compose.material.icons.filled.Menu\nimport androidx.compose.material3.*\nimport androidx.compose.runtime.Composable\nimport androidx.compose.ui.Alignment\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.text.font.FontWeight\nimport androidx.compose.ui.unit.dp\nimport androidx.compose.ui.unit.sp\nimport androidx.compose.ui.text.style.TextAlign\nimport androidx.compose.foundation.background\nimport androidx.compose.foundation.shape.CircleShape\nimport com.example.fqcapp.utils.getResponsivePadding\nimport com.example.fqcapp.utils.getResponsiveSpacing\nimport com.example.fqcapp.utils.getResponsiveTextSize\nimport com.example.fqcapp.utils.getResponsiveButtonSize\nimport com.example.fqcapp.utils.getResponsiveCardPadding\nimport com.example.fqcapp.utils.getResponsiveMaxWidth\nimport com.example.fqcapp.utils.getScreenInfo\nimport com.example.fqcapp.utils.getResponsiveColumnCount\nimport com.example.fqcapp.core.UndoManager\nimport androidx.compose.runtime.collectAsState\nimport androidx.compose.runtime.remember\nimport androidx.compose.runtime.mutableStateOf\nimport androidx.compose.runtime.LaunchedEffect\nimport androidx.compose.runtime.getValue\nimport androidx.compose.runtime.setValue\nimport androidx.compose.runtime.rememberCoroutineScope\nimport kotlinx.coroutines.launch\nimport android.util.Log\nimport androidx.compose.runtime.mutableStateListOf\nimport androidx.compose.ui.platform.LocalContext\nimport com.example.fqcapp.ui.components.MilestoneTimeline\nimport com.example.fqcapp.ui.components.MilestoneRowUi\nimport com.example.fqcapp.ui.components.SolutionReminderCard\nimport com.example.fqcapp.ui.components.CurrentHeadphoneStatusCard\nimport com.example.fqcapp.ui.components.DetailedMilestoneDataCard\nimport com.example.fqcapp.ui.models.CurrentStatusData\nimport com.example.fqcapp.ui.models.DetailedMilestoneData\nimport com.example.fqcapp.services.DeviceDataSyncService\nimport com.example.fqcapp.services.MacIdCacheManager\nimport com.example.fqcapp.services.GoogleSheetsAPI\nimport com.example.fqcapp.data.dao.MacIdCacheDao\nimport com.example.fqcapp.data.AppDatabase\nimport com.example.fqcapp.core.PendingSolution\nimport com.example.fqcapp.core.ReminderType\nimport androidx.compose.runtime.collectAsState\n\n@Composable\nfun LandingScreen(\n    operatorName: String,\n    currentSerialNumber: String?,\n    currentMacAddress: String,\n    currentDeviceName: String? = null, // New parameter for device name\n    isReferenceSerial: Boolean = false, // Track if serial is generated reference\n    onOpenScanner: () -> Unit,\n    onOpenFreqGen: () -> Unit,\n    onOpenTestSongs: () -> Unit,\n    onOpenReview: () -> Unit,\n    onOpenMore: () -> Unit,\n    onOpenDeviceInfo: () -> Unit = {}, // New parameter for opening device info\n    onLogout: () -> Unit,\n    onOpenDrawer: () -> Unit,\n    paddingValues: PaddingValues,\n    hasBluetoothPermissions: Boolean = true,\n    onRequestPermissions: () -> Unit = {},\n    dataUploadStatus: String = \"Unknown\", // New parameter for upload status\n    onForgetCurrentDevice: () -> Unit = {}, // New parameter for forgetting current device\n    undoManager: UndoManager? = null, // New parameter for undo manager\n    solutionReminderManager: com.example.fqcapp.core.SolutionReminderManager? = null, // New parameter for solution reminders\n    onNavigateToDriverPairing: () -> Unit = {}, // New parameter for navigating to driver pairing\n    onNavigateToChangedParts: () -> Unit = {} // New parameter for navigating to changed parts\n) {\n    val scope = rememberCoroutineScope()\n    val bgColor = Color(0xFF121212)\n    val accentColor = Color(0xFF6366F1) // Beautiful purple\n    val surfaceColor = Color(0xFF1E1E1E)\n    val secondaryColor = Color(0xFF374151)\n    val warningColor = Color(0xFFF59E0B) // Beautiful orange\n    val successColor = Color(0xFF10B981) // Beautiful green\n    val infoColor = Color(0xFF3B82F6) // Beautiful blue\n    val dangerColor = Color(0xFFEF4444) // Beautiful red\n\n    val screenInfo = getScreenInfo()\n    val responsivePadding = getResponsivePadding()\n    val responsiveSpacing = getResponsiveSpacing()\n    val context = LocalContext.current\n    \n    // Current Status Data - Declare at composable level\n    var currentStatusData by remember { mutableStateOf<CurrentStatusData?>(null) }\n    var detailedMilestoneData by remember { mutableStateOf<DetailedMilestoneData?>(null) }\n    var isDetailedViewExpanded by remember { mutableStateOf(false) }\n    var isSyncing by remember { mutableStateOf(false) }\n    \n    // Function to get serial number from MAC ID if serial number is null\n    val getSerialFromMacId = suspend {\n        if (currentSerialNumber != null) {\n            currentSerialNumber\n        } else if (currentMacAddress.isNotBlank()) {\n            try {\n                val db = com.example.fqcapp.data.AppDatabase.getDatabase(context)\n                val macIdCacheDao = db.macIdCacheDao()\n                val macIdCacheManager = MacIdCacheManager(context, macIdCacheDao, GoogleSheetsAPI(context))\n                val serialFromMac = macIdCacheManager.getSerialNumberByMacId(currentMacAddress)\n                Log.d(\"LandingScreen\", \" Looked up serial from MAC $currentMacAddress: $serialFromMac\")\n                serialFromMac\n            } catch (e: Exception) {\n                Log.e(\"LandingScreen\", \" Error looking up serial from MAC ID\", e)\n                null\n            }\n        } else {\n            null\n        }\n    }\n    \n    // Function to sync data from Supabase and load from local DB\n    val syncAndLoadData: suspend () -> Unit = {\n        val serialToUse = getSerialFromMacId()\n        if (serialToUse != null && !isSyncing) {\n            isSyncing = true\n            try {\n                val db = com.example.fqcapp.data.AppDatabase.getDatabase(context)\n                val repo = com.example.fqcapp.data.FQCRepository(db)\n                \n                // Load data from local DB FIRST (show cached data immediately)\n                val driverPairingSheetsService = com.example.fqcapp.services.DriverPairingSheetsService(context)\n                val driverPairingCacheManager = com.example.fqcapp.services.DriverPairingCacheManager(\n                    db.driverPairingCacheDao(),\n                    driverPairingSheetsService\n                )\n                \n                // Load from local DB immediately (fast, non-blocking)\n                val loadedCurrentStatus = repo.getCurrentStatusData(serialToUse, currentMacAddress, currentDeviceName, driverPairingCacheManager)\n                val loadedDetailedMilestone = repo.getDetailedMilestoneData(serialToUse)\n                currentStatusData = loadedCurrentStatus\n                detailedMilestoneData = loadedDetailedMilestone\n                \n                // Then sync from Supabase in background (non-blocking)\n                scope.launch(kotlinx.coroutines.Dispatchers.IO) {\n                    try {\n                        Log.d(\"LandingScreen\", \" Syncing data from Supabase for: $serialToUse (background)\")\n                        val syncService = DeviceDataSyncService(db)\n                        val syncSuccess = syncService.syncDeviceDataFromSupabase(serialToUse)\n                        Log.d(\"LandingScreen\", \" Sync completed: $syncSuccess\")\n                        \n                        // Reload data after sync completes (only if still on same serial)\n                        val currentSerial = getSerialFromMacId()\n                        if (serialToUse == currentSerial) {\n                            val updatedCurrentStatus = repo.getCurrentStatusData(serialToUse, currentMacAddress, currentDeviceName, driverPairingCacheManager)\n                            val updatedDetailedMilestone = repo.getDetailedMilestoneData(serialToUse)\n                            currentStatusData = updatedCurrentStatus\n                            detailedMilestoneData = updatedDetailedMilestone\n                        }\n                    } catch (e: kotlinx.coroutines.CancellationException) {\n                        Log.d(\"LandingScreen\", \" Sync cancelled (expected on navigation)\")\n                    } catch (e: Exception) {\n                        Log.e(\"LandingScreen\", \" Error syncing from Supabase\", e)\n                    }\n                }\n                \n                // Reduced logging for performance - only log errors\n            } catch (e: kotlinx.coroutines.CancellationException) {\n                // Expected when navigating away - don't log as error\n                Log.d(\"LandingScreen\", \" Load cancelled (expected on navigation)\")\n            } catch (e: Exception) {\n                Log.e(\"LandingScreen\", \" Error loading data\", e)\n                // Data loading already happened above, so we're good\n            } finally {\n                isSyncing = false\n            }\n        } else {\n            // No serial number found, cannot load data\n            Log.d(\"LandingScreen\", \" No serial number found (serial=$currentSerialNumber, mac=$currentMacAddress), cannot load data\")\n        }\n    }\n    \n    // Cache last loaded serial to prevent unnecessary reloads\n    var lastLoadedSerial by remember { mutableStateOf<String?>(null) }\n    var lastLoadTime by remember { mutableStateOf(0L) }\n    \n    // Sync and load when serial number or MAC address changes (with debouncing)\n    LaunchedEffect(currentSerialNumber, currentMacAddress) {\n        val serialToUse = getSerialFromMacId()\n        \n        // Debounce: Only reload if serial changed or it's been more than 2 seconds since last load\n        val shouldReload = serialToUse != null && (\n            serialToUse != lastLoadedSerial || \n            (System.currentTimeMillis() - lastLoadTime) > 2000\n        )\n        \n        if (shouldReload) {\n            if (serialToUse != null) {\n                lastLoadedSerial = serialToUse\n                lastLoadTime = System.currentTimeMillis()\n                syncAndLoadData()\n            } else {\n                currentStatusData = null\n                detailedMilestoneData = null\n                isDetailedViewExpanded = false\n                lastLoadedSerial = null\n            }\n        }\n    }\n    \n    // Also refresh periodically (every 30 seconds) to catch updates from other screens\n    // Only refresh if serial hasn't changed and it's been at least 30 seconds\n    LaunchedEffect(Unit) {\n        while (true) {\n            kotlinx.coroutines.delay(30000) // Check every 30 seconds (reduced from 15s)\n            val serialToUse = getSerialFromMacId()\n            \n            // Only refresh if:\n            // 1. Serial exists\n            // 2. Not currently syncing\n            // 3. Serial hasn't changed since last load\n            // 4. It's been at least 30 seconds since last load\n            if (serialToUse != null && \n                !isSyncing && \n                serialToUse == lastLoadedSerial &&\n                (System.currentTimeMillis() - lastLoadTime) >= 30000) {\n                try {\n                    // Only reload from local DB, don't sync again (faster)\n                    val db = com.example.fqcapp.data.AppDatabase.getDatabase(context)\n                    val repo = com.example.fqcapp.data.FQCRepository(db)\n                    // Create DriverPairingCacheManager to check Google Sheets if needed\n                    val driverPairingSheetsService = com.example.fqcapp.services.DriverPairingSheetsService(context)\n                    val driverPairingCacheManager = com.example.fqcapp.services.DriverPairingCacheManager(\n                        db.driverPairingCacheDao(),\n                        driverPairingSheetsService\n                    )\n                    currentStatusData = repo.getCurrentStatusData(serialToUse, currentMacAddress, currentDeviceName, driverPairingCacheManager)\n                    detailedMilestoneData = repo.getDetailedMilestoneData(serialToUse)\n                    lastLoadTime = System.currentTimeMillis()\n                } catch (e: Exception) {\n                    Log.e(\"LandingScreen\", \" Error refreshing data\", e)\n                }\n            }\n        }\n    }\n    \n    // Solution Reminder Logic - Observe StateFlow for reactive updates\n    val allPendingSolutionsMap by solutionReminderManager?.pendingSolutions?.collectAsState() \n        ?: remember { \n            mutableStateOf(emptyMap<String, List<PendingSolution>>()) \n        }\n    \n    // Calculate pending solutions for current serial/device\n    val pendingSolutions = remember(allPendingSolutionsMap, currentSerialNumber, currentDeviceName) {\n        val serialToCheck = currentSerialNumber ?: currentDeviceName\n        if (serialToCheck != null) {\n            allPendingSolutionsMap[serialToCheck] ?: emptyList()\n        } else {\n            emptyList<PendingSolution>()\n        }\n    }\n    \n    // Track which solutions have been dismissed (for confirmation dialogs)\n    val dismissedSolutions = remember { mutableStateOf(setOf<String>()) }\n    \n    Column(\n        modifier = Modifier\n            .fillMaxSize()\n            .verticalScroll(rememberScrollState())\n            .padding(paddingValues)\n            .padding(responsivePadding)\n            .then(\n                if (screenInfo.isTablet) {\n                    Modifier.widthIn(max = getResponsiveMaxWidth())\n                } else {\n                    Modifier\n                }\n            ),\n        horizontalAlignment = Alignment.CenterHorizontally,\n        verticalArrangement = Arrangement.spacedBy(responsiveSpacing)\n    ) {\n        // Hamburger Menu Icon (Top Left)\n        Row(\n            modifier = Modifier.fillMaxWidth(),\n            verticalAlignment = Alignment.CenterVertically\n        ) {\n            IconButton(onClick = onOpenDrawer) {\n                Icon(\n                    imageVector = Icons.Default.Menu,\n                    contentDescription = \"Open Menu\",\n                    tint = accentColor,\n                    modifier = Modifier.size(24.dp)\n                )\n            }\n        }\n        \n        // Permission Warning Banner (if not granted)\n        if (!hasBluetoothPermissions) {\n            Card(\n                modifier = Modifier.fillMaxWidth(),\n                colors = CardDefaults.cardColors(containerColor = warningColor.copy(alpha = 0.15f)),\n                shape = RoundedCornerShape(12.dp),\n                border = androidx.compose.foundation.BorderStroke(2.dp, warningColor)\n            ) {\n                Column(\n                    modifier = Modifier.padding(16.dp),\n                    verticalArrangement = Arrangement.spacedBy(12.dp)\n                ) {\n                    Row(\n                        verticalAlignment = Alignment.CenterVertically,\n                        horizontalArrangement = Arrangement.spacedBy(8.dp)\n                    ) {\n                        Text(\n                            text = \"\",\n                            style = MaterialTheme.typography.titleLarge\n                        )\n                        Text(\n                            text = \"Bluetooth Permissions Required\",\n                            style = MaterialTheme.typography.titleMedium,\n                            color = warningColor,\n                            fontWeight = FontWeight.Bold\n                        )\n                    }\n                    Text(\n                        text = \"Location permission is needed for Bluetooth scanning. Tap below to grant permissions.\",\n                        style = MaterialTheme.typography.bodyMedium,\n                        color = Color.White.copy(alpha = 0.9f)\n                    )\n            Button(\n                        onClick = onRequestPermissions,\n                modifier = Modifier.fillMaxWidth(),\n                colors = ButtonDefaults.buttonColors(\n                            containerColor = warningColor,\n                    contentColor = Color.Black\n                ),\n                        shape = RoundedCornerShape(8.dp)\n                    ) {\n                        Text(\n                            \"Grant Permissions Now\",\n                            fontWeight = FontWeight.Bold\n                        )\n                    }\n                }\n            }\n        }\n\n        // Current Headphone Status Card - Always show, even if no data (separate card)\n        CurrentHeadphoneStatusCard(\n            currentStatusData = currentStatusData ?: CurrentStatusData(),\n            onViewDetailsClick = { \n                // Always allow expanding, even if no serial number\n                // If data is null, it will try to load it\n                if (detailedMilestoneData == null && (currentSerialNumber != null || currentMacAddress.isNotBlank())) {\n                    // Try to load data when clicking View Details\n                    scope.launch {\n                        syncAndLoadData()\n                        isDetailedViewExpanded = true\n                    }\n                } else {\n                    isDetailedViewExpanded = true\n                }\n            },\n            modifier = Modifier.fillMaxWidth()\n        )\n        \n        // Detailed Milestone Data Card (shown when expanded)\n        if (isDetailedViewExpanded) {\n            if (detailedMilestoneData != null) {\n                DetailedMilestoneDataCard(\n                    detailedData = detailedMilestoneData!!,\n                    onHideDetailsClick = { isDetailedViewExpanded = false },\n                    modifier = Modifier.fillMaxWidth()\n                )\n            } else if (isSyncing) {\n                // Show loading state when expanding but data is syncing\n                Card(\n                    modifier = Modifier.fillMaxWidth(),\n                    colors = CardDefaults.cardColors(containerColor = surfaceColor),\n                    shape = RoundedCornerShape(12.dp)\n                ) {\n                    Box(\n                        modifier = Modifier\n                            .fillMaxWidth()\n                            .padding(16.dp),\n                        contentAlignment = Alignment.Center\n                    ) {\n                        Text(\n                            text = \"Loading detailed data...\",\n                            color = Color.White.copy(alpha = 0.6f)\n                        )\n                    }\n                }\n            } else {\n                // Show empty state when no data available\n                Card(\n                    modifier = Modifier.fillMaxWidth(),\n                    colors = CardDefaults.cardColors(containerColor = surfaceColor),\n                    shape = RoundedCornerShape(12.dp)\n                ) {\n                    Box(\n                        modifier = Modifier\n                            .fillMaxWidth()\n                            .padding(16.dp),\n                        contentAlignment = Alignment.Center\n                    ) {\n                        Text(\n                            text = \"No detailed data available. Please scan QR code to load device data.\",\n                            color = Color.White.copy(alpha = 0.6f),\n                            textAlign = TextAlign.Center\n                        )\n                    }\n                }\n            }\n        }\n\n        // Connected Device Section (Always Show)\n        Card(\n            modifier = Modifier.fillMaxWidth(),\n            colors = CardDefaults.cardColors(containerColor = surfaceColor),\n            shape = RoundedCornerShape(20.dp),\n            elevation = CardDefaults.cardElevation(defaultElevation = 8.dp),\n            border = androidx.compose.foundation.BorderStroke(1.dp, accentColor.copy(alpha = 0.2f))\n        ) {\n            Column(\n                modifier = Modifier.padding(12.dp),\n                horizontalAlignment = Alignment.CenterHorizontally\n            ) {\n                // Main Title (smaller font)\n                Text(\n                    text = if (currentSerialNumber != null) \"Device Connected\" else if (currentDeviceName != null) \"Bluetooth Device Connected\" else \"No Device Connected\",\n                    style = MaterialTheme.typography.titleMedium,\n                    fontSize = 16.sp,\n                    color = if (currentSerialNumber != null) {\n                        // Red if device name is not \"Sonic Lamb\", otherwise blue\n                        if (currentDeviceName != \"Sonic Lamb\") dangerColor else infoColor\n                    } else if (currentDeviceName != null) infoColor else warningColor,\n                    fontWeight = FontWeight.Bold,\n                    textAlign = TextAlign.Center\n                )\n                \n                // Show device details if connected (either with serial number or just Bluetooth device)\n                if (currentSerialNumber != null || currentDeviceName != null) {\n                    Spacer(modifier = Modifier.height(12.dp))\n                    \n                    var showForgetDialog by remember { mutableStateOf(false) }\n                    \n                    // Device Details Card (Clickable)\n                    val deviceCardColor = if (currentDeviceName == \"Sonic Lamb\") {\n                        infoColor.copy(alpha = 0.15f)\n                    } else {\n                        dangerColor.copy(alpha = 0.15f)\n                    }\n                    val deviceBorderColor = if (currentDeviceName == \"Sonic Lamb\") {\n                        infoColor.copy(alpha = 0.4f)\n                    } else {\n                        dangerColor.copy(alpha = 0.4f)\n                    }\n                    \n                    Card(\n                        modifier = Modifier\n                            .fillMaxWidth()\n                            .clickable(\n                                enabled = currentSerialNumber != null || currentMacAddress.isNotBlank(),\n                                onClick = onOpenDeviceInfo\n                            ),\n                        colors = CardDefaults.cardColors(containerColor = deviceCardColor),\n                        shape = RoundedCornerShape(12.dp),\n                        border = androidx.compose.foundation.BorderStroke(1.dp, deviceBorderColor)\n                    ) {\n                        Column(\n                            modifier = Modifier.padding(10.dp),\n                            horizontalAlignment = Alignment.CenterHorizontally\n                        ) {\n                            Text(\n                                text = \" Device Information\",\n                                style = MaterialTheme.typography.titleSmall,\n                                fontSize = (14 * 1.3).sp, // 30% increase\n                                color = if (currentDeviceName == \"Sonic Lamb\") infoColor else dangerColor,\n                                fontWeight = FontWeight.Bold\n                            )\n                            \n                            Spacer(modifier = Modifier.height(8.dp))\n                            \n                            // Serial Number\n                            Row(\n                                modifier = Modifier.fillMaxWidth(),\n                                horizontalArrangement = Arrangement.SpaceBetween,\n                                verticalAlignment = Alignment.CenterVertically\n                            ) {\n                                Text(\n                                    text = \"Serial Number:\",\n                                    style = MaterialTheme.typography.bodySmall,\n                                    fontSize = (12 * 1.3).sp, // 30% increase\n                                    color = Color.White.copy(alpha = 0.8f)\n                                )\n                                Text(\n                                    text = when {\n                                        isReferenceSerial -> \"Unknown (Reference: ${currentSerialNumber?.take(15)}...)\"\n                                        currentSerialNumber != null -> currentSerialNumber\n                                        else -> \"Not found in database\"\n                                    },\n                                    style = MaterialTheme.typography.bodySmall,\n                                    fontSize = (12 * 1.3).sp, // 30% increase\n                                    color = when {\n                                        isReferenceSerial -> warningColor\n                                        currentSerialNumber != null -> successColor\n                                        else -> warningColor\n                                    },\n                                    fontWeight = FontWeight.Bold\n                                )\n                            }\n                            \n                            Spacer(modifier = Modifier.height(6.dp))\n                            \n                            // MAC ID\n                            Row(\n                                modifier = Modifier.fillMaxWidth(),\n                                horizontalArrangement = Arrangement.SpaceBetween,\n                                verticalAlignment = Alignment.CenterVertically\n                            ) {\n                                Text(\n                                    text = \"MAC ID:\",\n                                    style = MaterialTheme.typography.bodySmall,\n                                    fontSize = (12 * 1.3).sp, // 30% increase\n                                    color = Color.White.copy(alpha = 0.8f)\n                                )\n                                Text(\n                                    text = currentMacAddress.ifBlank { \"Unknown\" },\n                                    style = MaterialTheme.typography.bodySmall,\n                                    fontSize = (12 * 1.3).sp, // 30% increase\n                                    color = infoColor,\n                                    fontWeight = FontWeight.Bold\n                                )\n                            }\n                            \n                            Spacer(modifier = Modifier.height(6.dp))\n                            \n                            // Device Name (if available)\n                            Row(\n                                modifier = Modifier.fillMaxWidth(),\n                                horizontalArrangement = Arrangement.SpaceBetween,\n                                verticalAlignment = Alignment.CenterVertically\n                            ) {\n                                Text(\n                                    text = \"Device Name:\",\n                                    style = MaterialTheme.typography.bodySmall,\n                                    fontSize = (12 * 1.3).sp, // 30% increase\n                                    color = Color.White.copy(alpha = 0.8f)\n                                )\n                                Text(\n                                    text = currentDeviceName ?: \"Bluetooth Headphone\",\n                                    style = MaterialTheme.typography.bodySmall,\n                                    fontSize = (12 * 1.3).sp, // 30% increase\n                                    color = Color.White.copy(alpha = 0.9f),\n                                    fontWeight = FontWeight.Medium\n                                )\n                            }\n                            \n                            Spacer(modifier = Modifier.height(8.dp))\n                            \n                            // Data Upload Status\n                            Row(\n                                modifier = Modifier.fillMaxWidth(),\n                                horizontalArrangement = Arrangement.SpaceBetween,\n                                verticalAlignment = Alignment.CenterVertically\n                            ) {\n                                Text(\n                                    text = \"Data Status:\",\n                                    style = MaterialTheme.typography.bodySmall,\n                                    fontSize = (11 * 1.3).sp, // 30% increase\n                                    color = Color.White.copy(alpha = 0.6f)\n                                )\n                                val statusColor = when (dataUploadStatus) {\n                                    \"Synced\" -> successColor\n                                    \"Pending\" -> warningColor\n                                    \"Failed\" -> dangerColor\n                                    else -> Color.White.copy(alpha = 0.6f)\n                                }\n                                Text(\n                                    text = dataUploadStatus,\n                                    style = MaterialTheme.typography.bodySmall,\n                                    fontSize = (11 * 1.3).sp, // 30% increase\n                                    color = statusColor,\n                                    fontWeight = FontWeight.Medium\n                                )\n                            }\n                            \n                            Spacer(modifier = Modifier.height(8.dp))\n                            \n                            // Forget Device Button\n                            Button(\n                                onClick = { showForgetDialog = true },\n                                modifier = Modifier.fillMaxWidth(),\n                                colors = ButtonDefaults.buttonColors(\n                                    containerColor = dangerColor.copy(alpha = 0.2f),\n                                    contentColor = dangerColor\n                                ),\n                                shape = RoundedCornerShape(8.dp)\n                            ) {\n                                Text(\n                                    text = \" Forget Current Device\",\n                                    style = MaterialTheme.typography.bodySmall,\n                                    fontSize = (12 * 1.3).sp, // 30% increase\n                                    fontWeight = FontWeight.Medium\n                                )\n                            }\n                        }\n                    }\n                    \n                    // Solution Reminder Cards - Show all pending solutions inline below Device Information\n                    val activeSolutions = pendingSolutions.filter { solution ->\n                        val key = \"${solution.serialNumber}_${solution.solution}\"\n                        !dismissedSolutions.value.contains(key)\n                    }\n                    \n                    if (activeSolutions.isNotEmpty()) {\n                        Spacer(modifier = Modifier.height(12.dp))\n                        \n                        activeSolutions.forEachIndexed { index, solution ->\n                            if (index > 0) {\n                                Spacer(modifier = Modifier.height(8.dp))\n                            }\n                            \n                            SolutionReminderCard(\n                                pendingSolution = solution,\n                                onNo = {\n                                    // Mark solution as dismissed\n                                    val key = \"${solution.serialNumber}_${solution.solution}\"\n                                    dismissedSolutions.value = dismissedSolutions.value + key\n                                    android.util.Log.d(\"LandingScreen\", \" [SOLUTION_REMINDER] User dismissed solution: ${solution.solution}\")\n                                },\n                                onYes = {\n                                    android.util.Log.d(\"LandingScreen\", \" [SOLUTION_REMINDER] User confirmed solution: ${solution.solution}\")\n                                    // Mark solution as completed in SolutionReminderManager\n                                    solutionReminderManager?.markSolutionCompleted(\n                                        serialNumber = solution.serialNumber,\n                                        solution = solution.solution,\n                                        reminderType = solution.reminderType\n                                    )\n                                    when (solution.reminderType) {\n                                        ReminderType.DRIVER_PAIRING -> {\n                                            android.util.Log.d(\"LandingScreen\", \" Navigating to Driver Pairing\")\n                                            onNavigateToDriverPairing()\n                                        }\n                                        ReminderType.CHANGED_PARTS -> {\n                                            android.util.Log.d(\"LandingScreen\", \" Navigating to Changed Parts\")\n                                            onNavigateToChangedParts()\n                                        }\n                                    }\n                                },\n                                onSkip = {\n                                    // Mark solution as dismissed\n                                    val key = \"${solution.serialNumber}_${solution.solution}\"\n                                    dismissedSolutions.value = dismissedSolutions.value + key\n                                    android.util.Log.d(\"LandingScreen\", \" [SOLUTION_REMINDER] User skipped solution: ${solution.solution}\")\n                                },\n                                modifier = Modifier.fillMaxWidth()\n                            )\n                        }\n                    }\n                    \n                    // Forget Device Confirmation Dialog\n                    if (showForgetDialog) {\n                        AlertDialog(\n                            onDismissRequest = { showForgetDialog = false },\n                            title = {\n                                Text(\n                                    \"Forget Device?\",\n                                    color = Color.White,\n                                    fontWeight = FontWeight.Bold\n                                )\n                            },\n                            text = {\n                                Text(\n                                    \"Are you sure you want to forget the current device?\",\n                                    color = Color.White.copy(alpha = 0.8f)\n                                )\n                            },\n                            confirmButton = {\n                                Button(\n                                    onClick = {\n                                        showForgetDialog = false\n                                        onForgetCurrentDevice()\n                                    },\n                                    colors = ButtonDefaults.buttonColors(\n                                        containerColor = dangerColor,\n                                        contentColor = Color.White\n                                    )\n                                ) {\n                                    Text(\"Forget\")\n                                }\n                            },\n                            dismissButton = {\n                                TextButton(\n                                    onClick = { showForgetDialog = false }\n                                ) {\n                                    Text(\"Cancel\", color = Color.White)\n                                }\n                            },\n                            containerColor = surfaceColor\n                        )\n                    }\n                } else {\n                    // Show scan prompt when no device connected\n                    Spacer(modifier = Modifier.height(16.dp))\n                    \n                    Card(\n                        modifier = Modifier.fillMaxWidth(),\n                        colors = CardDefaults.cardColors(containerColor = warningColor.copy(alpha = 0.1f)),\n                        shape = RoundedCornerShape(12.dp),\n                        border = androidx.compose.foundation.BorderStroke(1.dp, warningColor.copy(alpha = 0.3f))\n                    ) {\n                        Column(\n                            modifier = Modifier.padding(16.dp),\n                            horizontalAlignment = Alignment.CenterHorizontally\n                        ) {\n                            Text(\n                                text = \" No Device Connected\",\n                                style = MaterialTheme.typography.titleMedium,\n                                color = warningColor,\n                                fontWeight = FontWeight.Bold\n                            )\n                            \n                            Spacer(modifier = Modifier.height(8.dp))\n                            \n                            Text(\n                                text = \"Use the Scan button below to connect a device\",\n                                style = MaterialTheme.typography.bodyMedium,\n                                color = Color.White.copy(alpha = 0.8f),\n                                textAlign = TextAlign.Center\n                            )\n                        }\n                    }\n                }\n            }\n        }\n\n        // Responsive Grid of Action Buttons\n        if (screenInfo.isTablet) {\n            // 2x2 Grid for tablets\n            Column(\n                modifier = Modifier.fillMaxWidth(),\n                verticalArrangement = Arrangement.spacedBy(responsiveSpacing)\n            ) {\n                Row(\n                    modifier = Modifier.fillMaxWidth(),\n                    horizontalArrangement = Arrangement.spacedBy(responsiveSpacing)\n                ) {\n                    // Scan Button - Primary Action\n                    Button(\n                        onClick = onOpenScanner,\n                        modifier = Modifier\n                            .weight(1f)\n                            .height(getResponsiveButtonSize()),\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = accentColor,\n                            contentColor = Color.White\n                        ),\n                        shape = RoundedCornerShape(16.dp),\n                        elevation = ButtonDefaults.buttonElevation(defaultElevation = 8.dp)\n                    ) {\n                            Text(\n                                text = \"Scan\",\n                                style = MaterialTheme.typography.titleMedium,\n                                fontWeight = FontWeight.Bold,\n                                fontSize = getResponsiveTextSize(16f).sp\n                            )\n                    }\n                    \n                    // Frequency Generator Button\n                    Button(\n                        onClick = onOpenFreqGen,\n                        modifier = Modifier\n                            .weight(1f)\n                            .height(getResponsiveButtonSize()),\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = infoColor,\n                            contentColor = Color.White\n                        ),\n                        shape = RoundedCornerShape(16.dp),\n                        elevation = ButtonDefaults.buttonElevation(defaultElevation = 4.dp)\n                    ) {\n                            Text(\n                                text = \"Frequency\",\n                                style = MaterialTheme.typography.titleMedium,\n                                fontWeight = FontWeight.Bold,\n                                fontSize = getResponsiveTextSize(16f).sp\n                            )\n                    }\n                }\n                \n                Row(\n                    modifier = Modifier.fillMaxWidth(),\n                    horizontalArrangement = Arrangement.spacedBy(responsiveSpacing)\n                ) {\n                    // Test Song Button\n                    Button(\n                        onClick = onOpenTestSongs,\n                        modifier = Modifier\n                            .weight(1f)\n                            .height(getResponsiveButtonSize()),\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = successColor,\n                            contentColor = Color.White\n                        ),\n                        shape = RoundedCornerShape(16.dp),\n                        elevation = ButtonDefaults.buttonElevation(defaultElevation = 4.dp)\n                    ) {\n                            Text(\n                                text = \"Test Song\",\n                                style = MaterialTheme.typography.titleMedium,\n                                fontWeight = FontWeight.Bold,\n                                fontSize = getResponsiveTextSize(16f).sp\n                            )\n                    }\n                    \n                    // Final QC Button (was More)\n                    Button(\n                        onClick = onOpenMore,\n                        modifier = Modifier\n                            .weight(1f)\n                            .height(getResponsiveButtonSize()),\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = warningColor,\n                            contentColor = Color.White\n                        ),\n                        shape = RoundedCornerShape(16.dp),\n                        elevation = ButtonDefaults.buttonElevation(defaultElevation = 4.dp)\n                        ) {\n                            Text(\n                            text = \"Final QC\",\n                                style = MaterialTheme.typography.titleMedium,\n                                fontWeight = FontWeight.Bold,\n                                fontSize = getResponsiveTextSize(16f).sp\n                            )\n                    }\n                }\n            }\n        } else {\n            // Single column for phones\n            Column(\n                modifier = Modifier.fillMaxWidth(),\n                verticalArrangement = Arrangement.spacedBy(responsiveSpacing)\n            ) {\n                // Scan Button\n                Button(\n                    onClick = onOpenScanner,\n                    modifier = Modifier\n                        .fillMaxWidth()\n                        .height(getResponsiveButtonSize()),\n                    colors = ButtonDefaults.buttonColors(\n                        containerColor = accentColor,\n                        contentColor = Color.White\n                    ),\n                    shape = RoundedCornerShape(16.dp),\n                    elevation = ButtonDefaults.buttonElevation(defaultElevation = 8.dp)\n                ) {\n                        Text(\n                            text = \"Scan\",\n                            style = MaterialTheme.typography.titleMedium,\n                            fontWeight = FontWeight.Bold,\n                            fontSize = getResponsiveTextSize(16f).sp\n                        )\n                }\n                \n                // Other buttons in a row\n                Row(\n            modifier = Modifier.fillMaxWidth(),\n                    horizontalArrangement = Arrangement.spacedBy(responsiveSpacing)\n                ) {\n                    // Frequency Generator Button\n                    Button(\n                        onClick = onOpenFreqGen,\n                        modifier = Modifier\n                            .weight(1f)\n                            .height(getResponsiveButtonSize()),\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = infoColor,\n                            contentColor = Color.White\n                        ),\n                        shape = RoundedCornerShape(16.dp),\n                        elevation = ButtonDefaults.buttonElevation(defaultElevation = 4.dp)\n                    ) {\n                            Text(\n                                text = \"Frequency\",\n                                style = MaterialTheme.typography.titleMedium,\n                                fontWeight = FontWeight.Bold,\n                                fontSize = getResponsiveTextSize(16f).sp\n                            )\n                    }\n                    \n                    // Test Song Button\n                    Button(\n                        onClick = onOpenTestSongs,\n                        modifier = Modifier\n                            .weight(1f)\n                            .height(getResponsiveButtonSize()),\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = successColor,\n                            contentColor = Color.White\n                        ),\n                        shape = RoundedCornerShape(16.dp),\n                        elevation = ButtonDefaults.buttonElevation(defaultElevation = 4.dp)\n                    ) {\n                            Text(\n                                text = \"Test Song\",\n                                style = MaterialTheme.typography.titleMedium,\n                                fontWeight = FontWeight.Bold,\n                                fontSize = getResponsiveTextSize(16f).sp\n                            )\n                    }\n                }\n                \n                // Final QC Button (was More, full width)\n                Button(\n                    onClick = onOpenMore,\n                    modifier = Modifier\n                        .fillMaxWidth()\n                        .height(getResponsiveButtonSize()),\n                    colors = ButtonDefaults.buttonColors(\n                        containerColor = warningColor,\n                        contentColor = Color.White\n                    ),\n                    shape = RoundedCornerShape(16.dp),\n                    elevation = ButtonDefaults.buttonElevation(defaultElevation = 4.dp)\n                    ) {\n                        Text(\n                        text = \"Final QC\",\n                            style = MaterialTheme.typography.titleMedium,\n                            fontWeight = FontWeight.Bold,\n                            fontSize = getResponsiveTextSize(16f).sp\n                        )\n                }\n            }\n        }\n\n        // Undo Snackbar - Moved higher up for visibility\n        undoManager?.let { manager ->\n            Log.d(\"LandingScreen\", \"UndoManager exists: true\")\n            // Use a state variable that gets updated from the StateFlow\n            var undoState by remember { \n                val initialState = manager.undoState.value\n                Log.d(\"LandingScreen\", \"Initial undo state - isActive: ${initialState.isActive}, time: ${initialState.timeRemaining}\")\n                mutableStateOf(initialState) \n            }\n            \n            // Observe StateFlow changes in LaunchedEffect\n            androidx.compose.runtime.LaunchedEffect(manager) {\n                Log.d(\"LandingScreen\", \"LaunchedEffect started - observing undoState\")\n                manager.undoState.collect { state ->\n                    Log.d(\"LandingScreen\", \" STATE UPDATE RECEIVED - isActive: ${state.isActive}, timeRemaining: ${state.timeRemaining}, fromScreen: ${state.fromScreen}\")\n                    undoState = state\n                    Log.d(\"LandingScreen\", \" Local undoState updated to: isActive=${undoState.isActive}, timeRemaining=${undoState.timeRemaining}\")\n                }\n            }\n            \n            if (undoState.isActive) {\n                Log.d(\"LandingScreen\", \" Snackbar rendering - isActive: ${undoState.isActive}, time: ${undoState.timeRemaining}\")\n                Surface(\n                    modifier = Modifier\n                        .fillMaxWidth()\n                        .padding(16.dp),\n                    shape = RoundedCornerShape(12.dp),\n                    color = Color(0xFF2B2B2B),\n                    tonalElevation = 8.dp\n                ) {\n                    Row(\n                        modifier = Modifier\n                            .fillMaxWidth()\n                            .padding(16.dp),\n                        horizontalArrangement = Arrangement.SpaceBetween,\n                        verticalAlignment = Alignment.CenterVertically\n                    ) {\n                        Column(modifier = Modifier.weight(1f)) {\n                            Text(\n                                text = \"Test saved. Tap undo to reverse.\",\n                                style = MaterialTheme.typography.bodyMedium,\n                                color = Color.White\n                            )\n                            Text(\n                                text = \"Auto-saving in ${undoState.timeRemaining}s\",\n                                style = MaterialTheme.typography.bodySmall,\n                                color = Color.White.copy(alpha = 0.7f),\n                                fontSize = 12.sp\n                            )\n                        }\n                        Row(horizontalArrangement = Arrangement.spacedBy(8.dp), verticalAlignment = Alignment.CenterVertically) {\n                            TextButton(\n                                onClick = { \n                                    Log.d(\"LandingScreen\", \"Cancel (commit now) clicked.\")\n                                    // Commit immediately and stop timer\n                                    scope.launch { \n                                        manager.executeCommitNow()\n                                    }\n                                }\n                            ) {\n                                Text(\n                                    text = \"CANCEL\",\n                                    color = Color(0xFF90CAF9),\n                                    fontWeight = FontWeight.Bold\n                                )\n                            }\n                            TextButton(\n                                onClick = { \n                                    Log.d(\"LandingScreen\", \"Undo button clicked. From screen: ${undoState.fromScreen}\")\n                                    manager.executeUndo()\n                                }\n                            ) {\n                                Text(\n                                    text = \"UNDO\",\n                                    color = Color(0xFFFFC107),\n                                    fontWeight = FontWeight.Bold\n                                )\n                            }\n                        }\n                    }\n                }\n            } else {\n                Log.d(\"LandingScreen\", \" Snackbar NOT rendering - undoState.isActive: ${undoState.isActive}\")\n            }\n        } ?: Log.d(\"LandingScreen\", \"UndoManager is null - no snackbar\")\n\n        Spacer(modifier = Modifier.weight(1f))\n\n        // Logout Button\n        TextButton(\n            onClick = onLogout,\n            modifier = Modifier.fillMaxWidth()\n        ) {\n            Text(\n                text = \"Logout\",\n                color = Color(0xFFCF6679)\n            )\n        }\n        \n    }\n}",
        "firstEditBubbleId": "68481205-c629-4aa8-8be6-8da4ed2dbbcc",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/entities/Device.kt": {
        "content": "package com.example.fqcapp.data.entities\n\nimport androidx.room.Entity\nimport androidx.room.PrimaryKey\n\n@Entity(tableName = \"devices\")\ndata class Device(\n    @PrimaryKey val serialNumber: String,\n    // DEPRECATED: macId is deprecated - MAC ID should be derived from active PCB link\n    // Use FQCRepository.getMacIdFromActivePcb(deviceId) instead\n    // Keeping for backward compatibility during migration, but should not be used\n    @Deprecated(\"Use getMacIdFromActivePcb() instead - MAC comes from active PCB link\")\n    val macId: String = \"\",  // Default to empty - MAC comes from active PCB link\n    val color: String,\n    val createdDate: String, // Format: \"2025-10-14\"\n    val finalStatus: String, // \"IN_PROGRESS\", \"PASSED\", \"FAILED\"\n    val totalIterations: Int = 0,\n    val totalTimeHours: Double = 0.0,\n    val finalOperator: String = \"\",\n    val firstTestDate: String = \"\",\n    val finalShipDate: String = \"\", // Date when final FQC passed\n    val needsSync: Boolean = true, // Flag for Google Sheets sync\n    val lastSyncTimestamp: Long = 0\n)\n\n\n\n\n",
        "firstEditBubbleId": "23ab48e2-7f50-4d55-8b59-4583378ac2aa",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt": {
        "content": "package com.example.fqcapp.data\n\nimport android.content.Context\nimport androidx.room.Database\nimport androidx.room.Room\nimport androidx.room.RoomDatabase\nimport androidx.room.migration.Migration\nimport androidx.sqlite.db.SupportSQLiteDatabase\nimport com.example.fqcapp.data.dao.*\nimport com.example.fqcapp.data.entities.*\nimport java.util.UUID\nimport java.text.SimpleDateFormat\nimport java.util.Date\nimport java.util.Locale\n\n@Database(\n    entities = [\n        Operator::class,\n        Device::class,\n        Session::class,\n        FrequencyTest::class,\n        SongTest::class,\n        FQCRecord::class,\n        FQCSession::class, // Legacy - can be removed later\n        MacIdCache::class,\n        TestSession::class,\n        DriverPairingCache::class,\n        MilestoneEntry::class,\n        DriverPairingRecord::class,\n        DeviceWorkflow::class,\n        ChangedPartsRecord::class,\n        OperatorCredential::class,\n        // New tables for database restructure\n        PCB::class,\n        DevicePcbLink::class,\n        DeviceCase::class,\n        TestConfiguration::class\n    ],\n    version = 18, // Incremented for new tables\n    exportSchema = false\n)\nabstract class AppDatabase : RoomDatabase() {\n    abstract fun operatorDao(): OperatorDao\n    abstract fun deviceDao(): DeviceDao\n    abstract fun sessionDao(): SessionDao\n    abstract fun frequencyTestDao(): FrequencyTestDao\n    abstract fun songTestDao(): SongTestDao\n    abstract fun fqcRecordDao(): FQCRecordDao\n    abstract fun fqcSessionDao(): FQCSessionDao // Legacy - can be removed later\n    abstract fun macIdCacheDao(): MacIdCacheDao\n    abstract fun testSessionDao(): TestSessionDao\n    abstract fun driverPairingCacheDao(): DriverPairingCacheDao\n    abstract fun milestoneDao(): MilestoneDao\n    abstract fun driverPairingRecordDao(): DriverPairingRecordDao\n    abstract fun deviceWorkflowDao(): DeviceWorkflowDao\n    abstract fun changedPartsRecordDao(): ChangedPartsRecordDao\n    abstract fun operatorCredentialDao(): OperatorCredentialDao\n    // New DAOs for database restructure\n    abstract fun pcbDao(): PcbDao\n    abstract fun devicePcbLinkDao(): DevicePcbLinkDao\n    abstract fun deviceCaseDao(): DeviceCaseDao\n    abstract fun testConfigurationDao(): TestConfigurationDao\n\n    companion object {\n        @Volatile\n        private var INSTANCE: AppDatabase? = null\n\n        fun getDatabase(context: Context): AppDatabase {\n            return INSTANCE ?: synchronized(this) {\n                val instance = Room.databaseBuilder(\n                    context.applicationContext,\n                    AppDatabase::class.java,\n                    \"fqc_database\"\n                )\n                    .addMigrations(MIGRATION_17_18)\n                    .build()\n                INSTANCE = instance\n                instance\n            }\n        }\n\n        /**\n         * Migration from version 17 to 18:\n         * 1. Creates new tables (PCB, DevicePcbLink, DeviceCase, TestConfiguration)\n         * 2. Migrates Device.macId to PCB links\n         * 3. Creates DeviceCase records for existing devices\n         * 4. Creates TestConfiguration records for existing tests\n         * 5. Updates tests with configurationId\n         */\n        private val MIGRATION_17_18 = object : Migration(17, 18) {\n            override fun migrate(database: SupportSQLiteDatabase) {\n                val dateFormat = SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ss\", Locale.US)\n                val currentTimestamp = dateFormat.format(Date())\n                \n                // Step 1: Create new tables (Room will create them, but we ensure they exist)\n                database.execSQL(\"\"\"\n                    CREATE TABLE IF NOT EXISTS pcbs (\n                        pcbId TEXT NOT NULL PRIMARY KEY,\n                        pcbSerialNumber TEXT NOT NULL,\n                        macId TEXT NOT NULL,\n                        createdAt TEXT NOT NULL,\n                        notes TEXT NOT NULL,\n                        needsSync INTEGER NOT NULL,\n                        lastSyncTimestamp INTEGER NOT NULL\n                    )\n                \"\"\")\n                \n                database.execSQL(\"CREATE UNIQUE INDEX IF NOT EXISTS index_pcbs_pcbSerialNumber ON pcbs(pcbSerialNumber)\")\n                database.execSQL(\"CREATE UNIQUE INDEX IF NOT EXISTS index_pcbs_macId ON pcbs(macId)\")\n                \n                database.execSQL(\"\"\"\n                    CREATE TABLE IF NOT EXISTS device_pcb_links (\n                        linkId TEXT NOT NULL PRIMARY KEY,\n                        deviceId TEXT NOT NULL,\n                        pcbId TEXT NOT NULL,\n                        isActive INTEGER NOT NULL,\n                        reason TEXT NOT NULL,\n                        linkedAt TEXT NOT NULL,\n                        unlinkedAt TEXT,\n                        operatorName TEXT NOT NULL,\n                        notes TEXT NOT NULL,\n                        needsSync INTEGER NOT NULL,\n                        lastSyncTimestamp INTEGER NOT NULL,\n                        FOREIGN KEY(deviceId) REFERENCES devices(serialNumber) ON DELETE CASCADE,\n                        FOREIGN KEY(pcbId) REFERENCES pcbs(pcbId) ON DELETE CASCADE\n                    )\n                \"\"\")\n                \n                database.execSQL(\"CREATE INDEX IF NOT EXISTS index_device_pcb_links_deviceId ON device_pcb_links(deviceId)\")\n                database.execSQL(\"CREATE INDEX IF NOT EXISTS index_device_pcb_links_pcbId ON device_pcb_links(pcbId)\")\n                database.execSQL(\"CREATE INDEX IF NOT EXISTS index_device_pcb_links_deviceId_isActive ON device_pcb_links(deviceId, isActive)\")\n                \n                database.execSQL(\"\"\"\n                    CREATE TABLE IF NOT EXISTS device_cases (\n                        caseId TEXT NOT NULL PRIMARY KEY,\n                        deviceId TEXT NOT NULL,\n                        caseType TEXT NOT NULL,\n                        repairType TEXT,\n                        receivedFromCustomerRef TEXT,\n                        returnToCustomerRef TEXT,\n                        ownershipTransferred INTEGER NOT NULL,\n                        status TEXT NOT NULL,\n                        resolution TEXT,\n                        openedAt TEXT NOT NULL,\n                        closedAt TEXT,\n                        operatorName TEXT NOT NULL,\n                        notes TEXT NOT NULL,\n                        needsSync INTEGER NOT NULL,\n                        lastSyncTimestamp INTEGER NOT NULL,\n                        FOREIGN KEY(deviceId) REFERENCES devices(serialNumber) ON DELETE CASCADE\n                    )\n                \"\"\")\n                \n                database.execSQL(\"CREATE INDEX IF NOT EXISTS index_device_cases_deviceId ON device_cases(deviceId)\")\n                database.execSQL(\"CREATE INDEX IF NOT EXISTS index_device_cases_caseType ON device_cases(caseType)\")\n                database.execSQL(\"CREATE INDEX IF NOT EXISTS index_device_cases_status ON device_cases(status)\")\n                database.execSQL(\"CREATE INDEX IF NOT EXISTS index_device_cases_deviceId_status ON device_cases(deviceId, status)\")\n                \n                database.execSQL(\"\"\"\n                    CREATE TABLE IF NOT EXISTS test_configurations (\n                        configurationId TEXT NOT NULL PRIMARY KEY,\n                        caseId TEXT NOT NULL,\n                        deviceId TEXT NOT NULL,\n                        pcbId TEXT,\n                        driverPairingRecordId TEXT NOT NULL,\n                        changedPartsRecordId TEXT,\n                        iterationNumber INTEGER NOT NULL,\n                        testStage TEXT NOT NULL,\n                        latestFrequencyResult TEXT,\n                        latestSongResult TEXT,\n                        latestFqcResult TEXT,\n                        configurationStatus TEXT NOT NULL,\n                        createdAt TEXT NOT NULL,\n                        lastUpdatedAt TEXT NOT NULL,\n                        endedAt TEXT,\n                        operatorName TEXT NOT NULL,\n                        reason TEXT,\n                        needsSync INTEGER NOT NULL,\n                        lastSyncTimestamp INTEGER NOT NULL,\n                        FOREIGN KEY(caseId) REFERENCES device_cases(caseId) ON DELETE CASCADE,\n                        FOREIGN KEY(deviceId) REFERENCES devices(serialNumber) ON DELETE CASCADE,\n                        FOREIGN KEY(pcbId) REFERENCES pcbs(pcbId) ON DELETE SET NULL,\n                        UNIQUE(caseId, testStage, iterationNumber)\n                    )\n                \"\"\")\n                \n                database.execSQL(\"CREATE INDEX IF NOT EXISTS index_test_configurations_caseId ON test_configurations(caseId)\")\n                database.execSQL(\"CREATE INDEX IF NOT EXISTS index_test_configurations_deviceId ON test_configurations(deviceId)\")\n                database.execSQL(\"CREATE INDEX IF NOT EXISTS index_test_configurations_pcbId ON test_configurations(pcbId)\")\n                database.execSQL(\"CREATE INDEX IF NOT EXISTS index_test_configurations_driverPairingRecordId ON test_configurations(driverPairingRecordId)\")\n                database.execSQL(\"CREATE INDEX IF NOT EXISTS index_test_configurations_changedPartsRecordId ON test_configurations(changedPartsRecordId)\")\n                // Create unique index for (caseId, testStage, iterationNumber) - Room expects this named index\n                database.execSQL(\"CREATE UNIQUE INDEX IF NOT EXISTS index_test_configurations_caseId_testStage_iterationNumber ON test_configurations(caseId, testStage, iterationNumber)\")\n                \n                // Add configurationId column to test tables if it doesn't exist\n                try {\n                    database.execSQL(\"ALTER TABLE frequency_tests ADD COLUMN configurationId TEXT\")\n                } catch (e: Exception) {\n                    // Column might already exist, ignore\n                }\n                // Always create index (even if column already existed)\n                try {\n                    database.execSQL(\"CREATE INDEX IF NOT EXISTS index_frequency_tests_configurationId ON frequency_tests(configurationId)\")\n                } catch (e: Exception) {\n                    // Index might already exist, ignore\n                }\n                \n                try {\n                    database.execSQL(\"ALTER TABLE song_tests ADD COLUMN configurationId TEXT\")\n                } catch (e: Exception) {\n                    // Column might already exist, ignore\n                }\n                // Always create index (even if column already existed)\n                try {\n                    database.execSQL(\"CREATE INDEX IF NOT EXISTS index_song_tests_configurationId ON song_tests(configurationId)\")\n                } catch (e: Exception) {\n                    // Index might already exist, ignore\n                }\n                \n                try {\n                    database.execSQL(\"ALTER TABLE fqc_records ADD COLUMN configurationId TEXT\")\n                } catch (e: Exception) {\n                    // Column might already exist, ignore\n                }\n                // Always create index (even if column already existed)\n                try {\n                    database.execSQL(\"CREATE INDEX IF NOT EXISTS index_fqc_records_configurationId ON fqc_records(configurationId)\")\n                } catch (e: Exception) {\n                    // Index might already exist, ignore\n                }\n                \n                // Migrate changed_parts_records table: Remove old PCB fields, add pcbLinkId\n                // SQLite doesn't support DROP COLUMN, so we recreate the table\n                try {\n                    // Check if old columns exist (by checking if table has isPcbChange column)\n                    val checkCursor = database.query(\"PRAGMA table_info(changed_parts_records)\")\n                    var hasOldColumns = false\n                    while (checkCursor.moveToNext()) {\n                        val columnName = checkCursor.getString(1) // Column name is at index 1\n                        if (columnName == \"isPcbChange\") {\n                            hasOldColumns = true\n                            break\n                        }\n                    }\n                    checkCursor.close()\n                    \n                    if (hasOldColumns) {\n                        // Old structure exists - need to migrate\n                        // Step 1: Create new table with correct structure\n                        database.execSQL(\"\"\"\n                            CREATE TABLE changed_parts_records_new (\n                                recordId INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,\n                                serialNumber TEXT NOT NULL,\n                                macId TEXT NOT NULL,\n                                operatorName TEXT NOT NULL,\n                                entryTimestamp TEXT NOT NULL,\n                                exitTimestamp TEXT NOT NULL,\n                                totalTimeSpent TEXT NOT NULL,\n                                pcbLinkId TEXT,\n                                selectedParts TEXT NOT NULL,\n                                iterationNumber INTEGER NOT NULL,\n                                testStage TEXT NOT NULL,\n                                timestamp TEXT NOT NULL,\n                                needsSync INTEGER NOT NULL,\n                                lastSyncTimestamp INTEGER NOT NULL\n                            )\n                        \"\"\")\n                        \n                        // Step 2: Copy data (excluding old PCB columns)\n                        database.execSQL(\"\"\"\n                            INSERT INTO changed_parts_records_new \n                            (recordId, serialNumber, macId, operatorName, entryTimestamp, exitTimestamp, \n                             totalTimeSpent, pcbLinkId, selectedParts, iterationNumber, testStage, \n                             timestamp, needsSync, lastSyncTimestamp)\n                            SELECT \n                                recordId, serialNumber, macId, operatorName, entryTimestamp, exitTimestamp,\n                                totalTimeSpent, NULL as pcbLinkId, selectedParts, iterationNumber, testStage,\n                                timestamp, needsSync, lastSyncTimestamp\n                            FROM changed_parts_records\n                        \"\"\")\n                        \n                        // Step 3: Drop old table\n                        database.execSQL(\"DROP TABLE changed_parts_records\")\n                        \n                        // Step 4: Rename new table\n                        database.execSQL(\"ALTER TABLE changed_parts_records_new RENAME TO changed_parts_records\")\n                        \n                        // Step 5: Recreate indexes\n                        database.execSQL(\"CREATE INDEX IF NOT EXISTS index_changed_parts_records_serialNumber ON changed_parts_records(serialNumber)\")\n                        database.execSQL(\"CREATE INDEX IF NOT EXISTS index_changed_parts_records_macId ON changed_parts_records(macId)\")\n                    } else {\n                        // New structure already exists or table doesn't exist - just ensure pcbLinkId column exists\n                        try {\n                            database.execSQL(\"ALTER TABLE changed_parts_records ADD COLUMN pcbLinkId TEXT\")\n                        } catch (e: Exception) {\n                            // Column might already exist, ignore\n                        }\n                        // Ensure indexes exist\n                        database.execSQL(\"CREATE INDEX IF NOT EXISTS index_changed_parts_records_serialNumber ON changed_parts_records(serialNumber)\")\n                        database.execSQL(\"CREATE INDEX IF NOT EXISTS index_changed_parts_records_macId ON changed_parts_records(macId)\")\n                    }\n                } catch (e: Exception) {\n                    // Table might not exist yet (will be created by Room), ignore\n                }\n                \n                // Step 2: Migrate Device.macId to PCB links\n                val deviceCursor = database.query(\"SELECT serialNumber, macId, createdDate FROM devices WHERE macId IS NOT NULL AND macId != ''\")\n                val macIdToPcbIdMap = mutableMapOf<String, String>()\n                \n                while (deviceCursor.moveToNext()) {\n                    val serialNumber = deviceCursor.getString(0)\n                    val macId = deviceCursor.getString(1)\n                    val createdDate = if (deviceCursor.columnCount > 2 && !deviceCursor.isNull(2)) {\n                        deviceCursor.getString(2)\n                    } else {\n                        currentTimestamp.substring(0, 10) // Use date part only\n                    }\n                    \n                    // Check if PCB already exists for this MAC ID\n                    val existingPcbCursor = database.query(\n                        \"SELECT pcbId FROM pcbs WHERE macId = ?\",\n                        arrayOf(macId)\n                    )\n                    \n                    val pcbId = if (existingPcbCursor.moveToFirst()) {\n                        existingPcbCursor.getString(0)\n                    } else {\n                        // Create new PCB record\n                        val newPcbId = UUID.randomUUID().toString()\n                        database.execSQL(\"\"\"\n                            INSERT INTO pcbs (pcbId, pcbSerialNumber, macId, createdAt, notes, needsSync, lastSyncTimestamp)\n                            VALUES (?, ?, ?, ?, ?, ?, ?)\n                        \"\"\", arrayOf(\n                            newPcbId,\n                            \"MIGRATED_$serialNumber\",\n                            macId,\n                            currentTimestamp,\n                            \"Migrated from Device.macId on $currentTimestamp\",\n                            1, // needsSync = true\n                            0L  // lastSyncTimestamp = 0\n                        ))\n                        newPcbId\n                    }\n                    existingPcbCursor.close()\n                    \n                    macIdToPcbIdMap[macId] = pcbId\n                    \n                    // Check if DevicePcbLink already exists\n                    val existingLinkCursor = database.query(\n                        \"SELECT linkId FROM device_pcb_links WHERE deviceId = ? AND pcbId = ?\",\n                        arrayOf(serialNumber, pcbId)\n                    )\n                    \n                    if (!existingLinkCursor.moveToFirst()) {\n                        // Create DevicePcbLink\n                        val linkId = UUID.randomUUID().toString()\n                        database.execSQL(\"\"\"\n                            INSERT INTO device_pcb_links (\n                                linkId, deviceId, pcbId, isActive, reason, linkedAt, \n                                unlinkedAt, operatorName, notes, needsSync, lastSyncTimestamp\n                            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n                        \"\"\", arrayOf(\n                            linkId,\n                            serialNumber,\n                            pcbId,\n                            1, // isActive = true\n                            \"MIGRATED_FROM_DEVICE_MACID\",\n                            currentTimestamp,\n                            null, // unlinkedAt\n                            \"SYSTEM\",\n                            \"Migrated from Device.macId on $currentTimestamp\",\n                            1, // needsSync = true\n                            0L  // lastSyncTimestamp = 0\n                        ))\n                    }\n                    existingLinkCursor.close()\n                }\n                deviceCursor.close()\n                \n                // Step 3: Create DeviceCase records for existing devices\n                val allDevicesCursor = database.query(\"SELECT serialNumber, createdDate, finalStatus FROM devices\")\n                val deviceToCaseIdMap = mutableMapOf<String, String>()\n                \n                while (allDevicesCursor.moveToNext()) {\n                    val serialNumber = allDevicesCursor.getString(0)\n                    val createdDate = if (!allDevicesCursor.isNull(1)) {\n                        allDevicesCursor.getString(1)\n                    } else {\n                        currentTimestamp.substring(0, 10)\n                    }\n                    val finalStatus = if (!allDevicesCursor.isNull(2)) {\n                        allDevicesCursor.getString(2)\n                    } else {\n                        \"IN_PROGRESS\"\n                    }\n                    \n                    // Check if device has any tests\n                    val hasTestsCursor = database.query(\n                        \"\"\"\n                            SELECT COUNT(*) FROM (\n                                SELECT 1 FROM frequency_tests WHERE serialNumber = ?\n                                UNION ALL\n                                SELECT 1 FROM song_tests WHERE serialNumber = ?\n                                UNION ALL\n                                SELECT 1 FROM fqc_records WHERE serialNumber = ?\n                            ) LIMIT 1\n                        \"\"\",\n                        arrayOf(serialNumber, serialNumber, serialNumber)\n                    )\n                    \n                    val hasTests = hasTestsCursor.moveToFirst() && hasTestsCursor.getInt(0) > 0\n                    hasTestsCursor.close()\n                    \n                    // Create DeviceCase\n                    val caseId = UUID.randomUUID().toString()\n                    val caseStatus = if (hasTests || finalStatus == \"PASSED\" || finalStatus == \"FAILED\") {\n                        \"CLOSED\"\n                    } else {\n                        \"OPEN\"\n                    }\n                    \n                    database.execSQL(\"\"\"\n                        INSERT INTO device_cases (\n                            caseId, deviceId, caseType, repairType, receivedFromCustomerRef,\n                            returnToCustomerRef, ownershipTransferred, status, resolution,\n                            openedAt, closedAt, operatorName, notes, needsSync, lastSyncTimestamp\n                        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n                    \"\"\", arrayOf(\n                        caseId,\n                        serialNumber,\n                        \"NEW_BUILD\",\n                        null, // repairType\n                        null, // receivedFromCustomerRef\n                        null, // returnToCustomerRef\n                        0, // ownershipTransferred = false\n                        caseStatus,\n                        if (caseStatus == \"CLOSED\") {\n                            when (finalStatus) {\n                                \"PASSED\" -> \"REPAIRED\"\n                                \"FAILED\" -> \"SCRAPPED\"\n                                else -> null\n                            }\n                        } else null,\n                        currentTimestamp,\n                        if (caseStatus == \"CLOSED\") currentTimestamp else null,\n                        \"SYSTEM\",\n                        \"Migrated from existing device on $currentTimestamp\",\n                        1, // needsSync = true\n                        0L  // lastSyncTimestamp = 0\n                    ))\n                    \n                    deviceToCaseIdMap[serialNumber] = caseId\n                }\n                allDevicesCursor.close()\n                \n                // Step 4: Create TestConfiguration records for existing tests\n                // Group tests by (serialNumber, iterationNumber, testStage)\n                // For each group, create a TestConfiguration\n                \n                // Process FrequencyTests\n                val freqTestCursor = database.query(\n                    \"SELECT DISTINCT serialNumber, iterationNumber, testStage FROM frequency_tests ORDER BY serialNumber, iterationNumber, testStage\"\n                )\n                \n                while (freqTestCursor.moveToNext()) {\n                    val serialNumber = freqTestCursor.getString(0)\n                    val iterationNumber = freqTestCursor.getInt(1)\n                    val testStage = freqTestCursor.getString(2)\n                    \n                    val caseId = deviceToCaseIdMap[serialNumber] ?: continue\n                    \n                    // Get active PCB link for this device\n                    val pcbLinkCursor = database.query(\n                        \"SELECT pcbId FROM device_pcb_links WHERE deviceId = ? AND isActive = 1 LIMIT 1\",\n                        arrayOf(serialNumber)\n                    )\n                    val pcbId = if (pcbLinkCursor.moveToFirst()) {\n                        pcbLinkCursor.getString(0)\n                    } else {\n                        null\n                    }\n                    pcbLinkCursor.close()\n                    \n                    // Find matching DriverPairingRecord (same serialNumber, iterationNumber, testStage)\n                    val driverPairingCursor = database.query(\n                        \"SELECT recordId FROM driver_pairing_records WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? LIMIT 1\",\n                        arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                    )\n                    val driverPairingRecordId = if (driverPairingCursor.moveToFirst()) {\n                        driverPairingCursor.getLong(0).toString()\n                    } else {\n                        // Create a placeholder - use first driver pairing record for this device\n                        val fallbackDriverCursor = database.query(\n                            \"SELECT recordId FROM driver_pairing_records WHERE serialNumber = ? ORDER BY recordId LIMIT 1\",\n                            arrayOf(serialNumber)\n                        )\n                        val fallbackId = if (fallbackDriverCursor.moveToFirst()) {\n                            fallbackDriverCursor.getLong(0).toString()\n                        } else {\n                            \"0\" // Placeholder\n                        }\n                        fallbackDriverCursor.close()\n                        fallbackId\n                    }\n                    driverPairingCursor.close()\n                    \n                    // Find matching ChangedPartsRecord (same serialNumber, iterationNumber, testStage)\n                    val changedPartsCursor = database.query(\n                        \"SELECT recordId FROM changed_parts_records WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? LIMIT 1\",\n                        arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                    )\n                    val changedPartsRecordId = if (changedPartsCursor.moveToFirst()) {\n                        changedPartsCursor.getLong(0).toString()\n                    } else {\n                        null\n                    }\n                    changedPartsCursor.close()\n                    \n                    // Check if TestConfiguration already exists\n                    val existingConfigCursor = database.query(\n                        \"SELECT configurationId FROM test_configurations WHERE caseId = ? AND testStage = ? AND iterationNumber = ?\",\n                        arrayOf(caseId, testStage, iterationNumber.toString())\n                    )\n                    \n                    val configurationId = if (existingConfigCursor.moveToFirst()) {\n                        existingConfigCursor.getString(0)\n                    } else {\n                        // Create TestConfiguration\n                        val newConfigId = UUID.randomUUID().toString()\n                        \n                        // Determine configuration status based on test results\n                        val freqResultCursor = database.query(\n                            \"SELECT result FROM frequency_tests WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? ORDER BY testId DESC LIMIT 1\",\n                            arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                        )\n                        val latestFreqResult = if (freqResultCursor.moveToFirst()) {\n                            freqResultCursor.getString(0)\n                        } else {\n                            null\n                        }\n                        freqResultCursor.close()\n                        \n                        val songResultCursor = database.query(\n                            \"SELECT result FROM song_tests WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? ORDER BY testId DESC LIMIT 1\",\n                            arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                        )\n                        val latestSongResult = if (songResultCursor.moveToFirst()) {\n                            songResultCursor.getString(0)\n                        } else {\n                            null\n                        }\n                        songResultCursor.close()\n                        \n                        val fqcResultCursor = database.query(\n                            \"SELECT overallResult FROM fqc_records WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? ORDER BY fqcId DESC LIMIT 1\",\n                            arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                        )\n                        val latestFqcResult = if (fqcResultCursor.moveToFirst()) {\n                            fqcResultCursor.getString(0)\n                        } else {\n                            null\n                        }\n                        fqcResultCursor.close()\n                        \n                        val configStatus = when {\n                            latestFqcResult == \"PASS\" -> \"CONFIG_PASSED\"\n                            latestFreqResult == \"FAIL\" || latestSongResult == \"FAIL\" -> \"CONFIG_FAILED\"\n                            latestFreqResult == \"PASS\" && latestSongResult in listOf(\"PASS\", \"CAN_BE_PASSED\") -> \"ELIGIBLE_FOR_FQC\"\n                            else -> \"IN_PROGRESS\"\n                        }\n                        \n                        database.execSQL(\"\"\"\n                            INSERT INTO test_configurations (\n                                configurationId, caseId, deviceId, pcbId, driverPairingRecordId,\n                                changedPartsRecordId, iterationNumber, testStage,\n                                latestFrequencyResult, latestSongResult, latestFqcResult,\n                                configurationStatus, createdAt, lastUpdatedAt, endedAt,\n                                operatorName, reason, needsSync, lastSyncTimestamp\n                            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n                        \"\"\", arrayOf(\n                            newConfigId,\n                            caseId,\n                            serialNumber,\n                            pcbId,\n                            driverPairingRecordId,\n                            changedPartsRecordId,\n                            iterationNumber,\n                            testStage,\n                            latestFreqResult,\n                            latestSongResult,\n                            latestFqcResult,\n                            configStatus,\n                            currentTimestamp,\n                            currentTimestamp,\n                            null, // endedAt\n                            \"SYSTEM\",\n                            \"Migrated from existing test on $currentTimestamp\",\n                            1, // needsSync = true\n                            0L  // lastSyncTimestamp = 0\n                        ))\n                        \n                        newConfigId\n                    }\n                    existingConfigCursor.close()\n                    \n                    // Update FrequencyTests with configurationId\n                    database.execSQL(\"\"\"\n                        UPDATE frequency_tests \n                        SET configurationId = ? \n                        WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? AND configurationId IS NULL\n                    \"\"\", arrayOf(configurationId, serialNumber, iterationNumber.toString(), testStage))\n                }\n                freqTestCursor.close()\n                \n                // Process SongTests (similar logic)\n                val songTestCursor = database.query(\n                    \"SELECT DISTINCT serialNumber, iterationNumber, testStage FROM song_tests ORDER BY serialNumber, iterationNumber, testStage\"\n                )\n                \n                while (songTestCursor.moveToNext()) {\n                    val serialNumber = songTestCursor.getString(0)\n                    val iterationNumber = songTestCursor.getInt(1)\n                    val testStage = songTestCursor.getString(2)\n                    \n                    val caseId = deviceToCaseIdMap[serialNumber] ?: continue\n                    \n                    // Get or create TestConfiguration (same logic as above)\n                    val pcbLinkCursor = database.query(\n                        \"SELECT pcbId FROM device_pcb_links WHERE deviceId = ? AND isActive = 1 LIMIT 1\",\n                        arrayOf(serialNumber)\n                    )\n                    val pcbId = if (pcbLinkCursor.moveToFirst()) {\n                        pcbLinkCursor.getString(0)\n                    } else {\n                        null\n                    }\n                    pcbLinkCursor.close()\n                    \n                    val driverPairingCursor = database.query(\n                        \"SELECT recordId FROM driver_pairing_records WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? LIMIT 1\",\n                        arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                    )\n                    val driverPairingRecordId = if (driverPairingCursor.moveToFirst()) {\n                        driverPairingCursor.getLong(0).toString()\n                    } else {\n                        val fallbackDriverCursor = database.query(\n                            \"SELECT recordId FROM driver_pairing_records WHERE serialNumber = ? ORDER BY recordId LIMIT 1\",\n                            arrayOf(serialNumber)\n                        )\n                        val fallbackId = if (fallbackDriverCursor.moveToFirst()) {\n                            fallbackDriverCursor.getLong(0).toString()\n                        } else {\n                            \"0\"\n                        }\n                        fallbackDriverCursor.close()\n                        fallbackId\n                    }\n                    driverPairingCursor.close()\n                    \n                    val changedPartsCursor = database.query(\n                        \"SELECT recordId FROM changed_parts_records WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? LIMIT 1\",\n                        arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                    )\n                    val changedPartsRecordId = if (changedPartsCursor.moveToFirst()) {\n                        changedPartsCursor.getLong(0).toString()\n                    } else {\n                        null\n                    }\n                    changedPartsCursor.close()\n                    \n                    val existingConfigCursor = database.query(\n                        \"SELECT configurationId FROM test_configurations WHERE caseId = ? AND testStage = ? AND iterationNumber = ?\",\n                        arrayOf(caseId, testStage, iterationNumber.toString())\n                    )\n                    \n                    val configurationId = if (existingConfigCursor.moveToFirst()) {\n                        existingConfigCursor.getString(0)\n                    } else {\n                        val newConfigId = UUID.randomUUID().toString()\n                        \n                        val freqResultCursor = database.query(\n                            \"SELECT result FROM frequency_tests WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? ORDER BY testId DESC LIMIT 1\",\n                            arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                        )\n                        val latestFreqResult = if (freqResultCursor.moveToFirst()) {\n                            freqResultCursor.getString(0)\n                        } else {\n                            null\n                        }\n                        freqResultCursor.close()\n                        \n                        val songResultCursor = database.query(\n                            \"SELECT result FROM song_tests WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? ORDER BY testId DESC LIMIT 1\",\n                            arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                        )\n                        val latestSongResult = if (songResultCursor.moveToFirst()) {\n                            songResultCursor.getString(0)\n                        } else {\n                            null\n                        }\n                        songResultCursor.close()\n                        \n                        val fqcResultCursor = database.query(\n                            \"SELECT overallResult FROM fqc_records WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? ORDER BY fqcId DESC LIMIT 1\",\n                            arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                        )\n                        val latestFqcResult = if (fqcResultCursor.moveToFirst()) {\n                            fqcResultCursor.getString(0)\n                        } else {\n                            null\n                        }\n                        fqcResultCursor.close()\n                        \n                        val configStatus = when {\n                            latestFqcResult == \"PASS\" -> \"CONFIG_PASSED\"\n                            latestFreqResult == \"FAIL\" || latestSongResult == \"FAIL\" -> \"CONFIG_FAILED\"\n                            latestFreqResult == \"PASS\" && latestSongResult in listOf(\"PASS\", \"CAN_BE_PASSED\") -> \"ELIGIBLE_FOR_FQC\"\n                            else -> \"IN_PROGRESS\"\n                        }\n                        \n                        database.execSQL(\"\"\"\n                            INSERT INTO test_configurations (\n                                configurationId, caseId, deviceId, pcbId, driverPairingRecordId,\n                                changedPartsRecordId, iterationNumber, testStage,\n                                latestFrequencyResult, latestSongResult, latestFqcResult,\n                                configurationStatus, createdAt, lastUpdatedAt, endedAt,\n                                operatorName, reason, needsSync, lastSyncTimestamp\n                            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n                        \"\"\", arrayOf(\n                            newConfigId,\n                            caseId,\n                            serialNumber,\n                            pcbId,\n                            driverPairingRecordId,\n                            changedPartsRecordId,\n                            iterationNumber,\n                            testStage,\n                            latestFreqResult,\n                            latestSongResult,\n                            latestFqcResult,\n                            configStatus,\n                            currentTimestamp,\n                            currentTimestamp,\n                            null,\n                            \"SYSTEM\",\n                            \"Migrated from existing test on $currentTimestamp\",\n                            1,\n                            0L\n                        ))\n                        \n                        newConfigId\n                    }\n                    existingConfigCursor.close()\n                    \n                    // Update SongTests with configurationId\n                    database.execSQL(\"\"\"\n                        UPDATE song_tests \n                        SET configurationId = ? \n                        WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? AND configurationId IS NULL\n                    \"\"\", arrayOf(configurationId, serialNumber, iterationNumber.toString(), testStage))\n                }\n                songTestCursor.close()\n                \n                // Process FQCRecords (similar logic)\n                val fqcRecordCursor = database.query(\n                    \"SELECT DISTINCT serialNumber, iterationNumber, testStage FROM fqc_records ORDER BY serialNumber, iterationNumber, testStage\"\n                )\n                \n                while (fqcRecordCursor.moveToNext()) {\n                    val serialNumber = fqcRecordCursor.getString(0)\n                    val iterationNumber = fqcRecordCursor.getInt(1)\n                    val testStage = fqcRecordCursor.getString(2)\n                    \n                    val caseId = deviceToCaseIdMap[serialNumber] ?: continue\n                    \n                    val pcbLinkCursor = database.query(\n                        \"SELECT pcbId FROM device_pcb_links WHERE deviceId = ? AND isActive = 1 LIMIT 1\",\n                        arrayOf(serialNumber)\n                    )\n                    val pcbId = if (pcbLinkCursor.moveToFirst()) {\n                        pcbLinkCursor.getString(0)\n                    } else {\n                        null\n                    }\n                    pcbLinkCursor.close()\n                    \n                    val driverPairingCursor = database.query(\n                        \"SELECT recordId FROM driver_pairing_records WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? LIMIT 1\",\n                        arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                    )\n                    val driverPairingRecordId = if (driverPairingCursor.moveToFirst()) {\n                        driverPairingCursor.getLong(0).toString()\n                    } else {\n                        val fallbackDriverCursor = database.query(\n                            \"SELECT recordId FROM driver_pairing_records WHERE serialNumber = ? ORDER BY recordId LIMIT 1\",\n                            arrayOf(serialNumber)\n                        )\n                        val fallbackId = if (fallbackDriverCursor.moveToFirst()) {\n                            fallbackDriverCursor.getLong(0).toString()\n                        } else {\n                            \"0\"\n                        }\n                        fallbackDriverCursor.close()\n                        fallbackId\n                    }\n                    driverPairingCursor.close()\n                    \n                    val changedPartsCursor = database.query(\n                        \"SELECT recordId FROM changed_parts_records WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? LIMIT 1\",\n                        arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                    )\n                    val changedPartsRecordId = if (changedPartsCursor.moveToFirst()) {\n                        changedPartsCursor.getLong(0).toString()\n                    } else {\n                        null\n                    }\n                    changedPartsCursor.close()\n                    \n                    val existingConfigCursor = database.query(\n                        \"SELECT configurationId FROM test_configurations WHERE caseId = ? AND testStage = ? AND iterationNumber = ?\",\n                        arrayOf(caseId, testStage, iterationNumber.toString())\n                    )\n                    \n                    val configurationId = if (existingConfigCursor.moveToFirst()) {\n                        existingConfigCursor.getString(0)\n                    } else {\n                        val newConfigId = UUID.randomUUID().toString()\n                        \n                        val freqResultCursor = database.query(\n                            \"SELECT result FROM frequency_tests WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? ORDER BY testId DESC LIMIT 1\",\n                            arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                        )\n                        val latestFreqResult = if (freqResultCursor.moveToFirst()) {\n                            freqResultCursor.getString(0)\n                        } else {\n                            null\n                        }\n                        freqResultCursor.close()\n                        \n                        val songResultCursor = database.query(\n                            \"SELECT result FROM song_tests WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? ORDER BY testId DESC LIMIT 1\",\n                            arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                        )\n                        val latestSongResult = if (songResultCursor.moveToFirst()) {\n                            songResultCursor.getString(0)\n                        } else {\n                            null\n                        }\n                        songResultCursor.close()\n                        \n                        val fqcResultCursor = database.query(\n                            \"SELECT overallResult FROM fqc_records WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? ORDER BY fqcId DESC LIMIT 1\",\n                            arrayOf(serialNumber, iterationNumber.toString(), testStage)\n                        )\n                        val latestFqcResult = if (fqcResultCursor.moveToFirst()) {\n                            fqcResultCursor.getString(0)\n                        } else {\n                            null\n                        }\n                        fqcResultCursor.close()\n                        \n                        val configStatus = when {\n                            latestFqcResult == \"PASS\" -> \"CONFIG_PASSED\"\n                            latestFreqResult == \"FAIL\" || latestSongResult == \"FAIL\" -> \"CONFIG_FAILED\"\n                            latestFreqResult == \"PASS\" && latestSongResult in listOf(\"PASS\", \"CAN_BE_PASSED\") -> \"ELIGIBLE_FOR_FQC\"\n                            else -> \"IN_PROGRESS\"\n                        }\n                        \n                        database.execSQL(\"\"\"\n                            INSERT INTO test_configurations (\n                                configurationId, caseId, deviceId, pcbId, driverPairingRecordId,\n                                changedPartsRecordId, iterationNumber, testStage,\n                                latestFrequencyResult, latestSongResult, latestFqcResult,\n                                configurationStatus, createdAt, lastUpdatedAt, endedAt,\n                                operatorName, reason, needsSync, lastSyncTimestamp\n                            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n                        \"\"\", arrayOf(\n                            newConfigId,\n                            caseId,\n                            serialNumber,\n                            pcbId,\n                            driverPairingRecordId,\n                            changedPartsRecordId,\n                            iterationNumber,\n                            testStage,\n                            latestFreqResult,\n                            latestSongResult,\n                            latestFqcResult,\n                            configStatus,\n                            currentTimestamp,\n                            currentTimestamp,\n                            null,\n                            \"SYSTEM\",\n                            \"Migrated from existing test on $currentTimestamp\",\n                            1,\n                            0L\n                        ))\n                        \n                        newConfigId\n                    }\n                    existingConfigCursor.close()\n                    \n                    // Update FQCRecords with configurationId\n                    database.execSQL(\"\"\"\n                        UPDATE fqc_records \n                        SET configurationId = ? \n                        WHERE serialNumber = ? AND iterationNumber = ? AND testStage = ? AND configurationId IS NULL\n                    \"\"\", arrayOf(configurationId, serialNumber, iterationNumber.toString(), testStage))\n                }\n                fqcRecordCursor.close()\n            }\n        }\n    }\n}\n\n",
        "firstEditBubbleId": "306972da-bdef-4c7b-b54f-9cb9307d1cfa",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt": {
        "content": "package com.example.fqcapp.data\n\nimport android.util.Log\nimport androidx.compose.ui.graphics.Color\nimport androidx.room.withTransaction\nimport com.example.fqcapp.data.entities.*\nimport com.example.fqcapp.supabase.SupabaseFrequencyTestService\nimport com.example.fqcapp.ui.models.*\nimport com.example.fqcapp.utils.ResultFormatter\nimport com.example.fqcapp.utils.SerialGenerator\nimport kotlinx.coroutines.flow.Flow\nimport kotlinx.coroutines.flow.flowOf\nimport kotlinx.coroutines.launch\nimport kotlinx.coroutines.CoroutineScope\nimport kotlinx.coroutines.Dispatchers\nimport java.util.UUID\n\nclass FQCRepository(\n    private val database: AppDatabase,\n    private val supabaseService: SupabaseFrequencyTestService = SupabaseFrequencyTestService(),\n    private val supabaseSongTestService: com.example.fqcapp.supabase.SupabaseSongTestService = com.example.fqcapp.supabase.SupabaseSongTestService()\n) {\n    private val TAG = \"FQCRepository\"\n    private val supabaseScope = CoroutineScope(Dispatchers.IO)\n\n    // Operator operations\n    suspend fun insertOperator(operator: Operator): Long {\n        // Save to local database first\n        val operatorId = database.operatorDao().insert(operator)\n        \n        // NOTE: Supabase operator sync disabled - operators are managed locally via Google Sheets sync\n        // The 34 operators from Google Sheets are sufficient for app operation\n        // Uncomment below if Supabase operator sync is needed in the future:\n        /*\n        // Sync to Supabase\n        try {\n            val supabaseService = com.example.fqcapp.supabase.SupabaseOperatorService()\n            val supabaseId = supabaseService.saveOperator(operator.copy(id = operatorId))\n            if (supabaseId != null) {\n                Log.d(TAG, \" Successfully synced operator to Supabase with ID: $supabaseId\")\n            } else {\n                Log.w(TAG, \" Failed to sync operator to Supabase (will retry later)\")\n            }\n        } catch (e: Exception) {\n            Log.e(TAG, \" Error syncing operator to Supabase\", e)\n        }\n        */\n        \n        return operatorId\n    }\n\n    fun getAllOperators(): Flow<List<Operator>> =\n        database.operatorDao().getAllOperators()\n\n    suspend fun getOperatorById(id: Long): Operator? =\n        database.operatorDao().getOperatorById(id)\n\n    suspend fun getOperatorByName(name: String): Operator? =\n        database.operatorDao().getOperatorByName(name)\n\n    // FQC Session operations\n    suspend fun insertSession(session: FQCSession): Long =\n        database.fqcSessionDao().insert(session)\n\n    suspend fun updateSession(session: FQCSession) =\n        database.fqcSessionDao().update(session)\n\n    suspend fun getSessionById(id: Long): FQCSession? =\n        database.fqcSessionDao().getSessionById(id)\n\n    suspend fun getSessionBySerialNumber(serialNumber: String): FQCSession? =\n        database.fqcSessionDao().getSessionBySerialNumber(serialNumber)\n\n    fun getSessionsByOperator(operatorId: Long): Flow<List<FQCSession>> =\n        database.fqcSessionDao().getSessionsByOperator(operatorId)\n\n    fun getAllSessions(): Flow<List<FQCSession>> =\n        database.fqcSessionDao().getAllSessions()\n\n    // Frequency Test operations\n    /**\n     * Sync data from Supabase before calculating iteration number to prevent duplicates\n     * This ensures we have the latest data from all devices before creating new tests\n     */\n    private suspend fun syncBeforeIteration(serialNumber: String) {\n        try {\n            Log.d(TAG, \" Syncing from Supabase before calculating iteration for: $serialNumber\")\n            val syncService = com.example.fqcapp.services.DeviceDataSyncService(database)\n            val syncSuccess = syncService.syncDeviceDataFromSupabase(serialNumber)\n            if (syncSuccess) {\n                Log.d(TAG, \" Sync completed successfully before iteration calculation\")\n            } else {\n                Log.w(TAG, \" Sync completed with errors, but continuing with iteration calculation\")\n            }\n        } catch (e: Exception) {\n            Log.e(TAG, \" Error syncing before iteration calculation, continuing anyway\", e)\n            // Continue even if sync fails - better to have a slightly wrong iteration than to block\n        }\n    }\n    \n    /**\n     * Check if a test with similar entryTimestamp and testStage already exists (duplicate detection)\n     * Returns true if duplicate found, false otherwise\n     */\n    private suspend fun isDuplicateFrequencyTest(\n        serialNumber: String,\n        entryTimestamp: String,\n        testStage: String,\n        result: String,\n        toleranceSeconds: Int = 10\n    ): Boolean {\n        try {\n            // Get all tests for this serial and stage\n            val existingTests = database.frequencyTestDao().getFrequencyTests(serialNumber)\n                .filter { it.testStage == testStage && it.result == result }\n            \n            // Parse entryTimestamp and check if any test is within tolerance\n            val entryTime = parseTimestamp(entryTimestamp)\n            if (entryTime == null) return false\n            \n            return existingTests.any { existing ->\n                val existingTime = parseTimestamp(existing.entryTimestamp)\n                if (existingTime == null) return@any false\n                val timeDiff = kotlin.math.abs(entryTime - existingTime) / 1000 // Convert to seconds\n                timeDiff <= toleranceSeconds\n            }\n        } catch (e: Exception) {\n            Log.e(TAG, \"Error checking for duplicate frequency test\", e)\n            return false // On error, allow insert\n        }\n    }\n    \n    private suspend fun isDuplicateSongTest(\n        serialNumber: String,\n        entryTimestamp: String,\n        testStage: String,\n        result: String,\n        toleranceSeconds: Int = 10\n    ): Boolean {\n        try {\n            val existingTests = database.songTestDao().getSongTests(serialNumber)\n                .filter { it.testStage == testStage && it.result == result && it.isOverallResult }\n            \n            val entryTime = parseTimestamp(entryTimestamp)\n            if (entryTime == null) return false\n            \n            return existingTests.any { existing ->\n                val existingTime = parseTimestamp(existing.entryTimestamp)\n                if (existingTime == null) return@any false\n                val timeDiff = kotlin.math.abs(entryTime - existingTime) / 1000\n                timeDiff <= toleranceSeconds\n            }\n        } catch (e: Exception) {\n            Log.e(TAG, \"Error checking for duplicate song test\", e)\n            return false\n        }\n    }\n    \n    private suspend fun isDuplicateFQCRecord(\n        serialNumber: String,\n        entryTimestamp: String,\n        testStage: String,\n        overallResult: String,\n        toleranceSeconds: Int = 10\n    ): Boolean {\n        try {\n            val existingRecords = database.fqcRecordDao().getFQCRecords(serialNumber)\n                .filter { it.testStage == testStage && it.overallResult == overallResult }\n            \n            val entryTime = parseTimestamp(entryTimestamp)\n            if (entryTime == null) return false\n            \n            return existingRecords.any { existing ->\n                val existingTime = parseTimestamp(existing.entryTimestamp)\n                if (existingTime == null) return@any false\n                val timeDiff = kotlin.math.abs(entryTime - existingTime) / 1000\n                timeDiff <= toleranceSeconds\n            }\n        } catch (e: Exception) {\n            Log.e(TAG, \"Error checking for duplicate FQC record\", e)\n            return false\n        }\n    }\n    \n    /**\n     * Parse timestamp string to milliseconds\n     * Supports formats: \"yyyy-MM-dd HH:mm:ss\" and ISO format\n     */\n    private fun parseTimestamp(timestamp: String): Long? {\n        if (timestamp.isBlank()) return null\n        return try {\n            // Try ISO format first\n            if (timestamp.contains(\"T\")) {\n                java.time.Instant.parse(timestamp).toEpochMilli()\n            } else {\n                // Try \"yyyy-MM-dd HH:mm:ss\" format\n                val format = java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.US)\n                format.parse(timestamp)?.time\n            }\n        } catch (e: Exception) {\n            Log.w(TAG, \"Failed to parse timestamp: $timestamp\", e)\n            null\n        }\n    }\n    \n    suspend fun getNextIterationNumber(serialNumber: String): Int {\n        // IMPORTANT: Sync from Supabase first to get latest data from all devices\n        syncBeforeIteration(serialNumber)\n        \n        // Get max iteration number excluding TEST_NOT_DONE results\n        val maxIteration = database.frequencyTestDao().getMaxIterationNumber(serialNumber)\n        // Also check song tests to get the overall max\n        val maxSongIteration = database.songTestDao().getMaxIterationNumber(serialNumber)\n        val overallMax = maxOf(maxIteration, maxSongIteration)\n        return overallMax + 1\n    }\n    \n    /**\n     * Helper function to get operatorId from operatorName\n     */\n    private suspend fun getOperatorId(operatorName: String): String {\n        return try {\n            val operator = database.operatorCredentialDao().getOperatorByName(operatorName)\n            operator?.operatorId ?: \"\"\n        } catch (e: Exception) {\n            Log.w(TAG, \" Could not find operatorId for operator: $operatorName, using empty string\")\n            \"\"\n        }\n    }\n    \n    suspend fun insertFrequencyTest(test: FrequencyTest, operatorId: String? = null): Long {\n        // Skip saving \"TEST_NOT_DONE\" to database - this is not a test result, just a reason why test couldn't be done\n        // TEST_NOT_DONE should not create an iteration\n        if (test.result.uppercase() == \"TEST_NOT_DONE\") {\n            Log.d(TAG, \" Skipping database save for TEST_NOT_DONE - not a test result, no iteration created\")\n            return 0L // Return 0 to indicate no test was saved\n        }\n        \n        // IMPORTANT: Sync from Supabase first to prevent duplicates from multiple devices\n        syncBeforeIteration(test.serialNumber)\n        \n        // Check for duplicate test (same serial, entryTimestamp within tolerance, same stage and result)\n        if (isDuplicateFrequencyTest(test.serialNumber, test.entryTimestamp, test.testStage, test.result)) {\n            Log.w(TAG, \" Duplicate frequency test detected - skipping insert\")\n            Log.w(TAG, \"   Serial: ${test.serialNumber}, Stage: ${test.testStage}, EntryTime: ${test.entryTimestamp}, Result: ${test.result}\")\n            return 0L // Return 0 to indicate test was not saved (duplicate)\n        }\n        \n        // DUAL-WRITE: Get or create TestConfiguration before saving test\n        var configurationId: String? = null\n        var configIterationNumber: Int? = null\n        var configTestStage: String? = null\n        try {\n            val config = getOrCreateConfigurationForTest(\n                deviceId = test.serialNumber,\n                testStage = test.testStage,\n                operatorName = test.operatorName\n            )\n            configurationId = config.configurationId\n            configIterationNumber = config.iterationNumber\n            configTestStage = config.testStage\n            Log.d(TAG, \" [DUAL-WRITE] Using configuration: $configurationId\")\n            Log.d(TAG, \"   Configuration iteration: ${config.iterationNumber}, stage: ${config.testStage}\")\n            Log.d(TAG, \"   Test will use EXACT values from configuration (dual-write)\")\n        } catch (e: Exception) {\n            Log.w(TAG, \" [DUAL-WRITE] Failed to get/create configuration, continuing without it: ${e.message}\")\n            // Continue without configurationId - backward compatibility\n        }\n        \n        // Update test with configurationId AND EXACT iterationNumber/testStage from configuration\n        // CRITICAL: iterationNumber and testStage must match configuration EXACTLY (dual-write)\n        val testWithConfig = if (configurationId != null && configIterationNumber != null && configTestStage != null) {\n            test.copy(\n                configurationId = configurationId,\n                iterationNumber = configIterationNumber,  // EXACT match from configuration\n                testStage = configTestStage  // EXACT match from configuration\n            )\n        } else {\n            test\n        }\n        \n        // First, save to local Room database (always succeeds)\n        val testId = database.frequencyTestDao().insert(testWithConfig)\n        Log.d(TAG, \" Saved frequency test to Room DB with ID: $testId\")\n        \n        // Then, try to save to Supabase (non-blocking, with error handling)\n        val testWithId = testWithConfig.copy(testId = testId)\n        supabaseScope.launch {\n            try {\n                Log.d(TAG, \"\")\n                Log.d(TAG, \" [REPOSITORY] SYNCING FREQUENCY TEST TO SUPABASE\")\n                Log.d(TAG, \"   Test ID (Local): $testId\")\n                Log.d(TAG, \"   Serial Number: ${testWithId.serialNumber}\")\n                Log.d(TAG, \"   Iteration: ${testWithId.iterationNumber}\")\n                Log.d(TAG, \"   Result: ${testWithId.result}\")\n                Log.d(TAG, \"   Operator: ${testWithId.operatorName}\")\n                Log.d(TAG, \"\")\n                \n                // Get operatorId if not provided\n                val finalOperatorId = operatorId ?: getOperatorId(testWithId.operatorName)\n                if (finalOperatorId.isBlank()) {\n                    Log.w(TAG, \" [WARNING] operatorId is empty for operator: ${testWithId.operatorName}\")\n                }\n                \n                val supabaseId = supabaseService.saveFrequencyTest(testWithId, finalOperatorId)\n                if (supabaseId != null) {\n                    Log.d(TAG, \"\")\n                    Log.d(TAG, \" [REPOSITORY] SYNC SUCCESSFUL\")\n                    Log.d(TAG, \"   Local Test ID: $testId\")\n                    Log.d(TAG, \"   Supabase Test ID: $supabaseId\")\n                    Log.d(TAG, \"\")\n                } else {\n                    Log.w(TAG, \"\")\n                    Log.w(TAG, \" [REPOSITORY] SYNC FAILED\")\n                    Log.w(TAG, \"   Local Test ID: $testId\")\n                    Log.w(TAG, \"   Will retry later\")\n                    Log.w(TAG, \"\")\n                }\n            } catch (e: Exception) {\n                Log.e(TAG, \"\")\n                Log.e(TAG, \" [REPOSITORY] ERROR SYNCING TO SUPABASE\")\n                Log.e(TAG, \"   Local Test ID: $testId\")\n                Log.e(TAG, \"   Error: ${e.message}\")\n                Log.e(TAG, \"   Stack trace: ${e.stackTraceToString()}\")\n                Log.e(TAG, \"\")\n            }\n        }\n        \n        // Update configuration cache after test creation\n        if (configurationId != null) {\n            try {\n                updateConfigurationCache(configurationId)\n            } catch (e: Exception) {\n                Log.w(TAG, \" Failed to update configuration cache: ${e.message}\")\n            }\n        }\n        \n        return testId\n    }\n    \n    suspend fun getAllFrequencyTests(): List<FrequencyTest> =\n        database.frequencyTestDao().getAllFrequencyTests()\n\n\n    // Song Test operations\n    /**\n     * Calculate priority score for a song test.\n     * Higher score = higher priority for Supabase sync.\n     * Priority: FAIL (30) > CAN_BE_PASSED (20) > PASS (10)\n     * Bonus: +5 if has issues\n     */\n    private fun calculateSongPriority(test: SongTest): Int {\n        var priority = when (test.result.uppercase()) {\n            \"FAIL\" -> 30\n            \"CAN_BE_PASSED\" -> 20\n            \"PASS\" -> 10\n            else -> 5\n        }\n        \n        // Bonus for songs with issues\n        if (test.issues.isNotBlank() && test.issues.trim() != \"[]\" && test.issues.trim() != \"\") {\n            priority += 5\n        }\n        \n        return priority\n    }\n    \n    suspend fun insertSongTest(test: SongTest, operatorId: String? = null): Long {\n        // Skip saving \"TEST_NOT_DONE\" to database - this is not a test result, just a reason why test couldn't be done\n        // TEST_NOT_DONE should not create an iteration\n        if (test.result.uppercase() == \"TEST_NOT_DONE\") {\n            Log.d(TAG, \" Skipping database save for TEST_NOT_DONE - not a test result, no iteration created\")\n            return 0L // Return 0 to indicate no test was saved\n        }\n        \n        // IMPORTANT: Sync from Supabase first to prevent duplicates from multiple devices\n        syncBeforeIteration(test.serialNumber)\n        \n        // Check for duplicate test (only for overall results)\n        if (test.isOverallResult && isDuplicateSongTest(test.serialNumber, test.entryTimestamp, test.testStage, test.result)) {\n            Log.w(TAG, \" Duplicate song test detected - skipping insert\")\n            Log.w(TAG, \"   Serial: ${test.serialNumber}, Stage: ${test.testStage}, EntryTime: ${test.entryTimestamp}, Result: ${test.result}\")\n            return 0L // Return 0 to indicate test was not saved (duplicate)\n        }\n        \n        // DUAL-WRITE: Get or create TestConfiguration before saving test\n        var configurationId: String? = null\n        var configIterationNumber: Int? = null\n        var configTestStage: String? = null\n        try {\n            val config = getOrCreateConfigurationForTest(\n                deviceId = test.serialNumber,\n                testStage = test.testStage,\n                operatorName = test.operatorName\n            )\n            configurationId = config.configurationId\n            configIterationNumber = config.iterationNumber\n            configTestStage = config.testStage\n            Log.d(TAG, \" [DUAL-WRITE] Using configuration: $configurationId\")\n            Log.d(TAG, \"   Configuration iteration: ${config.iterationNumber}, stage: ${config.testStage}\")\n            Log.d(TAG, \"   Test will use EXACT values from configuration (dual-write)\")\n        } catch (e: Exception) {\n            Log.w(TAG, \" [DUAL-WRITE] Failed to get/create configuration, continuing without it: ${e.message}\")\n            // Continue without configurationId - backward compatibility\n        }\n        \n        // Update test with configurationId AND EXACT iterationNumber/testStage from configuration\n        // CRITICAL: iterationNumber and testStage must match configuration EXACTLY (dual-write)\n        val testWithConfig = if (configurationId != null && configIterationNumber != null && configTestStage != null) {\n            test.copy(\n                configurationId = configurationId,\n                iterationNumber = configIterationNumber,  // EXACT match from configuration\n                testStage = configTestStage  // EXACT match from configuration\n            )\n        } else {\n            test\n        }\n        \n        // First, save to local Room database (always succeeds)\n        val testId = database.songTestDao().insert(testWithConfig)\n        Log.d(TAG, \" Saved song test to Room DB with ID: $testId\")\n        \n        // If this is an individual song (not overall), check and delete old songs beyond 3\n        if (!testWithConfig.isOverallResult && testWithConfig.serialNumber.isNotBlank()) {\n            try {\n                database.songTestDao().deleteOldIndividualSongs(testWithConfig.serialNumber, testWithConfig.iterationNumber)\n            } catch (e: Exception) {\n                Log.e(TAG, \"Error deleting old individual songs\", e)\n            }\n        }\n        \n        // For individual songs: Only sync top 3 songs by TIME SPENT to Supabase (matching table display)\n        if (!test.isOverallResult && test.serialNumber.isNotBlank()) {\n            try {\n                // Get all individual songs for this iteration\n                val allSongs = database.songTestDao()\n                    .getIndividualSongsForIteration(testWithConfig.serialNumber, testWithConfig.iterationNumber)\n                \n                // Parse time spent (HH:MM:SS) to milliseconds for sorting\n                fun parseTimeToMs(timeStr: String): Long {\n                    return try {\n                        val parts = timeStr.split(\":\")\n                        if (parts.size == 3) {\n                            val hours = parts[0].toLongOrNull() ?: 0L\n                            val minutes = parts[1].toLongOrNull() ?: 0L\n                            val seconds = parts[2].toLongOrNull() ?: 0L\n                            (hours * 3600 + minutes * 60 + seconds) * 1000\n                        } else {\n                            0L\n                        }\n                    } catch (e: Exception) {\n                        Log.w(TAG, \" Failed to parse time: $timeStr\", e)\n                        0L\n                    }\n                }\n                \n                // Calculate time spent (in ms) for each song\n                val songsWithTime = allSongs.map { song ->\n                    Pair(song, parseTimeToMs(song.totalTimeSpent))\n                }\n                \n                // Sort by time spent (descending) and take top 3\n                val top3Songs = songsWithTime\n                    .sortedByDescending { it.second }\n                    .take(3)\n                    .map { it.first }\n                \n                Log.d(TAG, \" [TIME] Total songs: ${allSongs.size}, Top 3 songs by time spent selected\")\n                top3Songs.forEachIndexed { index, song ->\n                    val timeMs = parseTimeToMs(song.totalTimeSpent)\n                    Log.d(TAG, \"   ${index + 1}. ${song.songName} (Time: ${song.totalTimeSpent} = ${timeMs}ms, Result: ${song.result})\")\n                }\n                \n                // Update needsSync flags: only top 3 should sync\n                allSongs.forEach { song ->\n                    val shouldSync = top3Songs.any { it.testId == song.testId }\n                    if (song.needsSync != shouldSync) {\n                        // Update needsSync flag in database\n                        database.songTestDao().updateNeedsSync(song.testId, shouldSync)\n                        Log.d(TAG, \"   ${if (shouldSync) \"\" else \"\"} ${song.songName}: needsSync = $shouldSync\")\n                    }\n                }\n                \n                // Only sync the current song if it's in top 3\n                val currentSongShouldSync = top3Songs.any { it.testId == testId }\n                if (!currentSongShouldSync) {\n                    Log.d(TAG, \" [TIME] Song '${testWithConfig.songName}' not in top 3 by time spent - skipping Supabase sync\")\n                    return testId\n                }\n            } catch (e: Exception) {\n                Log.e(TAG, \" Error calculating top 3 songs by time\", e)\n                // Continue with sync if calculation fails\n            }\n        }\n        \n        // Then, try to save to Supabase (non-blocking, with error handling)\n        val testWithId = testWithConfig.copy(testId = testId)\n        supabaseScope.launch {\n            try {\n                Log.d(TAG, \"\")\n                Log.d(TAG, \" [REPOSITORY] SYNCING SONG TEST TO SUPABASE\")\n                Log.d(TAG, \"   Test ID (Local): $testId\")\n                Log.d(TAG, \"   Serial Number: ${testWithId.serialNumber}\")\n                Log.d(TAG, \"   Song Name: ${testWithId.songName}\")\n                Log.d(TAG, \"   Iteration: ${testWithId.iterationNumber}\")\n                Log.d(TAG, \"   Result: ${testWithId.result}\")\n                Log.d(TAG, \"   Is Overall: ${testWithId.isOverallResult}\")\n                Log.d(TAG, \"   Operator: ${testWithId.operatorName}\")\n                Log.d(TAG, \"   Priority: ${calculateSongPriority(testWithId)}\")\n                Log.d(TAG, \"\")\n                \n                // Get operatorId if not provided\n                val finalOperatorId = operatorId ?: getOperatorId(testWithId.operatorName)\n                if (finalOperatorId.isBlank()) {\n                    Log.w(TAG, \" [WARNING] operatorId is empty for operator: ${testWithId.operatorName}\")\n                }\n                \n                val supabaseId = supabaseSongTestService.saveSongTest(testWithId, finalOperatorId)\n                if (supabaseId != null) {\n                    Log.d(TAG, \"\")\n                    Log.d(TAG, \" [REPOSITORY] SYNC SUCCESSFUL\")\n                    Log.d(TAG, \"   Local Test ID: $testId\")\n                    Log.d(TAG, \"   Supabase Test ID: $supabaseId\")\n                    Log.d(TAG, \"\")\n                } else {\n                    Log.w(TAG, \" Failed to sync song test to Supabase (will retry later)\")\n                }\n            } catch (e: Exception) {\n                Log.e(TAG, \" Error syncing song test to Supabase\", e)\n            }\n        }\n        \n        // Update configuration cache after test creation\n        if (configurationId != null) {\n            try {\n                updateConfigurationCache(configurationId)\n            } catch (e: Exception) {\n                Log.w(TAG, \" Failed to update configuration cache: ${e.message}\")\n            }\n        }\n        \n        return testId\n    }\n    \n    suspend fun getNextSongIterationNumber(serialNumber: String): Int {\n        // IMPORTANT: Sync from Supabase first to get latest data from all devices\n        syncBeforeIteration(serialNumber)\n        return database.songTestDao().getMaxIterationNumber(serialNumber) + 1\n    }\n    \n    suspend fun getIndividualSongsForIteration(serialNumber: String, iterationNumber: Int): List<SongTest> {\n        return database.songTestDao().getIndividualSongsForIteration(serialNumber, iterationNumber)\n    }\n    \n    suspend fun getAllSongTests(): List<SongTest> =\n        database.songTestDao().getAllSongTests()\n\n    // FQC Record operations\n    suspend fun insertFQCRecord(fqcRecord: FQCRecord, macId: String = \"\", operatorId: String? = null): Long {\n        // IMPORTANT: Sync from Supabase first to prevent duplicates from multiple devices\n        syncBeforeIteration(fqcRecord.serialNumber)\n        \n        // Check for duplicate FQC record\n        if (isDuplicateFQCRecord(fqcRecord.serialNumber, fqcRecord.entryTimestamp, fqcRecord.testStage, fqcRecord.overallResult)) {\n            Log.w(TAG, \" Duplicate FQC record detected - skipping insert\")\n            Log.w(TAG, \"   Serial: ${fqcRecord.serialNumber}, Stage: ${fqcRecord.testStage}, EntryTime: ${fqcRecord.entryTimestamp}, Result: ${fqcRecord.overallResult}\")\n            return 0L // Return 0 to indicate record was not saved (duplicate)\n        }\n        \n        // DUAL-WRITE: Get or create TestConfiguration before saving test\n        var configurationId: String? = null\n        var configIterationNumber: Int? = null\n        var configTestStage: String? = null\n        try {\n            val config = getOrCreateConfigurationForTest(\n                deviceId = fqcRecord.serialNumber,\n                testStage = fqcRecord.testStage,\n                operatorName = fqcRecord.operatorName\n            )\n            configurationId = config.configurationId\n            configIterationNumber = config.iterationNumber\n            configTestStage = config.testStage\n            Log.d(TAG, \" [DUAL-WRITE] Using configuration: $configurationId\")\n            Log.d(TAG, \"   Configuration iteration: ${config.iterationNumber}, stage: ${config.testStage}\")\n            Log.d(TAG, \"   FQC record will use EXACT values from configuration (dual-write)\")\n        } catch (e: Exception) {\n            Log.w(TAG, \" [DUAL-WRITE] Failed to get/create configuration, continuing without it: ${e.message}\")\n            // Continue without configurationId - backward compatibility\n        }\n        \n        // Update FQC record with configurationId AND EXACT iterationNumber/testStage from configuration\n        // CRITICAL: iterationNumber and testStage must match configuration EXACTLY (dual-write)\n        val fqcRecordWithConfig = if (configurationId != null && configIterationNumber != null && configTestStage != null) {\n            fqcRecord.copy(\n                configurationId = configurationId,\n                iterationNumber = configIterationNumber,  // EXACT match from configuration\n                testStage = configTestStage  // EXACT match from configuration\n            )\n        } else {\n            fqcRecord\n        }\n        \n        // First, save to local Room database (always succeeds)\n        val fqcId = database.fqcRecordDao().insertFQCRecord(fqcRecordWithConfig)\n        Log.d(TAG, \" Saved FQC record to Room DB with ID: $fqcId\")\n        \n        // Then, try to save to Supabase (non-blocking, with error handling)\n        val fqcWithId = fqcRecordWithConfig.copy(fqcId = fqcId)\n        supabaseScope.launch {\n            try {\n                Log.d(TAG, \"\")\n                Log.d(TAG, \" [REPOSITORY] SYNCING FQC RECORD TO SUPABASE\")\n                Log.d(TAG, \"   FQC ID (Local): $fqcId\")\n                Log.d(TAG, \"   Serial Number: ${fqcWithId.serialNumber}\")\n                Log.d(TAG, \"   Iteration: ${fqcWithId.iterationNumber}\")\n                Log.d(TAG, \"   Result: ${fqcWithId.overallResult}\")\n                Log.d(TAG, \"   FQC Type: ${fqcWithId.fqcType}\")\n                Log.d(TAG, \"   Operator: ${fqcWithId.operatorName}\")\n                Log.d(TAG, \"\")\n                \n                // Get operatorId if not provided\n                val finalOperatorId = operatorId ?: getOperatorId(fqcWithId.operatorName)\n                if (finalOperatorId.isBlank()) {\n                    Log.w(TAG, \" [WARNING] operatorId is empty for operator: ${fqcWithId.operatorName}\")\n                }\n                \n                val supabaseService = com.example.fqcapp.supabase.SupabaseFQCService()\n                val supabaseId = supabaseService.saveFQCRecord(fqcWithId, finalOperatorId, macId)\n                if (supabaseId != null) {\n                    Log.d(TAG, \"\")\n                    Log.d(TAG, \" [REPOSITORY] SYNC SUCCESSFUL\")\n                    Log.d(TAG, \"   Local FQC ID: $fqcId\")\n                    Log.d(TAG, \"   Supabase FQC ID: $supabaseId\")\n                    // Mark as synced in Room DB (if method exists)\n                    try {\n                        database.fqcRecordDao().markAsSynced(fqcId, System.currentTimeMillis())\n                        Log.d(TAG, \"    Marked as synced in Room DB\")\n                    } catch (e: Exception) {\n                        // Method might not exist, that's okay\n                        Log.d(TAG, \"    Note: markAsSynced method not available for FQC records\")\n                    }\n                    Log.d(TAG, \"\")\n                } else {\n                    Log.w(TAG, \"\")\n                    Log.w(TAG, \" [REPOSITORY] SYNC FAILED\")\n                    Log.w(TAG, \"   Local FQC ID: $fqcId\")\n                    Log.w(TAG, \"   Will retry later\")\n                    Log.w(TAG, \"\")\n                }\n            } catch (e: Exception) {\n                Log.e(TAG, \"\")\n                Log.e(TAG, \" [REPOSITORY] ERROR SYNCING TO SUPABASE\")\n                Log.e(TAG, \"   Local FQC ID: $fqcId\")\n                Log.e(TAG, \"   Error: ${e.message}\")\n                Log.e(TAG, \"   Stack trace: ${e.stackTraceToString()}\")\n                Log.e(TAG, \"\")\n            }\n        }\n        \n        // If FQC passed and a quality type is selected, update device status to PASSED/DONE\n        if (fqcRecord.overallResult.uppercase() == \"PASS\" && \n            fqcRecord.finalQualityType.isNotBlank() &&\n            fqcRecord.finalQualityType.uppercase() in listOf(\"REVIEWER\", \"CUSTOMER\", \"INTERNATIONAL\", \"MARKETING\")) {\n            try {\n                val device = getDeviceBySerialNumber(fqcRecord.serialNumber)\n                if (device != null) {\n                    val updatedDevice = device.copy(\n                        finalStatus = \"PASSED\", // Change from \"IN_PROGRESS\" to \"PASSED\"\n                        finalOperator = fqcRecord.operatorName,\n                        finalShipDate = java.time.LocalDate.now().toString()\n                    )\n                    updateDevice(updatedDevice)\n                    Log.d(TAG, \" Updated device status to PASSED for serial: ${fqcRecord.serialNumber}\")\n                    \n                    // Also sync device status to Supabase\n                    supabaseScope.launch {\n                        try {\n                            val deviceService = com.example.fqcapp.supabase.SupabaseDeviceService()\n                            deviceService.updateDeviceStatus(\n                                serialNumber = fqcRecord.serialNumber,\n                                status = \"PASSED\",\n                                finalOperator = fqcRecord.operatorName,\n                                finalShipDate = java.time.LocalDate.now().toString()\n                            )\n                            Log.d(TAG, \" Successfully synced device status to Supabase\")\n                        } catch (e: Exception) {\n                            Log.e(TAG, \" Error syncing device status to Supabase\", e)\n                        }\n                    }\n                }\n            } catch (e: Exception) {\n                Log.e(TAG, \" Error updating device status after FQC pass\", e)\n            }\n        }\n        \n        // Update configuration cache after FQC record creation\n        if (configurationId != null) {\n            try {\n                updateConfigurationCache(configurationId)\n            } catch (e: Exception) {\n                Log.w(TAG, \" Failed to update configuration cache: ${e.message}\")\n            }\n        }\n        \n        return fqcId\n    }\n\n    suspend fun getAllFQCRecords(): List<FQCRecord> =\n        database.fqcRecordDao().getAllFQCRecords()\n\n    private suspend fun isDuplicateDriverPairing(\n        serialNumber: String,\n        entryTimestamp: String,\n        driverData: String,\n        toleranceSeconds: Int = 10\n    ): Boolean {\n        try {\n            val existingRecords = database.driverPairingRecordDao().getDriverPairingRecords(serialNumber)\n            \n            val entryTime = parseTimestamp(entryTimestamp)\n            if (entryTime == null) return false\n            \n            return existingRecords.any { existing ->\n                val existingTime = parseTimestamp(existing.entryTimestamp)\n                if (existingTime == null) return@any false\n                val timeDiff = kotlin.math.abs(entryTime - existingTime) / 1000\n                // Check if timestamp is close AND driver data matches\n                timeDiff <= toleranceSeconds && existing.driverData == driverData\n            }\n        } catch (e: Exception) {\n            Log.e(TAG, \"Error checking for duplicate driver pairing\", e)\n            return false\n        }\n    }\n    \n    private suspend fun isDuplicateChangedParts(\n        serialNumber: String,\n        entryTimestamp: String,\n        selectedParts: String,\n        toleranceSeconds: Int = 10\n    ): Boolean {\n        try {\n            val existingRecords = database.changedPartsRecordDao().getChangedPartsBySerial(serialNumber)\n            \n            val entryTime = parseTimestamp(entryTimestamp)\n            if (entryTime == null) return false\n            \n            return existingRecords.any { existing ->\n                val existingTime = parseTimestamp(existing.entryTimestamp)\n                if (existingTime == null) return@any false\n                val timeDiff = kotlin.math.abs(entryTime - existingTime) / 1000\n                // Check if timestamp is close AND selected parts match\n                timeDiff <= toleranceSeconds && existing.selectedParts == selectedParts\n            }\n        } catch (e: Exception) {\n            Log.e(TAG, \"Error checking for duplicate changed parts\", e)\n            return false\n        }\n    }\n    \n    // Driver Pairing Record operations\n    suspend fun insertDriverPairingRecord(record: DriverPairingRecord): Long {\n        // IMPORTANT: Sync from Supabase first to prevent duplicates from multiple devices\n        syncBeforeIteration(record.serialNumber)\n        \n        // Check for duplicate driver pairing record\n        if (isDuplicateDriverPairing(record.serialNumber, record.entryTimestamp, record.driverData)) {\n            Log.w(TAG, \" Duplicate driver pairing record detected - skipping insert\")\n            Log.w(TAG, \"   Serial: ${record.serialNumber}, EntryTime: ${record.entryTimestamp}, DriverData: ${record.driverData.take(50)}...\")\n            return 0L // Return 0 to indicate record was not saved (duplicate)\n        }\n        \n        // DUAL-WRITE: Get or create TestConfiguration after saving driver pairing\n        // Note: Driver pairing is saved first, then configuration is created/updated\n        val recordId = database.driverPairingRecordDao().insertDriverPairingRecord(record)\n        \n        // Update configuration after driver pairing is saved\n        try {\n            val config = getOrCreateConfigurationForTest(\n                deviceId = record.serialNumber,\n                testStage = record.testStage,\n                operatorName = record.operatorName\n            )\n            Log.d(TAG, \" [DUAL-WRITE] Configuration updated after driver pairing: ${config.configurationId}\")\n        } catch (e: Exception) {\n            Log.w(TAG, \" [DUAL-WRITE] Failed to update configuration after driver pairing: ${e.message}\")\n            // Continue - configuration update is not critical for driver pairing\n        }\n        \n        return recordId\n    }\n    \n    suspend fun getAllDriverPairingRecords(): List<DriverPairingRecord> =\n        database.driverPairingRecordDao().getAllDriverPairingRecords()\n    \n    suspend fun getAllChangedPartsRecords(): List<ChangedPartsRecord> =\n        database.changedPartsRecordDao().getAllChangedPartsRecords()\n    \n    suspend fun getDriverPairingRecordsBySerial(serialNumber: String): List<DriverPairingRecord> =\n        database.driverPairingRecordDao().getDriverPairingRecords(serialNumber)\n    \n    suspend fun markDriverPairingAsSynced(recordId: Long, timestamp: Long = System.currentTimeMillis()) {\n        database.driverPairingRecordDao().markAsSynced(recordId, timestamp)\n    }\n    \n    suspend fun getNextDriverPairingIterationNumber(serialNumber: String): Int {\n        val maxIteration = database.driverPairingRecordDao().getMaxIterationNumber(serialNumber)\n        return maxIteration + 1\n    }\n    \n    // Changed Parts Record operations\n    suspend fun insertChangedPartsRecord(record: ChangedPartsRecord): Long {\n        // IMPORTANT: Sync from Supabase first to prevent duplicates from multiple devices\n        syncBeforeIteration(record.serialNumber)\n        \n        // Check for duplicate changed parts record\n        if (isDuplicateChangedParts(record.serialNumber, record.entryTimestamp, record.selectedParts)) {\n            Log.w(TAG, \" Duplicate changed parts record detected - skipping insert\")\n            Log.w(TAG, \"   Serial: ${record.serialNumber}, EntryTime: ${record.entryTimestamp}, Parts: ${record.selectedParts}\")\n            return 0L // Return 0 to indicate record was not saved (duplicate)\n        }\n        \n        return database.changedPartsRecordDao().insertChangedPartsRecord(record)\n    }\n    \n    suspend fun getChangedPartsBySerial(serialNumber: String): List<ChangedPartsRecord> =\n        database.changedPartsRecordDao().getChangedPartsBySerial(serialNumber)\n    \n    suspend fun getChangedPartsRecordsBySerial(serialNumber: String): List<ChangedPartsRecord> =\n        database.changedPartsRecordDao().getChangedPartsBySerial(serialNumber)\n    \n    suspend fun getFrequencyTestsBySerial(serialNumber: String): List<FrequencyTest> =\n        database.frequencyTestDao().getFrequencyTests(serialNumber)\n    \n    suspend fun getSongTestsBySerial(serialNumber: String): List<SongTest> =\n        database.songTestDao().getSongTests(serialNumber)\n    \n    suspend fun getNextChangedPartsIterationNumber(serialNumber: String): Int {\n        val maxIteration = database.changedPartsRecordDao().getMaxIterationNumber(serialNumber) ?: 0\n        return maxIteration + 1\n    }\n    \n    suspend fun markChangedPartsAsSynced(recordId: Long, timestamp: Long = System.currentTimeMillis()) {\n        database.changedPartsRecordDao().markAsSynced(recordId, timestamp)\n    }\n    \n    suspend fun getDriverPairingRecords(serialNumber: String): List<DriverPairingRecord> =\n        database.driverPairingRecordDao().getDriverPairingRecords(serialNumber)\n    \n    suspend fun getLatestDriverPairing(serialNumber: String): DriverPairingRecord? =\n        database.driverPairingRecordDao().getLatestDriverPairing(serialNumber)\n\n    // Device Workflow operations\n    suspend fun insertDeviceWorkflow(workflow: com.example.fqcapp.data.entities.DeviceWorkflow): Long =\n        database.deviceWorkflowDao().insertWorkflow(workflow)\n\n    suspend fun getDeviceWorkflowHistory(serialNumber: String): List<com.example.fqcapp.data.entities.DeviceWorkflow> =\n        database.deviceWorkflowDao().getWorkflowForDevice(serialNumber)\n\n    suspend fun getDeviceWorkflowForStage(serialNumber: String, stage: String): List<com.example.fqcapp.data.entities.DeviceWorkflow> =\n        database.deviceWorkflowDao().getWorkflowForDeviceStage(serialNumber, stage)\n\n    suspend fun getLatestWorkflowForStage(serialNumber: String, stage: String): com.example.fqcapp.data.entities.DeviceWorkflow? =\n        database.deviceWorkflowDao().getLatestWorkflowForStage(serialNumber, stage)\n\n    suspend fun getMaxWorkflowIterationForStage(serialNumber: String, stage: String): Int =\n        database.deviceWorkflowDao().getMaxIterationForStage(serialNumber, stage)\n\n    suspend fun getAllWorkflowEvents(): List<com.example.fqcapp.data.entities.DeviceWorkflow> =\n        database.deviceWorkflowDao().getAllWorkflowEvents()\n\n    suspend fun getUnsyncedWorkflowEvents(): List<com.example.fqcapp.data.entities.DeviceWorkflow> =\n        database.deviceWorkflowDao().getUnsyncedWorkflowEvents()\n\n    suspend fun markWorkflowAsSynced(workflowId: Long, timestamp: Long = System.currentTimeMillis()) {\n        database.deviceWorkflowDao().markAsSynced(workflowId, timestamp)\n    }\n\n    // Device operations\n    suspend fun insertDevice(device: Device) =\n        database.deviceDao().insertDevice(device)\n\n    suspend fun getDeviceBySerialNumber(serialNumber: String): Device? =\n        database.deviceDao().getDevice(serialNumber)\n\n    /**\n     * Find device by MAC ID through active PCB link\n     * This is used when device connects after PCB replacement - MAC changed but device is same\n     * Returns device if found, null otherwise\n     * \n     * Flow:\n     * 1. Find PCB by MAC ID\n     * 2. Find active PCB link for that PCB\n     * 3. Get device ID from link\n     * 4. Return device\n     * \n     * This ensures that when PCB is replaced, we can still find the device using the new MAC ID\n     * and the device keeps its original serial number (reference or printed).\n     */\n    suspend fun getDeviceByMacIdThroughPcbLink(macId: String): Device? {\n        // Find PCB by MAC ID\n        val pcb = database.pcbDao().getByMacId(macId) ?: return null\n        \n        // Find active PCB link for this PCB\n        val activeLink = database.devicePcbLinkDao().getActiveLinkByPcbId(pcb.pcbId) ?: return null\n        \n        // Get device from link\n        return database.deviceDao().getDevice(activeLink.deviceId)\n    }\n\n    suspend fun updateDevice(device: Device) =\n        database.deviceDao().updateDevice(device)\n\n    fun getAllDevices(): Flow<List<Device>> =\n        database.deviceDao().getAllDevices()\n\n    // MAC ID Cache operations\n    fun getMacIdCacheDao() = database.macIdCacheDao()\n    \n    suspend fun getMacBySerial(serialNumber: String) =\n        database.macIdCacheDao().getMacBySerial(serialNumber)\n    \n    suspend fun insertMacId(macIdCache: MacIdCache) =\n        database.macIdCacheDao().insertMacId(macIdCache)\n    \n    suspend fun getLastCacheUpdateTime() =\n        database.macIdCacheDao().getLastUpdateTime()\n    \n    suspend fun getCacheSize() =\n        database.macIdCacheDao().getCacheSize()\n    \n    suspend fun getAllCachedMacIds() =\n        database.macIdCacheDao().getAllCachedEntries()\n    \n    // Driver Pairing Cache operations\n    fun getDriverPairingCacheDao() = database.driverPairingCacheDao()\n\n    // Milestone operations\n    suspend fun getMilestonesForSerial(serialNumber: String) =\n        database.milestoneDao().getMilestonesForSerial(serialNumber)\n\n    suspend fun createNewMilestoneIteration(serialNumber: String): Long {\n        val nextIndex = database.milestoneDao().getMaxIteration(serialNumber) + 1\n        return database.milestoneDao().insert(\n            com.example.fqcapp.data.entities.MilestoneEntry(\n                serialNumber = serialNumber,\n                iterationIndex = nextIndex\n            )\n        )\n    }\n\n    suspend fun upsertMilestone(entry: com.example.fqcapp.data.entities.MilestoneEntry): Long {\n        android.util.Log.d(\"FQCRepository\", \" [UPSERT_MILESTONE] Upserting milestone: id=${entry.id}, serial=${entry.serialNumber}, iteration=${entry.iterationIndex}\")\n        android.util.Log.d(\"FQCRepository\", \" [UPSERT_MILESTONE] Statuses - driver: '${entry.driverInfoStatus}', freq: '${entry.frequencyStatus}', song: '${entry.testSongStatus}', fqc: '${entry.finalQcStatus}'\")\n        val result = database.milestoneDao().insert(entry)\n        android.util.Log.d(\"FQCRepository\", \" [UPSERT_MILESTONE] Insert returned ID: $result\")\n        return result\n    }\n\n    // Unsynced data queries\n    suspend fun getUnsyncedFrequencyTests(serialNumber: String) =\n        database.frequencyTestDao().getUnsyncedFrequencyTests(serialNumber)\n\n    suspend fun getUnsyncedSongTests(serialNumber: String) =\n        database.songTestDao().getUnsyncedSongTests(serialNumber)\n\n    suspend fun getUnsyncedFQCRecords(serialNumber: String) =\n        database.fqcRecordDao().getUnsyncedFQCRecords(serialNumber)\n\n    suspend fun getUnsyncedSessions(serialNumber: String) =\n        database.testSessionDao().getUnsyncedSessions().filter { it.serialNumber == serialNumber }\n\n    suspend fun getDevicesNeedingSync() =\n        database.deviceDao().getDevicesNeedingSync()\n\n    // Get all unsynced records (for testing)\n    suspend fun getAllUnsyncedFrequencyTests() =\n        database.frequencyTestDao().getAllUnsyncedFrequencyTests()\n\n    suspend fun getAllUnsyncedSongTests() =\n        database.songTestDao().getAllUnsyncedSongTests()\n\n    suspend fun getAllUnsyncedFQCRecords() =\n        database.fqcRecordDao().getAllUnsyncedFQCRecords()\n\n    suspend fun getAllUnsyncedSessions() =\n        database.testSessionDao().getUnsyncedSessions()\n\n    // Test Session operations\n    suspend fun insertTestSession(session: TestSession): Long =\n        database.testSessionDao().insertSession(session)\n\n    suspend fun updateTestSession(session: TestSession) =\n        database.testSessionDao().updateSession(session)\n\n    suspend fun updateTestSessionStatus(sessionId: Long, status: String, endTimestamp: String, handedOverTo: String? = null, handedOverAt: String? = null) =\n        database.testSessionDao().updateSessionStatus(sessionId, status, endTimestamp, handedOverTo, handedOverAt)\n\n    suspend fun getTestSessionById(sessionId: Long): TestSession? =\n        database.testSessionDao().getActiveSession(\"\") // This method doesn't exist, using placeholder\n\n    suspend fun getTestSessionsBySerialNumber(serialNumber: String): List<TestSession> =\n        database.testSessionDao().getSessionsForDevice(serialNumber)\n\n    suspend fun getTestSessionsBySerialNumberFlow(serialNumber: String): Flow<List<TestSession>> =\n        flowOf(database.testSessionDao().getSessionsForDevice(serialNumber))\n\n    suspend fun getAllTestSessions(): List<TestSession> =\n        database.testSessionDao().getAllSessions()\n\n    // Mark records as synced\n    suspend fun markFrequencyTestsAsSynced(testIds: List<Long>, timestamp: Long = System.currentTimeMillis()) {\n        testIds.forEach { id ->\n            database.frequencyTestDao().markAsSynced(id, timestamp)\n        }\n    }\n\n    suspend fun markSongTestsAsSynced(testIds: List<Long>, timestamp: Long = System.currentTimeMillis()) {\n        testIds.forEach { id ->\n            database.songTestDao().markAsSynced(id, timestamp)\n        }\n    }\n\n    suspend fun markFQCRecordsAsSynced(fqcIds: List<Long>, timestamp: Long = System.currentTimeMillis()) {\n        fqcIds.forEach { id ->\n            database.fqcRecordDao().markAsSynced(id, timestamp)\n        }\n    }\n\n    suspend fun markTestSessionsAsSynced(sessionIds: List<Long>, timestamp: Long = System.currentTimeMillis()) {\n        sessionIds.forEach { id ->\n            database.testSessionDao().markAsSynced(id, timestamp)\n        }\n    }\n\n    // Additional sync methods for hybrid sync service\n    suspend fun markDeviceAsSynced(serialNumber: String, timestamp: Long = System.currentTimeMillis()) =\n        database.deviceDao().markDeviceAsSynced(serialNumber, timestamp)\n\n    suspend fun markFrequencyTestAsSynced(testId: Long, timestamp: Long = System.currentTimeMillis()) =\n        database.frequencyTestDao().markAsSynced(testId, timestamp)\n\n    suspend fun markSongTestAsSynced(testId: Long, timestamp: Long = System.currentTimeMillis()) =\n        database.songTestDao().markAsSynced(testId, timestamp)\n\n    suspend fun markFQCRecordAsSynced(fqcId: Long, timestamp: Long = System.currentTimeMillis()) =\n        database.fqcRecordDao().markAsSynced(fqcId, timestamp)\n\n    suspend fun markSessionAsSynced(sessionId: Long, timestamp: Long = System.currentTimeMillis()) =\n        database.testSessionDao().markAsSynced(sessionId, timestamp)\n\n    // Delete methods for undo functionality\n    suspend fun deleteFrequencyTest(testId: Long) {\n        database.frequencyTestDao().deleteTest(testId)\n    }\n\n    // Landing Screen Data Methods\n    \n    /**\n     * Get current status data for the landing screen.\n     * Returns latest result for each test stage (Primary/Secondary/Final).\n     */\n    suspend fun getCurrentStatusData(\n        serialNumber: String, \n        macId: String = \"\", \n        deviceName: String? = null,\n        driverPairingCacheManager: com.example.fqcapp.services.DriverPairingCacheManager? = null\n    ): CurrentStatusData {\n        // Reduced logging for performance - only log on first call or errors\n        val stages = listOf(\"Primary Test\", \"Secondary Test\", \"Final Test\")\n        \n        // Get latest driver pairing - check by serial number first, then MAC ID, then device name\n        // #region agent log\n        try {\n            val logFile = java.io.File(\"c:\\\\Users\\\\pc\\\\Desktop\\\\.cursor\\\\debug.log\")\n            // Check what records exist in DB for debugging\n            val allRecords = database.driverPairingRecordDao().getAllDriverPairingRecords()\n            val logEntry = org.json.JSONObject().apply {\n                put(\"sessionId\", \"debug-session\")\n                put(\"runId\", \"run1\")\n                put(\"hypothesisId\", \"A\")\n                put(\"location\", \"FQCRepository.kt:1073\")\n                put(\"message\", \"Checking local DB for driver pairing\")\n                put(\"data\", org.json.JSONObject().apply {\n                    put(\"serialNumber\", serialNumber)\n                    put(\"macId\", macId)\n                    put(\"deviceName\", deviceName ?: \"null\")\n                    put(\"totalRecordsInDB\", allRecords.size)\n                    put(\"sampleRecords\", org.json.JSONArray(allRecords.take(5).map { org.json.JSONObject().apply {\n                        put(\"recordId\", it.recordId.toString())\n                        put(\"serialNumber\", it.serialNumber)\n                        put(\"macId\", it.macId ?: \"null\")\n                        put(\"iterationNumber\", it.iterationNumber.toString())\n                    }}))\n                })\n                put(\"timestamp\", System.currentTimeMillis())\n            }\n            logFile.appendText(logEntry.toString() + \"\\n\")\n        } catch (e: Exception) {}\n        // #endregion\n        var latestDriverPairing = database.driverPairingRecordDao().getLatestDriverPairing(serialNumber)\n        // #region agent log\n        try {\n            val logFile = java.io.File(\"c:\\\\Users\\\\pc\\\\Desktop\\\\.cursor\\\\debug.log\")\n            val logEntry = org.json.JSONObject().apply {\n                put(\"sessionId\", \"debug-session\")\n                put(\"runId\", \"run1\")\n                put(\"hypothesisId\", \"A\")\n                put(\"location\", \"FQCRepository.kt:1073-result\")\n                put(\"message\", \"Local DB query by serial result\")\n                put(\"data\", org.json.JSONObject().apply {\n                    put(\"serialNumber\", serialNumber)\n                    put(\"found\", latestDriverPairing != null)\n                    put(\"recordId\", latestDriverPairing?.recordId?.toString() ?: \"null\")\n                    put(\"iterationNumber\", latestDriverPairing?.iterationNumber?.toString() ?: \"null\")\n                })\n                put(\"timestamp\", System.currentTimeMillis())\n            }\n            logFile.appendText(logEntry.toString() + \"\\n\")\n        } catch (e: Exception) {}\n        // #endregion\n        if (latestDriverPairing == null && macId.isNotBlank()) {\n            val macRecords = database.driverPairingRecordDao().getDriverPairingByMacId(macId)\n            // #region agent log\n            try {\n                val logFile = java.io.File(\"c:\\\\Users\\\\pc\\\\Desktop\\\\.cursor\\\\debug.log\")\n                val logEntry = org.json.JSONObject().apply {\n                    put(\"sessionId\", \"debug-session\")\n                    put(\"runId\", \"run1\")\n                    put(\"hypothesisId\", \"B\")\n                    put(\"location\", \"FQCRepository.kt:1075-result\")\n                    put(\"message\", \"Local DB query by MAC ID result\")\n                    put(\"data\", org.json.JSONObject().apply {\n                        put(\"macId\", macId)\n                        put(\"foundCount\", macRecords.size)\n                        put(\"records\", org.json.JSONArray(macRecords.map { it.recordId.toString() }))\n                    })\n                    put(\"timestamp\", System.currentTimeMillis())\n                }\n                logFile.appendText(logEntry.toString() + \"\\n\")\n            } catch (e: Exception) {}\n            // #endregion\n            latestDriverPairing = macRecords.maxByOrNull { it.iterationNumber }\n        }\n        if (latestDriverPairing == null && deviceName != null && deviceName.isNotBlank()) {\n            latestDriverPairing = database.driverPairingRecordDao().getLatestDriverPairing(deviceName)\n            // #region agent log\n            try {\n                val logFile = java.io.File(\"c:\\\\Users\\\\pc\\\\Desktop\\\\.cursor\\\\debug.log\")\n                val logEntry = org.json.JSONObject().apply {\n                    put(\"sessionId\", \"debug-session\")\n                    put(\"runId\", \"run1\")\n                    put(\"hypothesisId\", \"C\")\n                    put(\"location\", \"FQCRepository.kt:1079-result\")\n                    put(\"message\", \"Local DB query by device name result\")\n                    put(\"data\", org.json.JSONObject().apply {\n                        put(\"deviceName\", deviceName)\n                        put(\"found\", latestDriverPairing != null)\n                    })\n                    put(\"timestamp\", System.currentTimeMillis())\n                }\n                logFile.appendText(logEntry.toString() + \"\\n\")\n            } catch (e: Exception) {}\n            // #endregion\n        }\n        \n        // If still not found in database, check Google Sheets via DriverPairingCacheManager\n        var driverPairingStatus: DriverPairingStatus? = null\n        // #region agent log\n        try {\n            val logFile = java.io.File(\"c:\\\\Users\\\\pc\\\\Desktop\\\\.cursor\\\\debug.log\")\n            val logEntry = org.json.JSONObject().apply {\n                put(\"sessionId\", \"debug-session\")\n                put(\"runId\", \"run1\")\n                put(\"hypothesisId\", \"D\")\n                put(\"location\", \"FQCRepository.kt:1084\")\n                put(\"message\", \"Decision: calling getDriverData\")\n                put(\"data\", org.json.JSONObject().apply {\n                    put(\"latestDriverPairingIsNull\", latestDriverPairing == null)\n                    put(\"driverPairingCacheManagerIsNull\", driverPairingCacheManager == null)\n                    put(\"willCallGetDriverData\", latestDriverPairing == null && driverPairingCacheManager != null)\n                })\n                put(\"timestamp\", System.currentTimeMillis())\n            }\n            logFile.appendText(logEntry.toString() + \"\\n\")\n        } catch (e: Exception) {}\n        // #endregion\n        if (latestDriverPairing == null && driverPairingCacheManager != null) {\n            try {\n                val googleSheetsData = driverPairingCacheManager.getDriverData(serialNumber, macId)\n                if (googleSheetsData != null && googleSheetsData.drivers.isNotEmpty()) {\n                    // Parse the first pair from Google Sheets data\n                    // Google Sheets format: [Driver1_Row1, Driver2_Row1, Driver1_Row2, Driver2_Row2, ...]\n                    if (googleSheetsData.drivers.size >= 2) {\n                        val leftDriver = googleSheetsData.drivers[0]\n                        val rightDriver = googleSheetsData.drivers[1]\n                        driverPairingStatus = DriverPairingStatus(\n                            iterationNumber = 1, // Google Sheets doesn't track iterations, use 1 as default\n                            leftDriver = leftDriver,\n                            rightDriver = rightDriver\n                        )\n                    }\n                }\n            } catch (e: Exception) {\n                android.util.Log.e(\"FQCRepository\", \" Error checking Google Sheets for driver pairing\", e)\n            }\n        }\n        \n        // If found in database, use that instead\n        if (latestDriverPairing != null) {\n            val driverPair = ResultFormatter.parseDriverData(latestDriverPairing.driverData)\n            driverPairingStatus = DriverPairingStatus(\n                iterationNumber = latestDriverPairing.iterationNumber,\n                leftDriver = driverPair?.first ?: \"\",\n                rightDriver = driverPair?.second ?: \"\"\n            )\n        }\n        \n        // Helper function to get stage priority (lower number = lower stage)\n        fun getStagePriority(stage: String): Int {\n            return when (stage) {\n                \"Primary Test\" -> 1\n                \"Secondary Test\" -> 2\n                \"Final Test\" -> 3\n                else -> 0\n            }\n        }\n        \n        // Get latest frequency test for each stage independently (optimized - parallel queries)\n        val frequencyStages = stages.associateWith { stage ->\n            val test = database.frequencyTestDao().getLatestFrequencyTestByStage(serialNumber, stage)\n            val result = test?.result ?: \"\"\n            val color = when (result.uppercase()) {\n                \"PASS\" -> Color(0xFF10B981) // Green\n                \"CAN_BE_PASSED\", \"CAN BE PASSED\", \"CBP\" -> Color(0xFFF59E0B) // Yellow\n                \"FAIL\" -> Color(0xFFEF4444) // Red\n                else -> Color(0xFF9CA3AF) // Gray\n            }\n            StageStatus(\n                stageName = ResultFormatter.getStageDisplayName(stage),\n                result = result,\n                color = color\n            )\n        }\n        \n        // Get latest song test for each stage independently\n        val songStages = stages.associateWith { stage ->\n            val test = database.songTestDao().getLatestSongTestByStage(serialNumber, stage)\n            val result = test?.result ?: \"\"\n            val color = when (result.uppercase()) {\n                \"PASS\" -> Color(0xFF10B981) // Green\n                \"CAN_BE_PASSED\", \"CAN BE PASSED\", \"CBP\" -> Color(0xFFF59E0B) // Yellow\n                \"FAIL\" -> Color(0xFFEF4444) // Red\n                else -> Color(0xFF9CA3AF) // Gray\n            }\n            StageStatus(\n                stageName = ResultFormatter.getStageDisplayName(stage),\n                result = result,\n                color = color\n            )\n        }\n        \n        // Get latest FQC for each stage independently\n        val fqcStages = stages.associateWith { stage ->\n            val record = database.fqcRecordDao().getLatestFQCByStage(serialNumber, stage)\n            val result = record?.overallResult ?: \"\"\n            val color = when (result.uppercase()) {\n                \"PASS\" -> Color(0xFF10B981) // Green\n                \"CAN_BE_PASSED\", \"CAN BE PASSED\", \"CBP\" -> Color(0xFFF59E0B) // Yellow\n                \"FAIL\" -> Color(0xFFEF4444) // Red\n                else -> Color(0xFF9CA3AF) // Gray\n            }\n            StageStatus(\n                stageName = ResultFormatter.getStageDisplayName(stage),\n                result = result,\n                color = color\n            )\n        }\n        \n        return CurrentStatusData(\n            driverPairing = driverPairingStatus,\n            frequencyStages = frequencyStages,\n            songStages = songStages,\n            fqcStages = fqcStages\n        )\n    }\n    \n    /**\n     * Get detailed milestone data for all iterations.\n     * Returns all iterations ordered by iteration number DESC (latest first).\n     */\n    suspend fun getDetailedMilestoneData(serialNumber: String): DetailedMilestoneData {\n        // Reduced logging for performance - only log errors\n        \n        // Get all frequency tests\n        val allFrequencyTests = database.frequencyTestDao().getAllFrequencyTestsBySerial(serialNumber)\n        \n        val frequencyIterations = allFrequencyTests.map { test ->\n            FrequencyIteration(\n                iterationNumber = test.iterationNumber,\n                testStage = test.testStage,\n                result = test.result,\n                solutions = ResultFormatter.parseSolutions(test.solutions),\n                resultText = ResultFormatter.formatFrequencyResult(test)\n            )\n        }\n        \n        // Get all song tests (overall results only)\n        val allSongTests = database.songTestDao().getAllSongTestsBySerial(serialNumber)\n        \n        val songIterations = allSongTests.map { test ->\n            SongIteration(\n                iterationNumber = test.iterationNumber,\n                testStage = test.testStage,\n                result = test.result,\n                solutions = ResultFormatter.parseSolutions(test.solutions),\n                resultText = ResultFormatter.formatSongResult(test)\n            )\n        }\n        \n        // Get all FQC records\n        val allFQCRecords = database.fqcRecordDao().getAllFQCRecordsBySerial(serialNumber)\n        \n        val fqcIterations = allFQCRecords.map { record ->\n            FQCIteration(\n                iterationNumber = record.iterationNumber,\n                testStage = record.testStage,\n                result = record.overallResult,\n                resultText = ResultFormatter.formatFQCResult(record)\n            )\n        }\n        \n        // Get all driver pairing records\n        val allDriverPairingRecords = database.driverPairingRecordDao().getAllDriverPairingBySerial(serialNumber)\n        \n        val driverPairingIterations = allDriverPairingRecords.map { record ->\n            val driverPair = ResultFormatter.parseDriverData(record.driverData)\n            DriverPairingIteration(\n                iterationNumber = record.iterationNumber,\n                leftDriver = driverPair?.first,\n                rightDriver = driverPair?.second,\n                resultText = ResultFormatter.formatDriverPairingResult(driverPair?.first, driverPair?.second)\n            )\n        }\n        \n        // Calculate max iteration across all test types\n        val maxIteration = maxOf(\n            frequencyIterations.maxOfOrNull { it.iterationNumber } ?: 0,\n            songIterations.maxOfOrNull { it.iterationNumber } ?: 0,\n            fqcIterations.maxOfOrNull { it.iterationNumber } ?: 0,\n            driverPairingIterations.maxOfOrNull { it.iterationNumber } ?: 0\n        )\n        \n        return DetailedMilestoneData(\n            driverPairingIterations = driverPairingIterations,\n            frequencyIterations = frequencyIterations,\n            songIterations = songIterations,\n            fqcIterations = fqcIterations,\n            maxIteration = maxIteration\n        )\n    }\n\n    // ============================================\n    // NEW: Core Services for Database Restructure\n    // ============================================\n\n    /**\n     * Create a device case with transaction (enforces one OPEN case per device)\n     */\n    suspend fun createDeviceCase(\n        deviceId: String,\n        caseType: String, // \"NEW_BUILD\" or \"REPAIR_RETURN\"\n        repairType: String? = null, // \"NORMAL_PART\" or \"PCB_REPAIR\" (only for REPAIR_RETURN)\n        receivedFromCustomerRef: String? = null,\n        returnToCustomerRef: String? = null,\n        ownershipTransferred: Boolean = false,\n        operatorName: String,\n        notes: String = \"\"\n    ): DeviceCase {\n        // IMPORTANT: Sync from Supabase first to prevent duplicate cases from multiple devices\n        syncBeforeIteration(deviceId)\n        \n        return database.withTransaction {\n            // Ensure device exists before creating case (FOREIGN KEY constraint)\n            var device = getDeviceBySerialNumber(deviceId)\n            if (device == null) {\n                Log.d(TAG, \" Device not found, creating new device: $deviceId\")\n                // Create device with minimal required fields\n                device = Device(\n                    serialNumber = deviceId,\n                    macId = \"\", // Will be set when PCB is linked\n                    color = \"\", // Can be updated later\n                    createdDate = SerialGenerator.getCurrentTimestamp().split(\" \")[0], // Just date part\n                    finalStatus = \"IN_PROGRESS\",\n                    totalIterations = 0,\n                    totalTimeHours = 0.0,\n                    finalOperator = operatorName,\n                    firstTestDate = \"\", // Empty string instead of null\n                    finalShipDate = \"\", // Empty string instead of null\n                    needsSync = true,\n                    lastSyncTimestamp = 0\n                )\n                insertDevice(device)\n                Log.d(TAG, \" Created device: $deviceId\")\n            }\n            \n            // Check for existing OPEN case (after sync, so we have latest data from all devices)\n            val existingOpenCase = database.deviceCaseDao().getOpenCaseByDevice(deviceId)\n            if (existingOpenCase != null) {\n                Log.w(TAG, \" Device already has an OPEN case: ${existingOpenCase.caseId} (created by another device or previous session)\")\n                throw IllegalStateException(\"Device already has an OPEN case: ${existingOpenCase.caseId}\")\n            }\n\n            // Create new case\n            val newCase = DeviceCase(\n                caseId = UUID.randomUUID().toString(),\n                deviceId = deviceId,\n                caseType = caseType,\n                repairType = repairType,\n                receivedFromCustomerRef = receivedFromCustomerRef,\n                returnToCustomerRef = returnToCustomerRef ?: receivedFromCustomerRef,\n                ownershipTransferred = ownershipTransferred,\n                status = \"OPEN\",\n                resolution = null,\n                openedAt = SerialGenerator.getCurrentTimestamp(),\n                closedAt = null,\n                operatorName = operatorName,\n                notes = notes,\n                needsSync = true,\n                lastSyncTimestamp = 0\n            )\n            database.deviceCaseDao().insert(newCase)\n            Log.d(TAG, \" Created device case: ${newCase.caseId} for device: $deviceId\")\n            newCase\n        }\n    }\n\n    /**\n     * Replace PCB for a device (deactivate old, create new link)\n     */\n    suspend fun replacePcb(\n        deviceId: String,\n        newPcbSerialNumber: String,\n        newMacId: String,\n        operatorName: String,\n        notes: String = \"\"\n    ): DevicePcbLink {\n        return database.withTransaction {\n            val currentTimestamp = SerialGenerator.getCurrentTimestamp()\n\n            // Deactivate old PCB link\n            val oldLink = database.devicePcbLinkDao().getActivePcbLinkByDevice(deviceId)\n            oldLink?.let {\n                database.devicePcbLinkDao().deactivateActiveLinks(deviceId, currentTimestamp)\n                Log.d(TAG, \" Deactivated old PCB link: ${it.linkId}\")\n            }\n\n            // Create/find new PCB\n            val newPcb = database.pcbDao().findOrCreatePcb(newPcbSerialNumber, newMacId, notes)\n\n            // Create new PCB link\n            val newLink = DevicePcbLink(\n                linkId = UUID.randomUUID().toString(),\n                deviceId = deviceId,\n                pcbId = newPcb.pcbId,\n                isActive = true,\n                reason = \"PCB_REPLACED\",\n                linkedAt = currentTimestamp,\n                unlinkedAt = null,\n                operatorName = operatorName,\n                notes = notes,\n                needsSync = true,\n                lastSyncTimestamp = 0\n            )\n            database.devicePcbLinkDao().insert(newLink)\n            Log.d(TAG, \" Created new PCB link: ${newLink.linkId} for device: $deviceId\")\n            newLink\n        }\n    }\n\n    /**\n     * Get or create test configuration\n     */\n    suspend fun getOrCreateConfiguration(\n        deviceId: String,\n        caseId: String,\n        driverPairingRecordId: Long, // Convert to String\n        changedPartsRecordId: Long? = null, // Convert to String\n        testStage: String,\n        operatorName: String,\n        pcbId: String? = null,\n        reason: String? = null\n    ): TestConfiguration {\n        // Convert Long IDs to String\n        val driverPairingRecordIdStr = driverPairingRecordId.toString()\n        val changedPartsRecordIdStr = changedPartsRecordId?.toString()\n\n        // Get current configuration\n        val currentConfig = database.testConfigurationDao().getCurrentConfiguration(deviceId)\n\n        // Check if current config matches (same driver pair, parts, PCB, stage)\n        if (currentConfig != null &&\n            currentConfig.caseId == caseId &&\n            currentConfig.driverPairingRecordId == driverPairingRecordIdStr &&\n            currentConfig.changedPartsRecordId == changedPartsRecordIdStr &&\n            currentConfig.pcbId == pcbId &&\n            currentConfig.testStage == testStage &&\n            currentConfig.endedAt == null\n        ) {\n            Log.d(TAG, \" Using existing configuration: ${currentConfig.configurationId}\")\n            return currentConfig\n        }\n\n        // End previous configuration if exists\n        currentConfig?.let {\n            val timestamp = SerialGenerator.getCurrentTimestamp()\n            database.testConfigurationDao().endConfiguration(\n                it.configurationId,\n                timestamp,\n                reason ?: \"NEW_CONFIGURATION_CREATED\",\n                timestamp\n            )\n            Log.d(TAG, \" Ended previous configuration: ${it.configurationId}\")\n        }\n\n        // Get next iteration number for case + stage\n        val nextIteration = database.testConfigurationDao().getNextIterationNumber(caseId, testStage)\n\n        // Create new configuration\n        val newConfig = TestConfiguration(\n            configurationId = UUID.randomUUID().toString(),\n            caseId = caseId,\n            deviceId = deviceId,\n            pcbId = pcbId,\n            driverPairingRecordId = driverPairingRecordIdStr,\n            changedPartsRecordId = changedPartsRecordIdStr,\n            iterationNumber = nextIteration,\n            testStage = testStage,\n            latestFrequencyResult = null,\n            latestSongResult = null,\n            latestFqcResult = null,\n            configurationStatus = \"IN_PROGRESS\",\n            createdAt = SerialGenerator.getCurrentTimestamp(),\n            lastUpdatedAt = SerialGenerator.getCurrentTimestamp(),\n            endedAt = null,\n            operatorName = operatorName,\n            reason = reason,\n            needsSync = true,\n            lastSyncTimestamp = 0\n        )\n        database.testConfigurationDao().insert(newConfig)\n        Log.d(TAG, \" Created new configuration: ${newConfig.configurationId} for case: $caseId, stage: $testStage, iteration: $nextIteration\")\n        return newConfig\n    }\n\n    /**\n     * Update configuration cache (compute from actual tests)\n     */\n    suspend fun updateConfigurationCache(configurationId: String) {\n        val config = database.testConfigurationDao().getById(configurationId)\n            ?: return\n\n        // Get latest tests for this configuration\n        val latestFreq = database.frequencyTestDao().getLatestByConfiguration(configurationId)\n        val latestSong = database.songTestDao().getLatestByConfiguration(configurationId)\n        val latestFqc = database.fqcRecordDao().getLatestByConfiguration(configurationId)\n\n        // Update cache fields\n        val updatedConfig = config.copy(\n            latestFrequencyResult = latestFreq?.result,\n            latestSongResult = latestSong?.result,\n            latestFqcResult = latestFqc?.overallResult,\n            configurationStatus = computeConfigurationStatus(latestFreq, latestSong, latestFqc),\n            lastUpdatedAt = SerialGenerator.getCurrentTimestamp()\n        )\n\n        database.testConfigurationDao().update(updatedConfig)\n        Log.d(TAG, \" Updated configuration cache: $configurationId\")\n    }\n\n    /**\n     * Compute configuration status from test results\n     */\n    private fun computeConfigurationStatus(\n        latestFreq: FrequencyTest?,\n        latestSong: SongTest?,\n        latestFqc: FQCRecord?\n    ): String {\n        return when {\n            latestFqc != null && latestFqc.overallResult == \"PASS\" -> \"CONFIG_PASSED\"\n            latestFreq != null && latestFreq.result == \"FAIL\" -> \"CONFIG_FAILED\"\n            latestSong != null && latestSong.result == \"FAIL\" -> \"CONFIG_FAILED\"\n            latestFreq != null && latestFreq.result == \"PASS\" &&\n                    latestSong != null && latestSong.result == \"PASS\" -> \"ELIGIBLE_FOR_FQC\"\n            latestFreq != null || latestSong != null -> \"IN_PROGRESS\"\n            else -> \"IN_PROGRESS\"\n        }\n    }\n\n    /**\n     * End a configuration\n     */\n    suspend fun endConfiguration(configurationId: String, reason: String) {\n        val timestamp = SerialGenerator.getCurrentTimestamp()\n        database.testConfigurationDao().endConfiguration(\n            configurationId,\n            timestamp,\n            reason,\n            timestamp\n        )\n        Log.d(TAG, \" Ended configuration: $configurationId, reason: $reason\")\n    }\n\n    /**\n     * Get active PCB link for a device (derives MAC ID)\n     */\n    suspend fun getActivePcbLink(deviceId: String): DevicePcbLink? {\n        return database.devicePcbLinkDao().getActivePcbLinkByDevice(deviceId)\n    }\n\n    /**\n     * Get MAC ID from active PCB link\n     */\n    suspend fun getMacIdFromActivePcb(deviceId: String): String? {\n        val activeLink = getActivePcbLink(deviceId) ?: return null\n        val pcb = database.pcbDao().getById(activeLink.pcbId) ?: return null\n        return pcb.macId\n    }\n\n    /**\n     * Helper function to get or create TestConfiguration for a test\n     * This implements dual-write logic: creates configuration and links test to it\n     */\n    private suspend fun getOrCreateConfigurationForTest(\n        deviceId: String,\n        testStage: String,\n        operatorName: String\n    ): TestConfiguration {\n        // Get or create OPEN case for device (NEW_BUILD if none exists)\n        var deviceCase = database.deviceCaseDao().getOpenCaseByDevice(deviceId)\n        if (deviceCase == null) {\n            // Create NEW_BUILD case if none exists\n            deviceCase = createDeviceCase(\n                deviceId = deviceId,\n                caseType = \"NEW_BUILD\",\n                operatorName = operatorName,\n                notes = \"Auto-created for test\"\n            )\n            Log.d(TAG, \" [DUAL-WRITE] Created NEW_BUILD case: ${deviceCase.caseId}\")\n        }\n\n        // Get active PCB link\n        val activePcbLink = getActivePcbLink(deviceId)\n        val pcbId = activePcbLink?.pcbId\n\n        // Get latest driver pairing record\n        val driverPairingRecords = database.driverPairingRecordDao().getDriverPairingRecords(deviceId)\n        val latestDriverPairing = driverPairingRecords.maxByOrNull { it.recordId }\n        val driverPairingRecordId = latestDriverPairing?.recordId ?: 0L\n\n        // Get latest changed parts record (optional)\n        val changedPartsRecords = database.changedPartsRecordDao().getChangedPartsBySerial(deviceId)\n        val latestChangedParts = changedPartsRecords.maxByOrNull { it.recordId }\n        val changedPartsRecordId = latestChangedParts?.recordId\n\n        // Get or create configuration\n        return getOrCreateConfiguration(\n            deviceId = deviceId,\n            caseId = deviceCase.caseId,\n            driverPairingRecordId = driverPairingRecordId,\n            changedPartsRecordId = changedPartsRecordId,\n            testStage = testStage,\n            operatorName = operatorName,\n            pcbId = pcbId,\n            reason = \"Test creation\"\n        )\n    }\n\n}\n",
        "firstEditBubbleId": "8cf24150-25fd-438d-97b8-557b658cb8de",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ScannerScreen.kt": {
        "content": "package com.example.fqcapp.scanner\n\nimport android.Manifest\nimport android.content.pm.PackageManager\nimport androidx.activity.compose.rememberLauncherForActivityResult\nimport androidx.activity.result.contract.ActivityResultContracts\nimport androidx.camera.camera2.interop.Camera2Interop\nimport androidx.camera.core.*\nimport androidx.camera.lifecycle.ProcessCameraProvider\nimport androidx.camera.view.PreviewView\nimport androidx.compose.foundation.Canvas\nimport androidx.compose.foundation.layout.*\nimport androidx.compose.material.icons.Icons\nimport androidx.compose.material.icons.filled.ArrowBack\nimport androidx.compose.material.icons.filled.FlashOff\nimport androidx.compose.material.icons.filled.FlashOn\nimport androidx.compose.material3.*\nimport androidx.compose.runtime.*\nimport androidx.compose.ui.Alignment\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.geometry.Offset\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.platform.LocalContext\nimport androidx.compose.ui.platform.LocalLifecycleOwner\nimport androidx.compose.ui.text.style.TextAlign\nimport androidx.compose.ui.unit.dp\nimport androidx.compose.ui.unit.sp\nimport androidx.compose.ui.viewinterop.AndroidView\nimport androidx.core.content.ContextCompat\nimport kotlinx.coroutines.delay\nimport com.google.mlkit.vision.barcode.common.Barcode\nimport com.google.mlkit.vision.barcode.BarcodeScanning\nimport com.google.mlkit.vision.common.InputImage\nimport kotlinx.coroutines.launch\nimport kotlin.math.max\nimport com.example.fqcapp.services.GoogleSheetsService\nimport com.example.fqcapp.data.FQCRepository\nimport com.example.fqcapp.data.AppDatabase\nimport android.util.Log\n// Helper function to format MAC ID as XX:XX:XX:XX:XX:XX (for display/confirmation)\nfun formatMacId(input: String): String {\n    // Remove all non-hex characters (colons, spaces, etc.)\n    val cleaned = input.filter { it.isLetterOrDigit() }.uppercase()\n    \n    // Limit to 12 hex characters (6 pairs)\n    val limited = cleaned.take(12)\n    \n    // Format as XX:XX:XX:XX:XX:XX\n    return limited.chunked(2).joinToString(\":\")\n}\n\n\n@OptIn(ExperimentalMaterial3Api::class)\n@Composable\nfun ScannerScreen(\n    serialNumberPrefix: String,\n    onBack: () -> Unit,\n    onScanned: (String, String?) -> Unit,  // Changed to accept optional macIdOverride\n    onMacIdUpdate: ((String) -> Unit)? = null  // Optional callback to update MAC ID (for PCB changes)\n) {\n    val ctx = LocalContext.current\n    val lifecycle = LocalLifecycleOwner.current\n    val scope = rememberCoroutineScope()\n    \n    // Database and services\n    val database = remember { AppDatabase.getDatabase(ctx) }\n    val repository = remember { FQCRepository(database) }\n    val googleSheetsService = remember {\n        GoogleSheetsService(ctx, repository.getMacIdCacheDao())\n    }\n    \n    // Get operator name from preferences\n    val prefsManager = remember { com.example.fqcapp.utils.PreferencesManager(ctx) }\n    val operatorName = remember { prefsManager.getOperatorName() ?: \"Unknown\" }\n\n    // Device type state: \"New\", \"Repair\", \"Rnd\"\n    var deviceType by remember { mutableStateOf(\"New\") } // Default: New Build\n    var previousDeviceType by remember { mutableStateOf(\"New\") }\n    var showDeviceTypeChangeDialog by remember { mutableStateOf(false) }\n    var pendingDeviceType by remember { mutableStateOf<String?>(null) }\n    \n    // Dialog state for scanned result\n    var scannedValue by remember { mutableStateOf<String?>(null) }\n    var showDialog by remember { mutableStateOf(false) }\n    \n    // Repair intake form state\n    var showRepairIntakeForm by remember { mutableStateOf(false) }\n    var repairType by remember { mutableStateOf<String?>(null) } // \"NORMAL_PART\" or \"PCB_REPAIR\"\n    var receivedFromCustomer by remember { mutableStateOf(\"\") }\n    var repairNotes by remember { mutableStateOf(\"\") }\n    \n    // PCB scanning state (for PCB repairs)\n    var showPcbScanScreen by remember { mutableStateOf(false) }\n    var newPcbSerial by remember { mutableStateOf(\"\") }\n    var newPcbMacId by remember { mutableStateOf(\"\") }  // Raw MAC ID (plain text, no colons)\n    var isFetchingMacId by remember { mutableStateOf(false) }\n    var macIdFetchError by remember { mutableStateOf<String?>(null) }\n    var showMacIdConfirmation by remember { mutableStateOf(false) }\n    \n    // Manual entry dialog state - Two-step process\n    var showManualEntry by remember { mutableStateOf(false) }\n    var showColorSelection by remember { mutableStateOf(false) }\n    var selectedColor by remember { mutableStateOf<String?>(null) }\n    var last6Digits by remember { mutableStateOf(\"\") }\n\n    // Permission\n    var permitted by remember {\n        mutableStateOf(\n            ContextCompat.checkSelfPermission(ctx, Manifest.permission.CAMERA)\n                    == PackageManager.PERMISSION_GRANTED\n        )\n    }\n    val permLauncher = rememberLauncherForActivityResult(\n        ActivityResultContracts.RequestPermission()\n    ) { permitted = it }\n    LaunchedEffect(Unit) { if (!permitted) permLauncher.launch(Manifest.permission.CAMERA) }\n\n    // Camera UI state\n    val previewView = remember(ctx) {\n        PreviewView(ctx).apply { implementationMode = PreviewView.ImplementationMode.PERFORMANCE }\n    }\n    var camera by remember { mutableStateOf<Camera?>(null) }\n    var flashAvailable by remember { mutableStateOf(false) }\n    var torchOn by remember { mutableStateOf(false) }\n    var currentZoom by remember { mutableStateOf(0f) } // 0 to 1 (linear zoom)\n\n    // Tiny helper: smooth linear zoom (0f..1f)\n    suspend fun CameraControl.smoothLinearZoom(target: Float) {\n        val info = camera?.cameraInfo ?: return\n        val start = info.zoomState.value?.linearZoom ?: return\n        val dst = target.coerceIn(0f, 1f)\n        repeat(10) { step ->\n            val t = (step + 1) / 10f\n            setLinearZoom(start + (dst - start) * t)\n            delay(12)\n        }\n    }\n\n    Scaffold(\n        topBar = {\n            Column {\n                TopAppBar(\n                    title = { Text(\"Scan\", color = Color.White) },\n                    navigationIcon = {\n                        IconButton(onClick = onBack) {\n                            Icon(Icons.Filled.ArrowBack, contentDescription = \"Back\", tint = Color.White)\n                        }\n                    },\n                    actions = {\n                        IconButton(\n                            onClick = {\n                                torchOn = !torchOn\n                                camera?.cameraControl?.enableTorch(torchOn)\n                            },\n                            enabled = flashAvailable\n                        ) {\n                            Icon(\n                                if (torchOn) Icons.Filled.FlashOn else Icons.Filled.FlashOff,\n                                contentDescription = \"Toggle torch\",\n                                tint = Color.White\n                            )\n                        }\n                    }\n                )\n                // New Build / Repair / R&D Toggle\n                Row(\n                    modifier = Modifier\n                        .fillMaxWidth()\n                        .padding(horizontal = 16.dp, vertical = 8.dp),\n                    horizontalArrangement = Arrangement.spacedBy(8.dp)\n                ) {\n                    Button(\n                        onClick = {\n                            if (deviceType != \"New\") {\n                                pendingDeviceType = \"New\"\n                                showDeviceTypeChangeDialog = true\n                            }\n                        },\n                        modifier = Modifier.weight(1f),\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = if (deviceType == \"New\") Color(0xFF4CAF50) else Color(0xFF424242),\n                            contentColor = Color.White\n                        )\n                    ) {\n                        Text(\"New Build\", fontWeight = androidx.compose.ui.text.font.FontWeight.Bold)\n                    }\n                    Button(\n                        onClick = {\n                            if (deviceType != \"Repair\") {\n                                pendingDeviceType = \"Repair\"\n                                showDeviceTypeChangeDialog = true\n                            }\n                        },\n                        modifier = Modifier.weight(1f),\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = if (deviceType == \"Repair\") Color(0xFFFF9800) else Color(0xFF424242),\n                            contentColor = Color.White\n                        )\n                    ) {\n                        Text(\"Repair\", fontWeight = androidx.compose.ui.text.font.FontWeight.Bold)\n                    }\n                    Button(\n                        onClick = {\n                            if (deviceType != \"Rnd\") {\n                                pendingDeviceType = \"Rnd\"\n                                showDeviceTypeChangeDialog = true\n                            }\n                        },\n                        modifier = Modifier.weight(1f),\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = if (deviceType == \"Rnd\") Color(0xFF9C27B0) else Color(0xFF424242),\n                            contentColor = Color.White\n                        )\n                    ) {\n                        Text(\"R&D\", fontWeight = androidx.compose.ui.text.font.FontWeight.Bold)\n                    }\n                }\n            }\n        }\n    ) { padding ->\n        if (!permitted) {\n            Box(Modifier.fillMaxSize().padding(padding), contentAlignment = Alignment.Center) {\n                Text(\n                    \"Camera permission is required to scan.\",\n                    textAlign = TextAlign.Center,\n                    color = Color.White\n                )\n            }\n            return@Scaffold\n        }\n\n        // Start CameraX\n        LaunchedEffect(permitted) {\n            if (!permitted) return@LaunchedEffect\n            val provider = ProcessCameraProvider.getInstance(ctx).get()\n\n            val preview = Preview.Builder()\n                .apply {\n                    // Helpful defaults via Camera2 interop\n                    Camera2Interop.Extender(this)\n                        .setCaptureRequestOption(\n                            android.hardware.camera2.CaptureRequest.CONTROL_AF_MODE,\n                            android.hardware.camera2.CaptureRequest.CONTROL_AF_MODE_CONTINUOUS_PICTURE\n                        )\n                        .setCaptureRequestOption(\n                            android.hardware.camera2.CaptureRequest.CONTROL_AE_MODE,\n                            android.hardware.camera2.CaptureRequest.CONTROL_AE_MODE_ON\n                        )\n                }\n                .build()\n                .also { it.setSurfaceProvider(previewView.surfaceProvider) }\n\n            val analysis = ImageAnalysis.Builder()\n                .setBackpressureStrategy(ImageAnalysis.STRATEGY_KEEP_ONLY_LATEST)\n                .setOutputImageFormat(ImageAnalysis.OUTPUT_IMAGE_FORMAT_YUV_420_888)\n                .build()\n                .apply {\n                    setAnalyzer(\n                        ContextCompat.getMainExecutor(ctx),\n                        BarcodeAnalyzer { hit: ScanHit ->\n                            val value = hit.text ?: hit.raw\n                            if (!value.isNullOrEmpty() && !showDialog) {\n                                // Auto-zoom if the code is tiny in view (< ~6% of area)\n                                hit.box?.let { b ->\n                                    val w = max(1, previewView.width)\n                                    val h = max(1, previewView.height)\n                                    val areaPct = (b.width().toFloat() * b.height().toFloat()) / (w.toFloat() * h.toFloat())\n                                    if (areaPct < 0.06f) {\n                                        val wantPct = 0.20f\n                                        val factor = (wantPct / areaPct.coerceAtLeast(0.01f)).coerceIn(1f, 8f)\n                                        val cur = camera?.cameraInfo?.zoomState?.value?.linearZoom ?: 0f\n                                        val newZoom = (cur * factor).coerceIn(0f, 1f)\n                                        scope.launch { camera?.cameraControl?.smoothLinearZoom(newZoom) }\n                                    }\n                                }\n                                // Show dialog instead of directly calling onScanned\n                                previewView.post {\n                                    scannedValue = value\n                                    showDialog = true\n                                }\n                            }\n                        }\n                    )\n                }\n\n            provider.unbindAll()\n            camera = provider.bindToLifecycle(lifecycle, CameraSelector.DEFAULT_BACK_CAMERA, preview, analysis)\n            flashAvailable = camera?.cameraInfo?.hasFlashUnit() == true\n        }\n\n        // Preview and reticle overlay\n        Box(Modifier.fillMaxSize().padding(padding)) {\n            AndroidView(factory = { previewView }, modifier = Modifier.fillMaxSize())\n            ReticleOverlay()\n            \n            // Zoom Controls at Bottom\n            Row(\n                modifier = Modifier\n                    .align(Alignment.BottomCenter)\n                    .fillMaxWidth()\n                    .padding(16.dp),\n                horizontalArrangement = Arrangement.spacedBy(8.dp, Alignment.CenterHorizontally)\n            ) {\n                // Zoom In Button\n                Button(\n                    onClick = {\n                        scope.launch {\n                            val newZoom = (currentZoom + 0.2f).coerceIn(0f, 1f)\n                            camera?.cameraControl?.smoothLinearZoom(newZoom)\n                            currentZoom = newZoom\n                        }\n                    },\n                    colors = ButtonDefaults.buttonColors(\n                        containerColor = Color(0xFFFFC107),\n                        contentColor = Color.Black\n                    ),\n                    modifier = Modifier.height(40.dp)\n                ) {\n                    Text(\"Zoom In\", fontWeight = androidx.compose.ui.text.font.FontWeight.Bold, fontSize = 12.sp)\n                }\n                \n                // Zoom Out Button\n                Button(\n                    onClick = {\n                        scope.launch {\n                            val newZoom = (currentZoom - 0.2f).coerceIn(0f, 1f)\n                            camera?.cameraControl?.smoothLinearZoom(newZoom)\n                            currentZoom = newZoom\n                        }\n                    },\n                    colors = ButtonDefaults.buttonColors(\n                        containerColor = Color(0xFFFF9800),\n                        contentColor = Color.Black\n                    ),\n                    modifier = Modifier.height(40.dp)\n                ) {\n                    Text(\"Zoom Out\", fontWeight = androidx.compose.ui.text.font.FontWeight.Bold, fontSize = 12.sp)\n                }\n                \n                // Reset Button\n                Button(\n                    onClick = {\n                        scope.launch {\n                            camera?.cameraControl?.smoothLinearZoom(0f)\n                            currentZoom = 0f\n                        }\n                    },\n                    colors = ButtonDefaults.buttonColors(\n                        containerColor = Color(0xFF424242),\n                        contentColor = Color.White\n                    ),\n                    modifier = Modifier.height(40.dp)\n                ) {\n                    Text(\"Reset\", fontWeight = androidx.compose.ui.text.font.FontWeight.Bold, fontSize = 12.sp)\n                }\n                \n                // Manual Entry Button\n                Button(\n                    onClick = {\n                        last6Digits = \"\"\n                        selectedColor = null\n                        showColorSelection = true\n                    },\n                    colors = ButtonDefaults.buttonColors(\n                        containerColor = Color(0xFF2196F3),\n                        contentColor = Color.White\n                    ),\n                    modifier = Modifier.height(40.dp)\n                ) {\n                    Text(\"Manual\", fontWeight = androidx.compose.ui.text.font.FontWeight.Bold, fontSize = 12.sp)\n                }\n            }\n        }\n\n        // Scan Result Dialog\n        if (showDialog && scannedValue != null) {\n            AlertDialog(\n                onDismissRequest = { },\n                title = {\n                    Text(\n                        \"Scanned Result\",\n                        color = Color(0xFFFFC107),\n                        fontWeight = androidx.compose.ui.text.font.FontWeight.Bold\n                    )\n                },\n                text = {\n                    Column {\n                        Text(\n                            \"Serial Number:\",\n                            style = MaterialTheme.typography.bodySmall,\n                            color = Color.White.copy(alpha = 0.7f)\n                        )\n                        Spacer(modifier = Modifier.height(8.dp))\n                        Text(\n                            scannedValue!!,\n                            style = MaterialTheme.typography.titleMedium,\n                            color = Color.White,\n                            fontWeight = androidx.compose.ui.text.font.FontWeight.SemiBold\n                        )\n                    }\n                },\n                confirmButton = {\n                    Button(\n                        onClick = {\n                            showDialog = false\n                            if (deviceType == \"Repair\") {\n                                // Show repair intake form instead of directly scanning\n                                showRepairIntakeForm = true\n                            } else {\n                                // Normal flow: proceed with scan (New Build or R&D)\n                                onScanned(scannedValue!!, null)\n                            }\n                        },\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = Color(0xFFFFC107),\n                            contentColor = Color.Black\n                        )\n                    ) {\n                        Text(\"OK\")\n                    }\n                },\n                dismissButton = {\n                    OutlinedButton(\n                        onClick = {\n                            showDialog = false\n                            scannedValue = null\n                        },\n                        colors = ButtonDefaults.outlinedButtonColors(\n                            contentColor = Color.White\n                        )\n                    ) {\n                        Text(\"Rescan\")\n                    }\n                },\n                containerColor = Color(0xFF2B2B2B),\n                titleContentColor = Color.White,\n                textContentColor = Color.White\n            )\n        }\n        \n        // Step 1: Color Selection Dialog\n        if (showColorSelection) {\n            AlertDialog(\n                onDismissRequest = { showColorSelection = false },\n                title = {\n                    Text(\n                        \"Select Headphone Color\",\n                        color = Color(0xFFFFC107),\n                        fontWeight = androidx.compose.ui.text.font.FontWeight.Bold\n                    )\n                },\n                text = {\n                    Column(verticalArrangement = Arrangement.spacedBy(12.dp)) {\n                        Text(\n                            \"Choose the headphone color:\",\n                            style = MaterialTheme.typography.bodyMedium,\n                            color = Color.White.copy(alpha = 0.7f)\n                        )\n                        Spacer(modifier = Modifier.height(8.dp))\n                        \n                        // Obsidian Black\n                        OutlinedButton(\n                            onClick = {\n                                selectedColor = \"OB\"\n                                showColorSelection = false\n                                showManualEntry = true\n                            },\n                            modifier = Modifier.fillMaxWidth(),\n                            colors = ButtonDefaults.outlinedButtonColors(\n                                contentColor = Color.White\n                            ),\n                            border = androidx.compose.foundation.BorderStroke(2.dp, Color(0xFF424242))\n                        ) {\n                            Text(\"Obsidian Black (OB)\", modifier = Modifier.padding(vertical = 8.dp))\n                        }\n                        \n                        // Ember Gray\n                        OutlinedButton(\n                            onClick = {\n                                selectedColor = \"EG\"\n                                showColorSelection = false\n                                showManualEntry = true\n                            },\n                            modifier = Modifier.fillMaxWidth(),\n                            colors = ButtonDefaults.outlinedButtonColors(\n                                contentColor = Color.White\n                            ),\n                            border = androidx.compose.foundation.BorderStroke(2.dp, Color(0xFF424242))\n                        ) {\n                            Text(\"Ember Gray (EG)\", modifier = Modifier.padding(vertical = 8.dp))\n                        }\n                        \n                        // Moonstone White\n                        OutlinedButton(\n                            onClick = {\n                                selectedColor = \"MW\"\n                                showColorSelection = false\n                                showManualEntry = true\n                            },\n                            modifier = Modifier.fillMaxWidth(),\n                            colors = ButtonDefaults.outlinedButtonColors(\n                                contentColor = Color.White\n                            ),\n                            border = androidx.compose.foundation.BorderStroke(2.dp, Color(0xFF424242))\n                        ) {\n                            Text(\"Moonstone White (MW)\", modifier = Modifier.padding(vertical = 8.dp))\n                        }\n                    }\n                },\n                confirmButton = {},\n                dismissButton = {\n                    OutlinedButton(\n                        onClick = { showColorSelection = false },\n                        colors = ButtonDefaults.outlinedButtonColors(\n                            contentColor = Color.White\n                        )\n                    ) {\n                        Text(\"Cancel\")\n                    }\n                },\n                containerColor = Color(0xFF2B2B2B),\n                titleContentColor = Color.White,\n                textContentColor = Color.White\n            )\n        }\n        \n        // Step 2: Enter Last 6 Digits Dialog\n        if (showManualEntry && selectedColor != null) {\n            val partialSerial = \"$serialNumberPrefix$selectedColor\"\n            \n            AlertDialog(\n                onDismissRequest = { showManualEntry = false },\n                title = {\n                    Text(\n                        \"Enter Last 6 Digits\",\n                        color = Color(0xFFFFC107),\n                        fontWeight = androidx.compose.ui.text.font.FontWeight.Bold\n                    )\n                },\n                text = {\n                    Column {\n                        Text(\n                            \"60% complete:\",\n                            style = MaterialTheme.typography.bodySmall,\n                            color = Color.White.copy(alpha = 0.5f)\n                        )\n                        Text(\n                            partialSerial,\n                            style = MaterialTheme.typography.titleLarge,\n                            color = Color(0xFFFFC107),\n                            fontWeight = androidx.compose.ui.text.font.FontWeight.Bold\n                        )\n                        Spacer(modifier = Modifier.height(16.dp))\n                        Text(\n                            \"Enter the remaining 6 digits:\",\n                            style = MaterialTheme.typography.bodyMedium,\n                            color = Color.White.copy(alpha = 0.7f)\n                        )\n                        Spacer(modifier = Modifier.height(12.dp))\n                        OutlinedTextField(\n                            value = last6Digits,\n                            onValueChange = { \n                                if (it.length <= 6 && it.all { ch -> ch.isDigit() }) {\n                                    last6Digits = it\n                                }\n                            },\n                            label = { Text(\"Last 6 Digits\") },\n                            placeholder = { Text(\"000000\") },\n                            singleLine = true,\n                            keyboardOptions = androidx.compose.foundation.text.KeyboardOptions(\n                                keyboardType = androidx.compose.ui.text.input.KeyboardType.Number\n                            ),\n                            colors = androidx.compose.material3.OutlinedTextFieldDefaults.colors(\n                                focusedBorderColor = Color(0xFFFFC107),\n                                unfocusedBorderColor = Color(0xFF424242),\n                                focusedLabelColor = Color(0xFFFFC107),\n                                unfocusedLabelColor = Color.White.copy(alpha = 0.6f),\n                                cursorColor = Color(0xFFFFC107),\n                                focusedTextColor = Color.White,\n                                unfocusedTextColor = Color.White\n                            ),\n                            modifier = Modifier.fillMaxWidth()\n                        )\n                        Spacer(modifier = Modifier.height(8.dp))\n                        Text(\n                            \"Complete serial: $partialSerial${last6Digits.padEnd(6, '_')}\",\n                            style = MaterialTheme.typography.bodySmall,\n                            color = if (last6Digits.length == 6) Color(0xFF4CAF50) else Color.White.copy(alpha = 0.5f),\n                            fontWeight = if (last6Digits.length == 6) androidx.compose.ui.text.font.FontWeight.Bold else null\n                        )\n                    }\n                },\n                confirmButton = {\n                    Button(\n                        onClick = {\n                            if (last6Digits.length == 6) {\n                                val fullSerial = \"$partialSerial$last6Digits\"\n                                showManualEntry = false\n                                scannedValue = fullSerial\n                                // Show dialog or repair form based on device type\n                                if (deviceType == \"Repair\") {\n                                    showRepairIntakeForm = true\n                                } else {\n                                    showDialog = true\n                                }\n                            }\n                        },\n                        enabled = last6Digits.length == 6,\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = Color(0xFFFFC107),\n                            contentColor = Color.Black\n                        )\n                    ) {\n                        Text(\"Submit\")\n                    }\n                },\n                dismissButton = {\n                    OutlinedButton(\n                        onClick = {\n                            showManualEntry = false\n                            // Go back to color selection\n                            showColorSelection = true\n                        },\n                        colors = ButtonDefaults.outlinedButtonColors(\n                            contentColor = Color.White\n                        )\n                    ) {\n                        Text(\"Back\")\n                    }\n                },\n                containerColor = Color(0xFF2B2B2B),\n                titleContentColor = Color.White,\n                textContentColor = Color.White\n            )\n        }\n        \n        // Repair Intake Form Dialog\n        if (showRepairIntakeForm && scannedValue != null) {\n            AlertDialog(\n                onDismissRequest = { showRepairIntakeForm = false },\n                title = {\n                    Text(\n                        \"Repair Intake Form\",\n                        color = Color(0xFFFFC107),\n                        fontWeight = androidx.compose.ui.text.font.FontWeight.Bold\n                    )\n                },\n                text = {\n                    Column(\n                        verticalArrangement = Arrangement.spacedBy(16.dp),\n                        modifier = Modifier.fillMaxWidth()\n                    ) {\n                        // Serial Number Display\n                        Text(\n                            \"Serial Number: $scannedValue\",\n                            style = MaterialTheme.typography.bodyMedium,\n                            color = Color.White,\n                            fontWeight = androidx.compose.ui.text.font.FontWeight.SemiBold\n                        )\n                        Divider(color = Color(0xFF424242))\n                        \n                        // Repair Type Selection\n                        Text(\n                            \"Repair Type:\",\n                            style = MaterialTheme.typography.bodyMedium,\n                            color = Color.White.copy(alpha = 0.7f)\n                        )\n                        Row(\n                            horizontalArrangement = Arrangement.spacedBy(12.dp)\n                        ) {\n                            Row(\n                                verticalAlignment = Alignment.CenterVertically,\n                                modifier = Modifier.weight(1f)\n                            ) {\n                                RadioButton(\n                                    selected = repairType == \"NORMAL_PART\",\n                                    onClick = { repairType = \"NORMAL_PART\" },\n                                    colors = RadioButtonDefaults.colors(\n                                        selectedColor = Color(0xFFFFC107)\n                                    )\n                                )\n                                Text(\n                                    \"Normal Part\",\n                                    color = Color.White,\n                                    modifier = Modifier.padding(start = 4.dp)\n                                )\n                            }\n                            Row(\n                                verticalAlignment = Alignment.CenterVertically,\n                                modifier = Modifier.weight(1f)\n                            ) {\n                                RadioButton(\n                                    selected = repairType == \"PCB_REPAIR\",\n                                    onClick = { repairType = \"PCB_REPAIR\" },\n                                    colors = RadioButtonDefaults.colors(\n                                        selectedColor = Color(0xFFFFC107)\n                                    )\n                                )\n                                Text(\n                                    \"PCB Repair\",\n                                    color = Color.White,\n                                    modifier = Modifier.padding(start = 4.dp)\n                                )\n                            }\n                        }\n                        \n                        // Received From\n                        OutlinedTextField(\n                            value = receivedFromCustomer,\n                            onValueChange = { receivedFromCustomer = it },\n                            label = { Text(\"Received From (Customer/CRM ID)\") },\n                            modifier = Modifier.fillMaxWidth(),\n                            singleLine = true,\n                            colors = androidx.compose.material3.OutlinedTextFieldDefaults.colors(\n                                focusedBorderColor = Color(0xFFFFC107),\n                                unfocusedBorderColor = Color(0xFF424242),\n                                focusedLabelColor = Color(0xFFFFC107),\n                                unfocusedLabelColor = Color.White.copy(alpha = 0.6f),\n                                cursorColor = Color(0xFFFFC107),\n                                focusedTextColor = Color.White,\n                                unfocusedTextColor = Color.White\n                            )\n                        )\n                        \n                        // Notes\n                        OutlinedTextField(\n                            value = repairNotes,\n                            onValueChange = { repairNotes = it },\n                            label = { Text(\"Notes\") },\n                            modifier = Modifier.fillMaxWidth(),\n                            maxLines = 3,\n                            colors = androidx.compose.material3.OutlinedTextFieldDefaults.colors(\n                                focusedBorderColor = Color(0xFFFFC107),\n                                unfocusedBorderColor = Color(0xFF424242),\n                                focusedLabelColor = Color(0xFFFFC107),\n                                unfocusedLabelColor = Color.White.copy(alpha = 0.6f),\n                                cursorColor = Color(0xFFFFC107),\n                                focusedTextColor = Color.White,\n                                unfocusedTextColor = Color.White\n                            )\n                        )\n                    }\n                },\n                confirmButton = {\n                    Button(\n                        onClick = {\n                            if (repairType != null && receivedFromCustomer.isNotBlank()) {\n                                if (repairType == \"PCB_REPAIR\") {\n                                    // Create repair case first, then show PCB scanning screen\n                                    scope.launch {\n                                        try {\n                                            val deviceCase = repository.createDeviceCase(\n                                                deviceId = scannedValue!!,\n                                                caseType = \"REPAIR_RETURN\",\n                                                repairType = repairType,\n                                                receivedFromCustomerRef = receivedFromCustomer,\n                                                returnToCustomerRef = receivedFromCustomer, // Always same as received from\n                                                ownershipTransferred = false, // Always false since returnTo = receivedFrom\n                                                operatorName = operatorName,\n                                                notes = repairNotes\n                                            )\n                                            Log.d(\"ScannerScreen\", \" Created repair case for PCB repair: ${deviceCase.caseId}\")\n                                            showRepairIntakeForm = false\n                                            showPcbScanScreen = true\n                                        } catch (e: Exception) {\n                                            Log.e(\"ScannerScreen\", \" Failed to create repair case\", e)\n                                            android.widget.Toast.makeText(ctx, \"Failed to create repair case: ${e.message}\", android.widget.Toast.LENGTH_LONG).show()\n                                        }\n                                    }\n                                } else {\n                                    // Normal part repair - create repair case and proceed\n                                    scope.launch {\n                                        try {\n                                            val deviceCase = repository.createDeviceCase(\n                                                deviceId = scannedValue!!,\n                                                caseType = \"REPAIR_RETURN\",\n                                                repairType = repairType,\n                                                receivedFromCustomerRef = receivedFromCustomer,\n                                                returnToCustomerRef = receivedFromCustomer, // Always same as received from\n                                                ownershipTransferred = false, // Always false since returnTo = receivedFrom\n                                                operatorName = operatorName,\n                                                notes = repairNotes\n                                            )\n                                            Log.d(\"ScannerScreen\", \" Created repair case: ${deviceCase.caseId}\")\n                                            showRepairIntakeForm = false\n                                            onScanned(scannedValue!!, null)\n                                        } catch (e: Exception) {\n                                            Log.e(\"ScannerScreen\", \" Failed to create repair case\", e)\n                                            android.widget.Toast.makeText(ctx, \"Failed to create repair case: ${e.message}\", android.widget.Toast.LENGTH_LONG).show()\n                                        }\n                                    }\n                                }\n                            }\n                        },\n                        enabled = repairType != null && receivedFromCustomer.isNotBlank(),\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = Color(0xFFFFC107),\n                            contentColor = Color.Black\n                        )\n                    ) {\n                        Text(\"Continue\")\n                    }\n                },\n                dismissButton = {\n                    OutlinedButton(\n                        onClick = {\n                            showRepairIntakeForm = false\n                            // Reset form\n                            repairType = null\n                            receivedFromCustomer = \"\"\n                            repairNotes = \"\"\n                        },\n                        colors = ButtonDefaults.outlinedButtonColors(\n                            contentColor = Color.White\n                        )\n                    ) {\n                        Text(\"Cancel\")\n                    }\n                },\n                containerColor = Color(0xFF2B2B2B),\n                titleContentColor = Color.White,\n                textContentColor = Color.White\n            )\n        }\n        \n        // Device Type Change Confirmation Dialog\n        if (showDeviceTypeChangeDialog && pendingDeviceType != null) {\n            val typeDisplayName = when (pendingDeviceType) {\n                \"New\" -> \"New Build\"\n                \"Repair\" -> \"Repair\"\n                \"Rnd\" -> \"R&D\"\n                else -> pendingDeviceType\n            }\n            \n            AlertDialog(\n                onDismissRequest = {\n                    showDeviceTypeChangeDialog = false\n                    pendingDeviceType = null\n                },\n                title = {\n                    Text(\n                        \"Change Device Type\",\n                        color = Color(0xFFFFC107),\n                        fontWeight = androidx.compose.ui.text.font.FontWeight.Bold\n                    )\n                },\n                text = {\n                    Text(\n                        \"Do you want to change the device type to $typeDisplayName?\",\n                        color = Color.White\n                    )\n                },\n                confirmButton = {\n                    Button(\n                        onClick = {\n                            previousDeviceType = deviceType\n                            deviceType = pendingDeviceType!!\n                            showDeviceTypeChangeDialog = false\n                            pendingDeviceType = null\n                        },\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = Color(0xFFFFC107),\n                            contentColor = Color.Black\n                        )\n                    ) {\n                        Text(\"Yes\")\n                    }\n                },\n                dismissButton = {\n                    OutlinedButton(\n                        onClick = {\n                            showDeviceTypeChangeDialog = false\n                            pendingDeviceType = null\n                        },\n                        colors = ButtonDefaults.outlinedButtonColors(\n                            contentColor = Color.White\n                        )\n                    ) {\n                        Text(\"No\")\n                    }\n                },\n                containerColor = Color(0xFF2B2B2B),\n                titleContentColor = Color.White,\n                textContentColor = Color.White\n            )\n        }\n        \n        // PCB Scanning Screen Dialog\n        if (showPcbScanScreen) {\n            // Fetch MAC ID when PCB serial is entered\n            LaunchedEffect(newPcbSerial) {\n                if (newPcbSerial.isNotBlank() && newPcbMacId.isBlank()) {\n                    isFetchingMacId = true\n                    macIdFetchError = null\n                    try {\n                        val fetchedMacId = googleSheetsService.getMacIdBySerialNumber(newPcbSerial)\n                        if (fetchedMacId != null) {\n                            // Store raw MAC ID (without colons) for consistency\n                            // Extract raw MAC ID (remove colons) from fetched MAC ID\n                            newPcbMacId = fetchedMacId.filter { it.isLetterOrDigit() }.uppercase()\n                            Log.d(\"ScannerScreen\", \" Found MAC ID for PCB Serial $newPcbSerial: ${formatMacId(newPcbMacId)}\")\n                        } else {\n                            macIdFetchError = \"MAC ID not found in Google Sheets\"\n                            Log.w(\"ScannerScreen\", \" MAC ID not found for PCB Serial: $newPcbSerial\")\n                        }\n                    } catch (e: Exception) {\n                        macIdFetchError = \"Error fetching MAC ID: ${e.message}\"\n                        Log.e(\"ScannerScreen\", \" Error fetching MAC ID\", e)\n                    } finally {\n                        isFetchingMacId = false\n                    }\n                } else if (newPcbSerial.isBlank()) {\n                    // Clear MAC ID if PCB serial is cleared\n                    newPcbMacId = \"\"\n                    macIdFetchError = null\n                }\n            }\n            \n            AlertDialog(\n                onDismissRequest = { showPcbScanScreen = false },\n                title = {\n                    Text(\n                        \"Scan New PCB\",\n                        color = Color(0xFFFFC107),\n                        fontWeight = androidx.compose.ui.text.font.FontWeight.Bold\n                    )\n                },\n                text = {\n                    Column(\n                        verticalArrangement = Arrangement.spacedBy(16.dp),\n                        modifier = Modifier.fillMaxWidth()\n                    ) {\n                        Text(\n                            \"Device Serial: $scannedValue\",\n                            style = MaterialTheme.typography.bodyMedium,\n                            color = Color.White,\n                            fontWeight = androidx.compose.ui.text.font.FontWeight.SemiBold\n                        )\n                        Divider(color = Color(0xFF424242))\n                        \n                        Text(\n                            \"Enter PCB Serial Number OR MAC ID:\",\n                            style = MaterialTheme.typography.bodyMedium,\n                            color = Color.White.copy(alpha = 0.7f)\n                        )\n                        \n                        // PCB Serial Number Field\n                        OutlinedTextField(\n                            value = newPcbSerial,\n                            onValueChange = { \n                                newPcbSerial = it\n                                // Clear MAC ID when serial changes (will be refetched)\n                                if (it.isBlank()) {\n                                    newPcbMacId = \"\"\n                                }\n                            },\n                            label = { Text(\"PCB Serial Number\") },\n                            modifier = Modifier.fillMaxWidth(),\n                            singleLine = true,\n                            colors = androidx.compose.material3.OutlinedTextFieldDefaults.colors(\n                                focusedBorderColor = Color(0xFFFFC107),\n                                unfocusedBorderColor = Color(0xFF424242),\n                                focusedLabelColor = Color(0xFFFFC107),\n                                unfocusedLabelColor = Color.White.copy(alpha = 0.6f),\n                                cursorColor = Color(0xFFFFC107),\n                                focusedTextColor = Color.White,\n                                unfocusedTextColor = Color.White\n                            )\n                        )\n                        \n                        // MAC ID fetching status\n                        if (isFetchingMacId) {\n                            Text(\n                                \"Fetching MAC ID from Google Sheets...\",\n                                style = MaterialTheme.typography.bodySmall,\n                                color = Color(0xFFFFC107)\n                            )\n                        } else if (macIdFetchError != null && newPcbSerial.isNotBlank()) {\n                            Text(\n                                macIdFetchError!!,\n                                style = MaterialTheme.typography.bodySmall,\n                                color = Color(0xFFFF5252)\n                            )\n                        } else if (newPcbMacId.isNotBlank()) {\n                            Text(\n                                \"MAC ID (from Google Sheets): ${formatMacId(newPcbMacId)}\",\n                                style = MaterialTheme.typography.bodySmall,\n                                color = Color(0xFF4CAF50)\n                            )\n                        }\n                        \n                        Text(\n                            \"OR\",\n                            style = MaterialTheme.typography.bodyMedium,\n                            color = Color.White.copy(alpha = 0.5f),\n                            modifier = Modifier.padding(vertical = 8.dp)\n                        )\n                        \n                        // MAC ID Field (direct entry) - Plain text input, format only for confirmation\n                        OutlinedTextField(\n                            value = newPcbMacId,\n                            onValueChange = { input ->\n                                // Filter to only hex characters, uppercase, limit to 12\n                                val cleaned = input.filter { it.isLetterOrDigit() }.uppercase().take(12)\n                                newPcbMacId = cleaned\n                                Log.d(\"ScannerScreen\", \" [MAC_ID_INPUT] User typed: '$input' -> Cleaned: '$cleaned'\")\n                            },\n                            label = { Text(\"MAC ID (Direct Entry)\") },\n                            modifier = Modifier.fillMaxWidth(),\n                            singleLine = true,\n                            placeholder = { Text(\"Type hex digits (e.g., DC0D300DBE75)\") },\n                            colors = androidx.compose.material3.OutlinedTextFieldDefaults.colors(\n                                focusedBorderColor = Color(0xFFFFC107),\n                                unfocusedBorderColor = Color(0xFF424242),\n                                focusedLabelColor = Color(0xFFFFC107),\n                                unfocusedLabelColor = Color.White.copy(alpha = 0.6f),\n                                cursorColor = Color(0xFFFFC107),\n                                focusedTextColor = Color.White,\n                                unfocusedTextColor = Color.White\n                            )\n                        )\n                        \n                    }\n                },\n                confirmButton = {\n                    Button(\n                        onClick = {\n                            // Either PCB Serial or MAC ID should be provided\n                            if (newPcbSerial.isNotBlank() || newPcbMacId.isNotBlank()) {\n                                // If MAC ID was entered, show confirmation dialog with formatted MAC ID\n                                if (newPcbMacId.isNotBlank()) {\n                                    showMacIdConfirmation = true\n                                } else {\n                                    // Only PCB serial provided (MAC ID fetched from Google Sheets), proceed directly\n                                    val finalMacId = if (newPcbMacId.isNotBlank()) {\n                                        formatMacId(newPcbMacId)\n                                    } else {\n                                        \"\"\n                                    }\n                                    \n                                    // Update MAC ID if callback is provided (for PCB changes)\n                                    if (finalMacId.isNotBlank() && onMacIdUpdate != null) {\n                                        Log.d(\"ScannerScreen\", \" [PCB_CHANGE] Updating MAC ID to: $finalMacId\")\n                                        onMacIdUpdate(finalMacId)\n                                    }\n                                    \n                                    // TODO: Replace PCB logic here (create PCB link, deactivate old one, etc.)\n                                    // Proceed with scan\n                                    showPcbScanScreen = false\n                                    onScanned(scannedValue!!, null)\n                                }\n                            }\n                        },\n                        enabled = newPcbSerial.isNotBlank() || newPcbMacId.isNotBlank(),\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = Color(0xFFFFC107),\n                            contentColor = Color.Black\n                        )\n                    ) {\n                        Text(\"Confirm Replace PCB\")\n                    }\n                },\n                dismissButton = {\n                    OutlinedButton(\n                        onClick = {\n                            showPcbScanScreen = false\n                            newPcbSerial = \"\"\n                            newPcbMacId = \"\"\n                            isFetchingMacId = false\n                            macIdFetchError = null\n                        },\n                        colors = ButtonDefaults.outlinedButtonColors(\n                            contentColor = Color.White\n                        )\n                    ) {\n                        Text(\"Cancel\")\n                    }\n                },\n                containerColor = Color(0xFF2B2B2B),\n                titleContentColor = Color.White,\n                textContentColor = Color.White\n            )\n        }\n        \n        // MAC ID Confirmation Dialog (shows formatted MAC ID before submitting)\n        if (showMacIdConfirmation && newPcbMacId.isNotBlank()) {\n            val formattedMacId = formatMacId(newPcbMacId)\n            \n            AlertDialog(\n                onDismissRequest = { showMacIdConfirmation = false },\n                title = {\n                    Text(\n                        \"Confirm MAC ID\",\n                        color = Color(0xFFFFC107),\n                        fontWeight = androidx.compose.ui.text.font.FontWeight.Bold\n                    )\n                },\n                text = {\n                    Column(verticalArrangement = Arrangement.spacedBy(12.dp)) {\n                        Text(\n                            \"Please verify the MAC ID:\",\n                            style = MaterialTheme.typography.bodyMedium,\n                            color = Color.White.copy(alpha = 0.7f)\n                        )\n                        Text(\n                            formattedMacId,\n                            style = MaterialTheme.typography.titleLarge,\n                            color = Color(0xFFFFC107),\n                            fontWeight = androidx.compose.ui.text.font.FontWeight.Bold,\n                            modifier = Modifier.padding(vertical = 8.dp)\n                        )\n                        Text(\n                            \"Raw input: $newPcbMacId\",\n                            style = MaterialTheme.typography.bodySmall,\n                            color = Color.White.copy(alpha = 0.5f)\n                        )\n                    }\n                },\n                confirmButton = {\n                    Button(\n                        onClick = {\n                            // Replace PCB using backend service\n                            scope.launch {\n                                try {\n                                    val finalMacId = formattedMacId\n                                    val pcbSerial = if (newPcbSerial.isNotBlank()) newPcbSerial else \"UNKNOWN\"\n                                    \n                                    val pcbLink = repository.replacePcb(\n                                        deviceId = scannedValue!!,\n                                        newPcbSerialNumber = pcbSerial,\n                                        newMacId = finalMacId,\n                                        operatorName = operatorName,\n                                        notes = \"PCB replaced via Scanner Screen (Repair flow)\"\n                                    )\n                                    \n                                    Log.d(\"ScannerScreen\", \" PCB replaced successfully, linkId: ${pcbLink.linkId}\")\n                                    \n                                    // Update MAC ID if callback is provided (for Navigation)\n                                    if (onMacIdUpdate != null) {\n                                        Log.d(\"ScannerScreen\", \" [PCB_CHANGE] Updating MAC ID to: $finalMacId\")\n                                        onMacIdUpdate(finalMacId)\n                                    }\n                                    \n                                    // Proceed with scan, passing MAC ID override\n                                    showMacIdConfirmation = false\n                                    showPcbScanScreen = false\n                                    onScanned(scannedValue!!, finalMacId)\n                                } catch (e: Exception) {\n                                    Log.e(\"ScannerScreen\", \" Failed to replace PCB\", e)\n                                    android.widget.Toast.makeText(ctx, \"Failed to replace PCB: ${e.message}\", android.widget.Toast.LENGTH_LONG).show()\n                                }\n                            }\n                        },\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = Color(0xFFFFC107),\n                            contentColor = Color.Black\n                        )\n                    ) {\n                        Text(\"Confirm\")\n                    }\n                },\n                dismissButton = {\n                    OutlinedButton(\n                        onClick = { showMacIdConfirmation = false },\n                        colors = ButtonDefaults.outlinedButtonColors(\n                            contentColor = Color.White\n                        )\n                    ) {\n                        Text(\"Edit\")\n                    }\n                },\n                containerColor = Color(0xFF2B2B2B),\n                titleContentColor = Color.White,\n                textContentColor = Color.White\n            )\n        }\n    }\n}\n\n@Composable\nprivate fun ReticleOverlay(modifier: Modifier = Modifier) {\n    Canvas(\n        modifier = modifier\n            .fillMaxSize()\n            .padding(24.dp)\n    ) {\n        val boxW = size.minDimension * 0.6f\n        val left = (size.width - boxW) / 2f\n        val top = (size.height - boxW) / 2f\n        val right = left + boxW\n        val bottom = top + boxW\n        val l = boxW * 0.15f\n        val stroke = 6.dp.toPx()\n        // corners\n        drawLine(Color.White, Offset(left, top), Offset(left + l, top), stroke)\n        drawLine(Color.White, Offset(left, top), Offset(left, top + l), stroke)\n        drawLine(Color.White, Offset(right, top), Offset(right - l, top), stroke)\n        drawLine(Color.White, Offset(right, top), Offset(right, top + l), stroke)\n        drawLine(Color.White, Offset(left, bottom), Offset(left + l, bottom), stroke)\n        drawLine(Color.White, Offset(left, bottom), Offset(left, bottom - l), stroke)\n        drawLine(Color.White, Offset(right, bottom), Offset(right - l, bottom), stroke)\n        drawLine(Color.White, Offset(right, bottom), Offset(right, bottom - l), stroke)\n    }\n}\n",
        "firstEditBubbleId": "1c5524ff-22c8-4aef-af09-e634a8563953",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/IMPLEMENTATION_PROGRESS.md": {
        "content": "",
        "firstEditBubbleId": "1bdaa99d-dd33-401c-a61a-262cf0dcbf4b",
        "isNewlyCreated": true,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt": {
        "content": "package com.example.fqcapp\n\nimport android.media.AudioFormat\nimport android.media.AudioManager\nimport android.media.AudioTrack\nimport android.media.AudioFocusRequest\nimport android.os.Build\nimport android.util.Log\nimport androidx.compose.animation.core.*\nimport androidx.compose.foundation.Canvas\nimport androidx.compose.foundation.ExperimentalFoundationApi\nimport androidx.compose.foundation.clickable\nimport androidx.compose.foundation.combinedClickable\nimport androidx.compose.foundation.gestures.detectTapGestures\nimport androidx.compose.foundation.layout.*\nimport androidx.compose.foundation.rememberScrollState\nimport androidx.compose.foundation.shape.RoundedCornerShape\nimport androidx.compose.foundation.text.KeyboardOptions\nimport androidx.compose.foundation.verticalScroll\nimport androidx.compose.ui.input.pointer.pointerInput\nimport androidx.compose.material.icons.Icons\nimport androidx.compose.material.icons.filled.*\nimport androidx.compose.material3.*\nimport androidx.compose.runtime.*\nimport androidx.compose.runtime.saveable.rememberSaveable\nimport androidx.compose.runtime.DisposableEffect\nimport androidx.compose.ui.Alignment\nimport androidx.compose.ui.window.DialogProperties\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.graphics.Path\nimport androidx.compose.ui.graphics.StrokeCap\nimport androidx.compose.ui.graphics.drawscope.Stroke\nimport androidx.compose.ui.text.font.FontWeight\nimport androidx.compose.ui.text.input.KeyboardType\nimport androidx.compose.ui.text.style.TextAlign\nimport androidx.compose.ui.unit.dp\nimport androidx.compose.ui.unit.sp\nimport com.example.fqcapp.data.FQCRepository\nimport com.example.fqcapp.data.AppDatabase\nimport com.example.fqcapp.data.entities.FrequencyTest\nimport com.example.fqcapp.utils.getResponsivePadding\nimport com.example.fqcapp.utils.getResponsiveSpacing\nimport com.example.fqcapp.utils.getResponsiveTextSize\nimport com.example.fqcapp.utils.getResponsiveButtonSize\nimport com.example.fqcapp.utils.getResponsiveTextFieldHeight\nimport com.example.fqcapp.utils.getResponsiveIconSize\nimport com.example.fqcapp.utils.getResponsiveCardPadding\nimport com.example.fqcapp.utils.getResponsiveMaxWidth\nimport com.example.fqcapp.utils.getScreenInfo\nimport com.example.fqcapp.data.TestType\nimport com.example.fqcapp.data.TestOutcome\nimport com.example.fqcapp.data.TestResult\nimport kotlinx.coroutines.Dispatchers\nimport androidx.compose.runtime.collectAsState\nimport kotlinx.coroutines.delay\nimport kotlinx.coroutines.isActive\nimport kotlinx.coroutines.launch\nimport kotlinx.coroutines.withContext\nimport kotlin.math.PI\nimport kotlin.math.sin\nimport kotlin.math.roundToInt\nimport com.example.fqcapp.core.SessionManager\nimport com.example.fqcapp.core.ReviewValidator\nimport com.example.fqcapp.core.UndoManager\nimport com.example.fqcapp.ui.ReviewScreenContainer\nimport org.json.JSONArray\n\n// Review Log Data Class\ndata class ReviewLog(\n    val serialNumber: String?,\n    val type: String,             // \"frequency\"\n    val result: String,           // \"pass\" | \"fail\"\n    val issues: List<String>,\n    val remark: String,\n    val solutions: List<String>,\n    val otherSolution: String,\n    val timestamp: Long = System.currentTimeMillis()\n)\n\n@OptIn(ExperimentalMaterial3Api::class)\n@Composable\nfun FrequencyGeneratorScreen(\n    currentSessionId: Long?,\n    repository: FQCRepository,\n    initialSerialNumber: String? = null, // Add serial number parameter (renamed to avoid conflict)\n    authenticatedOperator: com.example.fqcapp.data.entities.OperatorCredential? = null,\n    connectedDeviceName: String? = null, // Device name from Bluetooth connection\n    longPressSpeed: Int = 10,\n    onBack: (() -> Unit)? = null,\n    onNavigateToLanding: (() -> Unit)? = null,\n    onNavigateToFreqGen: (() -> Unit)? = null,\n    undoManager: UndoManager = UndoManager(),\n    solutionReminderManager: com.example.fqcapp.core.SolutionReminderManager? = null\n) {\n    val context = androidx.compose.ui.platform.LocalContext.current\n    val prefs = remember { \n        context.getSharedPreferences(\"frequency_generator_prefs\", android.content.Context.MODE_PRIVATE) \n    }\n    val scope = rememberCoroutineScope()\n    val snackbarHostState = remember { SnackbarHostState() }\n    val onBackPressedDispatcher = androidx.activity.compose.LocalOnBackPressedDispatcherOwner.current?.onBackPressedDispatcher\n    \n    // Session tracking\n    var currentTestSessionId by remember { mutableStateOf<Long?>(null) }\n    var sessionStartTime by remember { mutableStateOf<Long?>(null) }\n    \n    // Session management\n    val sessionManager = remember { SessionManager(context) }\n    val reviewValidator = remember { ReviewValidator() }\n    val sessionTimestampManager = remember { com.example.fqcapp.core.SessionTimestampManager(context) }\n    \n    // Review screen state\n    var showReview by remember { mutableStateOf(false) }\n    var previousTestResult by remember { mutableStateOf<com.example.fqcapp.data.TestResult?>(null) }\n    // Navigation state machine: track where we are and where we should go\n    var isFromUndo by remember { mutableStateOf(false) } // True if we're restoring from undo\n    var shouldNavigateToLanding by remember { mutableStateOf(false) } // True if after submit we should go to landing\n    var isSubmitting by remember { mutableStateOf(false) } // Guard to prevent duplicate submissions\n    // Note: shouldShowReviewAfterUndo is declared in LaunchedEffect section below\n    var lastSubmittedTestId by remember { mutableStateOf<Long?>(null) }\n    // Use parameter as initial value, fallback to device name, then null\n    var currentSerialNumber by remember { mutableStateOf<String?>(initialSerialNumber ?: connectedDeviceName) }\n    var operatorName by remember { mutableStateOf(\"Unknown\") }\n    var operatorId by remember { mutableStateOf(\"\") }\n    \n    // Use authenticated operator if provided\n    LaunchedEffect(authenticatedOperator) {\n        if (authenticatedOperator != null) {\n            operatorName = authenticatedOperator.operatorName\n            operatorId = authenticatedOperator.operatorId\n            android.util.Log.d(\"FrequencyGenerator\", \" Using authenticated operator: $operatorName (ID: $operatorId)\")\n        } else {\n            val prefsManager = com.example.fqcapp.utils.PreferencesManager(context)\n            operatorName = prefsManager.getOperatorName() ?: \"Unknown\"\n            android.util.Log.d(\"FrequencyGenerator\", \" No authenticated operator, using preferences: $operatorName\")\n        }\n    }\n    \n    // Debug log state\n    var debugLogs by remember { mutableStateOf<List<String>>(emptyList()) }\n    \n    // Session handover notification\n    val sessionHandover by sessionManager.sessionHandover.collectAsState()\n    \n    // Device Workflow Service\n    val workflowService = remember { com.example.fqcapp.services.DeviceWorkflowService(repository) }\n    \n    // UI Colors\n    val accentColor = Color(0xFFFFC107)\n    val bgColor = Color(0xFF212121)\n    val surfaceColor = Color(0xFF2B2B2B)\n    \n    // Log workflow: Frequency Test STARTED when screen opens\n    // Delayed and non-blocking - runs in background after screen loads\n    // Use a Mutex to prevent race conditions and duplicate calls\n    val workflowKey = remember(currentSerialNumber, operatorName) { \n        \"$currentSerialNumber-$operatorName\" \n    }\n    val workflowMutex = remember { kotlinx.coroutines.sync.Mutex() }\n    var workflowLogged by remember(workflowKey) { mutableStateOf(false) }\n    \n    LaunchedEffect(workflowKey) {\n        // Only log workflow if we have a valid serial number (not device name) and haven't logged yet\n        // Use Mutex to ensure atomic check-and-set operation\n        val shouldLog = workflowMutex.withLock {\n            if (workflowLogged) {\n                false // Already logged\n            } else if (currentSerialNumber != null && \n                currentSerialNumber!!.isNotBlank() && \n                operatorName != \"Unknown\" &&\n                !currentSerialNumber!!.matches(Regex(\"^BT-.*\", RegexOption.IGNORE_CASE)) && // Not a device name\n                !currentSerialNumber!!.matches(Regex(\"^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$\")) && // Not a MAC address\n                currentSerialNumber!!.length >= 10) { // Serial numbers are typically 10+ chars\n                workflowLogged = true // Mark as logged atomically\n                true\n            } else {\n                false\n            }\n        }\n        \n        if (shouldLog) {\n            // Delay workflow logging to avoid blocking screen load\n            scope.launch(Dispatchers.IO) {\n                try {\n                    delay(500) // Small delay to let screen render first\n                    val iterationNumber = workflowService.getNextIterationNumber(\n                        currentSerialNumber!!,\n                        com.example.fqcapp.services.DeviceWorkflowService.STAGE_FREQUENCY_TEST\n                    )\n                    workflowService.logWorkflow(\n                        serialNumber = currentSerialNumber!!,\n                        stage = com.example.fqcapp.services.DeviceWorkflowService.STAGE_FREQUENCY_TEST,\n                        operatorName = operatorName,\n                        action = com.example.fqcapp.services.DeviceWorkflowService.ACTION_STARTED,\n                        iterationNumber = iterationNumber\n                    )\n                    android.util.Log.d(\"FrequencyGenerator\", \" [WORKFLOW] Logged FREQUENCY_TEST STARTED (background)\")\n                } catch (e: kotlinx.coroutines.CancellationException) {\n                    // Ignore cancellation exceptions (screen left composition)\n                    android.util.Log.d(\"FrequencyGenerator\", \" [WORKFLOW] Workflow logging cancelled (screen left)\")\n                } catch (e: Exception) {\n                    android.util.Log.e(\"FrequencyGenerator\", \" [WORKFLOW] Error logging workflow STARTED\", e)\n                }\n            }\n        } else if (currentSerialNumber != null && currentSerialNumber!!.isNotBlank() && !workflowLogged) {\n            android.util.Log.w(\"FrequencyGenerator\", \" Skipping workflow log - invalid serial number format: '${currentSerialNumber}'\")\n        }\n    }\n\n    // State - Load from SharedPreferences\n    var currentFreq by rememberSaveable { mutableStateOf(prefs.getFloat(\"current_freq\", 100f)) }\n    var startFreq by rememberSaveable { mutableStateOf(prefs.getFloat(\"start_freq\", 20f)) }\n    var endFreq by rememberSaveable { mutableStateOf(prefs.getFloat(\"end_freq\", 120f)) }\n    var duration by rememberSaveable { mutableStateOf(prefs.getFloat(\"duration\", 0.1f)) }\n    var loop by rememberSaveable { mutableStateOf(prefs.getBoolean(\"loop\", false)) }\n    // Separate left and right channel volumes (0-100, representing 0-100%)\n    var leftVolume by rememberSaveable { mutableStateOf(prefs.getInt(\"left_volume\", 100)) }\n    var rightVolume by rememberSaveable { mutableStateOf(prefs.getInt(\"right_volume\", 100)) }\n    var playingSingle by remember { mutableStateOf(false) } // Single frequency mode\n    var playingSweep by remember { mutableStateOf(false) }  // Sweep mode\n    var showFreqDialog by remember { mutableStateOf(false) }\n    \n    // Real-time gain values for visual feedback\n    var actualLeftGain by remember { mutableStateOf(0.0f) }\n    var actualRightGain by remember { mutableStateOf(0.0f) }\n    var systemVolumeInfo by remember { mutableStateOf(\"\") }\n    \n    // Channel test mode\n    var channelTestMode by remember { mutableStateOf(false) }\n    \n    // Audio focus management\n    var currentAudioFocusRequest by remember { mutableStateOf<AudioFocusRequest?>(null) }\n    var hasAudioFocus by remember { mutableStateOf(false) }\n    \n    // Text input state variables for better text field handling\n    var startFreqText by remember { mutableStateOf(startFreq.toInt().toString()) }\n    var endFreqText by remember { mutableStateOf(endFreq.toInt().toString()) }\n    var durationText by remember { mutableStateOf(duration.toString()) }\n    var loopSweep by remember { mutableStateOf(loop) }\n    \n    // Sync text variables with numeric variables\n    LaunchedEffect(startFreq) {\n        startFreqText = startFreq.toInt().toString()\n    }\n    LaunchedEffect(endFreq) {\n        endFreqText = endFreq.toInt().toString()\n    }\n    LaunchedEffect(duration) {\n        durationText = duration.toString()\n    }\n    LaunchedEffect(loop) {\n        loopSweep = loop\n    }\n    \n    // Save settings whenever they change\n    LaunchedEffect(currentFreq) {\n        prefs.edit().putFloat(\"current_freq\", currentFreq).apply()\n    }\n    LaunchedEffect(startFreq) {\n        prefs.edit().putFloat(\"start_freq\", startFreq).apply()\n    }\n    LaunchedEffect(endFreq) {\n        prefs.edit().putFloat(\"end_freq\", endFreq).apply()\n    }\n    LaunchedEffect(duration) {\n        prefs.edit().putFloat(\"duration\", duration).apply()\n    }\n    LaunchedEffect(loop) {\n        prefs.edit().putBoolean(\"loop\", loop).apply()\n    }\n    LaunchedEffect(leftVolume) {\n        prefs.edit().putInt(\"left_volume\", leftVolume).apply()\n    }\n    LaunchedEffect(rightVolume) {\n        prefs.edit().putInt(\"right_volume\", rightVolume).apply()\n    }\n    \n    // Long press state for fast increment/decrement\n    var isHoldingPlus by remember { mutableStateOf(false) }\n    var isHoldingMinus by remember { mutableStateOf(false) }\n    \n    // Fast increment/decrement on hold\n    LaunchedEffect(isHoldingPlus) {\n        if (isHoldingPlus) {\n            delay(300) // Initial delay before fast increment starts\n            while (isActive && isHoldingPlus) {\n                currentFreq = (currentFreq + 5f).coerceAtMost(20000f)\n                delay(50) // Fast increment every 50ms\n            }\n        }\n    }\n    \n    LaunchedEffect(isHoldingMinus) {\n        if (isHoldingMinus) {\n            delay(300) // Initial delay before fast decrement starts\n            while (isActive && isHoldingMinus) {\n                currentFreq = (currentFreq - 5f).coerceAtLeast(1f)\n                delay(50) // Fast decrement every 50ms\n            }\n        }\n    }\n\n    // Review state\n    var showFailDialog by remember { mutableStateOf(false) }    // Dialog B\n    var showSolutionsDialog by remember { mutableStateOf(false) } // Dialog C\n    var selectedIssues by remember { mutableStateOf(setOf<String>()) }\n    \n    // Handle system back navigation (gesture and button)\n    androidx.compose.runtime.DisposableEffect(Unit) {\n        val callback = object : androidx.activity.OnBackPressedCallback(true) {\n            override fun handleOnBackPressed() {\n                android.util.Log.d(\"FrequencyGenerator\", \"System back navigation - showing review dialog\")\n                showReview = true\n            }\n        }\n        onBackPressedDispatcher?.addCallback(callback)\n        onDispose { callback.remove() }\n    }\n    var selectedSolutions by remember { mutableStateOf(setOf<String>()) }\n    var remark by remember { mutableStateOf(\"\") }\n    var otherSolution by remember { mutableStateOf(\"\") }\n    var reviewLogs by rememberSaveable { mutableStateOf(listOf<ReviewLog>()) }\n    \n    // Session count tracking\n    var sessionCount by remember { mutableStateOf(0) }\n    \n    // Serial number from session (would be passed from navigation in real app)\n    val serialNumber = \"TEST-SERIAL-001\" // TODO: Get from navigation or session\n\n    // Audio track reference\n    var audioJob by remember { mutableStateOf<kotlinx.coroutines.Job?>(null) }\n    var currentAudioTrack by remember { mutableStateOf<AudioTrack?>(null) }\n    \n    \n    // Hardcoded issues and solutions\n    val issueOptions = listOf(\n        \"Right to left shift\",\n        \"Left to right shift\", \n        \"Right Dominant\",\n        \"Left Dominant\",\n        \"Right chir\",\n        \"Left chir\",\n        \"Wire noise\",\n        \"Battery noise\",\n        \"U clamp issue\",\n        \"Sorbathane issue\",\n        \"High pressure\"\n    )\n    \n    val availableSolutions = listOf(\n        \"INTERCHANGE\",\n        \"DRIVER CHANGE\",\n        \"Replace BC Driver\",\n        \"Replace AC Driver\",\n        \"2dB programm\",\n        \"Headband Replace\"\n    )\n    \n    // Function to log review results and complete session\n    fun logReview(reviewLog: ReviewLog) {\n        android.util.Log.d(\"FrequencyGenerator\", \" logReview called with result: ${reviewLog.result}\")\n        \n        // Skip recording if \"Test not done\" - this is not a valid test session\n        if (reviewLog.result == \"test_not_done\") {\n            android.util.Log.d(\"FrequencyGenerator\", \"Test not done - skipping session recording\")\n            return\n        }\n        \n        scope.launch {\n            try {\n                // Get current session info\n                val session = currentTestSessionId?.let { repository.getTestSessionById(it) }\n                val serialNumber = reviewLog.serialNumber ?: \"PLACEHOLDER\"\n                val operatorName = session?.operatorName ?: \"Unknown\"\n                \n                android.util.Log.d(\"FrequencyGenerator\", \"Session info - ID: $currentTestSessionId, Serial: $serialNumber, Operator: $operatorName\")\n                \n                // Calculate timing\n                val endTime = System.currentTimeMillis()\n                val startTime = sessionStartTime ?: endTime\n                val durationMs = endTime - startTime\n                val durationHours = durationMs / (1000 * 60 * 60)\n                val durationMinutes = (durationMs % (1000 * 60 * 60)) / (1000 * 60)\n                val durationSeconds = (durationMs % (1000 * 60)) / 1000\n                val durationFormatted = String.format(\"%d:%02d:%02d\", durationHours, durationMinutes, durationSeconds)\n                \n                android.util.Log.d(\"FrequencyGenerator\", \"Duration calculation: ${durationMs}ms = $durationFormatted\")\n                \n                val startTimeFormatted = java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.getDefault()).format(java.util.Date(startTime))\n                val endTimeFormatted = java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.getDefault()).format(java.util.Date(endTime))\n                \n                android.util.Log.d(\"FrequencyGenerator\", \"Frequency test ended at: $endTimeFormatted\")\n                android.util.Log.d(\"FrequencyGenerator\", \"Duration: $durationFormatted\")\n                \n                // Get iteration number from Supabase\n                android.util.Log.d(\"FrequencyGenerator\", \"\")\n                android.util.Log.d(\"FrequencyGenerator\", \" [FREQUENCY TEST] PREPARING TO SAVE TEST\")\n                android.util.Log.d(\"FrequencyGenerator\", \"   Serial Number: $serialNumber\")\n                android.util.Log.d(\"FrequencyGenerator\", \"   Operator: $operatorName\")\n                android.util.Log.d(\"FrequencyGenerator\", \"   Result: ${reviewLog.result}\")\n                android.util.Log.d(\"FrequencyGenerator\", \"\")\n                \n                android.util.Log.d(\"FrequencyGenerator\", \" [ACTION] Getting next iteration number from Supabase...\")\n                val iterationNumber = try {\n                    if (serialNumber.isNotBlank()) {\n                        val workflowService = com.example.fqcapp.services.DeviceWorkflowService(repository)\n                        workflowService.getNextFrequencyTestIteration(serialNumber)\n                    } else {\n                        android.util.Log.w(\"FrequencyGenerator\", \"    Serial number is blank, using default iteration 1\")\n                        1\n                    }\n                } catch (e: Exception) {\n                    android.util.Log.e(\"FrequencyGenerator\", \"    [ERROR] Error getting iteration number from Supabase: ${e.message}\")\n                    android.util.Log.e(\"FrequencyGenerator\", \"   Stack trace: ${e.stackTraceToString()}\")\n                    android.util.Log.w(\"FrequencyGenerator\", \"    Falling back to iteration 1\")\n                    1\n                }\n                \n                android.util.Log.d(\"FrequencyGenerator\", \"    Next iteration: $iterationNumber\")\n                \n                // Get session entry timestamp (ISO8601 format)\n                android.util.Log.d(\"FrequencyGenerator\", \" [ACTION] Getting session entry timestamp...\")\n                val sessionEntryTimestamp = if (serialNumber.isNotBlank()) {\n                    sessionTimestampManager.getSessionEntryTimestamp(serialNumber)\n                } else {\n                    val fallback = java.time.Instant.now().toString()\n                    android.util.Log.w(\"FrequencyGenerator\", \"    Serial number is blank, using current time: $fallback\")\n                    fallback\n                }\n                android.util.Log.d(\"FrequencyGenerator\", \"    Session entry timestamp: $sessionEntryTimestamp\")\n                \n                // Calculate total time spent and format as HH:MM:SS\n                val totalTimeSpentSeconds = durationMs / 1000\n                val hours = totalTimeSpentSeconds / 3600\n                val minutes = (totalTimeSpentSeconds % 3600) / 60\n                val seconds = totalTimeSpentSeconds % 60\n                val totalTimeSpentFormatted = String.format(\"%02d:%02d:%02d\", hours, minutes, seconds)\n                \n                android.util.Log.d(\"FrequencyGenerator\", \" Entry: $sessionEntryTimestamp, Exit: $endTimeFormatted, Duration: $totalTimeSpentFormatted\")\n                \n                // Create frequency test record with new simplified structure\n                // Use session entry timestamp (ISO8601) for Supabase compatibility\n                val frequencyTest = com.example.fqcapp.data.entities.FrequencyTest(\n                    serialNumber = serialNumber,\n                    operatorName = operatorName,\n                    entryTimestamp = sessionEntryTimestamp, // ISO8601 format from session timestamp manager\n                    exitTimestamp = endTimeFormatted, // When user exited/completed the test (will be updated at final submit)\n                    totalTimeSpent = totalTimeSpentFormatted, // Total time in HH:MM:SS format\n                    result = reviewLog.result.uppercase(),\n                    issues = com.google.gson.Gson().toJson(reviewLog.issues),\n                    solutions = com.google.gson.Gson().toJson(reviewLog.solutions + if (reviewLog.otherSolution.isNotEmpty()) listOf(reviewLog.otherSolution) else emptyList()),\n                    remark = reviewLog.remark,\n                    iterationNumber = iterationNumber,\n                    timestamp = sessionEntryTimestamp // ISO8601 for Supabase compatibility\n                )\n                \n                android.util.Log.d(\"FrequencyGenerator\", \" [ACTION] Creating FrequencyTest entity...\")\n                android.util.Log.d(\"FrequencyGenerator\", \"    [DATA] Test data prepared:\")\n                android.util.Log.d(\"FrequencyGenerator\", \"      - serialNumber: $serialNumber\")\n                android.util.Log.d(\"FrequencyGenerator\", \"      - operatorName: $operatorName\")\n                android.util.Log.d(\"FrequencyGenerator\", \"      - entryTimestamp: $sessionEntryTimestamp\")\n                android.util.Log.d(\"FrequencyGenerator\", \"      - exitTimestamp: $endTimeFormatted\")\n                android.util.Log.d(\"FrequencyGenerator\", \"      - totalTimeSpent: $totalTimeSpentFormatted\")\n                android.util.Log.d(\"FrequencyGenerator\", \"      - result: ${frequencyTest.result}\")\n                android.util.Log.d(\"FrequencyGenerator\", \"      - iterationNumber: $iterationNumber\")\n                android.util.Log.d(\"FrequencyGenerator\", \"      - issues count: ${reviewLog.issues.size}\")\n                android.util.Log.d(\"FrequencyGenerator\", \"      - solutions count: ${reviewLog.solutions.size + if (reviewLog.otherSolution.isNotEmpty()) 1 else 0}\")\n                \n                android.util.Log.d(\"FrequencyGenerator\", \"\")\n                android.util.Log.d(\"FrequencyGenerator\", \" [LOCAL] Saving to Room Database...\")\n                \n                // Save to database\n                try {\n                    val operatorId = authenticatedOperator?.operatorId\n                    val testId = repository.insertFrequencyTest(frequencyTest, operatorId)\n                    android.util.Log.d(\"FrequencyGenerator\", \"    [LOCAL] Frequency test saved to Room DB with ID: $testId\")\n                    android.util.Log.d(\"FrequencyGenerator\", \"    [SYNC] Test will be synced to Supabase in background\")\n                    \n                    // Update milestone for frequency generator\n                    android.util.Log.d(\"FrequencyGenerator\", \" [MILESTONE_CALL] Calling milestone update service\")\n                    android.util.Log.d(\"FrequencyGenerator\", \" [MILESTONE_CALL] Serial number: $serialNumber\")\n                    android.util.Log.d(\"FrequencyGenerator\", \" [MILESTONE_CALL] Result value: '${frequencyTest.result}'\")\n                    try {\n                        val milestoneService = com.example.fqcapp.services.MilestoneUpdateService(repository)\n                        milestoneService.updateFrequencyStatus(serialNumber, frequencyTest.result)\n                        android.util.Log.d(\"FrequencyGenerator\", \" [MILESTONE_CALL] Milestone update call completed\")\n                    } catch (e: Exception) {\n                        android.util.Log.e(\"FrequencyGenerator\", \" [MILESTONE_CALL] Error updating milestone\", e)\n                        e.printStackTrace()\n                    }\n                } catch (e: Exception) {\n                    android.util.Log.e(\"FrequencyGenerator\", \" Failed to save frequency test\", e)\n                }\n                \n                // Complete the test session\n                currentTestSessionId?.let { sessionId ->\n                    val durationMinutes = sessionStartTime?.let { \n                        ((System.currentTimeMillis() - it) / 60000).toInt() \n                    } ?: 0\n                    \n                    repository.updateTestSessionStatus(\n                        sessionId = sessionId,\n                        status = \"COMPLETED\",\n                        endTimestamp = java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.getDefault()).format(java.util.Date())\n                    )\n                    \n                    android.util.Log.d(\"FrequencyGenerator\", \"Completed frequency test session: $sessionId\")\n                }\n                \n                android.util.Log.d(\"FrequencyGenerator\", \"Frequency test logged: ${reviewLog.result}\")\n            } catch (e: Exception) {\n                android.util.Log.e(\"FrequencyGenerator\", \"Error logging review\", e)\n            }\n        }\n    }\n    \n    // Session tracking - Create session when component starts\n    LaunchedEffect(Unit) {\n        if (currentSessionId != null) {\n            try {\n                // Get current operator from preferences (login name)\n                val prefsManager = com.example.fqcapp.utils.PreferencesManager(context)\n                operatorName = prefsManager.getOperatorName() ?: \"Unknown\"\n                \n                // Get serial number - priority: initialSerialNumber > connectedDeviceName > session\n                when {\n                    initialSerialNumber != null -> {\n                        currentSerialNumber = initialSerialNumber\n                        android.util.Log.d(\"FrequencyGenerator\", \" Serial from parameter: '$currentSerialNumber'\")\n                    }\n                    connectedDeviceName != null -> {\n                        // Don't use device name as serial number - it's not a real serial\n                        // Keep currentSerialNumber as null/empty - screen will handle it\n                        android.util.Log.w(\"FrequencyGenerator\", \" Device name available ('$connectedDeviceName') but not using as serial number - user should scan QR code\")\n                    }\n                    currentSessionId != null -> {\n                        val session = repository.getSessionById(currentSessionId)\n                        currentSerialNumber = session?.serialNumber\n                        android.util.Log.d(\"FrequencyGenerator\", \" Serial from session: '$currentSerialNumber'\")\n                    }\n                }\n                \n                android.util.Log.d(\"FrequencyGenerator\", \" Operator: $operatorName\")\n                android.util.Log.d(\"FrequencyGenerator\", \" Final serial: '$currentSerialNumber'\")\n                \n                // Count existing sessions for this device - simplified for now\n                val existingSessions = repository.getTestSessionsBySerialNumber(currentSerialNumber ?: \"\")\n                sessionCount = existingSessions.size + 1 // +1 for current session\n                \n                android.util.Log.d(\"FrequencyGenerator\", \"Device: $currentSerialNumber, Session count: $sessionCount\")\n                \n                // Session will be created when actual play/stop occurs, not just on screen load\n                android.util.Log.d(\"FrequencyGenerator\", \"Frequency generator screen loaded, waiting for play/stop activity\")\n            } catch (e: Exception) {\n                android.util.Log.e(\"FrequencyGenerator\", \"Error creating test session\", e)\n            }\n        }\n    }\n\n    // Animation for waveform\n    val infiniteTransition = rememberInfiniteTransition(label = \"wave\")\n    val wavePhase by infiniteTransition.animateFloat(\n        initialValue = 0f,\n        targetValue = (2 * PI).toFloat(),\n        animationSpec = infiniteRepeatable(\n            animation = tween(\n                durationMillis = (1000f / (currentFreq / 10f)).toInt().coerceIn(100, 2000),\n                easing = LinearEasing\n            ),\n            repeatMode = RepeatMode.Restart\n        ),\n        label = \"phase\"\n    )\n\n    // Cleanup on dispose\n    DisposableEffect(Unit) {\n        onDispose {\n            audioJob?.cancel()\n            audioJob = null\n            currentAudioTrack?.let { track ->\n                try {\n                    if (track.playState == AudioTrack.PLAYSTATE_PLAYING) {\n                        track.stop()\n                    }\n                    track.release()\n                } catch (e: Exception) {\n                    android.util.Log.e(\"FrequencyGenerator\", \"Error disposing AudioTrack\", e)\n                }\n            }\n            currentAudioTrack = null\n        }\n    }\n\n    // Stop audio function - ROBUST VERSION\n    fun stopAllAudio() {\n        android.util.Log.d(\"FrequencyGenerator\", \"===  STOPPING ALL AUDIO ===\")\n        android.util.Log.d(\"FrequencyGenerator\", \" Current state - playingSingle: $playingSingle, playingSweep: $playingSweep\")\n        android.util.Log.d(\"FrequencyGenerator\", \" AudioJob state: ${audioJob?.isActive ?: \"null\"}\")\n        android.util.Log.d(\"FrequencyGenerator\", \" CurrentAudioTrack state: ${currentAudioTrack?.playState ?: \"null\"}\")\n        \n        // Cancel any running audio job\n        audioJob?.cancel()\n        audioJob = null\n        android.util.Log.d(\"FrequencyGenerator\", \" AudioJob cancelled\")\n        \n        // Stop and release current audio track\n        currentAudioTrack?.let { track ->\n            try {\n                if (track.playState == AudioTrack.PLAYSTATE_PLAYING) {\n                    track.stop()\n                    android.util.Log.d(\"FrequencyGenerator\", \" AudioTrack stopped\")\n                }\n                track.release()\n                android.util.Log.d(\"FrequencyGenerator\", \" AudioTrack released\")\n            } catch (e: Exception) {\n                android.util.Log.e(\"FrequencyGenerator\", \" Error stopping AudioTrack\", e)\n            }\n        }\n        currentAudioTrack = null\n        \n        // Reset all playing states\n        playingSingle = false\n        playingSweep = false\n        android.util.Log.d(\"FrequencyGenerator\", \" All playing states reset to false\")\n        \n        // Release audio focus properly\n        val audioManager = context.getSystemService(android.content.Context.AUDIO_SERVICE) as AudioManager\n        try {\n            if (hasAudioFocus && currentAudioFocusRequest != null) {\n                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n                    audioManager.abandonAudioFocusRequest(currentAudioFocusRequest!!)\n                    android.util.Log.d(\"FrequencyGenerator\", \" Audio focus request abandoned (API 26+)\")\n                } else {\n                    @Suppress(\"DEPRECATION\")\n                    audioManager.abandonAudioFocus(null)\n                    android.util.Log.d(\"FrequencyGenerator\", \" Audio focus abandoned (legacy)\")\n                }\n            } else {\n                // Fallback for cases where we don't have the request reference\n                @Suppress(\"DEPRECATION\")\n                audioManager.abandonAudioFocus(null)\n                android.util.Log.d(\"FrequencyGenerator\", \" Audio focus abandoned (fallback)\")\n            }\n            currentAudioFocusRequest = null\n            hasAudioFocus = false\n            android.util.Log.d(\"FrequencyGenerator\", \" Audio focus released\")\n        } catch (e: Exception) {\n            android.util.Log.e(\"FrequencyGenerator\", \" Error releasing audio focus\", e)\n            currentAudioFocusRequest = null\n            hasAudioFocus = false\n        }\n        \n        android.util.Log.d(\"FrequencyGenerator\", \" === ALL AUDIO STOPPED ===\")\n    }\n\n    // Start single frequency audio - ROBUST VERSION\n    fun playSingleFrequency() {\n        android.util.Log.d(\"FrequencyGenerator\", \"===  PLAY SINGLE FREQUENCY REQUESTED ===\")\n        android.util.Log.d(\"FrequencyGenerator\", \" Current state - playingSingle: $playingSingle, playingSweep: $playingSweep\")\n        android.util.Log.d(\"FrequencyGenerator\", \" AudioJob state: ${audioJob?.isActive ?: \"null\"}\")\n        android.util.Log.d(\"FrequencyGenerator\", \" CurrentAudioTrack state: ${currentAudioTrack?.playState ?: \"null\"}\")\n        \n        // If already playing single, stop it\n        if (playingSingle) {\n            android.util.Log.d(\"FrequencyGenerator\", \" Already playing single - stopping\")\n            stopAllAudio()\n            return\n        }\n        \n        // ALWAYS do a complete stop when switching modes (including abandoning audio focus)\n        // This ensures clean state transition - no lingering listeners or state\n        val wasSwitchingFromSweep = playingSweep\n        if (playingSweep) {\n            android.util.Log.d(\"FrequencyGenerator\", \" Switching from sweep to single - doing FULL STOP first\")\n            stopAllAudio()\n            // Use coroutine to ensure cleanup completes before starting new mode\n            scope.launch {\n                kotlinx.coroutines.delay(200) // Give time for audio focus to be fully abandoned\n                withContext(Dispatchers.Main) {\n                    // Reset flags to ensure clean start\n                    playingSingle = false\n                    playingSweep = false\n                    // Now start single frequency fresh\n                    android.util.Log.d(\"FrequencyGenerator\", \" Starting single frequency after mode switch cleanup\")\n                    // Recursively call this function, but now playingSweep will be false, so it will go to the else branch\n                    playSingleFrequency()\n                }\n            }\n            return\n        } else {\n            // No audio playing, do full cleanup\n            stopAllAudio()\n        }\n        \n        // Continue with starting single frequency (no switch needed)\n        // Set state immediately to prevent double-clicks\n        playingSingle = true\n        android.util.Log.d(\"FrequencyGenerator\", \" Set playingSingle = true\")\n        \n        // ALWAYS request fresh audio focus when starting - don't reuse\n        val audioManager = context.getSystemService(android.content.Context.AUDIO_SERVICE) as AudioManager\n        \n        // Create new audio focus request with unified listener\n        android.util.Log.d(\"FrequencyGenerator\", \" Requesting FRESH audio focus with unified listener\")\n        \n        val focusResult = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n            val audioFocusRequest = AudioFocusRequest.Builder(AudioManager.AUDIOFOCUS_GAIN)\n                .setAudioAttributes(android.media.AudioAttributes.Builder()\n                    .setUsage(android.media.AudioAttributes.USAGE_MEDIA)\n                    .setContentType(android.media.AudioAttributes.CONTENT_TYPE_MUSIC)\n                    .build())\n                .setAcceptsDelayedFocusGain(true)\n                .setOnAudioFocusChangeListener { focusChange ->\n                    android.util.Log.d(\"FrequencyGenerator\", \" Audio focus change (unified): $focusChange\")\n                    when (focusChange) {\n                        AudioManager.AUDIOFOCUS_LOSS -> {\n                            android.util.Log.d(\"FrequencyGenerator\", \" Audio focus lost (permanent) - stopping playback\")\n                            try {\n                                currentAudioTrack?.let { track ->\n                                    if (track.playState == AudioTrack.PLAYSTATE_PLAYING) {\n                                        track.stop()\n                                    }\n                                    track.release()\n                                }\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"FrequencyGenerator\", \" Error stopping on focus loss\", e)\n                            }\n                            currentAudioTrack = null\n                            playingSingle = false\n                            playingSweep = false\n                            hasAudioFocus = false\n                            currentAudioFocusRequest = null\n                        }\n                        AudioManager.AUDIOFOCUS_LOSS_TRANSIENT -> {\n                            android.util.Log.d(\"FrequencyGenerator\", \" Audio focus lost (transient) - keeping playback, not pausing\")\n                            // Don't pause on transient loss - keep playing\n                            // The system will handle it\n                        }\n                        AudioManager.AUDIOFOCUS_GAIN -> {\n                            android.util.Log.d(\"FrequencyGenerator\", \" Audio focus gained - resuming if needed\")\n                            hasAudioFocus = true\n                            try {\n                                currentAudioTrack?.play()\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"FrequencyGenerator\", \" Error resuming on focus gain\", e)\n                            }\n                        }\n                    }\n                }\n                .build()\n            currentAudioFocusRequest = audioFocusRequest\n            val result = audioManager.requestAudioFocus(audioFocusRequest)\n            if (result == AudioManager.AUDIOFOCUS_REQUEST_GRANTED) {\n                hasAudioFocus = true\n            }\n            result\n        } else {\n            @Suppress(\"DEPRECATION\")\n            val result = audioManager.requestAudioFocus(\n                { focusChange ->\n                    android.util.Log.d(\"FrequencyGenerator\", \" Audio focus change (unified, legacy): $focusChange\")\n                    when (focusChange) {\n                        AudioManager.AUDIOFOCUS_LOSS -> {\n                            android.util.Log.d(\"FrequencyGenerator\", \" Audio focus lost (permanent) - stopping playback\")\n                            try {\n                                currentAudioTrack?.let { track ->\n                                    if (track.playState == AudioTrack.PLAYSTATE_PLAYING) {\n                                        track.stop()\n                                    }\n                                    track.release()\n                                }\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"FrequencyGenerator\", \" Error stopping on focus loss\", e)\n                            }\n                            currentAudioTrack = null\n                            playingSingle = false\n                            playingSweep = false\n                            hasAudioFocus = false\n                        }\n                        AudioManager.AUDIOFOCUS_LOSS_TRANSIENT -> {\n                            android.util.Log.d(\"FrequencyGenerator\", \" Audio focus lost (transient) - keeping playback, not pausing\")\n                            // Don't pause on transient loss - keep playing\n                            // The system will handle it\n                        }\n                        AudioManager.AUDIOFOCUS_GAIN -> {\n                            android.util.Log.d(\"FrequencyGenerator\", \" Audio focus gained\")\n                            hasAudioFocus = true\n                            try {\n                                currentAudioTrack?.play()\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"FrequencyGenerator\", \" Error resuming on focus gain\", e)\n                            }\n                        }\n                    }\n                },\n                AudioManager.STREAM_MUSIC,\n                AudioManager.AUDIOFOCUS_GAIN\n            )\n            if (result == AudioManager.AUDIOFOCUS_REQUEST_GRANTED) {\n                hasAudioFocus = true\n            }\n            result\n        }\n        \n        if (focusResult != AudioManager.AUDIOFOCUS_REQUEST_GRANTED) {\n            android.util.Log.w(\"FrequencyGenerator\", \" Audio focus not granted (result: $focusResult) - cannot play audio\")\n            playingSingle = false\n            currentAudioFocusRequest = null\n            hasAudioFocus = false\n            return\n        }\n        \n        android.util.Log.d(\"FrequencyGenerator\", \" Audio focus granted - proceeding with audio generation\")\n        \n        // Create session only when actual play occurs\n        if (currentTestSessionId == null) {\n            scope.launch {\n                try {\n                    val sessionId = repository.insertTestSession(\n                        com.example.fqcapp.data.entities.TestSession(\n                            serialNumber = currentSerialNumber ?: \"PLACEHOLDER\",\n                            operatorPin = \"0000\", // Default pin\n                            operatorName = \"Unknown\", // Will be updated from session\n                            startTimestamp = java.text.SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ss\", java.util.Locale.getDefault()).format(java.util.Date()),\n                            status = \"IN_PROGRESS\"\n                        )\n                    )\n                    currentTestSessionId = sessionId\n                    android.util.Log.d(\"FrequencyGenerator\", \"Created frequency test session: $sessionId\")\n                } catch (e: Exception) {\n                    android.util.Log.e(\"FrequencyGenerator\", \"Error creating test session\", e)\n                }\n            }\n        }\n        \n        // Track start time\n        sessionStartTime = System.currentTimeMillis()\n        android.util.Log.d(\"FrequencyGenerator\", \"=== SINGLE FREQUENCY STARTED ===\")\n        android.util.Log.d(\"FrequencyGenerator\", \"Target Frequency: $currentFreq Hz\")\n        \n        // Start audio generation\n        audioJob = scope.launch(Dispatchers.Default) {\n            try {\n                android.util.Log.d(\"FrequencyGenerator\", \" Starting audio generation coroutine\")\n                val sampleRate = 48000\n                val track = AudioTrack(\n                AudioManager.STREAM_MUSIC,\n                    sampleRate,\n                AudioFormat.CHANNEL_OUT_STEREO,\n                AudioFormat.ENCODING_PCM_16BIT,\n                    sampleRate * 2,\n                AudioTrack.MODE_STREAM\n            )\n                \n                // Store track reference\n                currentAudioTrack = track\n                android.util.Log.d(\"FrequencyGenerator\", \" AudioTrack created and stored\")\n                \n                track.play()\n                android.util.Log.d(\"FrequencyGenerator\", \" AudioTrack started playing\")\n\n                val buffer = ShortArray(2048)\n                var phase = 0.0\n                var lastLogTime = sessionStartTime!!\n                val logInterval = 2000L\n\n                // Get system volume for relative volume calculation (once, outside loop)\n                val audioManager = context.getSystemService(android.content.Context.AUDIO_SERVICE) as AudioManager\n                val maxSystemVolume = audioManager.getStreamMaxVolume(AudioManager.STREAM_MUSIC)\n                \n                // Function to calculate volume gains\n                fun calculateGains(): Triple<Float, Float, String> {\n                    val systemVolume = audioManager.getStreamVolume(AudioManager.STREAM_MUSIC)\n                    val systemVolumeRatio = if (maxSystemVolume > 0) systemVolume.toFloat() / maxSystemVolume.toFloat() else 1f\n                    \n                    // Calculate independent channel gains\n                    // At 0%: gain = 0.0 (mute) regardless of system volume\n                    // At 100%: gain = systemVolumeRatio (full system volume)\n                    // Formula: gain = (sliderValue / 100.0) * systemVolumeRatio\n                    val leftGain = if (leftVolume == 0) 0.0f else (leftVolume / 100.0f * systemVolumeRatio).coerceIn(0f, 1f)\n                    val rightGain = if (rightVolume == 0) 0.0f else (rightVolume / 100.0f * systemVolumeRatio).coerceIn(0f, 1f)\n                    \n                    return Triple(leftGain, rightGain, \"$systemVolume/$maxSystemVolume\")\n                }\n                \n                // Set initial volume using setStereoVolume (as backup)\n                val (initialLeftGain, initialRightGain, _) = calculateGains()\n                track.setStereoVolume(initialLeftGain, initialRightGain)\n                \n                var lastVolumeUpdateTime = System.currentTimeMillis()\n                val volumeUpdateInterval = 50L // Update volume every 50ms for smooth real-time control\n                \n                while (isActive && playingSingle) {\n                    val currentTime = System.currentTimeMillis()\n                    val freq = currentFreq\n                    \n                    // Calculate current gains and update UI feedback\n                    val (currentLeftGain, currentRightGain, volumeInfo) = calculateGains()\n                    withContext(Dispatchers.Main) {\n                        actualLeftGain = currentLeftGain\n                        actualRightGain = currentRightGain\n                        systemVolumeInfo = volumeInfo\n                    }\n                    \n                    // Update volume periodically to catch slider and system volume changes\n                    if (currentTime - lastVolumeUpdateTime >= volumeUpdateInterval) {\n                        // Also try setStereoVolume as backup (though we use manual multiplication)\n                        track.setStereoVolume(currentLeftGain, currentRightGain)\n                        lastVolumeUpdateTime = currentTime\n                    }\n                    \n                    val angularVelocity = 2.0 * PI * freq / sampleRate\n\n                    // Log every 2 seconds\n                    if (currentTime - lastLogTime >= logInterval) {\n                        val timeFormatted = java.text.SimpleDateFormat(\"HH:mm:ss.SSS\", java.util.Locale.getDefault()).format(java.util.Date(currentTime))\n                        val elapsed = currentTime - sessionStartTime!!\n                        val phaseInDegrees = (phase * 180.0 / PI) % 360.0\n                        val cyclesPerBuffer = (freq * buffer.size / 2) / sampleRate\n                        \n                        android.util.Log.d(\"FrequencyGenerator\", \"SINGLE_FREQ: TIME=$timeFormatted | ELAPSED=${elapsed}ms | FREQ=${String.format(\"%.2f\", freq)}Hz | PHASE=${String.format(\"%.1f\", phaseInDegrees)} | CYCLES/BUFFER=${String.format(\"%.2f\", cyclesPerBuffer)} | LEFT_VOL=${leftVolume}% | RIGHT_VOL=${rightVolume}% | SYS_VOL=$systemVolumeInfo | LEFT_GAIN=${String.format(\"%.3f\", currentLeftGain)} | RIGHT_GAIN=${String.format(\"%.3f\", currentRightGain)}\")\n                        lastLogTime = currentTime\n                    }\n\n                    // Generate stereo audio with MANUAL volume control for precise independent channels\n                    // This ensures 0% = complete mute and precise 1% steps\n                    for (i in 0 until buffer.size step 2) {\n                        val rawSample = sin(phase) * Short.MAX_VALUE * 0.3\n                        \n                        // Apply independent channel gains directly to samples\n                        // This gives us precise control: 0% = 0.0 gain = mute\n                        val leftSample = (rawSample * currentLeftGain).toInt().toShort()\n                        val rightSample = (rawSample * currentRightGain).toInt().toShort()\n                        \n                        buffer[i] = leftSample      // Left channel with independent gain\n                        buffer[i + 1] = rightSample  // Right channel with independent gain\n                        \n                        phase += angularVelocity\n                        if (phase >= 2.0 * PI) phase -= 2.0 * PI\n                    }\n\n                    track.write(buffer, 0, buffer.size)\n                }\n\n                android.util.Log.d(\"FrequencyGenerator\", \" === SINGLE FREQUENCY ENDED ===\")\n                val endTime = System.currentTimeMillis()\n                val totalDuration = endTime - sessionStartTime!!\n                android.util.Log.d(\"FrequencyGenerator\", \" Total Duration: ${totalDuration}ms | Final Freq: ${String.format(\"%.2f\", currentFreq)}Hz\")\n\n                // Clean up\n                try {\n                    if (track.state == AudioTrack.STATE_INITIALIZED && track.playState == AudioTrack.PLAYSTATE_PLAYING) {\n                track.stop()\n                    }\n                } catch (e: Exception) {\n                    android.util.Log.e(\"FrequencyGenerator\", \" stop() failed or unnecessary (single)\", e)\n                }\n                try {\n                track.release()\n                } catch (e: Exception) {\n                    android.util.Log.e(\"FrequencyGenerator\", \" release() failed (single)\", e)\n                }\n                currentAudioTrack = null\n                android.util.Log.d(\"FrequencyGenerator\", \" AudioTrack stopped and released\")\n                \n                withContext(Dispatchers.Main) {\n                    playingSingle = false\n                    android.util.Log.d(\"FrequencyGenerator\", \" Set playingSingle = false\")\n                }\n            } catch (e: Exception) {\n                android.util.Log.e(\"FrequencyGenerator\", \" Error in single frequency playback\", e)\n                withContext(Dispatchers.Main) {\n                    playingSingle = false\n                    currentAudioTrack = null\n                }\n            }\n        }\n    }\n    \n    // Channel Test Mode: Plays different frequencies on each channel\n    // Left = 440Hz (A4), Right = 880Hz (A5) - makes it easy to hear independence\n    fun playChannelTest() = scope.launch(Dispatchers.IO) {\n        if (playingSingle || playingSweep) {\n            android.util.Log.d(\"FrequencyGenerator\", \" CHANNEL_TEST: Already playing, stopping first\")\n            playingSingle = false\n            playingSweep = false\n            delay(200) // Wait for cleanup\n        }\n        \n        withContext(Dispatchers.Main) {\n            playingSingle = true\n            channelTestMode = true\n        }\n        \n        try {\n            val sampleRate = 44100\n            val leftFreq = 440.0  // A4 note\n            val rightFreq = 880.0 // A5 note (octave higher)\n            \n            val track = AudioTrack(\n                AudioManager.STREAM_MUSIC,\n                sampleRate,\n                AudioFormat.CHANNEL_OUT_STEREO,\n                AudioFormat.ENCODING_PCM_16BIT,\n                AudioTrack.getMinBufferSize(\n                    sampleRate,\n                    AudioFormat.CHANNEL_OUT_STEREO,\n                    AudioFormat.ENCODING_PCM_16BIT\n                ) * 2,\n                AudioTrack.MODE_STREAM\n            )\n            \n            currentAudioTrack = track\n            track.play()\n            \n            android.util.Log.d(\"FrequencyGenerator\", \" CHANNEL_TEST: Playing L=440Hz, R=880Hz\")\n            \n            val audioManager = context.getSystemService(android.content.Context.AUDIO_SERVICE) as AudioManager\n            val maxSystemVolume = audioManager.getStreamMaxVolume(AudioManager.STREAM_MUSIC)\n            \n            val buffer = ShortArray(2048)\n            var leftPhase = 0.0\n            var rightPhase = 0.0\n            val leftAngularVelocity = 2.0 * PI * leftFreq / sampleRate\n            val rightAngularVelocity = 2.0 * PI * rightFreq / sampleRate\n            \n            while (isActive && playingSingle && channelTestMode) {\n                // Calculate gains\n                val systemVolume = audioManager.getStreamVolume(AudioManager.STREAM_MUSIC)\n                val systemVolumeRatio = if (maxSystemVolume > 0) systemVolume.toFloat() / maxSystemVolume.toFloat() else 1f\n                val leftGain = if (leftVolume == 0) 0.0f else (leftVolume / 100.0f * systemVolumeRatio).coerceIn(0f, 1f)\n                val rightGain = if (rightVolume == 0) 0.0f else (rightVolume / 100.0f * systemVolumeRatio).coerceIn(0f, 1f)\n                \n                // Update UI feedback\n                withContext(Dispatchers.Main) {\n                    actualLeftGain = leftGain\n                    actualRightGain = rightGain\n                    systemVolumeInfo = \"$systemVolume/$maxSystemVolume\"\n                }\n                \n                // Generate independent channel samples\n                for (i in 0 until buffer.size step 2) {\n                    val leftSample = (sin(leftPhase) * Short.MAX_VALUE * 0.3 * leftGain).toInt().toShort()\n                    val rightSample = (sin(rightPhase) * Short.MAX_VALUE * 0.3 * rightGain).toInt().toShort()\n                    \n                    buffer[i] = leftSample      // Left: 440Hz\n                    buffer[i + 1] = rightSample  // Right: 880Hz\n                    \n                    leftPhase += leftAngularVelocity\n                    rightPhase += rightAngularVelocity\n                    if (leftPhase >= 2.0 * PI) leftPhase -= 2.0 * PI\n                    if (rightPhase >= 2.0 * PI) rightPhase -= 2.0 * PI\n                }\n                \n                track.write(buffer, 0, buffer.size)\n            }\n            \n            track.stop()\n            track.release()\n            currentAudioTrack = null\n            \n            withContext(Dispatchers.Main) {\n                playingSingle = false\n                channelTestMode = false\n            }\n            \n            android.util.Log.d(\"FrequencyGenerator\", \" CHANNEL_TEST: Stopped\")\n        } catch (e: Exception) {\n            android.util.Log.e(\"FrequencyGenerator\", \" CHANNEL_TEST: Error\", e)\n            withContext(Dispatchers.Main) {\n                playingSingle = false\n                channelTestMode = false\n                currentAudioTrack = null\n            }\n        }\n    }\n\n    // Start sweep audio - ROBUST VERSION\n    fun playSweep() {\n        android.util.Log.d(\"FrequencyGenerator\", \"===  PLAY SWEEP REQUESTED ===\")\n        android.util.Log.d(\"FrequencyGenerator\", \" Current state - playingSingle: $playingSingle, playingSweep: $playingSweep\")\n        android.util.Log.d(\"FrequencyGenerator\", \" AudioJob state: ${audioJob?.isActive ?: \"null\"}\")\n        android.util.Log.d(\"FrequencyGenerator\", \" CurrentAudioTrack state: ${currentAudioTrack?.playState ?: \"null\"}\")\n        \n        // If already playing sweep, stop it\n        if (playingSweep) {\n            android.util.Log.d(\"FrequencyGenerator\", \" Already playing sweep - stopping\")\n            stopAllAudio()\n            return\n        }\n        \n        // ALWAYS do a complete stop when switching modes (including abandoning audio focus)\n        // This ensures clean state transition - no lingering listeners or state\n        if (playingSingle) {\n            android.util.Log.d(\"FrequencyGenerator\", \" Switching from single to sweep - doing FULL STOP first\")\n            stopAllAudio()\n            // Use coroutine to ensure cleanup completes before starting new mode\n            scope.launch {\n                kotlinx.coroutines.delay(200) // Give time for audio focus to be fully abandoned\n                withContext(Dispatchers.Main) {\n                    // Reset flags to ensure clean start\n                    playingSingle = false\n                    playingSweep = false\n                    // Now start sweep fresh\n                    android.util.Log.d(\"FrequencyGenerator\", \" Starting sweep after mode switch cleanup\")\n                    // Recursively call this function, but now playingSingle will be false, so it will go to the else branch\n                    playSweep()\n                }\n            }\n            return\n        } else {\n            // No audio playing, do full cleanup\n            stopAllAudio()\n        }\n        \n        // Continue with starting sweep (no switch needed)\n        // Set state immediately to prevent double-clicks\n        playingSweep = true\n        android.util.Log.d(\"FrequencyGenerator\", \" Set playingSweep = true\")\n        \n        // ALWAYS request fresh audio focus when starting - don't reuse\n        val audioManager = context.getSystemService(android.content.Context.AUDIO_SERVICE) as AudioManager\n        \n        // Create new audio focus request with unified listener\n        android.util.Log.d(\"FrequencyGenerator\", \" Requesting FRESH audio focus with unified listener\")\n        \n        val focusResult = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n            val audioFocusRequest = AudioFocusRequest.Builder(AudioManager.AUDIOFOCUS_GAIN)\n                .setAudioAttributes(android.media.AudioAttributes.Builder()\n                    .setUsage(android.media.AudioAttributes.USAGE_MEDIA)\n                    .setContentType(android.media.AudioAttributes.CONTENT_TYPE_MUSIC)\n                    .build())\n                .setAcceptsDelayedFocusGain(true)\n                .setOnAudioFocusChangeListener { focusChange ->\n                    android.util.Log.d(\"FrequencyGenerator\", \" Audio focus change (unified): $focusChange\")\n                    when (focusChange) {\n                        AudioManager.AUDIOFOCUS_LOSS -> {\n                            android.util.Log.d(\"FrequencyGenerator\", \" Audio focus lost (permanent) - stopping playback\")\n                            try {\n                                currentAudioTrack?.let { track ->\n                                    if (track.playState == AudioTrack.PLAYSTATE_PLAYING) {\n                                        track.stop()\n                                    }\n                                    track.release()\n                                }\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"FrequencyGenerator\", \" Error stopping on focus loss\", e)\n                            }\n                            currentAudioTrack = null\n                            playingSingle = false\n                            playingSweep = false\n                            hasAudioFocus = false\n                            currentAudioFocusRequest = null\n                        }\n                        AudioManager.AUDIOFOCUS_LOSS_TRANSIENT -> {\n                            android.util.Log.d(\"FrequencyGenerator\", \" Audio focus lost (transient) - keeping playback, not pausing\")\n                            // Don't pause on transient loss - keep playing\n                            // The system will handle it\n                        }\n                        AudioManager.AUDIOFOCUS_GAIN -> {\n                            android.util.Log.d(\"FrequencyGenerator\", \" Audio focus gained - resuming if needed\")\n                            hasAudioFocus = true\n                            try {\n                                currentAudioTrack?.play()\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"FrequencyGenerator\", \" Error resuming on focus gain\", e)\n                            }\n                        }\n                    }\n                }\n                .build()\n            currentAudioFocusRequest = audioFocusRequest\n            val result = audioManager.requestAudioFocus(audioFocusRequest)\n            if (result == AudioManager.AUDIOFOCUS_REQUEST_GRANTED) {\n                hasAudioFocus = true\n            }\n            result\n        } else {\n            @Suppress(\"DEPRECATION\")\n            val result = audioManager.requestAudioFocus(\n                { focusChange ->\n                    android.util.Log.d(\"FrequencyGenerator\", \" Audio focus change (unified, legacy): $focusChange\")\n                    when (focusChange) {\n                        AudioManager.AUDIOFOCUS_LOSS -> {\n                            android.util.Log.d(\"FrequencyGenerator\", \" Audio focus lost (permanent) - stopping playback\")\n                            try {\n                                currentAudioTrack?.let { track ->\n                                    if (track.playState == AudioTrack.PLAYSTATE_PLAYING) {\n                                        track.stop()\n                                    }\n                                    track.release()\n                                }\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"FrequencyGenerator\", \" Error stopping on focus loss\", e)\n                            }\n                            currentAudioTrack = null\n                            playingSingle = false\n                            playingSweep = false\n                            hasAudioFocus = false\n                        }\n                        AudioManager.AUDIOFOCUS_LOSS_TRANSIENT -> {\n                            android.util.Log.d(\"FrequencyGenerator\", \" Audio focus lost (transient) - keeping playback, not pausing\")\n                            // Don't pause on transient loss - keep playing\n                            // The system will handle it\n                        }\n                        AudioManager.AUDIOFOCUS_GAIN -> {\n                            android.util.Log.d(\"FrequencyGenerator\", \" Audio focus gained\")\n                            hasAudioFocus = true\n                            try {\n                                currentAudioTrack?.play()\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"FrequencyGenerator\", \" Error resuming on focus gain\", e)\n                            }\n                        }\n                    }\n                },\n                AudioManager.STREAM_MUSIC,\n                AudioManager.AUDIOFOCUS_GAIN\n            )\n            if (result == AudioManager.AUDIOFOCUS_REQUEST_GRANTED) {\n                hasAudioFocus = true\n            }\n            result\n        }\n        \n        if (focusResult != AudioManager.AUDIOFOCUS_REQUEST_GRANTED) {\n            android.util.Log.w(\"FrequencyGenerator\", \" Audio focus not granted (result: $focusResult) - cannot play sweep\")\n            playingSweep = false\n            currentAudioFocusRequest = null\n            hasAudioFocus = false\n            return\n        }\n        \n        // Create session only when actual play occurs\n        if (currentTestSessionId == null) {\n            scope.launch {\n                try {\n                    val sessionId = repository.insertTestSession(\n                        com.example.fqcapp.data.entities.TestSession(\n                            serialNumber = currentSerialNumber ?: \"PLACEHOLDER\",\n                            operatorPin = \"0000\", // Default pin\n                            operatorName = \"Unknown\", // Will be updated from session\n                            startTimestamp = java.text.SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ss\", java.util.Locale.getDefault()).format(java.util.Date()),\n                            status = \"IN_PROGRESS\"\n                        )\n                    )\n                    currentTestSessionId = sessionId\n                    android.util.Log.d(\"FrequencyGenerator\", \"Created frequency test session: $sessionId\")\n                } catch (e: Exception) {\n                    android.util.Log.e(\"FrequencyGenerator\", \"Error creating test session\", e)\n                }\n            }\n        }\n        \n        // Start audio generation\n        audioJob = scope.launch(Dispatchers.Default) {\n            try {\n                android.util.Log.d(\"FrequencyGenerator\", \" Starting sweep audio generation coroutine\")\n                val sampleRate = 48000\n                \n                // Calculate proper buffer size for stereo audio\n                val minBufferSize = AudioTrack.getMinBufferSize(\n                    sampleRate,\n                    AudioFormat.CHANNEL_OUT_STEREO,\n                    AudioFormat.ENCODING_PCM_16BIT\n                )\n                val bufferSize = (minBufferSize * 2).coerceAtLeast(8192) // Ensure minimum 8KB buffer\n                \n                android.util.Log.d(\"FrequencyGenerator\", \" Buffer size: $bufferSize bytes (min: $minBufferSize)\")\n                \n                val track = AudioTrack(\n                    AudioManager.STREAM_MUSIC,\n                    sampleRate,\n                    AudioFormat.CHANNEL_OUT_STEREO,\n                    AudioFormat.ENCODING_PCM_16BIT,\n                    bufferSize,\n                    AudioTrack.MODE_STREAM\n                )\n                \n                // Verify track is in correct state\n                if (track.state != AudioTrack.STATE_INITIALIZED) {\n                    android.util.Log.e(\"FrequencyGenerator\", \" AudioTrack not initialized! State: ${track.state}\")\n                    withContext(Dispatchers.Main) {\n                        playingSweep = false\n                    }\n                    return@launch\n                }\n                \n                android.util.Log.d(\"FrequencyGenerator\", \" AudioTrack state: ${track.state} (${if (track.state == AudioTrack.STATE_INITIALIZED) \"INITIALIZED\" else \"UNINITIALIZED\"})\")\n                \n                // Store track reference\n                currentAudioTrack = track\n                android.util.Log.d(\"FrequencyGenerator\", \" AudioTrack created and stored\")\n                \n                // Start playback BEFORE generating audio\n                track.play()\n                \n                // Verify playback started\n                if (track.playState != AudioTrack.PLAYSTATE_PLAYING) {\n                    android.util.Log.e(\"FrequencyGenerator\", \" AudioTrack not playing! PlayState: ${track.playState}\")\n                    withContext(Dispatchers.Main) {\n                        playingSweep = false\n                    }\n                    return@launch\n                }\n                \n                android.util.Log.d(\"FrequencyGenerator\", \" Sweep AudioTrack started playing (PlayState: ${track.playState})\")\n\n                // Use smaller buffer for ultra-fast sweeps to reduce latency\n                // Note: bufferSize is in samples, not bytes. For stereo, we need 2 samples per frame.\n                val audioBufferSize = if (duration <= 1.0f) 512 else 2048\n                val buffer = ShortArray(audioBufferSize * 2) // Stereo: 2 channels\n                var phase = 0.0\n                var sweepStartTime = System.currentTimeMillis()\n                var forward = true\n                var currentSweepFreq = startFreq\n                var loopCount = 0\n                var lastLogTime = sweepStartTime\n                val logInterval = if (duration <= 1.0f) 50L else 1000L // Log every 50ms for ultra-fast sweeps, 1s for normal\n\n                // Get system volume for relative volume calculation (once, outside loop)\n                val audioManager = context.getSystemService(android.content.Context.AUDIO_SERVICE) as AudioManager\n                val maxSystemVolume = audioManager.getStreamMaxVolume(AudioManager.STREAM_MUSIC)\n                \n                // Function to calculate volume gains\n                fun calculateGains(): Triple<Float, Float, String> {\n                    val systemVolume = audioManager.getStreamVolume(AudioManager.STREAM_MUSIC)\n                    val systemVolumeRatio = if (maxSystemVolume > 0) systemVolume.toFloat() / maxSystemVolume.toFloat() else 1f\n                    \n                    // Calculate independent channel gains\n                    // At 0%: gain = 0.0 (mute) regardless of system volume\n                    // At 100%: gain = systemVolumeRatio (full system volume)\n                    // Formula: gain = (sliderValue / 100.0) * systemVolumeRatio\n                    val leftGain = if (leftVolume == 0) 0.0f else (leftVolume / 100.0f * systemVolumeRatio).coerceIn(0f, 1f)\n                    val rightGain = if (rightVolume == 0) 0.0f else (rightVolume / 100.0f * systemVolumeRatio).coerceIn(0f, 1f)\n                    \n                    return Triple(leftGain, rightGain, \"$systemVolume/$maxSystemVolume\")\n                }\n                \n                // Set initial volume using setStereoVolume (as backup)\n                val (initialLeftGain, initialRightGain, _) = calculateGains()\n                track.setStereoVolume(initialLeftGain, initialRightGain)\n                \n                var lastVolumeUpdateTime = System.currentTimeMillis()\n                val volumeUpdateInterval = 50L // Update volume every 50ms for smooth real-time control\n\n                // Check if sweep mode\n                val isSweep = kotlin.math.abs(startFreq - endFreq) > 0.1f\n                \n                android.util.Log.d(\"FrequencyGenerator\", \"=== FREQUENCY SWEEP STARTED ===\")\n                android.util.Log.d(\"FrequencyGenerator\", \"Start Freq: $startFreq Hz, End Freq: $endFreq Hz, Duration: $duration sec, Loop: $loop\")\n                android.util.Log.d(\"FrequencyGenerator\", \"Sample Rate: $sampleRate Hz, Buffer Size: ${buffer.size}\")\n                \n                // Special logging for ultra-fast sweeps\n                if (duration <= 1.0f) {\n                    val freqRange = kotlin.math.abs(endFreq - startFreq)\n                    val frequencyChangeRate = freqRange / duration // Hz per second\n                    android.util.Log.d(\"FrequencyGenerator\", \" ULTRA_FAST_SWEEP: ${frequencyChangeRate.toInt()} Hz/sec | ${(duration * 1000).toInt()}ms total | Logging every 10ms\")\n                }\n\n                // FUNDAMENTAL REBUILD: Time-based sweep algorithm\n                val sweepDurationMs = (duration * 1000).toLong() // Convert to milliseconds\n                val totalSlices = (sweepDurationMs / 10).toInt() // 10ms per slice\n                val delta = (endFreq - startFreq) / totalSlices.toFloat() // Hz per slice\n                var currentSlice = 0\n                var isUpSweep = true\n                var timeBasedSweepStartTime = System.currentTimeMillis()\n                var lastSliceTime = timeBasedSweepStartTime\n                \n                android.util.Log.d(\"FrequencyGenerator\", \"FUNDAMENTAL_SWEEP: Duration=${duration}s, TotalSlices=$totalSlices, Delta=${String.format(\"%.3f\", delta)} Hz/slice\")\n\n                while (isActive && playingSweep) {\n                    val timeBasedCurrentTime = System.currentTimeMillis()\n                    val timeBasedElapsedFromStart = timeBasedCurrentTime - timeBasedSweepStartTime\n                    \n                    // Calculate current slice based on elapsed time\n                    val expectedSlice = (timeBasedElapsedFromStart / 10).toInt()\n                    \n                    // Calculate frequency for current slice\n                    val freq = if (isSweep) {\n                        if (isUpSweep) {\n                            // UP sweep: f(k) = start_freq + k * delta\n                            val f = startFreq + expectedSlice * delta\n                            f.coerceIn(startFreq, endFreq)\n                        } else {\n                            // DOWN sweep: f(k) = end_freq - k * delta\n                            val f = endFreq - expectedSlice * delta\n                            f.coerceIn(startFreq, endFreq)\n                        }\n                    } else {\n                        startFreq\n                    }\n                    \n                    // Update UI immediately for smooth frequency display\n                    withContext(Dispatchers.Main) {\n                        val oldFreq = currentFreq\n                        currentFreq = freq\n                        android.util.Log.d(\"FrequencyGenerator\", \"UI_UPDATE: OLD_FREQ=${String.format(\"%.2f\", oldFreq)}Hz  NEW_FREQ=${String.format(\"%.2f\", currentFreq)}Hz | SLICE=$expectedSlice/$totalSlices\")\n                    }\n                    \n                    // Check if sweep is complete\n                    if (expectedSlice >= totalSlices) {\n                            if (loop) {\n                            // Reset for next iteration\n                            currentSlice = 0\n                            isUpSweep = !isUpSweep\n                                loopCount++\n                            timeBasedSweepStartTime = System.currentTimeMillis()\n                            lastSliceTime = timeBasedSweepStartTime\n                                \n                            android.util.Log.d(\"FrequencyGenerator\", \"=== LOOP $loopCount STARTED ===\")\n                            android.util.Log.d(\"FrequencyGenerator\", \"Direction: ${if (isUpSweep) \"UP\" else \"DOWN\"}\")\n                                \n                            // Continue to next iteration without breaking\n                            continue\n                            } else {\n                                break\n                            }\n                    }\n\n                    // Log frequency details with time-based algorithm\n                    if (timeBasedCurrentTime - lastLogTime >= logInterval) {\n                        val timeFormatted = java.text.SimpleDateFormat(\"HH:mm:ss.SSS\", java.util.Locale.getDefault()).format(java.util.Date(timeBasedCurrentTime))\n                        val progressPercent = if (isSweep) {\n                            (expectedSlice * 100 / totalSlices).coerceIn(0, 100)\n                        } else {\n                            100\n                        }\n                        \n                        // Enhanced logging for time-based sweep algorithm\n                        if (duration <= 1.0f) {\n                            val expectedFreq = if (isUpSweep) {\n                                startFreq + expectedSlice * delta\n                    } else {\n                                endFreq - expectedSlice * delta\n                            }\n                            val freqError = kotlin.math.abs(freq - expectedFreq)\n                            \n                            android.util.Log.d(\"FrequencyGenerator\", \"TIME_BASED_SWEEP: TIME=$timeFormatted | SLICE=$expectedSlice/$totalSlices | PROGRESS=${progressPercent}% | FREQ=${String.format(\"%.2f\", freq)}Hz | EXPECTED=${String.format(\"%.2f\", expectedFreq)}Hz | ERROR=${String.format(\"%.2f\", freqError)}Hz | DIR=${if (isUpSweep) \"UP\" else \"DOWN\"} | LOOP=$loopCount | UI_FREQ=${String.format(\"%.2f\", currentFreq)}Hz | UI_MATCH=${freq == currentFreq}\")\n                        } else {\n                            android.util.Log.d(\"FrequencyGenerator\", \"TIME_BASED_SWEEP: TIME=$timeFormatted | SLICE=$expectedSlice/$totalSlices | PROGRESS=${progressPercent}% | FREQ=${String.format(\"%.2f\", freq)}Hz | DIR=${if (isUpSweep) \"UP\" else \"DOWN\"} | LOOP=$loopCount\")\n                        }\n                        lastLogTime = timeBasedCurrentTime\n                    }\n\n\n                    // Calculate current gains and update UI feedback\n                    val (currentLeftGain, currentRightGain, volumeInfo) = calculateGains()\n                    withContext(Dispatchers.Main) {\n                        actualLeftGain = currentLeftGain\n                        actualRightGain = currentRightGain\n                        systemVolumeInfo = volumeInfo\n                    }\n                    \n                    // Update volume periodically to catch slider and system volume changes\n                    if (timeBasedCurrentTime - lastVolumeUpdateTime >= volumeUpdateInterval) {\n                        // Also try setStereoVolume as backup (though we use manual multiplication)\n                        track.setStereoVolume(currentLeftGain, currentRightGain)\n                        lastVolumeUpdateTime = timeBasedCurrentTime\n                    }\n                    \n                    val angularVelocity = 2.0 * PI * freq / sampleRate\n\n                    // Log detailed audio generation info every 5 seconds\n                    if (timeBasedCurrentTime - lastLogTime >= 5000L) {\n                        val cyclesPerBuffer = (freq * buffer.size / 2) / sampleRate\n                        val phaseInDegrees = (phase * 180.0 / PI) % 360.0\n                        \n                        android.util.Log.d(\"FrequencyGenerator\", \"AUDIO_GEN: Freq=${String.format(\"%.2f\", freq)}Hz | AngularVel=${String.format(\"%.6f\", angularVelocity)} | Phase=${String.format(\"%.1f\", phaseInDegrees)} | Cycles/Buffer=${String.format(\"%.2f\", cyclesPerBuffer)} | LEFT_VOL=${leftVolume}% | RIGHT_VOL=${rightVolume}% | SYS_VOL=$systemVolumeInfo | LeftGain=${String.format(\"%.3f\", currentLeftGain)} | RightGain=${String.format(\"%.3f\", currentRightGain)}\")\n                    }\n\n                    // Generate stereo audio with MANUAL volume control for precise independent channels\n                    // This ensures 0% = complete mute and precise 1% steps\n                    // Optimized audio generation for ultra-fast sweeps\n                    if (duration <= 1.0f) {\n                        // Use faster generation for ultra-fast sweeps - process stereo pairs\n                        for (i in 0 until buffer.size step 2) {\n                            val rawSample = sin(phase) * Short.MAX_VALUE * 0.3\n                            \n                            // Apply independent channel gains directly to samples\n                            val leftSample = (rawSample * currentLeftGain).toInt().toShort()\n                            val rightSample = (rawSample * currentRightGain).toInt().toShort()\n                            \n                            buffer[i] = leftSample      // Left channel with independent gain\n                            buffer[i + 1] = rightSample  // Right channel with independent gain\n                            \n                            phase += angularVelocity\n                            if (phase >= 2.0 * PI) phase -= 2.0 * PI\n                        }\n                    } else {\n                        // Standard generation for normal sweeps\n                        for (i in 0 until buffer.size step 2) {\n                            val rawSample = sin(phase) * Short.MAX_VALUE * 0.3\n                            \n                            // Apply independent channel gains directly to samples\n                            val leftSample = (rawSample * currentLeftGain).toInt().toShort()\n                            val rightSample = (rawSample * currentRightGain).toInt().toShort()\n                            \n                            buffer[i] = leftSample      // Left channel with independent gain\n                            buffer[i + 1] = rightSample  // Right channel with independent gain\n                            \n                            phase += angularVelocity\n                            if (phase >= 2.0 * PI) phase -= 2.0 * PI\n                        }\n                    }\n\n                    // Write audio data to track\n                    val bytesWritten = track.write(buffer, 0, buffer.size)\n                    if (bytesWritten < 0) {\n                        android.util.Log.e(\"FrequencyGenerator\", \" AudioTrack.write() failed! Error code: $bytesWritten\")\n                    } else if (bytesWritten < buffer.size) {\n                        android.util.Log.w(\"FrequencyGenerator\", \" Partial write: $bytesWritten/${buffer.size} bytes\")\n                    }\n                    \n                    // Time-based control: ensure we don't exceed the target duration\n                    val timeControlCurrentTime = System.currentTimeMillis()\n                    val timeControlElapsedFromStart = timeControlCurrentTime - timeBasedSweepStartTime\n                    val targetSliceTime = expectedSlice * 10L // 10ms per slice\n                    \n                    // If we're behind schedule, don't wait; if ahead, wait to maintain timing\n                    if (timeControlElapsedFromStart < targetSliceTime) {\n                        delay(targetSliceTime - timeControlElapsedFromStart)\n                    }\n                }\n\n                android.util.Log.d(\"FrequencyGenerator\", \" === FREQUENCY SWEEP ENDED ===\")\n                android.util.Log.d(\"FrequencyGenerator\", \" Total Loops: $loopCount | Final Freq: ${String.format(\"%.2f\", currentSweepFreq)}Hz\")\n\n                // Clean up\n                try {\n                    if (track.state == AudioTrack.STATE_INITIALIZED && track.playState == AudioTrack.PLAYSTATE_PLAYING) {\n                track.stop()\n                    }\n                } catch (e: Exception) {\n                    android.util.Log.e(\"FrequencyGenerator\", \" stop() failed or unnecessary (sweep)\", e)\n                }\n                try {\n                track.release()\n                } catch (e: Exception) {\n                    android.util.Log.e(\"FrequencyGenerator\", \" release() failed (sweep)\", e)\n                }\n                currentAudioTrack = null\n                android.util.Log.d(\"FrequencyGenerator\", \" AudioTrack stopped and released\")\n                \n                withContext(Dispatchers.Main) {\n                    playingSweep = false\n                    android.util.Log.d(\"FrequencyGenerator\", \" Set playingSweep = false\")\n                }\n            } catch (e: Exception) {\n                android.util.Log.e(\"FrequencyGenerator\", \" Error in sweep playback\", e)\n                withContext(Dispatchers.Main) {\n                    playingSweep = false\n                    currentAudioTrack = null\n                }\n            }\n        }\n    }\n\n    Scaffold(\n        topBar = {\n            TopAppBar(\n                title = { \n                    Column {\n                        Text(\"Single Tone\", color = Color.White, fontSize = 18.sp)\n                        if (sessionCount > 0) {\n                            Text(\n                                \"Session $sessionCount\", \n                                color = accentColor, \n                                fontSize = 12.sp,\n                                style = MaterialTheme.typography.bodySmall\n                            )\n                        }\n                    }\n                },\n                navigationIcon = {\n                    if (onBack != null) {\n                        IconButton(onClick = {\n                            android.util.Log.d(\"FrequencyGenerator\", \"Back button pressed - showing review dialog\")\n                            showReview = true\n                        }) {\n                            Icon(Icons.Filled.ArrowBack, \"Back\", tint = Color.White)\n                        }\n                    }\n                },\n                colors = TopAppBarDefaults.topAppBarColors(containerColor = bgColor)\n            )\n        },\n        snackbarHost = {\n            SnackbarHost(hostState = snackbarHostState)\n        }\n    ) { padding ->\n        val screenInfo = getScreenInfo()\n        val responsivePadding = getResponsivePadding()\n        val responsiveSpacing = getResponsiveSpacing()\n        \n        Column(\n            modifier = Modifier\n                .fillMaxSize()\n                .padding(padding)\n                .padding(horizontal = responsivePadding, vertical = responsiveSpacing)\n                .then(\n                    if (screenInfo.isTablet) {\n                        Modifier.widthIn(max = getResponsiveMaxWidth())\n                    } else {\n                        Modifier\n                    }\n                ),\n            horizontalAlignment = Alignment.CenterHorizontally,\n            verticalArrangement = Arrangement.spacedBy(responsiveSpacing)\n        ) {\n            // Driver Pair Display at the top\n            var driverPairsText by remember { mutableStateOf<String?>(null) }\n            LaunchedEffect(currentSerialNumber) {\n                if (currentSerialNumber != null && currentSerialNumber!!.isNotBlank()) {\n                    try {\n                        val latestDriverPairing = withContext(Dispatchers.IO) {\n                            repository.getLatestDriverPairing(currentSerialNumber!!)\n                        }\n                        if (latestDriverPairing != null && latestDriverPairing.driverData.isNotBlank()) {\n                            val driverDataJson = org.json.JSONArray(latestDriverPairing.driverData)\n                            // Get only the latest (last) pair\n                            if (driverDataJson.length() > 0) {\n                                val lastIndex = driverDataJson.length() - 1\n                                val pairObj = driverDataJson.getJSONObject(lastIndex)\n                                val driver1 = pairObj.optString(\"driver1\", \"\")\n                                val driver2 = pairObj.optString(\"driver2\", \"\")\n                                if (driver1.isNotBlank() || driver2.isNotBlank()) {\n                                    driverPairsText = \"Pair ${lastIndex + 1}: R-$driver1 L-$driver2\"\n                                } else {\n                                    driverPairsText = null\n                                }\n                            } else {\n                                driverPairsText = null\n                            }\n                        } else {\n                            driverPairsText = null\n                        }\n                    } catch (e: Exception) {\n                        android.util.Log.e(\"FrequencyGenerator\", \"Error fetching driver pairs\", e)\n                        driverPairsText = null\n                    }\n                } else {\n                    driverPairsText = null\n                }\n            }\n            \n            if (driverPairsText != null) {\n                Card(\n                    modifier = Modifier.fillMaxWidth(),\n                    colors = CardDefaults.cardColors(containerColor = Color(0xFF2196F3).copy(alpha = 0.2f)),\n                    shape = RoundedCornerShape(8.dp)\n                ) {\n                    Row(\n                        modifier = Modifier\n                            .fillMaxWidth()\n                            .padding(12.dp),\n                        verticalAlignment = Alignment.CenterVertically,\n                        horizontalArrangement = Arrangement.spacedBy(8.dp)\n                    ) {\n                        Icon(\n                            Icons.Filled.Speaker,\n                            contentDescription = \"Driver Pairs\",\n                            tint = Color(0xFF2196F3),\n                            modifier = Modifier.size(20.dp)\n                        )\n                        Text(\n                            driverPairsText!!,\n                            style = MaterialTheme.typography.bodyMedium,\n                            color = Color.White,\n                            fontSize = 13.sp,\n                            fontWeight = FontWeight.Medium\n                        )\n                    }\n                }\n            }\n            \n            // 1. FREQUENCY SWEEP SECTION (TOP)\n            Text(\n                \"Frequency Sweep\",\n                style = MaterialTheme.typography.titleSmall,\n                color = accentColor,\n                fontSize = 14.sp\n            )\n\n            // Start and End Frequency (Larger)\n            Row(\n                modifier = Modifier.fillMaxWidth(),\n                horizontalArrangement = Arrangement.spacedBy(8.dp)\n            ) {\n                OutlinedTextField(\n                    value = startFreqText,\n                    onValueChange = { newValue ->\n                        android.util.Log.d(\"FrequencyGenerator\", \"Start frequency changed: $newValue\")\n                        startFreqText = newValue\n                        // Allow empty string and partial input for better backspace\n                        if (newValue.isEmpty() || newValue == \".\" || newValue == \"0.\" || newValue == \"0\" || newValue == \".\") {\n                            // Allow partial input - don't validate yet\n                        } else {\n                        newValue.toFloatOrNull()?.let { value ->\n                            if (value >= 1f && value <= 20000f) {\n                                startFreq = value\n                                    android.util.Log.d(\"FrequencyGenerator\", \"Start frequency set to: $value Hz\")\n                                }\n                            }\n                        }\n                    },\n                    label = { Text(\"Start (Hz)\", fontSize = 13.sp) },\n                    modifier = Modifier.weight(1f).height(getResponsiveTextFieldHeight()),\n                    colors = OutlinedTextFieldDefaults.colors(\n                        focusedBorderColor = accentColor,\n                        unfocusedBorderColor = Color(0xFF424242),\n                        focusedTextColor = Color.White,\n                        unfocusedTextColor = Color.White,\n                        focusedLabelColor = accentColor,\n                        unfocusedLabelColor = Color.White.copy(0.7f)\n                    ),\n                    textStyle = MaterialTheme.typography.bodyLarge.copy(fontSize = getResponsiveTextSize(16f).sp),\n                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)\n                )\n\n                OutlinedTextField(\n                    value = endFreqText,\n                    onValueChange = { newValue ->\n                        android.util.Log.d(\"FrequencyGenerator\", \"End frequency changed: $newValue\")\n                        endFreqText = newValue\n                        // Allow empty string and partial input for better backspace\n                        if (newValue.isEmpty() || newValue == \".\" || newValue == \"0.\" || newValue == \"0\" || newValue == \".\") {\n                            // Allow partial input - don't validate yet\n                        } else {\n                        newValue.toFloatOrNull()?.let { value ->\n                            if (value >= 1f && value <= 20000f) {\n                                endFreq = value\n                                    android.util.Log.d(\"FrequencyGenerator\", \"End frequency set to: $value Hz\")\n                                }\n                            }\n                        }\n                    },\n                    label = { Text(\"End (Hz)\", fontSize = 13.sp) },\n                    modifier = Modifier.weight(1f).height(getResponsiveTextFieldHeight()),\n                    colors = OutlinedTextFieldDefaults.colors(\n                        focusedBorderColor = accentColor,\n                        unfocusedBorderColor = Color(0xFF424242),\n                        focusedTextColor = Color.White,\n                        unfocusedTextColor = Color.White,\n                        focusedLabelColor = accentColor,\n                        unfocusedLabelColor = Color.White.copy(0.7f)\n                    ),\n                    textStyle = MaterialTheme.typography.bodyLarge.copy(fontSize = getResponsiveTextSize(16f).sp),\n                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)\n                )\n            }\n\n            // Duration and Loop (Larger)\n            Row(\n                modifier = Modifier.fillMaxWidth(),\n                horizontalArrangement = Arrangement.spacedBy(8.dp)\n            ) {\n                OutlinedTextField(\n                    value = durationText,\n                    onValueChange = { newValue ->\n                        android.util.Log.d(\"FrequencyGenerator\", \"Duration changed: $newValue\")\n                        durationText = newValue\n                        // Allow empty string, decimal input, and partial numbers for better backspace\n                        if (newValue.isEmpty() || newValue == \".\" || newValue == \"0.\" || newValue == \"0\") {\n                            // Allow partial input - don't validate yet\n                        } else {\n                        newValue.toFloatOrNull()?.let { value ->\n                                if (value >= 0.01f && value <= 300f) {\n                                duration = value\n                                    android.util.Log.d(\"FrequencyGenerator\", \"Duration set to: $value seconds\")\n                                }\n                            }\n                        }\n                    },\n                    label = { Text(\"Duration (sec)\", fontSize = 13.sp) },\n                    modifier = Modifier.weight(1f).height(getResponsiveTextFieldHeight()),\n                    colors = OutlinedTextFieldDefaults.colors(\n                        focusedBorderColor = accentColor,\n                        unfocusedBorderColor = Color(0xFF424242),\n                        focusedTextColor = Color.White,\n                        unfocusedTextColor = Color.White,\n                        focusedLabelColor = accentColor,\n                        unfocusedLabelColor = Color.White.copy(0.7f)\n                    ),\n                    textStyle = MaterialTheme.typography.bodyLarge.copy(fontSize = getResponsiveTextSize(16f).sp),\n                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)\n                )\n\n                // Loop Checkbox\n                Row(\n                    modifier = Modifier\n                        .weight(1f)\n                        .height(72.dp)\n                        .padding(vertical = 16.dp),\n                    verticalAlignment = Alignment.CenterVertically\n                ) {\n                    Checkbox(\n                        checked = loopSweep,\n                        onCheckedChange = { \n                            android.util.Log.d(\"FrequencyGenerator\", \"Loop checkbox changed: $it\")\n                            loopSweep = it\n                            loop = it\n                        },\n                        colors = CheckboxDefaults.colors(\n                            checkedColor = accentColor,\n                            uncheckedColor = Color(0xFF424242)\n                        )\n                    )\n                    Spacer(Modifier.width(8.dp))\n                    Text(\n                        \"Loop\",\n                        color = Color.White,\n                        fontSize = 14.sp\n                    )\n                }\n            }\n\n            Divider(color = Color(0xFF424242), modifier = Modifier.padding(vertical = 2.dp))\n\n            // 2. AUDIO VOLUME SECTION (MIDDLE) - Compact Design\n            // Header with Reset button, Title, and System volume\n            Row(\n                modifier = Modifier.fillMaxWidth(),\n                horizontalArrangement = Arrangement.SpaceBetween,\n                verticalAlignment = Alignment.CenterVertically\n            ) {\n                TextButton(\n                    onClick = { \n                        leftVolume = 100\n                        rightVolume = 100\n                    },\n                    modifier = Modifier.height(28.dp),\n                    contentPadding = PaddingValues(horizontal = 8.dp, vertical = 2.dp),\n                    colors = ButtonDefaults.textButtonColors(\n                        contentColor = accentColor\n                    )\n                ) {\n                    Text(\"Reset\", fontSize = 11.sp, color = accentColor)\n                }\n                \n                Text(\n                    \"Volume Control\",\n                    style = MaterialTheme.typography.bodySmall,\n                    color = accentColor,\n                    fontSize = 11.sp\n                )\n                \n                // System volume info\n                val audioManager = context.getSystemService(android.content.Context.AUDIO_SERVICE) as AudioManager\n                val maxSystemVolume = audioManager.getStreamMaxVolume(AudioManager.STREAM_MUSIC)\n                val currentSystemVolume = audioManager.getStreamVolume(AudioManager.STREAM_MUSIC)\n                Text(\n                    \"System: $currentSystemVolume/$maxSystemVolume\",\n                    style = MaterialTheme.typography.bodySmall,\n                    color = Color.White.copy(alpha = 0.9f),\n                    fontSize = 10.sp,\n                    modifier = Modifier.padding(end = 8.dp)\n                )\n            }\n            \n            // Left Channel Slider\n            Row(\n                modifier = Modifier.fillMaxWidth().padding(top = 2.dp),\n                verticalAlignment = Alignment.CenterVertically,\n                horizontalArrangement = Arrangement.SpaceBetween\n            ) {\n                Text(\n                    \"Left\",\n                    style = MaterialTheme.typography.bodySmall,\n                    color = Color.White.copy(alpha = 0.9f),\n                    fontSize = 12.sp,\n                    modifier = Modifier.width(50.dp)\n                )\n                Slider(\n                    value = leftVolume.toFloat(),\n                    onValueChange = { newValue ->\n                        // Round to nearest integer for exact 1% steps (0-100)\n                        val newVolume = newValue.roundToInt().coerceIn(0, 100)\n                        if (leftVolume != newVolume) {\n                            android.util.Log.d(\"FrequencyGenerator\", \"Left volume slider changed: $newVolume%\")\n                            leftVolume = newVolume\n                        }\n                    },\n                    valueRange = 0f..100f,\n                    steps = 99, // 100 steps (0-100) with 99 intervals for 1% precision\n                    modifier = Modifier.weight(1f).padding(horizontal = 8.dp),\n                    colors = SliderDefaults.colors(\n                        thumbColor = Color.White,\n                        activeTrackColor = accentColor,\n                        inactiveTrackColor = Color(0xFF424242)\n                    )\n                )\n                Text(\n                    \"${leftVolume}%\",\n                    style = MaterialTheme.typography.bodySmall,\n                    color = Color.White.copy(alpha = 0.9f),\n                    fontSize = 12.sp,\n                    modifier = Modifier.width(40.dp),\n                    textAlign = TextAlign.End\n                )\n            }\n            \n            // Right Channel Slider (minimal gap)\n            Row(\n                modifier = Modifier.fillMaxWidth().padding(top = 1.dp),\n                verticalAlignment = Alignment.CenterVertically,\n                horizontalArrangement = Arrangement.SpaceBetween\n            ) {\n                Text(\n                    \"Right\",\n                    style = MaterialTheme.typography.bodySmall,\n                    color = Color.White.copy(alpha = 0.9f),\n                    fontSize = 12.sp,\n                    modifier = Modifier.width(50.dp)\n                )\n                Slider(\n                    value = rightVolume.toFloat(),\n                    onValueChange = { newValue ->\n                        // Round to nearest integer for exact 1% steps (0-100)\n                        val newVolume = newValue.roundToInt().coerceIn(0, 100)\n                        if (rightVolume != newVolume) {\n                            android.util.Log.d(\"FrequencyGenerator\", \"Right volume slider changed: $newVolume%\")\n                            rightVolume = newVolume\n                        }\n                    },\n                    valueRange = 0f..100f,\n                    steps = 99, // 100 steps (0-100) with 99 intervals for 1% precision\n                    modifier = Modifier.weight(1f).padding(horizontal = 8.dp),\n                    colors = SliderDefaults.colors(\n                        thumbColor = Color.White,\n                        activeTrackColor = accentColor,\n                        inactiveTrackColor = Color(0xFF424242)\n                    )\n                )\n                Text(\n                    \"${rightVolume}%\",\n                    style = MaterialTheme.typography.bodySmall,\n                    color = Color.White.copy(alpha = 0.9f),\n                    fontSize = 12.sp,\n                    modifier = Modifier.width(40.dp),\n                    textAlign = TextAlign.End\n                )\n            }\n            \n            // Gain values at bottom (always visible, compact)\n            Row(\n                modifier = Modifier.fillMaxWidth().padding(top = 1.dp),\n                horizontalArrangement = Arrangement.SpaceBetween\n            ) {\n                Text(\n                    \"L Gain: ${String.format(\"%.1f\", actualLeftGain * 100)}%\",\n                    style = MaterialTheme.typography.bodySmall,\n                    color = if (actualLeftGain == 0.0f) Color.Red else Color.White.copy(alpha = 0.7f),\n                    fontSize = 10.sp\n                )\n                Text(\n                    \"R Gain: ${String.format(\"%.1f\", actualRightGain * 100)}%\",\n                    style = MaterialTheme.typography.bodySmall,\n                    color = if (actualRightGain == 0.0f) Color.Red else Color.White.copy(alpha = 0.7f),\n                    fontSize = 10.sp\n                )\n            }\n\n            Divider(color = Color(0xFF424242), modifier = Modifier.padding(vertical = 2.dp))\n\n            // 3. SINGLE TONE SECTION (BELOW)\n            Text(\n                \"Single Tone\",\n                style = MaterialTheme.typography.titleSmall,\n                color = accentColor,\n                fontSize = 14.sp\n            )\n\n            // Playing Frequency Display (Compact)\n            Text(\n                \"${String.format(\"%.1f\", currentFreq)} Hz\",\n                style = MaterialTheme.typography.displayMedium,\n                color = accentColor,\n                fontSize = getResponsiveTextSize(24f).sp,\n                fontWeight = FontWeight.ExtraBold,\n                modifier = Modifier.clickable { showFreqDialog = true }\n            )\n\n            // Top Controls: - Play + for Single Frequency\n            Row(\n                modifier = Modifier.fillMaxWidth(),\n                horizontalArrangement = Arrangement.spacedBy(8.dp, Alignment.CenterHorizontally),\n                verticalAlignment = Alignment.CenterVertically\n            ) {\n                // - Button with long press support (LEFT SIDE)\n                Surface(\n                    modifier = Modifier\n                        .size(getResponsiveButtonSize())\n                        .pointerInput(Unit) {\n                            detectTapGestures(\n                                onTap = { currentFreq = (currentFreq - 1f).coerceAtLeast(1f) },\n                                onPress = {\n                                    isHoldingMinus = true\n                                    tryAwaitRelease()\n                                    isHoldingMinus = false\n                                }\n                            )\n                        },\n                    shape = androidx.compose.foundation.shape.CircleShape,\n                    color = surfaceColor\n                ) {\n                    Box(contentAlignment = Alignment.Center) {\n                        Icon(\n                            Icons.Filled.Remove,\n                            \"Decrease\",\n                            tint = Color.White,\n                            modifier = Modifier.size(getResponsiveIconSize())\n                        )\n                    }\n                }\n\n                Button(\n                    onClick = { \n                        android.util.Log.d(\"FrequencyGenerator\", \" BUTTON_PRESSED: Play Single Frequency\")\n                        android.util.Log.d(\"FrequencyGenerator\", \" STATE_BEFORE: playingSingle=$playingSingle, playingSweep=$playingSweep\")\n                        playSingleFrequency()\n                        android.util.Log.d(\"FrequencyGenerator\", \" STATE_AFTER: playingSingle=$playingSingle, playingSweep=$playingSweep\")\n                    },\n                    modifier = Modifier.height(getResponsiveButtonSize()),\n                    colors = ButtonDefaults.buttonColors(\n                        containerColor = if (playingSingle) Color(0xFF555555) else accentColor,\n                        contentColor = if (playingSingle) Color.White else bgColor\n                    ),\n                    shape = RoundedCornerShape(12.dp)\n                ) {\n                    Icon(\n                        if (playingSingle) Icons.Filled.Stop else Icons.Filled.PlayArrow,\n                        contentDescription = null,\n                        modifier = Modifier.size(22.dp)\n                    )\n                    Spacer(Modifier.width(8.dp))\n                    Text(\n                        if (playingSingle) \"Stop\" else \"Play\",\n                        fontSize = 16.sp,\n                        fontWeight = FontWeight.Bold\n                    )\n                }\n\n                // + Button with long press support (RIGHT SIDE)\n                Surface(\n                    modifier = Modifier\n                        .size(getResponsiveButtonSize())\n                        .pointerInput(Unit) {\n                            detectTapGestures(\n                                onTap = { currentFreq = (currentFreq + 1f).coerceAtMost(20000f) },\n                                onPress = {\n                                    isHoldingPlus = true\n                                    tryAwaitRelease()\n                                    isHoldingPlus = false\n                                }\n                            )\n                        },\n                    shape = androidx.compose.foundation.shape.CircleShape,\n                    color = surfaceColor\n                ) {\n                    Box(contentAlignment = Alignment.Center) {\n                        Icon(\n                            Icons.Filled.Add,\n                            \"Increase\",\n                            tint = Color.White,\n                            modifier = Modifier.size(getResponsiveIconSize())\n                        )\n                    }\n                }\n            }\n\n            // Frequency Slider\n            Slider(\n                value = currentFreq,\n                onValueChange = { currentFreq = it },\n                valueRange = 1f..1000f,\n                modifier = Modifier.fillMaxWidth(),\n                colors = SliderDefaults.colors(\n                    thumbColor = accentColor,\n                    activeTrackColor = accentColor,\n                    inactiveTrackColor = Color(0xFF424242)\n                )\n            )\n\n            // Animated Waveform (Compact)\n            Card(\n                modifier = Modifier\n                    .fillMaxWidth()\n                    .height(getResponsiveButtonSize()),\n                colors = CardDefaults.cardColors(containerColor = surfaceColor)\n            ) {\n                AnimatedWaveform(\n                    frequency = if (playingSingle || playingSweep) currentFreq else 100f,\n                    phase = if (playingSingle || playingSweep) wavePhase else 0f,\n                    color = accentColor\n                )\n            }\n\n\n\n\n            if (currentSessionId == null) {\n                Text(\n                    \"Scan QR first\",\n                    style = MaterialTheme.typography.bodySmall,\n                    color = Color(0xFFCF6679),\n                    fontSize = 10.sp\n                )\n            }\n\n            // Play Sweep and Review Buttons\n            Row(\n                modifier = Modifier.fillMaxWidth(),\n                horizontalArrangement = Arrangement.spacedBy(8.dp)\n            ) {\n                Button(\n                    onClick = {\n                        android.util.Log.d(\"FrequencyGenerator\", \" BUTTON_PRESSED: Play Sweep\")\n                        android.util.Log.d(\"FrequencyGenerator\", \" STATE_BEFORE: playingSingle=$playingSingle, playingSweep=$playingSweep\")\n                        android.util.Log.d(\"FrequencyGenerator\", \" SWEEP_PARAMS: Start=$startFreq Hz, End=$endFreq Hz, Duration=$duration sec, Loop=$loop\")\n                        if (playingSweep) {\n                            android.util.Log.d(\"FrequencyGenerator\", \" STOPPING: sweep is playing, calling stopAllAudio()\")\n                            stopAllAudio()\n                        } else {\n                            android.util.Log.d(\"FrequencyGenerator\", \" STARTING: sweep not playing, calling playSweep()\")\n                            playSweep()\n                        }\n                        android.util.Log.d(\"FrequencyGenerator\", \" STATE_AFTER: playingSingle=$playingSingle, playingSweep=$playingSweep\")\n                    },\n                    modifier = Modifier.weight(1f),\n                    colors = ButtonDefaults.buttonColors(\n                        containerColor = accentColor,\n                        contentColor = bgColor\n                    )\n                ) {\n                    Text(\n                        if (playingSweep) \"Stop Sweep\" else \"Play Sweep\",\n                        fontSize = 13.sp,\n                        fontWeight = FontWeight.Bold\n                    )\n                }\n\n                Button(\n                    onClick = { \n                        android.util.Log.d(\"FrequencyGenerator\", \"Review button pressed\")\n                        showReview = true \n                    },\n                    modifier = Modifier.weight(1f),\n                    colors = ButtonDefaults.buttonColors(\n                        containerColor = Color(0xFF4CAF50),\n                        contentColor = Color.White\n                    )\n                ) {\n                    Text(\"Review\", fontSize = 13.sp, fontWeight = FontWeight.Bold)\n                }\n            }\n        }\n    }\n\n    // Frequency Edit Dialog\n    if (showFreqDialog) {\n        var tempFreq by remember { mutableStateOf(currentFreq.toInt().toString()) }\n        \n        AlertDialog(\n            onDismissRequest = { showFreqDialog = false },\n            title = { Text(\"Set Frequency\", color = accentColor) },\n            text = {\n                OutlinedTextField(\n                    value = tempFreq,\n                    onValueChange = { tempFreq = it },\n                    label = { Text(\"Frequency (Hz)\") },\n                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number),\n                    colors = OutlinedTextFieldDefaults.colors(\n                        focusedBorderColor = accentColor,\n                        focusedTextColor = Color.White,\n                        unfocusedTextColor = Color.White\n                    )\n                )\n            },\n            confirmButton = {\n                Button(\n                    onClick = {\n                        tempFreq.toFloatOrNull()?.let {\n                            currentFreq = it.coerceIn(1f, 20000f)\n                        }\n                        showFreqDialog = false\n                    },\n                    colors = ButtonDefaults.buttonColors(\n                        containerColor = accentColor,\n                        contentColor = bgColor\n                    )\n                ) {\n                    Text(\"Set\")\n                }\n            },\n            dismissButton = {\n                TextButton(onClick = { showFreqDialog = false }) {\n                    Text(\"Cancel\", color = Color.White)\n                }\n            },\n            containerColor = surfaceColor\n        )\n    }\n\n    // Dialog A: Pass/Fail Selection - HIDDEN (using new ReviewScreen instead)\n    // if (showReview) {\n    //     AlertDialog(\n    //         onDismissRequest = { showReview = false },\n    //         containerColor = surfaceColor,\n    //         title = {\n    //             Text(\n    //                 \"Review result\",\n    //                 color = accentColor,\n    //                 fontWeight = FontWeight.Bold,\n    //                 fontSize = 20.sp\n    //             )\n    //         },\n    //         text = {\n    //             Column(\n    //                 modifier = Modifier.fillMaxWidth(),\n    //                 verticalArrangement = Arrangement.spacedBy(12.dp)\n    //             ) {\n    //                 Text(\n    //                     \"Did the frequency test pass or fail?\",\n    //                     color = Color.White.copy(alpha = 0.9f),\n    //                     fontSize = 14.sp\n    //                 )\n    //             }\n    //         },\n    //         confirmButton = {\n    //             Column(\n    //                 modifier = Modifier.fillMaxWidth(),\n    //                 verticalArrangement = Arrangement.spacedBy(8.dp)\n    //             ) {\n    //                 // Pass Button\n    //                 Button(\n    //                     onClick = {\n    //                         android.util.Log.d(\"FrequencyGenerator\", \"Pass button selected in review dialog\")\n    //                         android.util.Log.d(\"FrequencyGenerator\", \"Calling logReview function...\")\n    //                         logReview(\n    //                             ReviewLog(\n    //                                 serialNumber = currentSerialNumber,\n    //                                 type = \"frequency\",\n    //                                 result = \"pass\",\n    //                                 issues = emptyList(),\n    //                                 remark = \"\",\n    //                                 solutions = emptyList(),\n    //                                 otherSolution = \"\"\n    //                             )\n    //                         )\n    //                         showReview = false\n    //                         selectedIssues = setOf()\n    //                         remark = \"\"\n    //                         // Navigate to landing page\n    //                         onBack?.invoke()\n    //                     },\n    //                     modifier = Modifier\n    //                         .fillMaxWidth()\n    //                         .height(48.dp),\n    //                     colors = ButtonDefaults.buttonColors(\n    //                         containerColor = Color(0xFF33D17A),\n    //                         contentColor = Color.White\n    //                     ),\n    //                     shape = RoundedCornerShape(8.dp)\n    //                 ) {\n    //                     Icon(Icons.Filled.CheckCircle, null, modifier = Modifier.size(20.dp))\n    //                     Spacer(Modifier.width(8.dp))\n    //                     Text(\"Pass\", fontSize = 16.sp, fontWeight = FontWeight.Bold)\n    //                 }\n    //                 \n    //                 // Can be Passed Button\n    //                 Button(\n    //                     onClick = {\n    //                         android.util.Log.d(\"FrequencyGenerator\", \"Can be Passed button selected in review dialog\")\n    //                         logReview(\n    //                             ReviewLog(\n    //                                 serialNumber = currentSerialNumber,\n    //                                 type = \"frequency\",\n    //                                 result = \"can_be_passed\",\n    //                                 issues = emptyList(),\n    //                                 remark = \"\",\n    //                                 solutions = emptyList(),\n    //                                 otherSolution = \"\"\n    //                             )\n    //                         )\n    //                         showReview = false\n    //                         selectedIssues = setOf()\n    //                         remark = \"\"\n    //                         // Navigate to landing page\n    //                         onBack?.invoke()\n    //                     },\n    //                     modifier = Modifier\n    //                         .fillMaxWidth()\n    //                         .height(48.dp),\n    //                     colors = ButtonDefaults.buttonColors(\n    //                         containerColor = Color(0xFFF39C12),\n    //                         contentColor = Color.White\n    //                     ),\n    //                     shape = RoundedCornerShape(8.dp)\n    //                 ) {\n    //                     Icon(Icons.Filled.Warning, null, modifier = Modifier.size(20.dp))\n    //                     Spacer(Modifier.width(8.dp))\n    //                     Text(\"Can be Passed\", fontSize = 16.sp, fontWeight = FontWeight.Bold)\n    //                 }\n    //             }\n    //         },\n    //         dismissButton = {\n    //             Column(\n    //                 modifier = Modifier.fillMaxWidth(),\n    //                 verticalArrangement = Arrangement.spacedBy(8.dp)\n    //             ) {\n    //                 // Fail Button\n    //                 OutlinedButton(\n    //                     onClick = {\n    //                         showReview = false\n    //                         showFailDialog = true\n    //                     },\n    //                     modifier = Modifier\n    //                         .fillMaxWidth()\n    //                         .height(48.dp),\n    //                     colors = ButtonDefaults.outlinedButtonColors(\n    //                         contentColor = Color(0xFFCF6679)\n    //                     ),\n    //                     border = androidx.compose.foundation.BorderStroke(2.dp, Color(0xFFCF6679)),\n    //                     shape = RoundedCornerShape(8.dp)\n    //                 ) {\n    //                     Icon(Icons.Filled.Cancel, null, modifier = Modifier.size(20.dp))\n    //                     Spacer(Modifier.width(8.dp))\n    //                     Text(\"Fail\", fontSize = 16.sp, fontWeight = FontWeight.Bold)\n    //                 }\n    //                 \n    //                 // Test not done Button\n    //                 OutlinedButton(\n    //                     onClick = {\n    //                         android.util.Log.d(\"FrequencyGenerator\", \"Test not done button selected in review dialog\")\n    //                         logReview(\n    //                             ReviewLog(\n    //                                 serialNumber = currentSerialNumber,\n    //                                 type = \"frequency\",\n    //                                 result = \"test_not_done\",\n    //                                 issues = emptyList(),\n    //                                 remark = \"\",\n    //                                 solutions = emptyList(),\n    //                                 otherSolution = \"\"\n    //                             )\n    //                         )\n    //                         showReview = false\n    //                         selectedIssues = setOf()\n    //                         remark = \"\"\n    //                         // Navigate to landing page\n    //                         onBack?.invoke()\n    //                     },\n    //                     modifier = Modifier\n    //                         .fillMaxWidth()\n    //                         .height(48.dp),\n    //                     colors = ButtonDefaults.outlinedButtonColors(\n    //                         contentColor = Color(0xFF9E9E9E)\n    //                     ),\n    //                     border = androidx.compose.foundation.BorderStroke(2.dp, Color(0xFF9E9E9E)),\n    //                     shape = RoundedCornerShape(8.dp)\n    //                 ) {\n    //                     Icon(Icons.Filled.Remove, null, modifier = Modifier.size(20.dp))\n    //                     Spacer(Modifier.width(8.dp))\n    //                     Text(\"Test not done\", fontSize = 16.sp, fontWeight = FontWeight.Bold)\n    //                 }\n\n    //                 // Close Button\n    //                 TextButton(\n    //                     onClick = { \n    //                         showReview = false\n    //                         selectedIssues = setOf()\n    //                         remark = \"\"\n    //                     },\n    //                     modifier = Modifier.fillMaxWidth()\n    //                 ) {\n    //                     Icon(Icons.Filled.Close, null)\n    //                     Spacer(Modifier.width(4.dp))\n    //                     Text(\"Close\", color = Color.White.copy(alpha = 0.7f))\n    //                 }\n    //             }\n    //         }\n    //     )\n    // }\n\n    // Dialog B: Mark Issues\n    if (showFailDialog) {\n        val issueOptions = listOf(\n            \"Right to left shift\",\n            \"Left to right shift\",\n            \"Right dominant\",\n            \"Left dominant\",\n            \"Wire sound\",\n            \"Chirr issue\",\n            \"High pressure headband\"\n        )\n\n        AlertDialog(\n            onDismissRequest = { },\n            containerColor = surfaceColor,\n            title = {\n                Text(\n                    \"Mark issues\",\n                    color = accentColor,\n                    fontWeight = FontWeight.Bold,\n                    fontSize = 20.sp\n                )\n            },\n            text = {\n    Column(\n                    modifier = Modifier\n                        .fillMaxWidth()\n                        .heightIn(max = 500.dp)\n                        .verticalScroll(rememberScrollState()),\n                    verticalArrangement = Arrangement.spacedBy(2.dp)\n                ) {\n                    Text(\n                        \"Select all issues found:\",\n                        color = Color.White.copy(alpha = 0.7f),\n                        fontSize = 14.sp,\n                        fontWeight = FontWeight.SemiBold,\n                        modifier = Modifier.padding(bottom = 12.dp)\n                    )\n\n                    // Display issues in 2 columns\n                    val chunkedIssues = issueOptions.chunked(2)\n                    chunkedIssues.forEach { rowIssues ->\n                        Row(\n                            modifier = Modifier.fillMaxWidth(),\n                            horizontalArrangement = Arrangement.spacedBy(4.dp)\n                        ) {\n                            rowIssues.forEach { issue ->\n                                Row(\n                                    modifier = Modifier\n                                        .weight(1f)\n                                        .clickable {\n                                            selectedIssues = if (selectedIssues.contains(issue)) {\n                                                selectedIssues - issue\n                                            } else {\n                                                selectedIssues + issue\n                                            }\n                                        }\n                                        .padding(vertical = 2.dp),\n                                    verticalAlignment = Alignment.CenterVertically\n                                ) {\n                                    Checkbox(\n                                        checked = selectedIssues.contains(issue),\n                                        onCheckedChange = {\n                                            android.util.Log.d(\"FrequencyGenerator\", \"Issue checkbox changed: $issue = $it\")\n                                            selectedIssues = if (it) {\n                                                selectedIssues + issue\n                                            } else {\n                                                selectedIssues - issue\n                                            }\n                                        },\n                                        modifier = Modifier.size(20.dp),\n                                        colors = CheckboxDefaults.colors(\n                                            checkedColor = accentColor,\n                                            uncheckedColor = Color(0xFF424242)\n                                        )\n                                    )\n                                    Text(\n                                        issue,\n                                        color = Color.White,\n                                        fontSize = 13.sp,\n                                        modifier = Modifier.padding(start = 4.dp)\n                                    )\n                                }\n                            }\n                            // Add empty space if odd number of items\n                            if (rowIssues.size < 2) {\n                                Spacer(Modifier.weight(1f))\n                            }\n                        }\n                    }\n\n        Spacer(Modifier.height(16.dp))\n\n        OutlinedTextField(\n                        value = remark,\n                        onValueChange = { \n                            android.util.Log.d(\"FrequencyGenerator\", \"Remark text changed: $it\")\n                            remark = it \n                        },\n                        label = { Text(\"Remark\", color = Color.White.copy(alpha = 0.7f)) },\n                        placeholder = { Text(\"Add additional notes...\", color = Color.White.copy(alpha = 0.5f)) },\n                        modifier = Modifier.fillMaxWidth(),\n                        minLines = 3,\n                        maxLines = 5,\n                        colors = OutlinedTextFieldDefaults.colors(\n                            focusedBorderColor = accentColor,\n                            unfocusedBorderColor = Color(0xFF424242),\n                            focusedTextColor = Color.White,\n                            unfocusedTextColor = Color.White,\n                            cursorColor = accentColor\n                        ),\n                        shape = RoundedCornerShape(8.dp)\n                    )\n                }\n            },\n            confirmButton = {\n                Row(\n                    modifier = Modifier.fillMaxWidth(),\n                    horizontalArrangement = Arrangement.spacedBy(8.dp)\n                ) {\n                    // Back Button\n                    OutlinedButton(\n                        onClick = {\n                            showFailDialog = false\n                            showReview = true\n                        },\n                        modifier = Modifier.weight(1f),\n                        colors = ButtonDefaults.outlinedButtonColors(\n                            contentColor = Color.White\n                        )\n                    ) {\n                        Icon(Icons.Filled.ArrowBack, null, modifier = Modifier.size(18.dp))\n                        Spacer(Modifier.width(4.dp))\n                        Text(\"Back\", fontSize = 13.sp)\n                    }\n\n                    // OK Button\n                    Button(\n                        onClick = {\n                            showFailDialog = false\n                            showSolutionsDialog = true\n                        },\n                        modifier = Modifier.weight(1f),\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = accentColor,\n                            contentColor = bgColor\n                        )\n                    ) {\n                        Text(\"OK\", fontSize = 13.sp, fontWeight = FontWeight.Bold)\n                    }\n                }\n            },\n            dismissButton = {\n                TextButton(\n                    onClick = {\n                        showFailDialog = false\n                        showReview = false\n                        selectedIssues = setOf()\n                        remark = \"\"\n                    },\n                    modifier = Modifier.fillMaxWidth()\n                ) {\n                    Text(\"Cancel\", color = Color.White.copy(alpha = 0.7f))\n                }\n            }\n        )\n    }\n\n    // Dialog C: Solutions Dialog\n    if (showSolutionsDialog) {\n        AlertDialog(\n            onDismissRequest = { showSolutionsDialog = false },\n            title = {\n                Text(\n                    \"Potential Solutions\",\n                    color = Color.White,\n                    fontSize = 18.sp,\n                    fontWeight = FontWeight.Bold\n                )\n            },\n            text = {\n                Column(\n                    modifier = Modifier.fillMaxWidth(),\n                    verticalArrangement = Arrangement.spacedBy(12.dp)\n                ) {\n                    Text(\n                        \"Select potential solutions for the identified issues:\",\n                        color = Color.White.copy(alpha = 0.8f),\n                        fontSize = 14.sp\n                    )\n\n                    // Solutions checkboxes in rows of 2\n                    val solutionRows = availableSolutions.chunked(2)\n                    solutionRows.forEach { rowSolutions ->\n                        Row(\n                            modifier = Modifier.fillMaxWidth(),\n                            horizontalArrangement = Arrangement.spacedBy(16.dp)\n                        ) {\n                            rowSolutions.forEach { solution ->\n                                Row(\n                                    modifier = Modifier\n                                        .weight(1f)\n                                        .clickable {\n                                            selectedSolutions = if (selectedSolutions.contains(solution)) {\n                                                selectedSolutions - solution\n                                            } else {\n                                                selectedSolutions + solution\n                                            }\n                                        }\n                                        .padding(vertical = 2.dp),\n                                    verticalAlignment = Alignment.CenterVertically\n                                ) {\n                                    Checkbox(\n                                        checked = selectedSolutions.contains(solution),\n                                        onCheckedChange = {\n                                            android.util.Log.d(\"FrequencyGenerator\", \"Solution checkbox changed: $solution = $it\")\n                                            selectedSolutions = if (it) {\n                                                selectedSolutions + solution\n                                            } else {\n                                                selectedSolutions - solution\n                                            }\n                                        },\n                                        modifier = Modifier.size(20.dp),\n                                        colors = CheckboxDefaults.colors(\n                                            checkedColor = accentColor,\n                                            uncheckedColor = Color(0xFF424242)\n                                        )\n                                    )\n                                    Text(\n                                        solution,\n                                        color = Color.White,\n                                        fontSize = 13.sp,\n                                        modifier = Modifier.padding(start = 4.dp)\n                                    )\n                                }\n                            }\n                            // Add empty space if odd number of items\n                            if (rowSolutions.size < 2) {\n                                Spacer(Modifier.weight(1f))\n                            }\n                        }\n                    }\n\n                    Spacer(Modifier.height(16.dp))\n\n                    OutlinedTextField(\n                        value = otherSolution,\n                        onValueChange = { \n                            android.util.Log.d(\"FrequencyGenerator\", \"Other solution text changed: $it\")\n                            otherSolution = it \n                        },\n                        label = { Text(\"Other Solution\", color = Color.White.copy(alpha = 0.7f)) },\n                        placeholder = { Text(\"Enter other potential solution...\", color = Color.White.copy(alpha = 0.5f)) },\n                        modifier = Modifier.fillMaxWidth(),\n                        minLines = 2,\n                        maxLines = 3,\n                        colors = OutlinedTextFieldDefaults.colors(\n                            focusedBorderColor = accentColor,\n                            unfocusedBorderColor = Color(0xFF424242),\n                            focusedTextColor = Color.White,\n                            unfocusedTextColor = Color.White,\n                            cursorColor = accentColor\n                        ),\n                        shape = RoundedCornerShape(8.dp)\n                    )\n                }\n            },\n            confirmButton = {\n                Row(\n                    modifier = Modifier.fillMaxWidth(),\n                    horizontalArrangement = Arrangement.spacedBy(8.dp)\n                ) {\n                    // Back Button\n                    OutlinedButton(\n                        onClick = {\n                            showSolutionsDialog = false\n                            showFailDialog = true\n                        },\n                        modifier = Modifier.weight(1f),\n                        colors = ButtonDefaults.outlinedButtonColors(\n                            contentColor = Color.White\n                        )\n                    ) {\n                        Icon(Icons.Filled.ArrowBack, null, modifier = Modifier.size(18.dp))\n                        Spacer(Modifier.width(4.dp))\n                        Text(\"Back\", fontSize = 13.sp)\n                    }\n\n                    // OK Button\n            Button(\n                        onClick = {\n                            android.util.Log.d(\"FrequencyGenerator\", \"Final OK button pressed in solutions dialog\")\n                            android.util.Log.d(\"FrequencyGenerator\", \"Selected issues: ${selectedIssues.toList()}\")\n                            android.util.Log.d(\"FrequencyGenerator\", \"Selected solutions: ${selectedSolutions.toList()}\")\n                            android.util.Log.d(\"FrequencyGenerator\", \"Remark: $remark\")\n                            android.util.Log.d(\"FrequencyGenerator\", \"Other solution: $otherSolution\")\n                            \n                            logReview(\n                                ReviewLog(\n                                    serialNumber = currentSerialNumber,\n                                    type = \"frequency\",\n                                    result = \"fail\",\n                                    issues = selectedIssues.toList(),\n                                    remark = remark,\n                                    solutions = selectedSolutions.toList(),\n                                    otherSolution = otherSolution\n                                )\n                            )\n                            showSolutionsDialog = false\n                            selectedIssues = setOf()\n                            selectedSolutions = setOf()\n                            remark = \"\"\n                            otherSolution = \"\"\n                            // Navigate to landing page\n                            onBack?.invoke()\n                        },\n                        modifier = Modifier.weight(1f),\n                colors = ButtonDefaults.buttonColors(\n                            containerColor = accentColor,\n                            contentColor = bgColor\n                        )\n                    ) {\n                        Text(\"OK\", fontSize = 13.sp, fontWeight = FontWeight.Bold)\n                    }\n                }\n            },\n            dismissButton = {\n                TextButton(\n                    onClick = {\n                        showSolutionsDialog = false\n                        showReview = false\n                        selectedIssues = setOf()\n                        selectedSolutions = setOf()\n                        remark = \"\"\n                        otherSolution = \"\"\n                    },\n                    modifier = Modifier.fillMaxWidth()\n                ) {\n                    Text(\"Cancel\", color = Color.White.copy(alpha = 0.7f))\n                }\n            }\n        )\n    }\n    \n    // Watch for undo restoration: when previousTestResult is set from undo, show review dialog\n    var shouldShowReviewAfterUndo by remember { mutableStateOf(false) }\n    \n    // Check for undo payload when screen becomes visible (after navigation back)\n    // Check on screen load and when undo state changes\n    val undoState by undoManager.undoState.collectAsState()\n    \n    // Track if we just restored from undo to prevent clearing flags prematurely\n    var isRestoringFromUndo by remember { mutableStateOf(false) }\n    \n    // Check for payload whenever screen becomes visible (including after navigation)\n    // Use DisposableEffect to check payload when screen is displayed\n    DisposableEffect(Unit) {\n        android.util.Log.d(\"FrequencyGenerator\", \" Screen visible - checking for undo payload\")\n        val undoPayload = undoManager.getAndClearLastUndo()\n        if (undoPayload != null) {\n            val (restoredResult, fromScreen) = undoPayload\n            android.util.Log.d(\"FrequencyGenerator\", \" UNDO PAYLOAD found!\")\n            android.util.Log.d(\"FrequencyGenerator\", \" From screen: $fromScreen, Result: ${restoredResult.outcome}\")\n            \n            if (fromScreen == \"FREQ_GEN\") {\n                // Set flags to trigger dialog opening\n                previousTestResult = restoredResult\n                shouldShowReviewAfterUndo = true\n                isFromUndo = true\n                isRestoringFromUndo = true // Mark that we're restoring\n                android.util.Log.d(\"FrequencyGenerator\", \" UNDO PAYLOAD: Set flags - dialog will open at step: ${restoredResult.outcome}\")\n            }\n        } else {\n            android.util.Log.d(\"FrequencyGenerator\", \" No undo payload found\")\n        }\n        \n        onDispose {\n            // Cleanup if needed\n        }\n    }\n    \n    // Watch undo state changes - check for payload when undo becomes inactive\n    // This catches the case where UNDO was pressed while on Landing Page\n    // executeUndo() sets undoState.isActive = false AND stores payload\n    // So when isActive changes from true to false, we should check for payload\n    var previousUndoActive by remember { mutableStateOf(false) }\n    LaunchedEffect(undoState.isActive) {\n        val undoBecameInactive = previousUndoActive && !undoState.isActive\n        previousUndoActive = undoState.isActive\n        \n        if (undoBecameInactive && !isRestoringFromUndo) {\n            // Undo was just executed - check for payload\n            android.util.Log.d(\"FrequencyGenerator\", \" Undo became inactive - checking for payload\")\n            val undoPayload = undoManager.getAndClearLastUndo()\n            if (undoPayload != null) {\n                val (restoredResult, fromScreen) = undoPayload\n                android.util.Log.d(\"FrequencyGenerator\", \" UNDO PAYLOAD found after undo execution!\")\n                android.util.Log.d(\"FrequencyGenerator\", \" From screen: $fromScreen, Result: ${restoredResult.outcome}\")\n                \n                if (fromScreen == \"FREQ_GEN\") {\n                    // Set flags to trigger dialog opening\n                    previousTestResult = restoredResult\n                    shouldShowReviewAfterUndo = true\n                    isFromUndo = true\n                    isRestoringFromUndo = true\n                    android.util.Log.d(\"FrequencyGenerator\", \" UNDO PAYLOAD: Set flags from undo state change\")\n                }\n            }\n        } else if (!undoState.isActive && !isRestoringFromUndo) {\n            // Undo is inactive and we're not restoring - clear any stale payload/flags\n            val stalePayload = undoManager.getAndClearLastUndo()\n            if (stalePayload != null) {\n                android.util.Log.d(\"FrequencyGenerator\", \" Found stale undo payload (undo not active, not restoring) - cleared\")\n            }\n            // Clear local restoration flags only if we're not restoring\n            if (shouldShowReviewAfterUndo) {\n                android.util.Log.d(\"FrequencyGenerator\", \" Clearing stale restoration flags\")\n                shouldShowReviewAfterUndo = false\n                previousTestResult = null\n            }\n        }\n    }\n    \n    // Watch for undo restoration - trigger when both flags are set\n    // This opens the review dialog automatically after navigating back from Landing Page\n    // Opens at the EXACT step where submission happened (PASSPASS_CHECKS, FAILFAIL_SOLUTIONS, CBPCAN_BE_PASSED, TNDTEST_NOT_DONE)\n    LaunchedEffect(previousTestResult, shouldShowReviewAfterUndo) {\n        if (shouldShowReviewAfterUndo && previousTestResult != null) {\n            val outcome = previousTestResult!!.outcome\n            val stepName = when (outcome) {\n                com.example.fqcapp.data.TestOutcome.PASS -> \"PASS_CHECKS\"\n                com.example.fqcapp.data.TestOutcome.FAIL -> \"FAIL_SOLUTIONS\"\n                com.example.fqcapp.data.TestOutcome.CAN_BE_PASSED -> \"CAN_BE_PASSED\"\n                com.example.fqcapp.data.TestOutcome.TEST_NOT_DONE -> \"TEST_NOT_DONE\"\n            }\n            \n            android.util.Log.d(\"FrequencyGenerator\", \" UNDO: Opening review dialog at submission step: $stepName\")\n            android.util.Log.d(\"FrequencyGenerator\", \" Outcome: $outcome\")\n            android.util.Log.d(\"FrequencyGenerator\", \" Dialog will open with fresh selections (not restored)\")\n            \n            // Minimal delay to ensure navigation to Frequency Generator screen has completed\n            kotlinx.coroutines.delay(100) // Reduced delay for faster response\n            showReview = true\n            shouldShowReviewAfterUndo = false // Reset flag\n            isRestoringFromUndo = false // Reset restoration flag after dialog opens\n            android.util.Log.d(\"FrequencyGenerator\", \" Review dialog opened at step: $stepName\")\n        }\n    }\n\n    // Review Screen - Full Screen Dialog\n    if (showReview) {\n        AlertDialog(\n            onDismissRequest = { showReview = false },\n            properties = DialogProperties(usePlatformDefaultWidth = false)\n        ) {\n            Box(\n                modifier = Modifier.fillMaxSize(),\n                contentAlignment = Alignment.Center\n            ) {\n                android.util.Log.d(\"FrequencyGenerator\", \" Rendering ReviewScreen with previousTestResult: ${previousTestResult?.outcome}\")\n                android.util.Log.d(\"FrequencyGenerator\", \" PreviousTestResult details: $previousTestResult\")\n                \n                // Check if device is connected (has serial number - either real like \"SLC...\" or reference like \"TMP-...\")\n                val hasDeviceConnected = currentSerialNumber?.let { serial ->\n                    serial.isNotBlank() && (serial.startsWith(\"SLC\", ignoreCase = true) || serial.startsWith(\"TMP-\", ignoreCase = true))\n                } ?: false\n                android.util.Log.d(\"FrequencyGenerator\", \" Device connection check - Serial: '$currentSerialNumber', Connected: $hasDeviceConnected\")\n                \n                ReviewScreenContainer(\n                    testType = TestType.FREQUENCY,\n                    previousTestResult = previousTestResult,\n                    hasDeviceConnected = hasDeviceConnected,\n                    onResultSubmitted = { result ->\n                        // Guard against duplicate submissions\n                        if (isSubmitting) {\n                            android.util.Log.w(\"FrequencyGenerator\", \" Submission already in progress, ignoring duplicate call\")\n                            return@ReviewScreenContainer\n                        }\n                        \n                        isSubmitting = true\n                        scope.launch {\n                            try {\n                                // Validate device connection for outcomes that require it\n                                val hasDeviceConnected = currentSerialNumber?.let { serial ->\n                                    serial.isNotBlank() && (serial.startsWith(\"SLC\", ignoreCase = true) || serial.startsWith(\"TMP-\", ignoreCase = true))\n                                } ?: false\n                                \n                                if (!hasDeviceConnected && result.outcome != com.example.fqcapp.data.TestOutcome.TEST_NOT_DONE) {\n                                    android.util.Log.e(\"FrequencyGenerator\", \" Invalid submission: Device not connected but outcome is ${result.outcome}\")\n                                    android.util.Log.e(\"FrequencyGenerator\", \"   Only TEST_NOT_DONE is allowed when no device is connected\")\n                                    isSubmitting = false\n                                    return@launch\n                                }\n                                \n                                // Capture serial number at the time of submission\n                                val capturedSerialNumber = currentSerialNumber ?: \"\"\n                                android.util.Log.d(\"FrequencyGenerator\", \" Captured serial number for milestone update: '$capturedSerialNumber'\")\n                            \n                            // Convert lists to JSON strings\n                            // IMPORTANT: Filter out PASS checklist items (\"No Distortion\", \"No Noise\", \"Balance OK\")\n                            // when result is not PASS - these are implicit in a PASS result\n                            val passChecklistItems = setOf(\"No Distortion\", \"No Noise\", \"Balance OK\", \"no disturbance\", \"no noise\", \"balance ok\")\n                            val filteredIssues = if (result.outcome.name.uppercase() != \"PASS\") {\n                                result.issues.filter { issue -> \n                                    !passChecklistItems.contains(issue.trim()) \n                                }\n                            } else {\n                                // For PASS, don't save checklist items as issues\n                                emptyList()\n                            }\n                            val issuesJson = JSONArray(filteredIssues).toString()\n                            val solutionsJson = JSONArray(result.solutions).toString()\n                            \n                            // Get operator name from preferences (login name)\n                            val prefsManager = com.example.fqcapp.utils.PreferencesManager(context)\n                            operatorName = prefsManager.getOperatorName() ?: \"Unknown\"\n                            \n                            // Get serial number from device name (if not captured)\n                            var finalSerialNumber = capturedSerialNumber\n                            if (finalSerialNumber.isBlank() && connectedDeviceName != null) {\n                                finalSerialNumber = connectedDeviceName\n                                android.util.Log.d(\"FrequencyGenerator\", \" Using device name as serial: '$finalSerialNumber'\")\n                            }\n                            \n                            android.util.Log.d(\"FrequencyGenerator\", \" Creating test - Serial: '$finalSerialNumber', Operator: '$operatorName'\")\n                            \n                            // Get entry time (when screen was opened)\n                            val entryTime = sessionStartTime ?: System.currentTimeMillis()\n                            val entryTimestamp = java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.getDefault()).format(java.util.Date(entryTime))\n                            \n                            // Calculate iteration number\n                            val iterationNumber = try {\n                                if (finalSerialNumber.isNotBlank()) {\n                                    repository.getNextIterationNumber(finalSerialNumber)\n                                } else {\n                                    1\n                                }\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"FrequencyGenerator\", \"Error getting iteration number\", e)\n                                1\n                            }\n                            \n                            android.util.Log.d(\"FrequencyGenerator\", \" Iteration number: $iterationNumber\")\n                            \n                            // Placeholder exit timestamp (will be updated at final submit)\n                            val placeholderExitTimestamp = entryTimestamp\n                            \n                            val frequencyTest = FrequencyTest(\n                                serialNumber = finalSerialNumber,\n                                operatorName = operatorName,\n                                entryTimestamp = entryTimestamp,\n                                exitTimestamp = placeholderExitTimestamp, // Will be updated at final submit\n                                totalTimeSpent = \"00:00:00\", // Will be calculated at final submit\n                                result = result.outcome.name,\n                                issues = issuesJson,\n                                solutions = solutionsJson,\n                                remark = result.remark,\n                                iterationNumber = iterationNumber,\n                                testStage = result.testStage,\n                                timestamp = java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.getDefault()).format(java.util.Date()),\n                                needsSync = true\n                            )\n                            \n                            // BUFFER: Defer DB insert until undo window expires\n                            // Store result BEFORE closing dialog (needed for undo restoration)\n                            previousTestResult = result\n                            android.util.Log.d(\"FrequencyGenerator\", \" Stored previousTestResult for undo: ${result.outcome}\")\n                            android.util.Log.d(\"FrequencyGenerator\", \" Issues: ${result.issues}, Solutions: ${result.solutions}\")\n                            \n                            android.util.Log.d(\"FrequencyGenerator\", \" Calling startUndo with scope: $scope\")\n                            undoManager.startUndo(\n                                testResult = result,\n                                onUndo = {\n                                    android.util.Log.d(\"FrequencyGenerator\", \" UNDO pressed - navigating to Frequency Generator\")\n                                    android.util.Log.d(\"FrequencyGenerator\", \" Result to show at step: ${result.outcome}\")\n                                    \n                                    // UndoManager.executeUndo() already stored payload in lastUndoPayload\n                                    // Just navigate - DisposableEffect will check payload and open dialog\n                                    android.util.Log.d(\"FrequencyGenerator\", \" Payload stored in UndoManager - navigating to Frequency Generator\")\n                                    android.util.Log.d(\"FrequencyGenerator\", \" DisposableEffect will detect payload and open review dialog\")\n                                    \n                                    // Explicitly navigate to Frequency Generator (don't use onBack since back stack might be cleared)\n                                    // Use explicit navigation callback if available, otherwise fall back to onBack\n                                    onNavigateToFreqGen?.invoke() ?: onBack?.invoke()\n                                },\n                                onCommit = suspend {\n                                    android.util.Log.d(\"FrequencyGenerator\", \" COMMIT after 30s - writing frequency test to DB\")\n                                    \n                                    // Get serial number - priority: capturedSerialNumber > currentSerialNumber > connectedDeviceName > session\n                                    var serialForMilestone = capturedSerialNumber\n                                    if (serialForMilestone.isBlank()) {\n                                        serialForMilestone = currentSerialNumber ?: \"\"\n                                    }\n                                    if (serialForMilestone.isBlank() && connectedDeviceName != null) {\n                                        serialForMilestone = connectedDeviceName\n                                        android.util.Log.d(\"FrequencyGenerator\", \" Using device name as serial: '$serialForMilestone'\")\n                                    }\n                                    if (serialForMilestone.isBlank() && currentSessionId != null) {\n                                        try {\n                                            val session = repository.getSessionById(currentSessionId)\n                                            serialForMilestone = session?.serialNumber ?: \"\"\n                                        } catch (e: Exception) {\n                                            android.util.Log.e(\"FrequencyGenerator\", \" Error fetching FQCSession\", e)\n                                        }\n                                    }\n                                    val testSessionId = currentTestSessionId\n                                    if (serialForMilestone.isBlank() && testSessionId != null) {\n                                        try {\n                                            val testSession = repository.getTestSessionById(testSessionId)\n                                            serialForMilestone = testSession?.serialNumber ?: \"\"\n                                        } catch (e: Exception) {\n                                            android.util.Log.e(\"FrequencyGenerator\", \" Error fetching TestSession\", e)\n                                        }\n                                    }\n                                    if (serialForMilestone.isBlank()) {\n                                        serialForMilestone = frequencyTest.serialNumber\n                                    }\n                                    \n                                    // Get operator name from preferences (login name)\n                                    val prefsManager = com.example.fqcapp.utils.PreferencesManager(context)\n                                    val finalOperatorName = prefsManager.getOperatorName() ?: \"Unknown\"\n                                    \n                                    // Calculate EXIT TIME at final submit (not when review screen closes)\n                                    val exitTime = System.currentTimeMillis()\n                                    \n                                    // Parse entry timestamp to get entry time in milliseconds\n                                    val dateFormat = java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.getDefault())\n                                    val entryTimeMillis = try {\n                                        dateFormat.parse(frequencyTest.entryTimestamp)?.time ?: sessionStartTime ?: exitTime\n                                    } catch (e: Exception) {\n                                        android.util.Log.e(\"FrequencyGenerator\", \"Error parsing entry timestamp: ${frequencyTest.entryTimestamp}\", e)\n                                        sessionStartTime ?: exitTime\n                                    }\n                                    \n                                    // Calculate total time spent\n                                    val totalTimeSpentMs = exitTime - entryTimeMillis\n                                    val totalTimeSpentSeconds = totalTimeSpentMs / 1000\n                                    val hours = totalTimeSpentSeconds / 3600\n                                    val minutes = (totalTimeSpentSeconds % 3600) / 60\n                                    val seconds = totalTimeSpentSeconds % 60\n                                    val totalTimeSpentFormatted = String.format(\"%02d:%02d:%02d\", hours, minutes, seconds)\n                                    \n                                    val exitTimestamp = java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.getDefault()).format(java.util.Date(exitTime))\n                                    \n                                    android.util.Log.d(\"FrequencyGenerator\", \" Entry: ${frequencyTest.entryTimestamp} ($entryTimeMillis), Exit: $exitTimestamp ($exitTime), Duration: ${totalTimeSpentMs}ms = $totalTimeSpentFormatted\")\n                                    \n                                    // Get iteration number\n                                    val iterationNumber = try {\n                                        if (serialForMilestone.isNotBlank()) {\n                                            repository.getNextIterationNumber(serialForMilestone)\n                                        } else {\n                                            frequencyTest.iterationNumber\n                                        }\n                                    } catch (e: Exception) {\n                                        android.util.Log.e(\"FrequencyGenerator\", \"Error getting iteration number\", e)\n                                        frequencyTest.iterationNumber\n                                    }\n                                    \n                                    android.util.Log.d(\"FrequencyGenerator\", \" Final Iteration: $iterationNumber\")\n                                    \n                                    try {\n                                        // Update frequencyTest with correct values at final submit\n                                        val finalFrequencyTest = frequencyTest.copy(\n                                            serialNumber = serialForMilestone,\n                                            operatorName = finalOperatorName,\n                                            exitTimestamp = exitTimestamp, // Exit time calculated at final submit\n                                            totalTimeSpent = totalTimeSpentFormatted, // Time calculated at final submit\n                                            iterationNumber = iterationNumber\n                                        )\n                                        \n                                        android.util.Log.d(\"FrequencyGenerator\", \" Saving - Serial: '$serialForMilestone', Operator: '$finalOperatorName', Result: '${finalFrequencyTest.result}', Iteration: $iterationNumber, Time: $totalTimeSpentFormatted\")\n                                        \n                                        val testId = repository.insertFrequencyTest(finalFrequencyTest)\n                                        lastSubmittedTestId = testId\n                                        sessionManager.markSessionHasSubmission()\n                                        android.util.Log.d(\"FrequencyGenerator\", \" Frequency test committed with ID: $testId\")\n                                        \n                                        // Add solution reminders if test failed and has solutions\n                                        if (finalFrequencyTest.result.uppercase() == \"FAIL\" && \n                                            finalFrequencyTest.solutions.isNotBlank() &&\n                                            solutionReminderManager != null &&\n                                            serialForMilestone.isNotBlank()) {\n                                            try {\n                                                val solutionsList = try {\n                                                    val jsonArray = org.json.JSONArray(finalFrequencyTest.solutions)\n                                                    (0 until jsonArray.length()).map { jsonArray.getString(it) }\n                                                } catch (e: Exception) {\n                                                    emptyList<String>()\n                                                }\n                                                if (solutionsList.isNotEmpty()) {\n                                                    solutionReminderManager.addPendingSolution(\n                                                        serialNumber = serialForMilestone,\n                                                        testType = com.example.fqcapp.data.TestType.FREQUENCY,\n                                                        solutions = solutionsList,\n                                                        testId = testId\n                                                    )\n                                                    android.util.Log.d(\"FrequencyGenerator\", \" Added ${solutionsList.size} solution reminders\")\n                                                }\n                                            } catch (e: Exception) {\n                                                android.util.Log.e(\"FrequencyGenerator\", \" Error adding solution reminders\", e)\n                                            }\n                                        }\n                                        \n                                        // Skip milestone and workflow updates for \"TEST_NOT_DONE\" - not a test result\n                                        if (finalFrequencyTest.result.uppercase() == \"TEST_NOT_DONE\") {\n                                            android.util.Log.d(\"FrequencyGenerator\", \" TEST_NOT_DONE selected - skipping milestone and workflow updates (stored locally only)\")\n                                        } else {\n                                            // Log workflow: Frequency Test COMPLETED\n                                            if (serialForMilestone.isNotBlank()) {\n                                                try {\n                                                    val workflowService = com.example.fqcapp.services.DeviceWorkflowService(repository)\n                                                    \n                                                    // Map result to workflow result\n                                                    val workflowResult = when (finalFrequencyTest.result.uppercase()) {\n                                                        \"PASS\" -> com.example.fqcapp.services.DeviceWorkflowService.RESULT_PASS\n                                                        \"FAIL\" -> com.example.fqcapp.services.DeviceWorkflowService.RESULT_FAIL\n                                                        \"CAN_PASS\" -> com.example.fqcapp.services.DeviceWorkflowService.RESULT_CAN_PASS\n                                                        else -> null\n                                                    }\n                                                    \n                                                    workflowService.logWorkflow(\n                                                        serialNumber = serialForMilestone,\n                                                        stage = com.example.fqcapp.services.DeviceWorkflowService.STAGE_FREQUENCY_TEST,\n                                                        operatorName = finalOperatorName,\n                                                        action = com.example.fqcapp.services.DeviceWorkflowService.ACTION_COMPLETED,\n                                                        result = workflowResult,\n                                                        iterationNumber = iterationNumber,\n                                                        recordId = testId\n                                                    )\n                                                    android.util.Log.d(\"FrequencyGenerator\", \" [WORKFLOW] Logged FREQUENCY_TEST COMPLETED\")\n                                                } catch (e: Exception) {\n                                                    android.util.Log.e(\"FrequencyGenerator\", \" [WORKFLOW] Error logging workflow COMPLETED\", e)\n                                                }\n                                                \n                                                // Update milestone for frequency generator - use captured serial number\n                                                android.util.Log.d(\"FrequencyGenerator\", \" [MILESTONE_CALL_COMMIT] Calling milestone update service (from commit)\")\n                                                android.util.Log.d(\"FrequencyGenerator\", \" [MILESTONE_CALL_COMMIT] Serial number: '$serialForMilestone'\")\n                                                android.util.Log.d(\"FrequencyGenerator\", \" [MILESTONE_CALL_COMMIT] Result value: '${finalFrequencyTest.result}'\")\n                                                try {\n                                                    val milestoneService = com.example.fqcapp.services.MilestoneUpdateService(repository)\n                                                    milestoneService.updateFrequencyStatus(serialForMilestone, finalFrequencyTest.result)\n                                                    android.util.Log.d(\"FrequencyGenerator\", \" [MILESTONE_CALL_COMMIT] Milestone update call completed\")\n                                                } catch (e: Exception) {\n                                                    android.util.Log.e(\"FrequencyGenerator\", \" [MILESTONE_CALL_COMMIT] Error updating milestone\", e)\n                                                    e.printStackTrace()\n                                                }\n                                            } else {\n                                                android.util.Log.e(\"FrequencyGenerator\", \" [MILESTONE_CALL_COMMIT] Cannot update milestone - serial number is blank!\")\n                                            }\n                                        }\n                                    } catch (e: Exception) {\n                                        android.util.Log.e(\"FrequencyGenerator\", \" Commit failed\", e)\n                                    }\n                                    Unit\n                                },\n                                scope = scope,\n                                fromScreen = \"FREQ_GEN\"\n                            )\n                            android.util.Log.d(\"FrequencyGenerator\", \" startUndo called successfully\")\n                            \n                            // Close review dialog\n                            showReview = false\n                            Log.d(\"FrequencyGenerator\", \"Submission buffered for 30s - will commit if not undone\")\n                            \n                            // Navigation logic: \n                            // Always navigate to Landing Page after submission\n                            android.util.Log.d(\"FrequencyGenerator\", \" Navigating to Landing Page after submit - isFromUndo: $isFromUndo\")\n                            if (isFromUndo) {\n                                // Reset undo flag after navigation\n                                isFromUndo = false\n                                android.util.Log.d(\"FrequencyGenerator\", \" Resetting isFromUndo flag\")\n                            }\n                            // Explicitly navigate to Landing Page\n                            onNavigateToLanding?.invoke() ?: onBack?.invoke()\n                            android.util.Log.d(\"FrequencyGenerator\", \" Navigation to Landing Page triggered\")\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"FrequencyGenerator\", \" Error during submission\", e)\n                            } finally {\n                                // Always reset submission flag, even on error or cancellation\n                                isSubmitting = false\n                            }\n                        }\n                    },\n                    onCancel = {\n                        showReview = false\n                        // If we cancel from undo-restored dialog, reset the flag\n                        if (isFromUndo) {\n                            isFromUndo = false\n                        }\n                    }\n                )\n            }\n        }\n    }\n    \n    // Undo Snackbar removed - now shows on landing page\n    \n    // Session Handover Banner\n    sessionHandover?.let { message ->\n        Card(\n            modifier = Modifier\n                .fillMaxWidth()\n                .padding(16.dp),\n            colors = CardDefaults.cardColors(\n                containerColor = Color(0xFFFF9800)\n            )\n        ) {\n            Row(\n                modifier = Modifier\n                    .fillMaxWidth()\n                    .padding(16.dp),\n                horizontalArrangement = Arrangement.SpaceBetween,\n                verticalAlignment = Alignment.CenterVertically\n            ) {\n                Text(\n                    text = message,\n                    color = Color.White,\n                    fontWeight = FontWeight.Bold\n                )\n                IconButton(\n                    onClick = { sessionManager.clearHandoverNotification() }\n                ) {\n                    Icon(\n                        Icons.Filled.Close,\n                        contentDescription = \"Dismiss\",\n                        tint = Color.White\n                    )\n                }\n            }\n        }\n    }\n}\n\n@Composable\nfun AnimatedWaveform(\n    frequency: Float,\n    phase: Float,\n    color: Color\n) {\n    Canvas(modifier = Modifier.fillMaxSize()) {\n        val width = size.width\n        val height = size.height\n        val centerY = height / 2f\n        val amplitude = height * 0.3f\n\n        val path = Path()\n        val points = 80\n        val cycles = (frequency / 100f).coerceIn(0.5f, 5f)\n\n        for (i in 0..points) {\n            val x = (i.toFloat() / points) * width\n            val progress = i.toFloat() / points\n            val y = centerY + (sin((progress * cycles * 2 * PI) + phase) * amplitude).toFloat()\n\n            if (i == 0) {\n                path.moveTo(x, y)\n            } else {\n                path.lineTo(x, y)\n            }\n        }\n\n        drawPath(\n            path = path,\n            color = color,\n            style = Stroke(width = 3.dp.toPx(), cap = StrokeCap.Round)\n        )\n    }\n}\n",
        "firstEditBubbleId": "42abb5bd-eef9-4406-9d96-2180791f678f",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/FrequencyTestDao.kt": {
        "content": "package com.example.fqcapp.data.dao\n\nimport androidx.room.*\nimport com.example.fqcapp.data.entities.FrequencyTest\nimport kotlinx.coroutines.flow.Flow\n\n@Dao\ninterface FrequencyTestDao {\n    @Insert\n    suspend fun insert(test: FrequencyTest): Long\n\n    \n    @Query(\"SELECT * FROM frequency_tests WHERE serialNumber = :serialNumber ORDER BY timestamp ASC\")\n    suspend fun getFrequencyTests(serialNumber: String): List<FrequencyTest>\n\n    @Query(\"SELECT * FROM frequency_tests WHERE testId = :id\")\n    suspend fun getTestById(id: Long): FrequencyTest?\n\n    @Query(\"SELECT * FROM frequency_tests WHERE serialNumber = :serialNumber AND needsSync = 1\")\n    suspend fun getUnsyncedFrequencyTests(serialNumber: String): List<FrequencyTest>\n\n    @Query(\"SELECT * FROM frequency_tests WHERE needsSync = 1\")\n    suspend fun getAllUnsyncedFrequencyTests(): List<FrequencyTest>\n    \n    @Query(\"SELECT * FROM frequency_tests ORDER BY timestamp ASC\")\n    suspend fun getAllFrequencyTests(): List<FrequencyTest>\n\n    @Query(\"UPDATE frequency_tests SET needsSync = 0, lastSyncTimestamp = :timestamp WHERE testId = :testId\")\n    suspend fun markAsSynced(testId: Long, timestamp: Long = System.currentTimeMillis())\n\n    @Query(\"UPDATE frequency_tests SET needsSync = 0, lastSyncTimestamp = :timestamp WHERE testId IN (:testIds)\")\n    suspend fun markMultipleAsSynced(testIds: List<Long>, timestamp: Long = System.currentTimeMillis())\n\n    @Delete\n    suspend fun delete(test: FrequencyTest)\n    \n    @Query(\"DELETE FROM frequency_tests WHERE testId = :testId\")\n    suspend fun deleteTest(testId: Long)\n    \n    @Query(\"SELECT COALESCE(MAX(iterationNumber), 0) FROM frequency_tests WHERE serialNumber = :serialNumber\")\n    suspend fun getMaxIterationNumber(serialNumber: String): Int\n    \n    @Query(\"SELECT * FROM frequency_tests WHERE serialNumber = :serialNumber AND testStage = :stage ORDER BY iterationNumber DESC LIMIT 1\")\n    suspend fun getLatestFrequencyTestByStage(serialNumber: String, stage: String): FrequencyTest?\n    \n    @Query(\"SELECT * FROM frequency_tests WHERE serialNumber = :serialNumber ORDER BY iterationNumber DESC\")\n    suspend fun getAllFrequencyTestsBySerial(serialNumber: String): List<FrequencyTest>\n    \n    // Get latest frequency test by timestamp (excluding TEST_NOT_DONE)\n    @Query(\"SELECT * FROM frequency_tests WHERE serialNumber = :serialNumber AND result != 'TEST_NOT_DONE' ORDER BY timestamp DESC LIMIT 1\")\n    suspend fun getLatestFrequencyTestByTimestamp(serialNumber: String): FrequencyTest?\n    \n    // Get latest frequency test by configuration ID\n    @Query(\"SELECT * FROM frequency_tests WHERE configurationId = :configurationId ORDER BY entryTimestamp DESC LIMIT 1\")\n    suspend fun getLatestByConfiguration(configurationId: String): FrequencyTest?\n}\n",
        "firstEditBubbleId": "d3a09ef7-3a82-40e5-a45e-ab0e487d3284",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt": {
        "content": "package com.example.fqcapp.ui\n\nimport android.Manifest\nimport android.content.pm.PackageManager\nimport android.media.AudioManager\nimport android.media.AudioFocusRequest\nimport android.os.Build\nimport android.util.Log\nimport com.example.fqcapp.utils.VLCPlayerManager\nimport androidx.activity.compose.BackHandler\nimport androidx.activity.compose.rememberLauncherForActivityResult\nimport androidx.activity.result.contract.ActivityResultContracts\nimport androidx.compose.foundation.ExperimentalFoundationApi\nimport androidx.compose.foundation.background\nimport androidx.compose.foundation.clickable\nimport androidx.compose.foundation.gestures.detectDragGesturesAfterLongPress\nimport androidx.compose.foundation.layout.*\nimport androidx.compose.foundation.lazy.LazyColumn\nimport androidx.compose.foundation.lazy.itemsIndexed\nimport androidx.compose.foundation.shape.CircleShape\nimport androidx.compose.foundation.shape.RoundedCornerShape\nimport androidx.compose.ui.input.pointer.pointerInput\nimport androidx.compose.material.icons.Icons\nimport androidx.compose.material.icons.filled.*\nimport androidx.compose.material3.*\nimport androidx.compose.runtime.*\nimport androidx.compose.ui.Alignment\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.window.DialogProperties\nimport androidx.compose.ui.draw.clip\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.platform.LocalContext\nimport androidx.compose.ui.text.font.FontWeight\nimport androidx.compose.ui.text.style.TextOverflow\nimport androidx.compose.ui.unit.dp\nimport androidx.compose.ui.unit.sp\nimport androidx.core.content.ContextCompat\nimport com.example.fqcapp.data.FQCRepository\nimport com.example.fqcapp.data.entities.SongTest\n// import com.example.fqcapp.ui.TestSongReviewScreen\nimport com.example.fqcapp.utils.AudioFile\nimport com.example.fqcapp.utils.AudioFileManager\nimport kotlinx.coroutines.delay\nimport kotlinx.coroutines.launch\nimport kotlinx.coroutines.Dispatchers\nimport kotlinx.coroutines.withContext\nimport org.json.JSONArray\nimport com.example.fqcapp.core.SessionManager\nimport com.example.fqcapp.core.ReviewValidator\nimport com.example.fqcapp.core.UndoManager\nimport com.example.fqcapp.data.TestType\nimport com.example.fqcapp.data.TestOutcome\nimport com.example.fqcapp.data.TestResult\n\n@OptIn(ExperimentalMaterial3Api::class, ExperimentalFoundationApi::class)\n@Composable\nfun TestSongScreen(\n    currentSessionId: Long?,\n    repository: FQCRepository,\n    currentSerialNumber: String = \"\",\n    currentOperatorName: String = \"\",\n    authenticatedOperator: com.example.fqcapp.data.entities.OperatorCredential? = null,\n    connectedDeviceName: String? = null, // Device name from Bluetooth scan\n    onBack: (() -> Unit)? = null,\n    onNavigateToLanding: (() -> Unit)? = null,\n    onNavigateToTestSongs: (() -> Unit)? = null,\n    undoManager: UndoManager = UndoManager(),\n    solutionReminderManager: com.example.fqcapp.core.SolutionReminderManager? = null\n) {\n    val context = LocalContext.current\n    val scope = rememberCoroutineScope()\n    val audioFileManager = remember { AudioFileManager(context) }\n    \n    // Track entry time when screen is opened\n    var sessionStartTime by remember { mutableStateOf<Long?>(null) }\n    var actualSerialNumber by remember { mutableStateOf<String>(currentSerialNumber) }\n    var actualOperatorName by remember { mutableStateOf<String>(currentOperatorName) }\n    var currentIterationNumber by remember { mutableStateOf<Int>(1) }\n\n    // State\n    val audioFiles = remember { mutableStateListOf<AudioFile>() }\n    var draggedIndex by remember { mutableStateOf<Int?>(null) }\n    var vlcPlayer by remember { mutableStateOf<VLCPlayerManager?>(null) }\n    var isPlaying by remember { mutableStateOf(false) }\n    var currentSong by remember { mutableStateOf<AudioFile?>(null) }\n    var currentPosition by remember { mutableStateOf(0) }\n    var seekPosition by remember { mutableStateOf(0) }\n    var showReviewDialog by remember { mutableStateOf(false) }\n    var songToReview by remember { mutableStateOf<AudioFile?>(null) }\n    var reviewFromOverallScreen by remember { mutableStateOf(false) } // Track if review was opened from overall review screen\n    // Store audio focus request to properly abandon it\n    var currentAudioFocusRequest by remember { mutableStateOf<AudioFocusRequest?>(null) }\n    var hasAudioFocus by remember { mutableStateOf(false) }\n    // Session management\n    val sessionManager = remember { SessionManager(context) }\n    val reviewValidator = remember { ReviewValidator() }\n    \n    // Song playback tracker\n    val playbackTracker = remember { com.example.fqcapp.core.SongPlaybackTracker() }\n    \n    // Snackbar host state for undo functionality\n    val snackbarHostState = remember { SnackbarHostState() }\n    \n    // Full-screen overall review state (supports undo buffer)\n    var showReview by remember { mutableStateOf(false) }\n    var previousTestResult by remember { mutableStateOf<com.example.fqcapp.data.TestResult?>(null) }\n    var shouldShowReviewAfterUndo by remember { mutableStateOf(false) }\n    var isFromUndo by remember { mutableStateOf(false) }\n    var isRestoringFromUndo by remember { mutableStateOf(false) }\n    \n    // Session handover notification\n    val sessionHandover by sessionManager.sessionHandover.collectAsState()\n    val currentSession by sessionManager.currentSession.collectAsState()\n    \n    // Session count tracking\n    var sessionCount by remember { mutableStateOf(0) }\n    \n    // Audio controls\n    var volume by remember { mutableStateOf(1.0f) } // 0.0 to 1.0\n    var balance by remember { mutableStateOf(0.5f) } // 0.0 = Left, 0.5 = Center, 1.0 = Right\n    var isSeeking by remember { mutableStateOf(false) }\n\n    // Storage permission\n    val permission = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.TIRAMISU) {\n        Manifest.permission.READ_MEDIA_AUDIO\n    } else {\n        Manifest.permission.READ_EXTERNAL_STORAGE\n    }\n\n    var hasPermission by remember {\n        mutableStateOf(\n            ContextCompat.checkSelfPermission(context, permission) == PackageManager.PERMISSION_GRANTED\n        )\n    }\n\n    val permissionLauncher = rememberLauncherForActivityResult(\n        ActivityResultContracts.RequestPermission()\n    ) { granted ->\n        hasPermission = granted\n        if (granted) {\n            audioFileManager.copySongsFromResources()\n            val files = audioFileManager.getAudioFiles()\n            audioFiles.clear()\n            audioFiles.addAll(files)\n        }\n    }\n    \n    // Use authenticated operator if provided\n    LaunchedEffect(authenticatedOperator) {\n        if (authenticatedOperator != null) {\n            actualOperatorName = authenticatedOperator.operatorName\n            android.util.Log.d(\"TestSongScreen\", \" Using authenticated operator: $actualOperatorName (ID: ${authenticatedOperator.operatorId})\")\n        } else {\n            val prefsManager = com.example.fqcapp.utils.PreferencesManager(context)\n            actualOperatorName = prefsManager.getOperatorName() ?: currentOperatorName\n            android.util.Log.d(\"TestSongScreen\", \" No authenticated operator, using preferences: $actualOperatorName\")\n        }\n    }\n\n        // Check for existing individual song reviews and mark as reviewed in tracker\n        LaunchedEffect(actualSerialNumber, currentIterationNumber) {\n            if (actualSerialNumber.isNotBlank()) {\n                try {\n                    val existingReviews = repository.getSongTestsBySerial(actualSerialNumber)\n                        .filter { \n                            !it.isOverallResult && \n                            it.iterationNumber == currentIterationNumber \n                        }\n                    android.util.Log.d(\"TestSongScreen\", \" Found ${existingReviews.size} existing individual song reviews\")\n                    existingReviews.forEach { review ->\n                        playbackTracker.markAsReviewed(review.songName, review.result)\n                        android.util.Log.d(\"TestSongScreen\", \" Marked existing review: ${review.songName} -> ${review.result}\")\n                    }\n                } catch (e: Exception) {\n                    android.util.Log.e(\"TestSongScreen\", \"Error loading existing reviews\", e)\n                }\n            }\n        }\n        \n        // Initialize - Capture entry time and get serial/operator\n        LaunchedEffect(Unit) {\n        // Capture entry time when screen is opened\n        sessionStartTime = System.currentTimeMillis()\n        android.util.Log.d(\"TestSongScreen\", \" Entry time captured: $sessionStartTime\")\n        \n        // Get serial number - priority: currentSerialNumber > connectedDeviceName > session\n        actualSerialNumber = when {\n            currentSerialNumber.isNotBlank() -> {\n                android.util.Log.d(\"TestSongScreen\", \" Serial from parameter: '$currentSerialNumber'\")\n                currentSerialNumber\n            }\n            connectedDeviceName != null -> {\n                android.util.Log.d(\"TestSongScreen\", \" Serial from device name: '$connectedDeviceName'\")\n                connectedDeviceName\n            }\n            currentSessionId != null -> {\n                try {\n                    val session = repository.getSessionById(currentSessionId)\n                    val serial = session?.serialNumber ?: \"\"\n                    android.util.Log.d(\"TestSongScreen\", \" Serial from session: '$serial'\")\n                    serial\n                } catch (e: Exception) {\n                    android.util.Log.e(\"TestSongScreen\", \"Error fetching session\", e)\n                    \"\"\n                }\n            }\n            else -> \"\"\n        }\n        \n        // Calculate iteration number\n        if (actualSerialNumber.isNotBlank()) {\n            try {\n                currentIterationNumber = repository.getNextSongIterationNumber(actualSerialNumber)\n                android.util.Log.d(\"TestSongScreen\", \" Iteration number: $currentIterationNumber for serial: $actualSerialNumber\")\n            } catch (e: Exception) {\n                android.util.Log.e(\"TestSongScreen\", \"Error getting iteration number\", e)\n                currentIterationNumber = 1\n            }\n        }\n    }\n    \n    // Log workflow: Song Test STARTED when screen opens\n    // Delayed and non-blocking - runs in background after screen loads\n    // Use a Mutex to prevent race conditions and duplicate calls\n    val workflowKey = remember(actualSerialNumber, actualOperatorName) { \n        \"$actualSerialNumber-$actualOperatorName\" \n    }\n    val workflowMutex = remember { kotlinx.coroutines.sync.Mutex() }\n    var workflowLogged by remember(workflowKey) { mutableStateOf(false) }\n    \n    LaunchedEffect(workflowKey) {\n        // Only log workflow if we have a valid serial number (not device name) and haven't logged yet\n        // Use Mutex to ensure atomic check-and-set operation\n        val shouldLog = workflowMutex.withLock {\n            if (workflowLogged) {\n                false // Already logged\n            } else if (actualSerialNumber.isNotBlank() &&\n                actualOperatorName != \"Unknown\" &&\n                !actualSerialNumber.matches(Regex(\"^BT-.*\", RegexOption.IGNORE_CASE)) &&\n                !actualSerialNumber.matches(Regex(\"^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$\")) &&\n                actualSerialNumber.length >= 10) {\n                workflowLogged = true // Mark as logged atomically\n                true\n            } else {\n                false\n            }\n        }\n        \n        if (shouldLog) {\n            // Delay workflow logging to avoid blocking screen load\n            scope.launch(Dispatchers.IO) {\n                try {\n                    delay(500) // Small delay to let screen render first\n                    val workflowService = com.example.fqcapp.services.DeviceWorkflowService(repository)\n                    workflowService.logWorkflow(\n                        serialNumber = actualSerialNumber,\n                        stage = com.example.fqcapp.services.DeviceWorkflowService.STAGE_SONG_TEST,\n                        operatorName = actualOperatorName,\n                        action = com.example.fqcapp.services.DeviceWorkflowService.ACTION_STARTED,\n                        iterationNumber = currentIterationNumber // Use the same iteration as the test\n                    )\n                    android.util.Log.d(\"TestSongScreen\", \" [WORKFLOW] Logged SONG_TEST STARTED (background, iteration: $currentIterationNumber)\")\n                } catch (e: kotlinx.coroutines.CancellationException) {\n                    android.util.Log.d(\"TestSongScreen\", \" [WORKFLOW] Workflow logging cancelled (screen left)\")\n                } catch (e: Exception) {\n                    android.util.Log.e(\"TestSongScreen\", \" [WORKFLOW] Error logging workflow STARTED\", e)\n                }\n            }\n        } else if (actualSerialNumber.isNotBlank() && !workflowLogged) {\n            android.util.Log.w(\"TestSongScreen\", \" Skipping workflow log - invalid serial number format: '${actualSerialNumber}'\")\n        }\n    }\n    \n    // Initialize audio files\n    LaunchedEffect(hasPermission) {\n        if (hasPermission) {\n            android.util.Log.d(\"TestSongScreen\", \"Loading audio files\")\n            audioFileManager.copySongsFromResources()\n            val files = audioFileManager.getAudioFiles()\n            audioFiles.clear()\n            audioFiles.addAll(files)\n            android.util.Log.d(\"TestSongScreen\", \"Loaded ${files.size} audio files\")\n        } else {\n            android.util.Log.d(\"TestSongScreen\", \"Requesting storage permission\")\n            permissionLauncher.launch(permission)\n        }\n    }\n    \n    // Handle pending undo from landing page for Test Songs\n    // NOTE: This is handled by the DisposableEffect below, so this LaunchedEffect is removed to avoid conflicts\n    \n    // Session count tracking\n    LaunchedEffect(currentSerialNumber) {\n        if (currentSerialNumber.isNotEmpty()) {\n            try {\n                val existingSessions = repository.getTestSessionsBySerialNumber(currentSerialNumber)\n                sessionCount = existingSessions.size + 1 // +1 for current session\n                android.util.Log.d(\"TestSongScreen\", \"Device: $currentSerialNumber, Session count: $sessionCount\")\n            } catch (e: Exception) {\n                android.util.Log.e(\"TestSongScreen\", \"Error getting session count\", e)\n            }\n        }\n    }\n\n    // Initialize VLC Player Manager\n    val vlcPlayerManager = remember {\n        try {\n            VLCPlayerManager(context).apply {\n                onProgressUpdate = { position ->\n                    if (!isSeeking) {\n                        currentPosition = position.toInt()\n                        seekPosition = position.toInt()\n                    }\n                }\n                onCompletion = {\n                    android.util.Log.d(\"TestSongScreen\", \"Song completed via VLC\")\n                    // Stop tracking playback when song completes\n                    currentSong?.let { song ->\n                        playbackTracker.stopPlayback(song.name)\n                    }\n                    isPlaying = false\n                    currentPosition = 0\n                    seekPosition = 0\n                }\n                onPlaying = {\n                    isPlaying = true\n                }\n                onPaused = {\n                    isPlaying = false\n                }\n                onStopped = {\n                    isPlaying = false\n                }\n                onError = { error ->\n                    android.util.Log.e(\"TestSongScreen\", \"VLC error: $error\")\n                    isPlaying = false\n                    currentSong = null\n                }\n            }\n        } catch (e: Exception) {\n            android.util.Log.e(\"TestSongScreen\", \"Failed to initialize VLC Player\", e)\n            null\n        }\n    }\n    \n    // Update current position while playing\n    LaunchedEffect(isPlaying) {\n        while (isPlaying) {\n            vlcPlayerManager?.updateProgress()\n            delay(100) // Update every 100ms\n        }\n    }\n    \n    // Apply volume and balance changes\n    LaunchedEffect(volume, balance) {\n        vlcPlayerManager?.let { player ->\n            val leftVolume = volume * (1f - balance).coerceIn(0f, 1f)\n            val rightVolume = volume * balance.coerceIn(0f, 1f)\n            player.setStereoVolume(leftVolume, rightVolume)\n        }\n    }\n\n    // Cleanup\n    DisposableEffect(Unit) {\n        onDispose {\n            try {\n                vlcPlayerManager?.let { player ->\n                    if (player.isPlaying()) {\n                        player.stop()\n                    }\n                    player.release()\n                }\n            } catch (e: Exception) {\n                                    android.util.Log.e(\"TestSongScreen\", \"Error releasing VLC player on dispose\", e)\n            }\n            vlcPlayer = null\n            \n            // Release audio focus when component is disposed\n            val audioManager = context.getSystemService(android.content.Context.AUDIO_SERVICE) as AudioManager\n            try {\n                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n                    currentAudioFocusRequest?.let {\n                        audioManager.abandonAudioFocusRequest(it)\n                    }\n                } else {\n                    @Suppress(\"DEPRECATION\")\n                    audioManager.abandonAudioFocus(null)\n                }\n                hasAudioFocus = false\n                currentAudioFocusRequest = null\n                android.util.Log.d(\"TestSongScreen\", \"Audio focus released on dispose\")\n            } catch (e: Exception) {\n                android.util.Log.e(\"TestSongScreen\", \"Error releasing audio focus on dispose\", e)\n            }\n        }\n    }\n\n    val accentColor = Color(0xFFFFC107)\n    val bgColor = Color(0xFF212121)\n    val surfaceColor = Color(0xFF2B2B2B)\n\n    Box(modifier = Modifier.fillMaxSize()) {\n    Scaffold(\n        snackbarHost = {\n            SnackbarHost(hostState = snackbarHostState)\n        },\n        topBar = {\n            TopAppBar(\n                title = { \n                    Column {\n                        Text(\"Test Song\", color = Color.White, fontSize = 18.sp)\n                        if (sessionCount > 0) {\n                            Text(\n                                \"Session $sessionCount\", \n                                color = accentColor, \n                                fontSize = 12.sp,\n                                style = MaterialTheme.typography.bodySmall\n                            )\n                        }\n                    }\n                },\n                navigationIcon = {\n                    IconButton(onClick = { \n                        android.util.Log.d(\"TestSongScreen\", \"Back button pressed - opening overall review\")\n                        // Open overall review instead of exiting\n                        previousTestResult = null\n                        showReview = true\n                    }) {\n                        Icon(Icons.Filled.ArrowBack, \"Back\", tint = Color.White)\n                    }\n                },\n                colors = TopAppBarDefaults.topAppBarColors(\n                    containerColor = bgColor\n                )\n            )\n        },\n        bottomBar = {\n            // Full-Featured Now Playing Player\n            if (currentSong != null) {\n                Surface(\n                    modifier = Modifier.fillMaxWidth(),\n                    color = surfaceColor,\n                    tonalElevation = 8.dp\n                ) {\n                    Column(\n                        modifier = Modifier.padding(16.dp)\n                    ) {\n                        // Song Info\n                        Row(\n                            modifier = Modifier.fillMaxWidth(),\n                            horizontalArrangement = Arrangement.SpaceBetween,\n                            verticalAlignment = Alignment.CenterVertically\n                        ) {\n                            // Album Art Placeholder + Song Info\n                            Row(\n                                modifier = Modifier.weight(1f),\n                                horizontalArrangement = Arrangement.spacedBy(12.dp),\n                                verticalAlignment = Alignment.CenterVertically\n                            ) {\n                                Box(\n                                    modifier = Modifier\n                                        .size(56.dp)\n                                        .clip(RoundedCornerShape(8.dp))\n                                        .background(accentColor),\n                                    contentAlignment = Alignment.Center\n                                ) {\n                                    Icon(\n                                        Icons.Filled.MusicNote,\n                                        contentDescription = null,\n                                        tint = bgColor,\n                                        modifier = Modifier.size(32.dp)\n                                    )\n                                }\n                                \n                                Column(modifier = Modifier.weight(1f)) {\n                                    Text(\n                                        currentSong!!.name,\n                                        style = MaterialTheme.typography.titleMedium,\n                                        color = Color.White,\n                                        fontWeight = FontWeight.Bold,\n                                        maxLines = 1,\n                                        overflow = TextOverflow.Ellipsis\n                                    )\n                                    Text(\n                                        audioFileManager.formatFileSize(currentSong!!.size),\n                                        style = MaterialTheme.typography.bodySmall,\n                                        color = Color.White.copy(alpha = 0.7f)\n                                    )\n                                }\n                            }\n\n                            // Review Button\n                            IconButton(\n                                onClick = {\n                                    songToReview = currentSong\n                                    showReviewDialog = true\n                                },\n                                enabled = actualSerialNumber.isNotBlank()\n                            ) {\n                                Icon(\n                                    Icons.Filled.RateReview,\n                                    \"Review\",\n                                    tint = if (actualSerialNumber.isNotBlank()) accentColor else Color.Gray\n                                )\n                            }\n                        }\n\n                        Spacer(modifier = Modifier.height(12.dp))\n\n                        // Seek Bar\n                        Column {\n                            Slider(\n                                value = seekPosition.toFloat(),\n                                onValueChange = { \n                                    android.util.Log.d(\"TestSongScreen\", \"Seek position changed: $it\")\n                                    isSeeking = true\n                                    seekPosition = it.toInt()\n                                },\n                                onValueChangeFinished = {\n                                    vlcPlayerManager?.seekTo(seekPosition.toLong())\n                                    isSeeking = false\n                                },\n                                valueRange = 0f..(vlcPlayerManager?.getDuration()?.toFloat() ?: currentSong!!.duration.toFloat()),\n                                colors = SliderDefaults.colors(\n                                    thumbColor = accentColor,\n                                    activeTrackColor = accentColor,\n                                    inactiveTrackColor = Color(0xFF424242)\n                                )\n                            )\n\n                            Row(\n                                modifier = Modifier.fillMaxWidth(),\n                                horizontalArrangement = Arrangement.SpaceBetween\n                            ) {\n                                Text(\n                                    audioFileManager.formatDuration(currentPosition.toLong()),\n                                    style = MaterialTheme.typography.bodySmall,\n                                    color = Color.White.copy(alpha = 0.7f),\n                                    fontSize = 11.sp\n                                )\n                                Text(\n                                    audioFileManager.formatDuration(\n                                        vlcPlayerManager?.getDuration()?.toLong() ?: currentSong!!.duration\n                                    ),\n                                    style = MaterialTheme.typography.bodySmall,\n                                    color = Color.White.copy(alpha = 0.7f),\n                                    fontSize = 11.sp\n                                )\n                            }\n                        }\n\n                        Spacer(modifier = Modifier.height(8.dp))\n\n                        // Playback Controls\n                        Row(\n                            modifier = Modifier.fillMaxWidth(),\n                            horizontalArrangement = Arrangement.Center,\n                            verticalAlignment = Alignment.CenterVertically\n                        ) {\n                            // Skip Backward 10s\n                            IconButton(\n                                onClick = {\n                                    android.util.Log.d(\"TestSongScreen\", \"Skip backward 10s button pressed\")\n                                    vlcPlayerManager?.let { player ->\n                                        val currentPos = player.getCurrentPosition()\n                                        val newPos = (currentPos - 10000).coerceAtLeast(0L)\n                                        player.seekTo(newPos)\n                                        currentPosition = newPos.toInt()\n                                    }\n                                }\n                            ) {\n                                Icon(\n                                    Icons.Filled.Replay10,\n                                    \"Back 10s\",\n                                    tint = Color.White,\n                                    modifier = Modifier.size(32.dp)\n                                )\n                            }\n\n                            Spacer(modifier = Modifier.width(8.dp))\n\n                            // Play/Pause Button\n                            IconButton(\n                                onClick = {\n                                    android.util.Log.d(\"TestSongScreen\", \"Play/Pause button pressed - isPlaying: $isPlaying\")\n                                    vlcPlayerManager?.let { player ->\n                                        try {\n                                            if (isPlaying) {\n                                                player.pause()\n                                            } else {\n                                                player.resume()\n                                            }\n                                        } catch (e: Exception) {\n                                            android.util.Log.e(\"TestSongScreen\", \"Error in play/pause\", e)\n                                            isPlaying = false\n                                        }\n                                    }\n                                },\n                                modifier = Modifier\n                                    .size(56.dp)\n                                    .background(accentColor, CircleShape)\n                            ) {\n                                Icon(\n                                    if (isPlaying) Icons.Filled.Pause else Icons.Filled.PlayArrow,\n                                    \"Play/Pause\",\n                                    tint = bgColor,\n                                    modifier = Modifier.size(32.dp)\n                                )\n                            }\n\n                            Spacer(modifier = Modifier.width(8.dp))\n\n                            // Skip Forward 10s\n                            IconButton(\n                                onClick = {\n                                    android.util.Log.d(\"TestSongScreen\", \"Skip forward 10s button pressed\")\n                                    vlcPlayerManager?.let { player ->\n                                        val currentPos = player.getCurrentPosition()\n                                        val duration = player.getDuration()\n                                        val newPos = (currentPos + 10000).coerceAtMost(duration)\n                                        player.seekTo(newPos)\n                                        currentPosition = newPos.toInt()\n                                    }\n                                }\n                            ) {\n                                Icon(\n                                    Icons.Filled.Forward10,\n                                    \"Forward 10s\",\n                                    tint = Color.White,\n                                    modifier = Modifier.size(32.dp)\n                                )\n                            }\n\n                            Spacer(modifier = Modifier.width(16.dp))\n\n                            // Stop Button\n                            IconButton(\n                                onClick = {\n                                    android.util.Log.d(\"TestSongScreen\", \"Stop button pressed\")\n                                    try {\n                                        vlcPlayerManager?.let { player ->\n                                            if (player.isPlaying()) {\n                                                player.stop()\n                                            }\n                                            player.release()\n                                        }\n                                    } catch (e: Exception) {\n                                        android.util.Log.e(\"TestSongScreen\", \"Error stopping VLC player\", e)\n                                    }\n                                    // Stop tracking playback\n                                    currentSong?.let { song ->\n                                        playbackTracker.stopPlayback(song.name)\n                                    }\n                                    \n                                    isPlaying = false\n                                    currentSong = null\n                                    currentPosition = 0\n                                    seekPosition = 0\n                                    \n                                    // Release audio focus when stopping\n                                    val audioManager = context.getSystemService(android.content.Context.AUDIO_SERVICE) as AudioManager\n                                    try {\n                                        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n                                            currentAudioFocusRequest?.let {\n                                                audioManager.abandonAudioFocusRequest(it)\n                                            }\n                                        } else {\n                                            @Suppress(\"DEPRECATION\")\n                                            audioManager.abandonAudioFocus(null)\n                                        }\n                                        hasAudioFocus = false\n                                        currentAudioFocusRequest = null\n                                        android.util.Log.d(\"TestSongScreen\", \"Audio focus released on stop\")\n                                    } catch (e: Exception) {\n                                        android.util.Log.e(\"TestSongScreen\", \"Error releasing audio focus\", e)\n                                    }\n                                }\n                            ) {\n                                Icon(\n                                    Icons.Filled.Stop,\n                                    \"Stop\",\n                                    tint = Color.White,\n                                    modifier = Modifier.size(28.dp)\n                                )\n                            }\n                        }\n\n                        Spacer(modifier = Modifier.height(12.dp))\n\n                        // Volume Control\n                        Row(\n                            modifier = Modifier.fillMaxWidth(),\n                            verticalAlignment = Alignment.CenterVertically,\n                            horizontalArrangement = Arrangement.spacedBy(8.dp)\n                        ) {\n                            Icon(\n                                Icons.Filled.VolumeDown,\n                                \"Volume\",\n                                tint = Color.White.copy(alpha = 0.7f),\n                                modifier = Modifier.size(20.dp)\n                            )\n                            Slider(\n                                value = volume,\n                                onValueChange = { \n                                    android.util.Log.d(\"TestSongScreen\", \"Volume slider changed: $it\")\n                                    volume = it \n                                },\n                                valueRange = 0f..1f,\n                                modifier = Modifier.weight(1f),\n                                colors = SliderDefaults.colors(\n                                    thumbColor = accentColor,\n                                    activeTrackColor = accentColor,\n                                    inactiveTrackColor = Color(0xFF424242)\n                                )\n                            )\n                            Icon(\n                                Icons.Filled.VolumeUp,\n                                \"Volume\",\n                                tint = Color.White.copy(alpha = 0.7f),\n                                modifier = Modifier.size(20.dp)\n                            )\n            Text(\n                                \"${(volume * 100).toInt()}%\",\n                                color = Color.White.copy(alpha = 0.7f),\n                                fontSize = 11.sp,\n                                modifier = Modifier.width(40.dp)\n                            )\n                        }\n\n                        // Balance Control\n                        Row(\n                            modifier = Modifier.fillMaxWidth(),\n                            verticalAlignment = Alignment.CenterVertically,\n                            horizontalArrangement = Arrangement.spacedBy(8.dp)\n                        ) {\n                            Text(\n                                \"L\",\n                                color = Color.White.copy(alpha = 0.7f),\n                                fontSize = 11.sp,\n                                modifier = Modifier.width(20.dp)\n                            )\n                            Slider(\n                                value = balance,\n                                onValueChange = { \n                                    android.util.Log.d(\"TestSongScreen\", \"Balance slider changed: $it\")\n                                    balance = it \n                                },\n                                valueRange = 0f..1f,\n                                modifier = Modifier.weight(1f),\n                                colors = SliderDefaults.colors(\n                                    thumbColor = accentColor,\n                                    activeTrackColor = accentColor,\n                                    inactiveTrackColor = Color(0xFF424242)\n                                )\n                            )\n                            Text(\n                                \"R\",\n                                color = Color.White.copy(alpha = 0.7f),\n                                fontSize = 11.sp,\n                                modifier = Modifier.width(20.dp)\n                            )\n                            TextButton(\n                                onClick = { \n                                    android.util.Log.d(\"TestSongScreen\", \"Balance reset button pressed\")\n                                    balance = 0.5f \n                                },\n                                modifier = Modifier.height(28.dp),\n                                contentPadding = PaddingValues(horizontal = 8.dp)\n                            ) {\n                                Text(\"Reset\", color = accentColor, fontSize = 10.sp)\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    ) { padding ->\n        if (!hasPermission) {\n            Box(\n                modifier = Modifier\n                    .fillMaxSize()\n                    .padding(padding),\n                contentAlignment = Alignment.Center\n            ) {\n    Column(\n                    horizontalAlignment = Alignment.CenterHorizontally,\n                    modifier = Modifier.padding(24.dp)\n                ) {\n                    Icon(\n                        Icons.Filled.FolderOff,\n                        contentDescription = null,\n                        tint = accentColor,\n                        modifier = Modifier.size(64.dp)\n                    )\n                    Spacer(modifier = Modifier.height(16.dp))\n                    Text(\n                        \"Storage permission required\",\n                        color = Color.White,\n                        style = MaterialTheme.typography.titleMedium,\n                        fontWeight = FontWeight.Bold\n                    )\n                    Text(\n                        \"Allow access to play test songs\",\n                        color = Color.White.copy(alpha = 0.7f),\n                        style = MaterialTheme.typography.bodyMedium\n                    )\n                }\n            }\n        } else if (audioFiles.isEmpty()) {\n            Box(\n                modifier = Modifier\n                    .fillMaxSize()\n                    .padding(padding),\n                contentAlignment = Alignment.Center\n            ) {\n                Column(horizontalAlignment = Alignment.CenterHorizontally) {\n                    CircularProgressIndicator(color = accentColor)\n                    Spacer(modifier = Modifier.height(16.dp))\n                    Text(\"Loading songs...\", color = Color.White)\n                }\n            }\n        } else {\n            // Driver Pair Display state (outside LazyColumn)\n            var driverPairsText by remember { mutableStateOf<String?>(null) }\n            LaunchedEffect(actualSerialNumber) {\n                if (actualSerialNumber.isNotBlank()) {\n                    try {\n                        val latestDriverPairing = withContext(Dispatchers.IO) {\n                            repository.getLatestDriverPairing(actualSerialNumber)\n                        }\n                        if (latestDriverPairing != null && latestDriverPairing.driverData.isNotBlank()) {\n                            val driverDataJson = org.json.JSONArray(latestDriverPairing.driverData)\n                            // Get only the latest (last) pair\n                            if (driverDataJson.length() > 0) {\n                                val lastIndex = driverDataJson.length() - 1\n                                val pairObj = driverDataJson.getJSONObject(lastIndex)\n                                val driver1 = pairObj.optString(\"driver1\", \"\")\n                                val driver2 = pairObj.optString(\"driver2\", \"\")\n                                if (driver1.isNotBlank() || driver2.isNotBlank()) {\n                                    driverPairsText = \"Pair ${lastIndex + 1}: R-$driver1 L-$driver2\"\n                                } else {\n                                    driverPairsText = null\n                                }\n                            } else {\n                                driverPairsText = null\n                            }\n                        } else {\n                            driverPairsText = null\n                        }\n                    } catch (e: Exception) {\n                        android.util.Log.e(\"TestSongScreen\", \"Error fetching driver pairs\", e)\n                        driverPairsText = null\n                    }\n                } else {\n                    driverPairsText = null\n                }\n            }\n            \n            LazyColumn(\n                modifier = Modifier\n                    .fillMaxSize()\n                    .padding(padding)\n                    .padding(horizontal = 16.dp, vertical = 8.dp),\n                verticalArrangement = Arrangement.spacedBy(8.dp)\n            ) {\n                item {\n                    if (driverPairsText != null) {\n                        Card(\n                            modifier = Modifier.fillMaxWidth(),\n                            colors = CardDefaults.cardColors(containerColor = Color(0xFF2196F3).copy(alpha = 0.2f)),\n                            shape = RoundedCornerShape(8.dp)\n                        ) {\n                            Row(\n                                modifier = Modifier\n                                    .fillMaxWidth()\n                                    .padding(12.dp),\n                                verticalAlignment = Alignment.CenterVertically,\n                                horizontalArrangement = Arrangement.spacedBy(8.dp)\n                            ) {\n                                Icon(\n                                    Icons.Filled.Speaker,\n                                    contentDescription = \"Driver Pairs\",\n                                    tint = Color(0xFF2196F3),\n                                    modifier = Modifier.size(20.dp)\n                                )\n                                Text(\n                                    driverPairsText!!,\n                                    style = MaterialTheme.typography.bodyMedium,\n                                    color = Color.White,\n                                    fontSize = 13.sp,\n                                    fontWeight = FontWeight.Medium\n                                )\n                            }\n                        }\n                    }\n                }\n                \n                item {\n                    Column {\n                        // Header with overall review button\n                        Row(\n                            modifier = Modifier.fillMaxWidth(),\n                            horizontalArrangement = Arrangement.SpaceBetween,\n                            verticalAlignment = Alignment.CenterVertically\n                        ) {\n                            Text(\n                                \"Available Test Songs\",\n                                style = MaterialTheme.typography.titleMedium,\n                                color = accentColor,\n                                fontWeight = FontWeight.Bold\n                            )\n                            \n                            // Overall Headphone Review Button\n                            Button(\n                                onClick = {\n                                    android.util.Log.d(\"TestSongScreen\", \" Overall headphone review button pressed\")\n                                    android.util.Log.d(\"TestSongScreen\", \" Setting showReview = true, previousTestResult = null\")\n                                    previousTestResult = null // Reset for fresh review\n                                    showReview = true\n                                    android.util.Log.d(\"TestSongScreen\", \" showReview set to true\")\n                                },\n                                colors = ButtonDefaults.buttonColors(\n                                    containerColor = Color(0xFFFF9800),\n                                    contentColor = Color.White\n                                ),\n                                modifier = Modifier.height(40.dp)\n                            ) {\n                                Icon(\n                                    Icons.Filled.Headphones,\n                                    contentDescription = null,\n                                    modifier = Modifier.size(18.dp)\n                                )\n                                Spacer(modifier = Modifier.width(8.dp))\n                                Text(\"Review Headphone\", fontSize = 12.sp, fontWeight = FontWeight.Bold)\n                            }\n                        }\n                        \n                        Spacer(modifier = Modifier.height(8.dp))\n                    }\n                }\n\n                itemsIndexed(audioFiles, key = { _, item -> item.file.absolutePath }) { index, audioFile ->\n            Card(\n                modifier = Modifier\n                    .fillMaxWidth()\n                    .animateItemPlacement()\n                            .clickable {\n                                android.util.Log.d(\"TestSongScreen\", \"Song selected: ${audioFile.name}\")\n                                \n                                val audioManager = context.getSystemService(android.content.Context.AUDIO_SERVICE) as AudioManager\n                                \n                                // Abandon previous audio focus if we have it\n                                if (hasAudioFocus) {\n                                    android.util.Log.d(\"TestSongScreen\", \"Abandoning previous audio focus before requesting new one\")\n                                    try {\n                                        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n                                            currentAudioFocusRequest?.let {\n                                                audioManager.abandonAudioFocusRequest(it)\n                                            }\n                                        } else {\n                                            @Suppress(\"DEPRECATION\")\n                                            audioManager.abandonAudioFocus(null)\n                                        }\n                                        hasAudioFocus = false\n                                        currentAudioFocusRequest = null\n                                    } catch (e: Exception) {\n                                        android.util.Log.e(\"TestSongScreen\", \"Error abandoning audio focus\", e)\n                                    }\n                                }\n                                \n                                // Request audio focus before playing\n                                val audioFocusRequest = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n                                    AudioFocusRequest.Builder(AudioManager.AUDIOFOCUS_GAIN)\n                                        .setAudioAttributes(android.media.AudioAttributes.Builder()\n                                            .setUsage(android.media.AudioAttributes.USAGE_MEDIA)\n                                            .setContentType(android.media.AudioAttributes.CONTENT_TYPE_MUSIC)\n                                            .build())\n                                        .setAcceptsDelayedFocusGain(true)\n                                        .setOnAudioFocusChangeListener { focusChange ->\n                                            android.util.Log.d(\"TestSongScreen\", \"Audio focus change: $focusChange\")\n                                            when (focusChange) {\n                                                AudioManager.AUDIOFOCUS_LOSS -> {\n                                                    android.util.Log.d(\"TestSongScreen\", \"Audio focus lost (permanent) - stopping playback\")\n                                                    try {\n                                                        vlcPlayerManager?.let { player ->\n                                                            if (player.isPlaying()) {\n                                                                player.stop()\n                                                            }\n                                                            player.release()\n                                                        }\n                                                    } catch (e: Exception) {\n                                                        android.util.Log.e(\"TestSongScreen\", \"Error releasing player on focus loss\", e)\n                                                    }\n                                                    isPlaying = false\n                                                    hasAudioFocus = false\n                                                    currentAudioFocusRequest = null\n                                                }\n                                                AudioManager.AUDIOFOCUS_LOSS_TRANSIENT -> {\n                                                    android.util.Log.d(\"TestSongScreen\", \"Audio focus lost transient - pausing playback\")\n                                                    try {\n                                                        vlcPlayerManager?.pause()\n                                                    } catch (e: Exception) {\n                                                        android.util.Log.e(\"TestSongScreen\", \"Error pausing player\", e)\n                                                    }\n                                                    isPlaying = false\n                                                }\n                                                AudioManager.AUDIOFOCUS_GAIN -> {\n                                                    android.util.Log.d(\"TestSongScreen\", \"Audio focus gained - resuming playback if needed\")\n                                                    hasAudioFocus = true\n                                                    // Don't auto-resume, let user control playback\n                                                }\n                                            }\n                                        }\n                                        .build()\n                                } else {\n                                    null\n                                }\n                                \n                                val focusResult = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n                                    audioManager.requestAudioFocus(audioFocusRequest!!)\n                                } else {\n                                    @Suppress(\"DEPRECATION\")\n                                    audioManager.requestAudioFocus(\n                                        { focusChange ->\n                                            android.util.Log.d(\"TestSongScreen\", \"Audio focus change (legacy): $focusChange\")\n                                            when (focusChange) {\n                                                AudioManager.AUDIOFOCUS_LOSS -> {\n                                                    android.util.Log.d(\"TestSongScreen\", \"Audio focus lost (permanent) - stopping playback\")\n                                                    try {\n                                                        vlcPlayerManager?.let { player ->\n                                                            if (player.isPlaying()) {\n                                                                player.stop()\n                                                            }\n                                                            player.release()\n                                                        }\n                                                    } catch (e: Exception) {\n                                                        android.util.Log.e(\"TestSongScreen\", \"Error releasing player on focus loss\", e)\n                                                    }\n                                                    isPlaying = false\n                                                    hasAudioFocus = false\n                                                }\n                                                AudioManager.AUDIOFOCUS_LOSS_TRANSIENT -> {\n                                                    android.util.Log.d(\"TestSongScreen\", \"Audio focus lost transient - pausing playback\")\n                                                    try {\n                                                        vlcPlayerManager?.pause()\n                                                    } catch (e: Exception) {\n                                                        android.util.Log.e(\"TestSongScreen\", \"Error pausing player\", e)\n                                                    }\n                                                    isPlaying = false\n                                                }\n                                                AudioManager.AUDIOFOCUS_GAIN -> {\n                                                    android.util.Log.d(\"TestSongScreen\", \"Audio focus gained\")\n                                                    hasAudioFocus = true\n                                                }\n                                            }\n                                        },\n                                        AudioManager.STREAM_MUSIC,\n                                        AudioManager.AUDIOFOCUS_GAIN\n                                    )\n                                }\n                                \n                                if (focusResult != AudioManager.AUDIOFOCUS_REQUEST_GRANTED) {\n                                    android.util.Log.w(\"TestSongScreen\", \"Audio focus not granted (result: $focusResult) - cannot play song\")\n                                    return@clickable\n                                }\n                                \n                                // Store the audio focus request and mark that we have focus\n                                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n                                    currentAudioFocusRequest = audioFocusRequest\n                                }\n                                hasAudioFocus = true\n                                android.util.Log.d(\"TestSongScreen\", \"Audio focus granted successfully\")\n                                \n                                // Stop and release current player properly before starting new one\n                                try {\n                                    vlcPlayerManager?.let { player ->\n                                        if (player.isPlaying()) {\n                                            player.stop()\n                                        }\n                                        player.release()\n                                    }\n                                } catch (e: Exception) {\n                                    android.util.Log.e(\"TestSongScreen\", \"Error releasing previous VLC player\", e)\n                                }\n                                \n                                // Stop tracking for previous song if playing a different song\n                                currentSong?.let { previousSong ->\n                                    if (previousSong.name != audioFile.name) {\n                                        android.util.Log.d(\"TestSongScreen\", \" Stopping previous song tracking: ${previousSong.name}\")\n                                        playbackTracker.stopPlayback(previousSong.name)\n                                    }\n                                }\n                                \n                                // Play new song with VLC\n                                try {\n                                    vlcPlayerManager?.let { player ->\n                                        // Apply current volume and balance before playing\n                                        val leftVolume = volume * (1f - balance).coerceIn(0f, 1f)\n                                        val rightVolume = volume * balance.coerceIn(0f, 1f)\n                                        player.setStereoVolume(leftVolume, rightVolume)\n                                        \n                                        // Play the file\n                                        player.play(audioFile.file)\n                                        \n                                        android.util.Log.d(\"TestSongScreen\", \" VLC: Started playing: ${audioFile.name}\")\n                                        \n                                        // Start tracking playback\n                                        playbackTracker.startPlayback(audioFile.name)\n                                    } ?: run {\n                                        android.util.Log.e(\"TestSongScreen\", \" VLC Player Manager not initialized\")\n                                    }\n                                    \n                                    currentSong = audioFile\n                                    currentPosition = 0\n                                    seekPosition = 0\n                                } catch (e: Exception) {\n                                    android.util.Log.e(\"TestSongScreen\", \" Error playing song with VLC: ${audioFile.name}\", e)\n                                    currentSong = null\n                                    isPlaying = false\n                                }\n                            },\n                        colors = CardDefaults.cardColors(\n                            containerColor = if (currentSong == audioFile && isPlaying) \n                                Color(0xFF3B3B3B) else surfaceColor\n                        ),\n                        shape = RoundedCornerShape(12.dp)\n                    ) {\n                        Row(\n                            modifier = Modifier\n                                .fillMaxWidth()\n                                .padding(12.dp),\n                            horizontalArrangement = Arrangement.SpaceBetween,\n                            verticalAlignment = Alignment.CenterVertically\n                        ) {\n                            // Drag Handle (left side - like Spotify)\n                            Icon(\n                                Icons.Filled.DragHandle,\n                                contentDescription = \"Reorder\",\n                                tint = Color.White.copy(alpha = 0.7f),\n                                modifier = Modifier\n                                    .size(24.dp)\n                                    .pointerInput(index) {\n                                        detectDragGesturesAfterLongPress(\n                                            onDragStart = { offset ->\n                                                draggedIndex = index\n                                                Log.d(\"TestSongScreen\", \"Drag started for index $index\")\n                                            },\n                                            onDrag = { change, dragAmount ->\n                                                change.consume()\n                                                val delta = dragAmount.y\n                                                val threshold = 30f // Reduced threshold for more responsive dragging\n                                                \n                                                if (delta > threshold && index < audioFiles.size - 1) {\n                                                    // Move down\n                                                    val item = audioFiles[index]\n                                                    audioFiles.removeAt(index)\n                                                    audioFiles.add(index + 1, item)\n                                                    draggedIndex = index + 1\n                                                    Log.d(\"TestSongScreen\", \"Moved item down from $index to ${index + 1}\")\n                                                } else if (delta < -threshold && index > 0) {\n                                                    // Move up\n                                                    val item = audioFiles[index]\n                                                    audioFiles.removeAt(index)\n                                                    audioFiles.add(index - 1, item)\n                                                    draggedIndex = index - 1\n                                                    Log.d(\"TestSongScreen\", \"Moved item up from $index to ${index - 1}\")\n                                                }\n                                            },\n                                            onDragEnd = {\n                                                draggedIndex = null\n                                                Log.d(\"TestSongScreen\", \"Drag ended\")\n                                            },\n                                            onDragCancel = {\n                                                draggedIndex = null\n                                                Log.d(\"TestSongScreen\", \"Drag cancelled\")\n                                            }\n                                        )\n                                    }\n                            )\n                            \n                            Spacer(modifier = Modifier.width(8.dp))\n                            \n                            Row(\n                                horizontalArrangement = Arrangement.spacedBy(12.dp),\n                                verticalAlignment = Alignment.CenterVertically,\n                                modifier = Modifier.weight(1f)\n                            ) {\n                                // Icon\n                                Box(\n                                    modifier = Modifier\n                                        .size(48.dp)\n                                        .clip(RoundedCornerShape(8.dp))\n                                        .background(\n                                            if (currentSong == audioFile && isPlaying) \n                                                accentColor else Color(0xFF424242)\n                                        ),\n                                    contentAlignment = Alignment.Center\n                                ) {\n                                    Icon(\n                                        if (currentSong == audioFile && isPlaying) \n                                            Icons.Filled.MusicNote else Icons.Filled.AudioFile,\n                                        contentDescription = null,\n                                        tint = if (currentSong == audioFile && isPlaying) \n                                            bgColor else Color.White.copy(alpha = 0.7f),\n                                        modifier = Modifier.size(24.dp)\n                                    )\n                                }\n\n                                // Song Info\n                                Column(modifier = Modifier.weight(1f)) {\n                                    Text(\n                                        audioFile.name,\n                                        style = MaterialTheme.typography.titleSmall,\n                                        color = Color.White,\n                                        fontWeight = FontWeight.SemiBold,\n                                        maxLines = 1,\n                                        overflow = TextOverflow.Ellipsis\n                                    )\n                                    Spacer(modifier = Modifier.height(2.dp))\n                                    Text(\n                                        \"${audioFileManager.formatDuration(audioFile.duration)}  ${audioFileManager.formatFileSize(audioFile.size)}\",\n                                        style = MaterialTheme.typography.bodySmall,\n                                        color = Color.White.copy(alpha = 0.7f),\n                                        fontSize = 11.sp\n                                    )\n                                }\n                            }\n\n                            // Action buttons\n                            Row(\n                                horizontalArrangement = Arrangement.spacedBy(8.dp),\n                                verticalAlignment = Alignment.CenterVertically\n                            ) {\n                                // Review button for this song\n                                Button(\n                                    onClick = {\n                                        android.util.Log.d(\"TestSongScreen\", \"Review button pressed for song: ${audioFile.name}\")\n                                        songToReview = audioFile\n                                        reviewFromOverallScreen = false // Review from Test Song Screen, not overall review\n                                        showReviewDialog = true\n                                    },\n                                    enabled = actualSerialNumber.isNotBlank(),\n                                    modifier = Modifier.height(36.dp),\n                                    colors = ButtonDefaults.buttonColors(\n                                        containerColor = if (actualSerialNumber.isNotBlank()) Color(0xFF4CAF50) else Color(0xFF666666),\n                                        contentColor = Color.White\n                                    ),\n                                    contentPadding = PaddingValues(horizontal = 12.dp, vertical = 0.dp)\n                                ) {\n                                    Text(\"Review\", fontSize = 12.sp, fontWeight = FontWeight.Bold)\n                                }\n                                \n                                if (currentSong == audioFile && isPlaying) {\n                                    Icon(\n                                        Icons.Filled.PlayArrow,\n                                        \"Playing\",\n                                        tint = accentColor,\n                                        modifier = Modifier.size(32.dp)\n                                    )\n                                }\n                            }\n                        }\n                    }\n                }\n\n                if (actualSerialNumber.isBlank()) {\n                    item {\n                        Card(\n                            colors = CardDefaults.cardColors(\n                                containerColor = Color(0x33FFC107)\n                            ),\n                            modifier = Modifier.padding(vertical = 8.dp)\n                        ) {\n                            Row(\n                                modifier = Modifier.padding(12.dp),\n                                horizontalArrangement = Arrangement.spacedBy(8.dp),\n                                verticalAlignment = Alignment.CenterVertically\n                            ) {\n                                Icon(\n                                    Icons.Filled.Warning,\n                                    contentDescription = null,\n                                    tint = accentColor,\n                                    modifier = Modifier.size(20.dp)\n                                )\n                                Text(\n                                    \"Scan a QR code first to enable test result saving\",\n                                    color = Color.White,\n                                    style = MaterialTheme.typography.bodySmall,\n                                    fontSize = 11.sp\n                                )\n                            }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n    // Song Review Dialog - Individual Song (TestSongReviewScreen)\n        if (showReviewDialog && songToReview != null) {\n            TestSongReviewScreen(\n                testType = TestType.SONG,\n                previousTestResult = null,\n                onResultSubmitted = { result ->\n                    android.util.Log.d(\"TestSongScreen\", \" Individual song review submitted\")\n                    android.util.Log.d(\"TestSongScreen\", \" Song: ${songToReview?.name}\")\n                    android.util.Log.d(\"TestSongScreen\", \" Outcome: ${result.outcome}\")\n                    android.util.Log.d(\"TestSongScreen\", \" Issues: ${result.issues}\")\n                    android.util.Log.d(\"TestSongScreen\", \" Solutions: ${result.solutions}\")\n                    android.util.Log.d(\"TestSongScreen\", \" Remark: '${result.remark}'\")\n                    scope.launch {\n                        // Individual songs don't require session ID - save directly\n                        // Convert issues list to JSON array format for structured storage\n                        val issuesJson = if (result.issues.isEmpty()) {\n                            \"[]\"\n                        } else {\n                            result.issues.joinToString(\", \", prefix = \"[\", postfix = \"]\") { \"\\\"$it\\\"\" }\n                        }\n                        \n                        // Get entry timestamp\n                        val entryTimestamp = java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.getDefault()).format(java.util.Date(sessionStartTime ?: System.currentTimeMillis()))\n                        \n                        // Get playback duration from tracker for this song\n                        val currentSongName = songToReview?.name ?: \"\"\n                        val durationMs = if (currentSongName.isNotEmpty()) {\n                            playbackTracker.getSongDuration(currentSongName)\n                        } else {\n                            0L\n                        }\n                        \n                        // Format duration as HH:MM:SS\n                        val totalHours = durationMs / (1000 * 60 * 60)\n                        val totalMinutes = (durationMs % (1000 * 60 * 60)) / (1000 * 60)\n                        val totalSeconds = (durationMs % (1000 * 60)) / 1000\n                        val formattedDuration = String.format(\"%02d:%02d:%02d\", totalHours, totalMinutes, totalSeconds)\n                        \n                        android.util.Log.d(\"TestSongScreen\", \" [DURATION] Song: $currentSongName, Duration: ${durationMs}ms = $formattedDuration\")\n                        \n                        val songTest = SongTest(\n                            serialNumber = actualSerialNumber,\n                            testStage = result.testStage,\n                            operatorName = actualOperatorName,\n                            entryTimestamp = entryTimestamp,\n                            exitTimestamp = entryTimestamp, // Will be updated at final submit\n                            totalTimeSpent = formattedDuration, // Store actual playback duration\n                            songName = currentSongName,\n                            result = result.outcome.name,\n                            issues = issuesJson, // JSON array format: [\"Issue 1\", \"Issue 2\"]\n                            solutions = \"\", // Individual songs don't have solutions\n                            remark = result.remark,\n                            timestamp = java.time.Instant.now().toString(),\n                            iterationNumber = currentIterationNumber,\n                            isOverallResult = false\n                        )\n                        \n                        android.util.Log.d(\"TestSongScreen\", \" Saving individual song test data:\")\n                        android.util.Log.d(\"TestSongScreen\", \"   Song: ${songTest.songName}\")\n                        android.util.Log.d(\"TestSongScreen\", \"   Result: ${songTest.result}\")\n                        android.util.Log.d(\"TestSongScreen\", \"   Issues: ${songTest.issues}\")\n                        android.util.Log.d(\"TestSongScreen\", \"   Serial: ${songTest.serialNumber}\")\n                        android.util.Log.d(\"TestSongScreen\", \"   Operator: ${songTest.operatorName}\")\n                        android.util.Log.d(\"TestSongScreen\", \"   Entry Timestamp: ${songTest.entryTimestamp}\")\n                        android.util.Log.d(\"TestSongScreen\", \"   Iteration Number: ${songTest.iterationNumber}\")\n                        \n                        val operatorId = authenticatedOperator?.operatorId\n                        val testId = repository.insertSongTest(songTest, operatorId)\n                        android.util.Log.d(\"TestSongScreen\", \" Individual song test saved successfully to database with ID: $testId\")\n                        \n                        // Mark song as reviewed in tracker\n                        val reviewedSongName = songToReview?.name\n                        songToReview?.let { song ->\n                            playbackTracker.markAsReviewed(song.name, result.outcome.name)\n                            android.util.Log.d(\"TestSongScreen\", \" Marked song as reviewed in tracker: ${song.name} -> ${result.outcome.name}\")\n                        }\n                        \n                        // Update milestone for test song (individual songs don't update milestone, only overall review does)\n                        // Milestone is updated only when overall review is committed\n                        \n                        showReviewDialog = false\n                        val wasFromOverallScreen = reviewFromOverallScreen\n                        reviewFromOverallScreen = false\n                        songToReview = null\n                        \n                        if (wasFromOverallScreen) {\n                            // Reopen overall review dialog if review was opened from overall review screen\n                            android.util.Log.d(\"TestSongScreen\", \" Review dialog closed - reopening overall review dialog\")\n                            kotlinx.coroutines.delay(100) // Small delay to ensure dialog closes properly\n                            showReview = true\n                            android.util.Log.d(\"TestSongScreen\", \" Overall review dialog reopened\")\n                        } else {\n                            // Stay on Test Song Screen if review was opened directly from Test Song Screen\n                            android.util.Log.d(\"TestSongScreen\", \" Review dialog closed - staying on Test Song page\")\n                        }\n                    }\n                },\n                onCancel = {\n                    showReviewDialog = false\n                    val wasFromOverallScreen = reviewFromOverallScreen\n                    reviewFromOverallScreen = false\n                    songToReview = null\n                    \n                    if (wasFromOverallScreen) {\n                        // Reopen overall review dialog if review was opened from overall review screen\n                        android.util.Log.d(\"TestSongScreen\", \" Individual song review cancelled - reopening overall review dialog\")\n                        scope.launch {\n                            kotlinx.coroutines.delay(100) // Small delay to ensure dialog closes properly\n                            showReview = true\n                            android.util.Log.d(\"TestSongScreen\", \" Overall review dialog reopened after cancel\")\n                        }\n                    } else {\n                        // Stay on Test Song Screen if review was opened directly from Test Song Screen\n                        android.util.Log.d(\"TestSongScreen\", \" Individual song review cancelled - staying on Test Song page\")\n                    }\n                },\n                validator = reviewValidator\n            )\n        }\n        \n        // Handle back button - intercept and open overall review dialog instead of exiting\n        BackHandler(enabled = !showReview && !showReviewDialog) {\n            android.util.Log.d(\"TestSongScreen\", \" Back button pressed - opening overall review dialog instead of exiting\")\n            previousTestResult = null // Reset for fresh review\n            showReview = true\n        }\n        \n        // Check for undo payload when screen becomes visible (after navigation back)\n        val undoState by undoManager.undoState.collectAsState()\n        \n        // Track if we just restored from undo to prevent clearing flags prematurely\n        var previousUndoActive by remember { mutableStateOf(false) }\n        \n        // Check for payload whenever screen becomes visible (including after navigation)\n        DisposableEffect(Unit) {\n            android.util.Log.d(\"TestSongScreen\", \" DisposableEffect: Screen visible - checking for undo payload\")\n            // Only check for undo payload if we're not already showing review dialog\n            if (!showReview) {\n                val undoPayload = undoManager.getAndClearLastUndo()\n                if (undoPayload != null) {\n                    val (restoredResult, fromScreen) = undoPayload\n                    android.util.Log.d(\"TestSongScreen\", \" UNDO PAYLOAD found!\")\n                    android.util.Log.d(\"TestSongScreen\", \" From screen: $fromScreen, Result: ${restoredResult.outcome}\")\n                    \n                    if (fromScreen == \"TEST_SONGS\") {\n                        // Set flags to trigger dialog opening\n                        previousTestResult = restoredResult\n                        shouldShowReviewAfterUndo = true\n                        isFromUndo = true\n                        isRestoringFromUndo = true\n                        android.util.Log.d(\"TestSongScreen\", \" UNDO PAYLOAD: Set flags - dialog will open at step: ${restoredResult.outcome}\")\n                    }\n                } else {\n                    android.util.Log.d(\"TestSongScreen\", \" No undo payload found\")\n                }\n            } else {\n                android.util.Log.d(\"TestSongScreen\", \" Dialog already showing, skipping undo payload check\")\n            }\n            \n            onDispose { }\n        }\n        \n        // Watch undo state changes - check for payload when undo becomes inactive\n        LaunchedEffect(undoState.isActive) {\n            val undoBecameInactive = previousUndoActive && !undoState.isActive\n            previousUndoActive = undoState.isActive\n            \n            if (undoBecameInactive && !isRestoringFromUndo) {\n                // Undo was just executed - check for payload\n                android.util.Log.d(\"TestSongScreen\", \" Undo became inactive - checking for payload\")\n                val undoPayload = undoManager.getAndClearLastUndo()\n                if (undoPayload != null) {\n                    val (restoredResult, fromScreen) = undoPayload\n                    android.util.Log.d(\"TestSongScreen\", \" UNDO PAYLOAD found after undo execution!\")\n                    \n                    if (fromScreen == \"TEST_SONGS\") {\n                        previousTestResult = restoredResult\n                        shouldShowReviewAfterUndo = true\n                        isFromUndo = true\n                        isRestoringFromUndo = true\n                        android.util.Log.d(\"TestSongScreen\", \" UNDO PAYLOAD: Set flags from undo state change\")\n                    }\n                }\n            } else if (!undoState.isActive && !isRestoringFromUndo) {\n                // Clear any stale payload/flags\n                val stalePayload = undoManager.getAndClearLastUndo()\n                if (stalePayload != null) {\n                    android.util.Log.d(\"TestSongScreen\", \" Found stale undo payload - cleared\")\n                }\n                if (shouldShowReviewAfterUndo) {\n                    android.util.Log.d(\"TestSongScreen\", \" Clearing stale restoration flags\")\n                    shouldShowReviewAfterUndo = false\n                    previousTestResult = null\n                }\n            }\n        }\n        \n        // Watch for undo restoration - trigger when both flags are set\n        LaunchedEffect(previousTestResult, shouldShowReviewAfterUndo) {\n            if (shouldShowReviewAfterUndo && previousTestResult != null) {\n                val outcome = previousTestResult!!.outcome\n                val stepName = when (outcome) {\n                    com.example.fqcapp.data.TestOutcome.PASS -> \"PASS_CHECKS\"\n                    com.example.fqcapp.data.TestOutcome.FAIL -> \"FAIL_SOLUTIONS\"\n                    com.example.fqcapp.data.TestOutcome.CAN_BE_PASSED -> \"CAN_BE_PASSED\"\n                    com.example.fqcapp.data.TestOutcome.TEST_NOT_DONE -> \"TEST_NOT_DONE\"\n                }\n                \n                android.util.Log.d(\"TestSongScreen\", \" UNDO: Opening review dialog at submission step: $stepName\")\n                android.util.Log.d(\"TestSongScreen\", \" Outcome: $outcome\")\n                \n                // Minimal delay to ensure navigation to Test Song screen has completed\n                kotlinx.coroutines.delay(100)\n                showReview = true\n                shouldShowReviewAfterUndo = false\n                isRestoringFromUndo = false\n                android.util.Log.d(\"TestSongScreen\", \" Review dialog opened at step: $stepName\")\n            }\n        }\n        \n        // Full-screen review overlay (overall + undo buffer)\n        LaunchedEffect(showReview) {\n            android.util.Log.d(\"TestSongScreen\", \" LaunchedEffect: showReview changed to: $showReview\")\n        }\n        \n        if (showReview) {\n            android.util.Log.d(\"TestSongScreen\", \" Rendering overall review dialog\")\n            androidx.compose.material3.BasicAlertDialog(\n                onDismissRequest = {\n                    // Only dismiss if user explicitly closes (not via back button - that's handled internally)\n                    android.util.Log.d(\"TestSongScreen\", \" Dialog dismissed\")\n                    showReview = false\n                    if (isFromUndo) {\n                        isFromUndo = false\n                    }\n                },\n                properties = androidx.compose.ui.window.DialogProperties(\n                    usePlatformDefaultWidth = false,\n                    decorFitsSystemWindows = false,\n                    dismissOnBackPress = false // Disable default back press handling - we handle it internally\n                )\n            ) {\n                Box(\n                    modifier = Modifier\n                        .fillMaxSize()\n                        .fillMaxWidth(),\n                    contentAlignment = Alignment.Center\n                ) {\n                    TestSongOverallReviewScreenContainer(\n                        testType = TestType.SONG,\n                        previousTestResult = previousTestResult,\n                        onResultSubmitted = { result ->\n                            android.util.Log.d(\"TestSongScreen\", \" Overall review submitted: ${result.outcome}\")\n                            // Store result for undo restoration\n                            previousTestResult = result\n                            android.util.Log.d(\"TestSongScreen\", \" Stored previousTestResult for undo: ${result.outcome}\")\n                            \n                            // Close review dialog\n                            showReview = false\n                            \n                            // Start undo timer - buffer the submission\n                            android.util.Log.d(\"TestSongScreen\", \" Calling startUndo with scope: $scope\")\n                            undoManager.startUndo(\n                                testResult = result,\n                                onUndo = {\n                                    android.util.Log.d(\"TestSongScreen\", \" UNDO pressed - navigating to Test Song Screen\")\n                                    android.util.Log.d(\"TestSongScreen\", \" Result to show at step: ${result.outcome}\")\n                                    \n                                    // UndoManager.executeUndo() already stored payload in lastUndoPayload\n                                    // Just navigate - DisposableEffect will check payload and open dialog\n                                    android.util.Log.d(\"TestSongScreen\", \" Payload stored in UndoManager - navigating to Test Song Screen\")\n                                    android.util.Log.d(\"TestSongScreen\", \" DisposableEffect will detect payload and open review dialog\")\n                                    \n                                    // Explicitly navigate to Test Song Screen (don't use onBack since back stack might be cleared)\n                                    // Use explicit navigation callback if available, otherwise fall back to onBack\n                                    onNavigateToTestSongs?.invoke() ?: onBack?.invoke()\n                                },\n                                onCommit = suspend {\n                                    android.util.Log.d(\"TestSongScreen\", \" COMMIT after 30s - saving overall song test to DB\")\n                                    \n                                    // Save overall song test to database\n                                    val issuesJson = if (result.issues.isEmpty()) {\n                                        \"[]\"\n                                    } else {\n                                        result.issues.joinToString(\", \", prefix = \"[\", postfix = \"]\") { \"\\\"$it\\\"\" }\n                                    }\n                                    \n                                    val solutionsJson = if (result.solutions.isEmpty()) {\n                                        \"[]\"\n                                    } else {\n                                        result.solutions.joinToString(\", \", prefix = \"[\", postfix = \"]\") { \"\\\"$it\\\"\" }\n                                    }\n                                    \n                                    val entryTimestamp = java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.getDefault()).format(java.util.Date(sessionStartTime ?: System.currentTimeMillis()))\n                                    val exitTimestamp = java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.getDefault()).format(java.util.Date())\n                                    \n                                    // Calculate total time spent (from session start to now)\n                                    val totalTimeMs = (sessionStartTime ?: System.currentTimeMillis()).let { start ->\n                                        System.currentTimeMillis() - start\n                                    }\n                                    val totalHours = totalTimeMs / (1000 * 60 * 60)\n                                    val totalMinutes = (totalTimeMs % (1000 * 60 * 60)) / (1000 * 60)\n                                    val totalSeconds = (totalTimeMs % (1000 * 60)) / 1000\n                                    val formattedDuration = String.format(\"%02d:%02d:%02d\", totalHours, totalMinutes, totalSeconds)\n                                    \n                                    val songTest = SongTest(\n                                        serialNumber = actualSerialNumber,\n                                        testStage = result.testStage,\n                                        operatorName = actualOperatorName,\n                                        entryTimestamp = entryTimestamp,\n                                        exitTimestamp = exitTimestamp,\n                                        totalTimeSpent = formattedDuration,\n                                        songName = \"OVERALL\", // Overall review doesn't have a specific song\n                                        result = result.outcome.name,\n                                        issues = issuesJson,\n                                        solutions = solutionsJson,\n                                        remark = result.remark,\n                                        timestamp = java.time.Instant.now().toString(),\n                                        iterationNumber = currentIterationNumber,\n                                        isOverallResult = true\n                                    )\n                                    \n                                    val operatorId = authenticatedOperator?.operatorId\n                                    val testId = repository.insertSongTest(songTest, operatorId)\n                                    android.util.Log.d(\"TestSongScreen\", \" Overall song test committed with ID: $testId\")\n                                    \n                                    // Add solution reminders if test failed and has solutions\n                                    if (result.outcome == TestOutcome.FAIL && \n                                        result.solutions.isNotEmpty() &&\n                                        solutionReminderManager != null &&\n                                        actualSerialNumber.isNotBlank()) {\n                                        try {\n                                            solutionReminderManager.addPendingSolution(\n                                                serialNumber = actualSerialNumber,\n                                                testType = TestType.SONG,\n                                                solutions = result.solutions,\n                                                testId = testId\n                                            )\n                                            android.util.Log.d(\"TestSongScreen\", \" Added ${result.solutions.size} solution reminders\")\n                                        } catch (e: Exception) {\n                                            android.util.Log.e(\"TestSongScreen\", \" Error adding solution reminders\", e)\n                                        }\n                                    }\n                                    \n                                    // Update milestone\n                                    if (actualSerialNumber.isNotBlank() && result.outcome != TestOutcome.TEST_NOT_DONE) {\n                                        try {\n                                            val milestoneService = com.example.fqcapp.services.MilestoneUpdateService(repository)\n                                            milestoneService.updateTestSongStatus(actualSerialNumber, result.outcome.name)\n                                            android.util.Log.d(\"TestSongScreen\", \" Milestone updated for song test\")\n                                        } catch (e: Exception) {\n                                            android.util.Log.e(\"TestSongScreen\", \" Error updating milestone\", e)\n                                        }\n                                    }\n                                    \n                                    // Navigate to landing page\n                                    onNavigateToLanding?.invoke() ?: onBack?.invoke() ?: Unit\n                                },\n                                scope = scope,\n                                fromScreen = \"TEST_SONGS\"\n                            )\n                            \n                            // Navigate to landing page immediately (undo snackbar will show there)\n                            onNavigateToLanding?.invoke() ?: onBack?.invoke()\n                        },\n                        onCancel = {\n                            android.util.Log.d(\"TestSongScreen\", \" Overall review cancelled\")\n                            showReview = false\n                        },\n                        playbackTracker = playbackTracker,\n                        onSongReviewRequested = { songName ->\n                            // Find the audio file and open review dialog\n                            android.util.Log.d(\"TestSongScreen\", \" [NAVIGATION] Opening review for song: $songName\")\n                            val audioFile = audioFiles.find { it.name == songName }\n                            if (audioFile != null) {\n                                songToReview = audioFile\n                                reviewFromOverallScreen = true // Review from overall review screen's song table\n                                // Temporarily close overall review dialog to show individual song review\n                                showReview = false\n                                showReviewDialog = true\n                                android.util.Log.d(\"TestSongScreen\", \" [NAVIGATION] Individual song review dialog opened (overall review temporarily closed)\")\n                            } else {\n                                android.util.Log.w(\"TestSongScreen\", \" Song not found in audio files: $songName\")\n                            }\n                        }\n                    )\n                }\n            }\n        }\n    \n    // Removed full-screen overlay review (reverted)\n    \n    // Restore default back behavior (no forced review on back)\n    \n    // Session Handover Banner (inside Box)\n    sessionHandover?.let { message ->\n        Card(\n            modifier = Modifier\n                .fillMaxWidth()\n                .padding(16.dp),\n            colors = CardDefaults.cardColors(\n                containerColor = Color(0xFFFF9800)\n            )\n        ) {\n            Row(\n                modifier = Modifier\n                    .fillMaxWidth()\n                    .padding(16.dp),\n                horizontalArrangement = Arrangement.SpaceBetween,\n                verticalAlignment = Alignment.CenterVertically\n            ) {\n                Text(\n                    text = message,\n                    color = Color.White,\n                    fontWeight = FontWeight.Bold\n                )\n                IconButton(\n                    onClick = { sessionManager.clearHandoverNotification() }\n                ) {\n                    Icon(\n                        Icons.Filled.Close,\n                        contentDescription = \"Dismiss\",\n                        tint = Color.White\n                    )\n                }\n            }\n        }\n    }\n    \n    // Undo Snackbar (shown when undoState is active)\n    if (undoState.isActive && undoState.fromScreen == \"TEST_SONGS\") {\n        Surface(\n            modifier = Modifier\n                .fillMaxWidth()\n                .padding(16.dp)\n                .align(Alignment.BottomCenter),\n            shape = RoundedCornerShape(12.dp),\n            color = Color(0xFF2B2B2B),\n            tonalElevation = 8.dp\n        ) {\n            Row(\n                modifier = Modifier\n                    .fillMaxWidth()\n                    .padding(16.dp),\n                horizontalArrangement = Arrangement.SpaceBetween,\n                verticalAlignment = Alignment.CenterVertically\n            ) {\n                Column(modifier = Modifier.weight(1f)) {\n                    Text(\n                        text = \"Test saved. Tap undo to reverse.\",\n                        style = MaterialTheme.typography.bodyMedium,\n                        color = Color.White\n                    )\n                    Text(\n                        text = \"Auto-saving in ${undoState.timeRemaining}s\",\n                        style = MaterialTheme.typography.bodySmall,\n                        color = Color.White.copy(alpha = 0.7f),\n                        fontSize = 12.sp\n                    )\n                }\n                Row(horizontalArrangement = Arrangement.spacedBy(8.dp), verticalAlignment = Alignment.CenterVertically) {\n                    TextButton(\n                        onClick = { \n                            android.util.Log.d(\"TestSongScreen\", \"Cancel (commit now) clicked.\")\n                            scope.launch { \n                                undoManager.executeCommitNow()\n                            }\n                        }\n                    ) {\n                        Text(\n                            text = \"CANCEL\",\n                            color = Color(0xFF90CAF9),\n                            fontWeight = FontWeight.Bold\n                        )\n                    }\n                    TextButton(\n                        onClick = { \n                            android.util.Log.d(\"TestSongScreen\", \"Undo button clicked.\")\n                            undoManager.executeUndo()\n                        }\n                    ) {\n                        Text(\n                            text = \"UNDO\",\n                            color = Color(0xFFFFC107),\n                            fontWeight = FontWeight.Bold\n                        )\n                    }\n                }\n            }\n        }\n    }\n    }  // Closing Box\n}\n",
        "firstEditBubbleId": "f8fd79be-4fa1-40db-8405-505bf320f5f8",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/SongTestDao.kt": {
        "content": "package com.example.fqcapp.data.dao\n\nimport androidx.room.*\nimport com.example.fqcapp.data.entities.SongTest\nimport kotlinx.coroutines.flow.Flow\n\n@Dao\ninterface SongTestDao {\n    @Insert\n    suspend fun insert(test: SongTest): Long\n\n    \n    @Query(\"SELECT * FROM song_tests WHERE serialNumber = :serialNumber ORDER BY timestamp ASC\")\n    suspend fun getSongTests(serialNumber: String): List<SongTest>\n\n    @Query(\"SELECT * FROM song_tests WHERE testId = :id\")\n    suspend fun getTestById(id: Long): SongTest?\n\n    @Query(\"SELECT * FROM song_tests WHERE serialNumber = :serialNumber AND needsSync = 1\")\n    suspend fun getUnsyncedSongTests(serialNumber: String): List<SongTest>\n\n    @Query(\"SELECT * FROM song_tests WHERE needsSync = 1\")\n    suspend fun getAllUnsyncedSongTests(): List<SongTest>\n\n    @Query(\"SELECT * FROM song_tests ORDER BY timestamp DESC\")\n    suspend fun getAllSongTests(): List<SongTest>\n\n    @Query(\"UPDATE song_tests SET needsSync = 0, lastSyncTimestamp = :timestamp WHERE testId = :testId\")\n    suspend fun markAsSynced(testId: Long, timestamp: Long = System.currentTimeMillis())\n\n    @Query(\"UPDATE song_tests SET needsSync = 0, lastSyncTimestamp = :timestamp WHERE testId IN (:testIds)\")\n    suspend fun markMultipleAsSynced(testIds: List<Long>, timestamp: Long = System.currentTimeMillis())\n    \n    @Query(\"UPDATE song_tests SET needsSync = :needsSync WHERE testId = :testId\")\n    suspend fun updateNeedsSync(testId: Long, needsSync: Boolean)\n\n    @Delete\n    suspend fun delete(test: SongTest)\n    \n    // Get max iteration number for a serial number\n    @Query(\"SELECT COALESCE(MAX(iterationNumber), 0) FROM song_tests WHERE serialNumber = :serialNumber AND isOverallResult = 1\")\n    suspend fun getMaxIterationNumber(serialNumber: String): Int\n    \n    // Get individual song tests (not overall) for a serial number and iteration, ordered by timestamp (latest first)\n    @Query(\"SELECT * FROM song_tests WHERE serialNumber = :serialNumber AND iterationNumber = :iterationNumber AND isOverallResult = 0 ORDER BY timestamp DESC\")\n    suspend fun getIndividualSongsForIteration(serialNumber: String, iterationNumber: Int): List<SongTest>\n    \n    // Delete individual song tests beyond the latest 3 for a given iteration\n    @Query(\"DELETE FROM song_tests WHERE serialNumber = :serialNumber AND iterationNumber = :iterationNumber AND isOverallResult = 0 AND testId NOT IN (SELECT testId FROM song_tests WHERE serialNumber = :serialNumber AND iterationNumber = :iterationNumber AND isOverallResult = 0 ORDER BY timestamp DESC LIMIT 3)\")\n    suspend fun deleteOldIndividualSongs(serialNumber: String, iterationNumber: Int)\n    \n    @Query(\"SELECT * FROM song_tests WHERE serialNumber = :serialNumber AND testStage = :stage AND isOverallResult = 1 ORDER BY iterationNumber DESC LIMIT 1\")\n    suspend fun getLatestSongTestByStage(serialNumber: String, stage: String): SongTest?\n    \n    @Query(\"SELECT * FROM song_tests WHERE serialNumber = :serialNumber AND isOverallResult = 1 ORDER BY iterationNumber DESC\")\n    suspend fun getAllSongTestsBySerial(serialNumber: String): List<SongTest>\n    \n    // Get latest song test by timestamp (excluding TEST_NOT_DONE)\n    @Query(\"SELECT * FROM song_tests WHERE serialNumber = :serialNumber AND isOverallResult = 1 AND result != 'TEST_NOT_DONE' ORDER BY timestamp DESC LIMIT 1\")\n    suspend fun getLatestSongTestByTimestamp(serialNumber: String): SongTest?\n    \n    // Get latest song test by configuration ID\n    @Query(\"SELECT * FROM song_tests WHERE configurationId = :configurationId AND isOverallResult = 1 ORDER BY entryTimestamp DESC LIMIT 1\")\n    suspend fun getLatestByConfiguration(configurationId: String): SongTest?\n}\n",
        "firstEditBubbleId": "31073f6e-da4c-487c-ba3e-7d192e4e5a03",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt": {
        "content": "package com.example.fqcapp\n\nimport android.util.Log\nimport androidx.compose.animation.AnimatedContent\nimport androidx.compose.foundation.layout.*\nimport androidx.compose.foundation.rememberScrollState\nimport androidx.compose.foundation.shape.RoundedCornerShape\nimport androidx.compose.foundation.verticalScroll\nimport androidx.compose.material.icons.Icons\nimport androidx.compose.material.icons.filled.ArrowBack\nimport androidx.compose.material3.*\nimport androidx.compose.runtime.*\nimport androidx.compose.runtime.rememberCoroutineScope\nimport androidx.compose.ui.Alignment\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.platform.LocalContext\nimport androidx.compose.ui.text.font.FontWeight\nimport androidx.compose.ui.unit.dp\nimport androidx.compose.ui.unit.sp\nimport com.example.fqcapp.core.CriteriaRepository\nimport com.example.fqcapp.core.DefaultCriteriaProvider\nimport kotlinx.coroutines.flow.first\nimport kotlinx.coroutines.launch\n\nenum class FQCStep {\n    CRITERIA_CHECK,\n    FINAL_QUALITY\n}\n\nenum class FinalQualityType {\n    CUSTOMER,\n    INTERNATIONAL,\n    REVIEWER,\n    MARKETING\n}\n\n@OptIn(ExperimentalMaterial3Api::class)\n@Composable\nfun FQCReviewScreen(\n    operatorName: String,\n    serialNumber: String,\n    authenticatedOperator: com.example.fqcapp.data.entities.OperatorCredential? = null,\n    solutionReminderManager: com.example.fqcapp.core.SolutionReminderManager? = null,\n    onBack: () -> Unit,\n    onSuccess: () -> Unit = onBack // Default to onBack if not provided\n) {\n    val accentColor = Color(0xFFFFC107)\n    val bgColor = Color(0xFF212121)\n    val surfaceColor = Color(0xFF2B2B2B)\n    val context = LocalContext.current\n    val scope = rememberCoroutineScope()\n    \n    // Load criteria\n    val criteria by CriteriaRepository.criteria.collectAsState(DefaultCriteriaProvider.default)\n    val fqcCriteria = remember(criteria) {\n        if (criteria.fqcCriteria.isNotEmpty()) {\n            criteria.fqcCriteria\n        } else {\n            DefaultCriteriaProvider.default.fqcCriteria\n        }\n    }\n    \n    Log.d(\"FQCReviewScreen\", \" FQC Criteria loaded: ${fqcCriteria.size} items - $fqcCriteria\")\n    \n    // Log initial parameters\n    Log.d(\"FQCReviewScreen\", \" [INIT] FQCReviewScreen initialized\")\n    Log.d(\"FQCReviewScreen\", \" [INIT] Serial Number (parameter): '$serialNumber'\")\n    Log.d(\"FQCReviewScreen\", \" [INIT] Operator Name (parameter): '$operatorName'\")\n    \n    // State\n    var currentStep by remember { mutableStateOf(FQCStep.CRITERIA_CHECK) }\n    val selectedCriteria = remember { mutableStateMapOf<String, Boolean>() }\n    var selectedFinalQuality by remember { mutableStateOf<FinalQualityType?>(null) }\n    // Editable operator name (defaults to login name or authenticated operator)\n    var editableOperatorName by remember { mutableStateOf(operatorName) }\n    var operatorId by remember { mutableStateOf(\"\") }\n    \n    // Use authenticated operator if provided\n    LaunchedEffect(authenticatedOperator) {\n        if (authenticatedOperator != null) {\n            editableOperatorName = authenticatedOperator.operatorName\n            operatorId = authenticatedOperator.operatorId\n            Log.d(\"FQCReviewScreen\", \" Using authenticated operator: $editableOperatorName (ID: $operatorId)\")\n        } else {\n            editableOperatorName = operatorName\n            Log.d(\"FQCReviewScreen\", \" No authenticated operator, using parameter: $editableOperatorName\")\n        }\n    }\n    \n    // Track entry time for FQC\n    var sessionStartTime by remember { mutableStateOf<Long?>(null) }\n    \n    // Database and workflow service\n    val database = remember { com.example.fqcapp.data.AppDatabase.getDatabase(context) }\n    val repo = remember { com.example.fqcapp.data.FQCRepository(database) }\n    val workflowService = remember { com.example.fqcapp.services.DeviceWorkflowService(repo) }\n    \n    // Capture entry time when screen opens\n    // Track if workflow has been logged (only log after user confirms in Device Config)\n    var workflowLogged by remember { mutableStateOf(false) }\n    \n    LaunchedEffect(Unit) {\n        sessionStartTime = System.currentTimeMillis()\n        Log.d(\"FQCReviewScreen\", \" Entry time captured: $sessionStartTime\")\n        // Note: Workflow logging is delayed until user actually starts FQC process\n        // This ensures iteration is not created until user confirms in Device Config\n        \n        // DEBUG: Log all information being displayed in FQC screen\n        scope.launch {\n            try {\n                Log.d(\"FQCReviewScreen\", \"\")\n                Log.d(\"FQCReviewScreen\", \" [FQC_SCREEN_DEBUG] Logging all displayed information\")\n                Log.d(\"FQCReviewScreen\", \"\")\n                Log.d(\"FQCReviewScreen\", \" [SCREEN_INFO] Serial Number: '$serialNumber'\")\n                Log.d(\"FQCReviewScreen\", \" [SCREEN_INFO] Operator Name: '$operatorName'\")\n                Log.d(\"FQCReviewScreen\", \" [SCREEN_INFO] Authenticated Operator: ${authenticatedOperator?.operatorName ?: \"N/A\"} (ID: ${authenticatedOperator?.operatorId ?: \"N/A\"})\")\n                Log.d(\"FQCReviewScreen\", \" [SCREEN_INFO] FQC Criteria Count: ${fqcCriteria.size}\")\n                Log.d(\"FQCReviewScreen\", \" [SCREEN_INFO] FQC Criteria: $fqcCriteria\")\n                \n                // Get driver pairing information\n                val driverPairingRecords = repo.getDriverPairingRecordsBySerial(serialNumber)\n                val latestDriverPairing = repo.getLatestDriverPairing(serialNumber)\n                Log.d(\"FQCReviewScreen\", \" [DRIVER_PAIRING] Total Records: ${driverPairingRecords.size}\")\n                if (latestDriverPairing != null) {\n                    Log.d(\"FQCReviewScreen\", \" [DRIVER_PAIRING] Latest Record:\")\n                    Log.d(\"FQCReviewScreen\", \"   - Record ID: ${latestDriverPairing.recordId}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Serial: ${latestDriverPairing.serialNumber}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Driver Data: ${latestDriverPairing.driverData}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Iteration: ${latestDriverPairing.iterationNumber}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Test Stage: ${latestDriverPairing.testStage}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Entry Timestamp: ${latestDriverPairing.entryTimestamp}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Operator: ${latestDriverPairing.operatorName}\")\n                } else {\n                    Log.w(\"FQCReviewScreen\", \" [DRIVER_PAIRING] No driver pairing records found for serial: '$serialNumber'\")\n                }\n                \n                // Get changed parts information\n                val changedPartsRecords = repo.getChangedPartsRecordsBySerial(serialNumber)\n                val latestChangedParts = changedPartsRecords.maxByOrNull { it.recordId }\n                Log.d(\"FQCReviewScreen\", \" [CHANGED_PARTS] Total Records: ${changedPartsRecords.size}\")\n                if (latestChangedParts != null) {\n                    Log.d(\"FQCReviewScreen\", \" [CHANGED_PARTS] Latest Record:\")\n                    Log.d(\"FQCReviewScreen\", \"   - Record ID: ${latestChangedParts.recordId}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Serial: ${latestChangedParts.serialNumber}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Selected Parts: ${latestChangedParts.selectedParts}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Iteration: ${latestChangedParts.iterationNumber}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Test Stage: ${latestChangedParts.testStage}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Entry Timestamp: ${latestChangedParts.entryTimestamp}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Operator: ${latestChangedParts.operatorName}\")\n                } else {\n                    Log.d(\"FQCReviewScreen\", \" [CHANGED_PARTS] No changed parts records found for serial: '$serialNumber'\")\n                }\n                \n                // Get test results\n                val freqTests = repo.getFrequencyTestsBySerial(serialNumber)\n                val songTests = repo.getSongTestsBySerial(serialNumber)\n                val latestFreqTest = freqTests.maxByOrNull { it.testId }\n                val latestSongTest = songTests.maxByOrNull { it.testId }\n                Log.d(\"FQCReviewScreen\", \" [TEST_RESULTS] Frequency Tests: ${freqTests.size}, Song Tests: ${songTests.size}\")\n                if (latestFreqTest != null) {\n                    Log.d(\"FQCReviewScreen\", \" [TEST_RESULTS] Latest Frequency Test:\")\n                    Log.d(\"FQCReviewScreen\", \"   - Result: ${latestFreqTest.result}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Test Stage: ${latestFreqTest.testStage}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Iteration: ${latestFreqTest.iterationNumber}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Timestamp: ${latestFreqTest.timestamp}\")\n                }\n                if (latestSongTest != null) {\n                    Log.d(\"FQCReviewScreen\", \" [TEST_RESULTS] Latest Song Test:\")\n                    Log.d(\"FQCReviewScreen\", \"   - Result: ${latestSongTest.result}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Test Stage: ${latestSongTest.testStage}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Iteration: ${latestSongTest.iterationNumber}\")\n                    Log.d(\"FQCReviewScreen\", \"   - Timestamp: ${latestSongTest.timestamp}\")\n                }\n                \n                Log.d(\"FQCReviewScreen\", \"\")\n            } catch (e: Exception) {\n                Log.e(\"FQCReviewScreen\", \" [FQC_SCREEN_DEBUG] Error logging debug information\", e)\n            }\n        }\n    }\n    \n    // Initialize selectedCriteria with all criteria set to false\n    LaunchedEffect(fqcCriteria) {\n        fqcCriteria.forEach { criterion ->\n            if (!selectedCriteria.containsKey(criterion)) {\n                selectedCriteria[criterion] = false\n            }\n        }\n    }\n    \n    // Track a version counter that updates when selections change\n    var validationKey by remember { mutableStateOf(0) }\n    \n    // Validation: all criteria must be checked\n    // We recalculate this whenever validationKey changes\n    val allCriteriaChecked = remember(validationKey, fqcCriteria.size) {\n        fqcCriteria.isNotEmpty() && fqcCriteria.all { selectedCriteria[it] == true }\n    }\n    \n    // Validation: final quality must be selected\n    val finalQualitySelected = selectedFinalQuality != null\n    \n    Scaffold(\n        topBar = {\n            TopAppBar(\n                title = { \n                    Text(\n                        \"Final Quality Check (FQC)\",\n                        color = accentColor,\n                        fontSize = 18.sp,\n                        fontWeight = FontWeight.Bold\n                    )\n                },\n                navigationIcon = {\n                    IconButton(onClick = onBack) {\n                        Icon(Icons.Filled.ArrowBack, \"Back\", tint = Color.White)\n                    }\n                },\n                colors = TopAppBarDefaults.topAppBarColors(\n                    containerColor = bgColor\n                )\n            )\n        }\n    ) { padding ->\n        AnimatedContent(\n            targetState = currentStep,\n            modifier = Modifier\n                .fillMaxSize()\n                .padding(padding)\n        ) { step ->\n            when (step) {\n                FQCStep.CRITERIA_CHECK -> {\n                        CriteriaCheckScreen(\n                        operatorName = editableOperatorName,\n                        onOperatorNameChanged = { editableOperatorName = it },\n                        serialNumber = serialNumber,\n                        fqcCriteria = fqcCriteria,\n                        selectedCriteria = selectedCriteria,\n                        allCriteriaChecked = allCriteriaChecked,\n                        onSelectionChanged = { \n                            validationKey++\n                            // Log workflow: FQC STARTED (only once, when first checkbox is checked)\n                            if (!workflowLogged && serialNumber.isNotBlank() && selectedCriteria.values.any { it }) {\n                                workflowLogged = true\n                                scope.launch {\n                                    try {\n                                        val iterationNumber = workflowService.getNextIterationNumber(\n                                            serialNumber,\n                                            com.example.fqcapp.services.DeviceWorkflowService.STAGE_FQC\n                                        )\n                                        workflowService.logWorkflow(\n                                            serialNumber = serialNumber,\n                                            stage = com.example.fqcapp.services.DeviceWorkflowService.STAGE_FQC,\n                                            operatorName = editableOperatorName,\n                                            action = com.example.fqcapp.services.DeviceWorkflowService.ACTION_STARTED,\n                                            iterationNumber = iterationNumber\n                                        )\n                                        Log.d(\"FQCReviewScreen\", \" [WORKFLOW] Logged FQC STARTED (after user confirmed in Device Config)\")\n                                    } catch (e: Exception) {\n                                        Log.e(\"FQCReviewScreen\", \" [WORKFLOW] Error logging workflow STARTED\", e)\n                                    }\n                                }\n                            }\n                        },\n                        onNext = { currentStep = FQCStep.FINAL_QUALITY },\n                        onBack = onBack,\n                        accentColor = accentColor,\n                        bgColor = bgColor,\n                        surfaceColor = surfaceColor\n                    )\n                }\n                FQCStep.FINAL_QUALITY -> {\n                    FinalQualityScreen(\n                        operatorName = editableOperatorName,\n                        onOperatorNameChanged = { editableOperatorName = it },\n                        serialNumber = serialNumber,\n                        selectedFinalQuality = selectedFinalQuality,\n                        onSelectionChanged = { selectedFinalQuality = it },\n                        finalQualitySelected = finalQualitySelected,\n                        onBack = { currentStep = FQCStep.CRITERIA_CHECK },\n                        onSave = {\n                            scope.launch {\n                                try {\n                                    // Use the repo already initialized above\n                                    // val db = com.example.fqcapp.data.AppDatabase.getDatabase(context)\n                                    // val repo = com.example.fqcapp.data.FQCRepository(database)\n                                    \n                                    // Calculate exit time and total time spent\n                                    val exitTime = System.currentTimeMillis()\n                                    val entryTimeMillis = sessionStartTime ?: exitTime\n                                    val totalTimeSpentMs = exitTime - entryTimeMillis\n                                    val totalTimeSpentSeconds = totalTimeSpentMs / 1000\n                                    val hours = totalTimeSpentSeconds / 3600\n                                    val minutes = (totalTimeSpentSeconds % 3600) / 60\n                                    val seconds = totalTimeSpentSeconds % 60\n                                    val totalTimeSpentFormatted = String.format(\"%02d:%02d:%02d\", hours, minutes, seconds)\n                                    \n                                    val dateFormat = java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.getDefault())\n                                    val entryTimestamp = dateFormat.format(java.util.Date(entryTimeMillis))\n                                    val exitTimestamp = dateFormat.format(java.util.Date(exitTime))\n                                    \n                                    // Get all checked criteria as JSON array\n                                    val checkedCriteria = selectedCriteria.keys.filter { selectedCriteria[it] == true }\n                                    val criteriaJson = if (checkedCriteria.isEmpty()) {\n                                        \"[]\"\n                                    } else {\n                                        checkedCriteria.joinToString(\", \", prefix = \"[\", postfix = \"]\") { \"\\\"$it\\\"\" }\n                                    }\n                                    \n                                    // Get final quality type as string - ensure it's not empty\n                                    val currentFinalQuality = selectedFinalQuality // Store in local variable for smart cast\n                                    val finalQualityTypeStr = if (currentFinalQuality != null) {\n                                        currentFinalQuality.name\n                                    } else {\n                                        Log.w(\"FQCReviewScreen\", \" WARNING: selectedFinalQuality is null! This should not happen if validation passed.\")\n                                        \"\"\n                                    }\n                                    \n                                    // Verify serial number is not empty\n                                    val finalSerialNumber = if (serialNumber.isBlank()) {\n                                        Log.e(\"FQCReviewScreen\", \" ERROR: Serial number is blank! Cannot save FQC record.\")\n                                        return@launch\n                                    } else {\n                                        serialNumber\n                                    }\n                                    \n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_START] Preparing to save FQC record:\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_START] Serial Number: '$finalSerialNumber'\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_START] Operator: '$editableOperatorName'\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_START] Selected Final Quality (enum): $selectedFinalQuality\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_START] Final Quality Type (string): '$finalQualityTypeStr'\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_START] Criteria Count: ${checkedCriteria.size}\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_START] Entry Time: $entryTimestamp\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_START] Exit Time: $exitTimestamp\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_START] Total Time: $totalTimeSpentFormatted\")\n                                    \n                                    // Get next iteration number\n                                    val existingRecords = repo.getAllFQCRecords()\n                                    val maxIteration = existingRecords.filter { it.serialNumber == finalSerialNumber }\n                                        .maxOfOrNull { it.iterationNumber } ?: 0\n                                    val nextIteration = maxIteration + 1\n                                    \n                                    // Determine FQC type based on iteration number\n                                    // INITIAL for first iteration (1), REWORK for subsequent iterations\n                                    val fqcType = if (nextIteration == 1) \"INITIAL\" else \"REWORK\"\n                                    \n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_START] Iteration Number: $nextIteration\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_START] FQC Type: $fqcType\")\n                                    \n                                    // Create FQCRecord\n                                    val fqcRecord = com.example.fqcapp.data.entities.FQCRecord(\n                                        serialNumber = finalSerialNumber,\n                                        operatorName = editableOperatorName,\n                                        timestamp = java.time.Instant.now().toString(), // ISO format for backward compatibility\n                                        fqcType = fqcType,\n                                        plasticCosmetics = \"\", // Not used in new flow\n                                        modeSelector = \"\",\n                                        button = \"\",\n                                        slider = \"\",\n                                        headbandScratch = \"\",\n                                        headbandShape = \"\",\n                                        screwBush = \"\",\n                                        ledCheck = \"\",\n                                        acBalance = \"\",\n                                        bcBalance = \"\",\n                                        serialVerification = \"\",\n                                        imageCount = 0,\n                                        imagesBase64 = \"\",\n                                        imageDescriptions = \"\",\n                                        overallResult = \"PASS\", // All criteria checked = PASS\n                                        majorIssues = \"\",\n                                        remark = \"\",\n                                        latestFreqResult = \"\",\n                                        latestSongResult = \"\",\n                                        fqcDurationSec = totalTimeSpentSeconds.toInt(),\n                                        iterationNumber = nextIteration,\n                                        testStage = \"Final Test\", // FQC always uses Final Test stage\n                                        entryTimestamp = entryTimestamp,\n                                        exitTimestamp = exitTimestamp,\n                                        totalTimeSpent = totalTimeSpentFormatted,\n                                        criteriaChecked = criteriaJson,\n                                        finalQualityType = finalQualityTypeStr,\n                                        needsSync = true,\n                                        lastSyncTimestamp = 0\n                                    )\n                                    \n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_CREATE] Created FQCRecord object:\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_CREATE]   serialNumber: '${fqcRecord.serialNumber}'\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_CREATE]   operatorName: '${fqcRecord.operatorName}'\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_CREATE]   finalQualityType: '${fqcRecord.finalQualityType}'\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_CREATE]   criteriaChecked: '${fqcRecord.criteriaChecked}'\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_CREATE]   entryTimestamp: '${fqcRecord.entryTimestamp}'\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_CREATE]   exitTimestamp: '${fqcRecord.exitTimestamp}'\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_CREATE]   totalTimeSpent: '${fqcRecord.totalTimeSpent}'\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_CREATE]   iterationNumber: ${fqcRecord.iterationNumber}\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_CREATE]   fqcType: '${fqcRecord.fqcType}'\")\n                                    \n                                    // Save to database\n                                    val operatorId = authenticatedOperator?.operatorId\n                                    val recordId = repo.insertFQCRecord(fqcRecord, operatorId = operatorId)\n                                    \n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_SUCCESS] FQC record saved successfully!\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_SUCCESS] Record ID: $recordId\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_SUCCESS] Serial Number: '$finalSerialNumber'\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_SUCCESS] Operator: '$editableOperatorName'\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_SUCCESS] Final Headphone Quality: '$finalQualityTypeStr'\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_SUCCESS] Criteria Checked (${checkedCriteria.size}): $checkedCriteria\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_SUCCESS] Entry: $entryTimestamp, Exit: $exitTimestamp, Time: $totalTimeSpentFormatted\")\n                                    Log.d(\"FQCReviewScreen\", \" [SAVE_SUCCESS] Iteration: $nextIteration, Type: $fqcType\")\n                                    \n                                    // Verify the saved record by reading it back\n                                    try {\n                                        val savedRecords = repo.getAllFQCRecords()\n                                        val savedRecord = savedRecords.find { it.fqcId == recordId }\n                                        if (savedRecord != null) {\n                                            Log.d(\"FQCReviewScreen\", \" [VERIFY] Verified saved record:\")\n                                            Log.d(\"FQCReviewScreen\", \" [VERIFY]   Serial: '${savedRecord.serialNumber}'\")\n                                            Log.d(\"FQCReviewScreen\", \" [VERIFY]   Operator: '${savedRecord.operatorName}'\")\n                                            Log.d(\"FQCReviewScreen\", \" [VERIFY]   Final Quality: '${savedRecord.finalQualityType}'\")\n                                            Log.d(\"FQCReviewScreen\", \" [VERIFY]   Criteria: '${savedRecord.criteriaChecked}'\")\n                                            Log.d(\"FQCReviewScreen\", \" [VERIFY]   Entry: '${savedRecord.entryTimestamp}'\")\n                                            Log.d(\"FQCReviewScreen\", \" [VERIFY]   Exit: '${savedRecord.exitTimestamp}'\")\n                                            Log.d(\"FQCReviewScreen\", \" [VERIFY]   Time: '${savedRecord.totalTimeSpent}'\")\n                                            \n                                            if (savedRecord.finalQualityType.isBlank()) {\n                                                Log.e(\"FQCReviewScreen\", \" [VERIFY] ERROR: Final Quality Type is empty in saved record!\")\n                                            } else {\n                                                Log.d(\"FQCReviewScreen\", \" [VERIFY] Final Quality Type is correctly saved: '${savedRecord.finalQualityType}'\")\n                                            }\n                                            \n                                            if (savedRecord.serialNumber.isBlank()) {\n                                                Log.e(\"FQCReviewScreen\", \" [VERIFY] ERROR: Serial Number is empty in saved record!\")\n                                            } else {\n                                                Log.d(\"FQCReviewScreen\", \" [VERIFY] Serial Number is correctly saved: '${savedRecord.serialNumber}'\")\n                                            }\n                                        } else {\n                                            Log.e(\"FQCReviewScreen\", \" [VERIFY] ERROR: Could not find saved record with ID: $recordId\")\n                                        }\n                                    } catch (e: Exception) {\n                                        Log.e(\"FQCReviewScreen\", \" [VERIFY] Error verifying saved record\", e)\n                                    }\n                                    \n                                    // Log workflow: FQC COMPLETED\n                                    try {\n                                        // Map final quality type to workflow result\n                                        val workflowResult = when (selectedFinalQuality) {\n                                            com.example.fqcapp.FinalQualityType.REVIEWER -> com.example.fqcapp.services.DeviceWorkflowService.RESULT_PASS\n                                            com.example.fqcapp.FinalQualityType.CUSTOMER -> com.example.fqcapp.services.DeviceWorkflowService.RESULT_CAN_PASS\n                                            com.example.fqcapp.FinalQualityType.INTERNATIONAL -> com.example.fqcapp.services.DeviceWorkflowService.RESULT_PASS\n                                            com.example.fqcapp.FinalQualityType.MARKETING -> com.example.fqcapp.services.DeviceWorkflowService.RESULT_PASS\n                                            null -> null\n                                        }\n                                        \n                                        workflowService.logWorkflow(\n                                            serialNumber = finalSerialNumber,\n                                            stage = com.example.fqcapp.services.DeviceWorkflowService.STAGE_FQC,\n                                            operatorName = editableOperatorName,\n                                            action = com.example.fqcapp.services.DeviceWorkflowService.ACTION_COMPLETED,\n                                            result = workflowResult,\n                                            iterationNumber = nextIteration,\n                                            recordId = recordId\n                                        )\n                                        Log.d(\"FQCReviewScreen\", \" [WORKFLOW] Logged FQC COMPLETED\")\n                                        \n                                        // Clear all solution reminders when FQC workflow completes\n                                        if (solutionReminderManager != null) {\n                                            solutionReminderManager.clearAllSolutions(finalSerialNumber)\n                                            Log.d(\"FQCReviewScreen\", \" [SOLUTION_REMINDER] Cleared all solution reminders for serial: $finalSerialNumber\")\n                                        }\n                                    } catch (e: Exception) {\n                                        Log.e(\"FQCReviewScreen\", \" [WORKFLOW] Error logging workflow COMPLETED\", e)\n                                    }\n                                    \n                                    // Update milestone for final QC\n                                    val milestoneService = com.example.fqcapp.services.MilestoneUpdateService(repo)\n                                    milestoneService.updateFinalQcStatus(serialNumber, selectedFinalQuality)\n                                    Log.d(\"FQCReviewScreen\", \" [MILESTONE] Final QC milestone updated with quality type: $selectedFinalQuality\")\n                                    \n                                    // Save to Supabase\n                                    try {\n                                        // Get MAC ID if available\n                                        var macId = \"\"\n                                        try {\n                                            val googleSheetsService = com.example.fqcapp.services.GoogleSheetsService(\n                                                context,\n                                                repo.getMacIdCacheDao()\n                                            )\n                                            val currentMacId = googleSheetsService.getMacIdBySerialNumber(finalSerialNumber)\n                                            if (currentMacId != null) {\n                                                macId = currentMacId\n                                            }\n                                        } catch (e: Exception) {\n                                            Log.w(\"FQCReviewScreen\", \" Could not get MAC ID for Supabase save\", e)\n                                        }\n                                        \n                                        val supabaseService = com.example.fqcapp.supabase.SupabaseFQCService()\n                                        val operatorId = authenticatedOperator?.operatorId ?: \"\"\n                                        val supabaseFqcId = supabaseService.saveFQCRecord(\n                                            record = fqcRecord,\n                                            operatorId = operatorId,\n                                            macId = macId\n                                        )\n                                        if (supabaseFqcId != null) {\n                                            Log.d(\"FQCReviewScreen\", \" [SUPABASE] FQC record saved to Supabase with ID: $supabaseFqcId\")\n                                            // Mark as synced in Room DB\n                                            repo.markFQCRecordAsSynced(recordId, System.currentTimeMillis())\n                                        } else {\n                                            Log.w(\"FQCReviewScreen\", \" [SUPABASE] Failed to save to Supabase (will retry later)\")\n                                        }\n                                    } catch (e: Exception) {\n                                        Log.e(\"FQCReviewScreen\", \" [SUPABASE] Error saving to Supabase\", e)\n                                        // Don't fail the whole operation if Supabase save fails\n                                    }\n                                    \n                                    // Navigate to landing page after successful save\n                                    onSuccess()\n                                    \n                                    } catch (e: Exception) {\n                                        Log.e(\"FQCReviewScreen\", \" Error saving FQC record\", e)\n                                        // On error, just go back (don't navigate to landing)\n                                        onBack()\n                                    }\n                            }\n                        },\n                        accentColor = accentColor,\n                        bgColor = bgColor,\n                        surfaceColor = surfaceColor\n                    )\n                }\n            }\n        }\n    }\n}\n\n@Composable\nfun CriteriaCheckScreen(\n    operatorName: String,\n    onOperatorNameChanged: (String) -> Unit,\n    serialNumber: String,\n    fqcCriteria: List<String>,\n    selectedCriteria: MutableMap<String, Boolean>,\n    allCriteriaChecked: Boolean,\n    onSelectionChanged: () -> Unit,\n    onNext: () -> Unit,\n    onBack: () -> Unit,\n    accentColor: Color,\n    bgColor: Color,\n    surfaceColor: Color\n) {\n    Column(\n        modifier = Modifier\n            .fillMaxSize()\n            .verticalScroll(rememberScrollState())\n            .padding(16.dp),\n        verticalArrangement = Arrangement.spacedBy(12.dp)\n    ) {\n        // Operator name (editable)\n        Row(\n            modifier = Modifier.fillMaxWidth(),\n            horizontalArrangement = Arrangement.spacedBy(12.dp),\n            verticalAlignment = Alignment.CenterVertically\n        ) {\n            Text(\n                \"Operator:\",\n                color = Color.White.copy(alpha = 0.7f),\n                fontSize = 14.sp,\n                fontWeight = FontWeight.Medium,\n                modifier = Modifier.width(110.dp)\n            )\n            TextField(\n                value = operatorName,\n                onValueChange = onOperatorNameChanged,\n                modifier = Modifier.weight(1f),\n                colors = TextFieldDefaults.colors(\n                    focusedTextColor = Color.White,\n                    unfocusedTextColor = Color.White,\n                    focusedContainerColor = surfaceColor,\n                    unfocusedContainerColor = surfaceColor,\n                    focusedIndicatorColor = accentColor,\n                    unfocusedIndicatorColor = Color(0xFF424242)\n                ),\n                textStyle = androidx.compose.ui.text.TextStyle(\n                fontSize = 14.sp,\n                    fontWeight = FontWeight.Normal\n                ),\n                singleLine = true\n            )\n        }\n\n        // Serial number (single line, read-only)\n        Row(\n            modifier = Modifier.fillMaxWidth(),\n            horizontalArrangement = Arrangement.spacedBy(12.dp),\n            verticalAlignment = Alignment.CenterVertically\n        ) {\n            Text(\n                \"Serial number:\",\n                color = Color.White.copy(alpha = 0.7f),\n                fontSize = 14.sp,\n                fontWeight = FontWeight.Medium,\n                modifier = Modifier.widthIn(min = 110.dp)\n            )\n            Text(\n                serialNumber,\n                color = Color.White,\n                fontSize = 14.sp,\n                fontWeight = FontWeight.Normal,\n                modifier = Modifier.weight(1f)\n            )\n        }\n\n        Spacer(modifier = Modifier.height(2.dp)) // Reduced by 70%: 8.dp * 0.3 = 2.4.dp, rounded to 2.dp\n\n        // Criteria Checklist\n        Card(\n            modifier = Modifier.fillMaxWidth(),\n            colors = CardDefaults.cardColors(\n                containerColor = surfaceColor\n            ),\n            shape = RoundedCornerShape(12.dp)\n        ) {\n            Column(modifier = Modifier.padding(4.dp)) { // Reduced by 70%: 12.dp * 0.3 = 3.6.dp, rounded to 4.dp\n                Text(\n                    \"FQC Criteria Checklist\",\n                    color = accentColor,\n                    fontSize = 15.sp,\n                    fontWeight = FontWeight.Bold,\n                    modifier = Modifier.padding(bottom = 2.dp) // Reduced by 70%: 8.dp * 0.3 = 2.4.dp, rounded to 2.dp\n                )\n                \n                Divider(\n                    color = Color(0xFF424242),\n                    modifier = Modifier.padding(vertical = 2.dp) // Reduced by 70%: 8.dp * 0.3 = 2.4.dp, rounded to 2.dp\n                )\n\n                // Dynamic criteria checkboxes\n                if (fqcCriteria.isEmpty()) {\n                    Text(\n                        \" No criteria loaded. Please sync config from Google Sheets.\",\n                        color = Color.White.copy(alpha = 0.7f),\n                        fontSize = 13.sp,\n                        modifier = Modifier.padding(vertical = 5.dp) // Reduced by 70%: 16.dp * 0.3 = 4.8.dp, rounded to 5.dp\n                    )\n                } else {\n                    fqcCriteria.forEach { criterion ->\n                        Row(\n                            modifier = Modifier\n                                .fillMaxWidth()\n                                .padding(vertical = 1.dp), // Reduced by 50%: 2.dp * 0.5 = 1.dp\n                            verticalAlignment = Alignment.CenterVertically,\n                            horizontalArrangement = Arrangement.spacedBy(2.dp) // Reduced by 50%: 4.dp * 0.5 = 2.dp\n                        ) {\n                            Checkbox(\n                                checked = selectedCriteria[criterion] == true,\n                                onCheckedChange = { isChecked ->\n                                    selectedCriteria[criterion] = isChecked\n                                    onSelectionChanged() // Notify parent to update validation\n                                },\n                                colors = CheckboxDefaults.colors(\n                                    checkedColor = accentColor,\n                                    uncheckedColor = Color(0xFF424242)\n                                )\n                            )\n                            Text(\n                                criterion,\n                                color = Color.White,\n                                fontSize = 14.sp,\n                                modifier = Modifier.weight(1f)\n                            )\n                        }\n                    }\n                    \n                    Spacer(modifier = Modifier.height(2.dp)) // Reduced by 70%: 8.dp * 0.3 = 2.4.dp, rounded to 2.dp\n                    \n                    // Progress indicator\n                    Text(\n                        \"Progress: ${selectedCriteria.values.count { it }}/${fqcCriteria.size}\",\n                        color = if (allCriteriaChecked) accentColor else Color.White.copy(alpha = 0.7f),\n                        fontSize = 13.sp,\n                        fontWeight = if (allCriteriaChecked) FontWeight.Bold else FontWeight.Normal\n                    )\n                }\n            }\n        }\n\n        Spacer(modifier = Modifier.weight(1f))\n\n        // Action Buttons\n        Row(\n            modifier = Modifier.fillMaxWidth(),\n            horizontalArrangement = Arrangement.spacedBy(12.dp)\n        ) {\n            OutlinedButton(\n                onClick = onBack,\n                modifier = Modifier\n                    .weight(1f)\n                    .height(50.dp),\n                colors = ButtonDefaults.outlinedButtonColors(\n                    contentColor = Color.White\n                ),\n                shape = RoundedCornerShape(12.dp)\n            ) {\n                Text(\"Cancel\", fontSize = 15.sp, fontWeight = FontWeight.Bold)\n            }\n\n            Button(\n                onClick = onNext,\n                enabled = allCriteriaChecked,\n                modifier = Modifier\n                    .weight(1f)\n                    .height(50.dp),\n                colors = ButtonDefaults.buttonColors(\n                    containerColor = if (allCriteriaChecked) accentColor else Color(0xFF424242),\n                    contentColor = if (allCriteriaChecked) bgColor else Color.White.copy(alpha = 0.5f),\n                    disabledContainerColor = Color(0xFF424242),\n                    disabledContentColor = Color.White.copy(alpha = 0.5f)\n                ),\n                shape = RoundedCornerShape(12.dp)\n            ) {\n                Text(\"Next\", fontSize = 15.sp, fontWeight = FontWeight.Bold)\n            }\n        }\n    }\n}\n\n@Composable\nfun FinalQualityScreen(\n    operatorName: String,\n    onOperatorNameChanged: (String) -> Unit,\n    serialNumber: String,\n    selectedFinalQuality: FinalQualityType?,\n    onSelectionChanged: (FinalQualityType) -> Unit,\n    finalQualitySelected: Boolean,\n    onBack: () -> Unit,\n    onSave: () -> Unit,\n    accentColor: Color,\n    bgColor: Color,\n    surfaceColor: Color\n) {\n    Column(\n        modifier = Modifier\n            .fillMaxSize()\n            .verticalScroll(rememberScrollState())\n            .padding(16.dp),\n        verticalArrangement = Arrangement.spacedBy(12.dp)\n    ) {\n        // Operator name (editable)\n        Row(\n            modifier = Modifier.fillMaxWidth(),\n            horizontalArrangement = Arrangement.spacedBy(12.dp),\n            verticalAlignment = Alignment.CenterVertically\n        ) {\n            Text(\n                \"Operator:\",\n                color = Color.White.copy(alpha = 0.7f),\n                fontSize = 14.sp,\n                fontWeight = FontWeight.Medium,\n                modifier = Modifier.width(110.dp)\n            )\n            TextField(\n                value = operatorName,\n                onValueChange = onOperatorNameChanged,\n                modifier = Modifier.weight(1f),\n                colors = TextFieldDefaults.colors(\n                    focusedTextColor = Color.White,\n                    unfocusedTextColor = Color.White,\n                    focusedContainerColor = surfaceColor,\n                    unfocusedContainerColor = surfaceColor,\n                    focusedIndicatorColor = accentColor,\n                    unfocusedIndicatorColor = Color(0xFF424242)\n                ),\n                textStyle = androidx.compose.ui.text.TextStyle(\n                fontSize = 14.sp,\n                    fontWeight = FontWeight.Normal\n                ),\n                singleLine = true\n            )\n        }\n\n        // Serial number (single line, read-only)\n        Row(\n            modifier = Modifier.fillMaxWidth(),\n            horizontalArrangement = Arrangement.spacedBy(12.dp),\n            verticalAlignment = Alignment.CenterVertically\n        ) {\n            Text(\n                \"Serial number:\",\n                color = Color.White.copy(alpha = 0.7f),\n                fontSize = 14.sp,\n                fontWeight = FontWeight.Medium,\n                modifier = Modifier.widthIn(min = 110.dp)\n            )\n            Text(\n                serialNumber,\n                color = Color.White,\n                fontSize = 14.sp,\n                fontWeight = FontWeight.Normal,\n                modifier = Modifier.weight(1f)\n            )\n        }\n\n        Spacer(modifier = Modifier.height(8.dp))\n\n        // Final Quality Selection\n        Card(\n            modifier = Modifier.fillMaxWidth(),\n            colors = CardDefaults.cardColors(\n                containerColor = surfaceColor\n            ),\n            shape = RoundedCornerShape(12.dp)\n        ) {\n            Column(modifier = Modifier.padding(4.dp)) { // Reduced by 70%: 12.dp * 0.3 = 3.6.dp, rounded to 4.dp\n                Text(\n                    \"Final Headphone Quality\",\n                    color = accentColor,\n                    fontSize = 15.sp,\n                    fontWeight = FontWeight.Bold,\n                    modifier = Modifier.padding(bottom = 2.dp) // Reduced by 70%: 8.dp * 0.3 = 2.4.dp, rounded to 2.dp\n                )\n                \n                Divider(\n                    color = Color(0xFF424242),\n                    modifier = Modifier.padding(vertical = 2.dp) // Reduced by 70%: 8.dp * 0.3 = 2.4.dp, rounded to 2.dp\n                )\n\n                // Quality options (Radio buttons - only one can be selected)\n                FinalQualityType.values().forEach { quality ->\n                    Row(\n                        modifier = Modifier\n                            .fillMaxWidth()\n                            .padding(vertical = 2.dp), // Reduced by 70%: 8.dp * 0.3 = 2.4.dp, rounded to 2.dp\n                        verticalAlignment = Alignment.CenterVertically,\n                        horizontalArrangement = Arrangement.spacedBy(4.dp) // Reduced by 70%: 12.dp * 0.3 = 3.6.dp, rounded to 4.dp\n                    ) {\n                        RadioButton(\n                            selected = selectedFinalQuality == quality,\n                            onClick = { onSelectionChanged(quality) },\n                            colors = RadioButtonDefaults.colors(\n                                selectedColor = accentColor,\n                                unselectedColor = Color(0xFF424242)\n                            )\n                        )\n                        Text(\n                            quality.name.replace(\"_\", \" \").lowercase().replaceFirstChar { it.uppercase() },\n                            color = Color.White,\n                            fontSize = 14.sp,\n                            modifier = Modifier.weight(1f)\n                        )\n                    }\n                }\n            }\n        }\n\n        Spacer(modifier = Modifier.weight(1f))\n\n        // Action Buttons\n        Row(\n            modifier = Modifier.fillMaxWidth(),\n            horizontalArrangement = Arrangement.spacedBy(12.dp)\n        ) {\n            OutlinedButton(\n                onClick = onBack,\n                modifier = Modifier\n                    .weight(1f)\n                    .height(50.dp),\n                colors = ButtonDefaults.outlinedButtonColors(\n                    contentColor = Color.White\n                ),\n                shape = RoundedCornerShape(12.dp)\n            ) {\n                Text(\"Back\", fontSize = 15.sp, fontWeight = FontWeight.Bold)\n            }\n\n            Button(\n                onClick = onSave,\n                enabled = finalQualitySelected,\n                modifier = Modifier\n                    .weight(1f)\n                    .height(50.dp),\n                colors = ButtonDefaults.buttonColors(\n                    containerColor = if (finalQualitySelected) accentColor else Color(0xFF424242),\n                    contentColor = if (finalQualitySelected) bgColor else Color.White.copy(alpha = 0.5f),\n                    disabledContainerColor = Color(0xFF424242),\n                    disabledContentColor = Color.White.copy(alpha = 0.5f)\n                ),\n                shape = RoundedCornerShape(12.dp)\n            ) {\n                Text(\"Complete\", fontSize = 15.sp, fontWeight = FontWeight.Bold)\n            }\n        }\n    }\n}\n",
        "firstEditBubbleId": "a607948c-0cda-4128-b4bc-e1f8230c336a",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/FQCRecordDao.kt": {
        "content": "package com.example.fqcapp.data.dao\n\nimport androidx.room.*\nimport com.example.fqcapp.data.entities.FQCRecord\nimport kotlinx.coroutines.flow.Flow\n\n@Dao\ninterface FQCRecordDao {\n    \n    @Query(\"SELECT * FROM fqc_records WHERE serialNumber = :serialNumber ORDER BY timestamp ASC\")\n    suspend fun getFQCRecords(serialNumber: String): List<FQCRecord>\n    \n    @Query(\"SELECT * FROM fqc_records WHERE serialNumber = :serialNumber ORDER BY timestamp ASC\")\n    fun getFQCRecordsFlow(serialNumber: String): Flow<List<FQCRecord>>\n    \n    @Query(\"SELECT * FROM fqc_records WHERE serialNumber = :serialNumber AND overallResult = 'PASS' ORDER BY timestamp DESC LIMIT 1\")\n    suspend fun getLastPassedFQC(serialNumber: String): FQCRecord?\n    \n    @Insert\n    suspend fun insertFQCRecord(fqcRecord: FQCRecord): Long\n    \n    @Update\n    suspend fun updateFQCRecord(fqcRecord: FQCRecord)\n    \n    @Query(\"SELECT * FROM fqc_records WHERE serialNumber = :serialNumber AND needsSync = 1\")\n    suspend fun getUnsyncedFQCRecords(serialNumber: String): List<FQCRecord>\n\n    @Query(\"SELECT * FROM fqc_records WHERE needsSync = 1\")\n    suspend fun getAllUnsyncedFQCRecords(): List<FQCRecord>\n\n    @Query(\"SELECT * FROM fqc_records ORDER BY timestamp DESC\")\n    suspend fun getAllFQCRecords(): List<FQCRecord>\n\n    @Query(\"UPDATE fqc_records SET needsSync = 0, lastSyncTimestamp = :timestamp WHERE fqcId = :fqcId\")\n    suspend fun markAsSynced(fqcId: Long, timestamp: Long = System.currentTimeMillis())\n\n    @Query(\"UPDATE fqc_records SET needsSync = 0, lastSyncTimestamp = :timestamp WHERE fqcId IN (:fqcIds)\")\n    suspend fun markMultipleAsSynced(fqcIds: List<Long>, timestamp: Long = System.currentTimeMillis())\n    \n    @Delete\n    suspend fun deleteFQCRecord(fqcRecord: FQCRecord)\n    \n    @Query(\"SELECT * FROM fqc_records WHERE serialNumber = :serialNumber AND testStage = :stage ORDER BY iterationNumber DESC LIMIT 1\")\n    suspend fun getLatestFQCByStage(serialNumber: String, stage: String): FQCRecord?\n    \n    @Query(\"SELECT * FROM fqc_records WHERE serialNumber = :serialNumber ORDER BY iterationNumber DESC\")\n    suspend fun getAllFQCRecordsBySerial(serialNumber: String): List<FQCRecord>\n    \n    // Get latest FQC record by timestamp\n    @Query(\"SELECT * FROM fqc_records WHERE serialNumber = :serialNumber ORDER BY timestamp DESC LIMIT 1\")\n    suspend fun getLatestFQCByTimestamp(serialNumber: String): FQCRecord?\n    \n    // Get latest FQC record by configuration ID\n    @Query(\"SELECT * FROM fqc_records WHERE configurationId = :configurationId ORDER BY entryTimestamp DESC LIMIT 1\")\n    suspend fun getLatestByConfiguration(configurationId: String): FQCRecord?\n}\n",
        "firstEditBubbleId": "15a95336-6704-4093-a671-3d3be5c30eec",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt": {
        "content": "package com.example.fqcapp\n\nimport androidx.activity.ComponentActivity\nimport androidx.compose.foundation.layout.Column\nimport androidx.compose.foundation.layout.Spacer\nimport androidx.compose.foundation.layout.fillMaxSize\nimport androidx.compose.foundation.layout.fillMaxWidth\nimport androidx.compose.foundation.layout.height\nimport androidx.compose.material3.DrawerValue\nimport androidx.compose.material3.ModalNavigationDrawer\nimport androidx.compose.material3.Scaffold\nimport androidx.compose.material3.rememberDrawerState\nimport androidx.compose.runtime.*\nimport androidx.compose.runtime.mutableStateOf\nimport androidx.compose.runtime.getValue\nimport androidx.compose.runtime.setValue\nimport androidx.compose.runtime.derivedStateOf\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.platform.LocalContext\nimport androidx.compose.ui.unit.dp\nimport androidx.navigation.NavHostController\nimport androidx.navigation.compose.NavHost\nimport androidx.navigation.compose.composable\nimport androidx.navigation.compose.rememberNavController\nimport androidx.navigation.compose.currentBackStackEntryAsState\nimport com.example.fqcapp.data.AppDatabase\nimport com.example.fqcapp.data.FQCRepository\nimport com.example.fqcapp.data.entities.FQCSession\nimport com.example.fqcapp.data.entities.Device\nimport com.example.fqcapp.data.entities.Operator\nimport com.example.fqcapp.scanner.ScannerScreen\nimport com.example.fqcapp.services.BluetoothService\nimport com.example.fqcapp.services.ConnectionManager\nimport com.example.fqcapp.services.ConnectionManager.ConnectionStep\nimport com.example.fqcapp.services.GoogleSheetsService\nimport com.example.fqcapp.services.MacIdCacheManager\nimport com.example.fqcapp.services.GoogleSheetsAPI\nimport com.example.fqcapp.services.DriverPairingSheetsService\nimport com.example.fqcapp.services.DriverPairingCacheManager\nimport com.example.fqcapp.utils.SerialGenerator\n// import com.example.fqcapp.services.GoogleSheetsUploadAPI\n// import com.example.fqcapp.services.DataSyncService\nimport com.example.fqcapp.ui.TestSongScreen\nimport com.example.fqcapp.ui.components.AppDrawer\nimport com.example.fqcapp.ui.components.ConnectionErrorDialog\nimport com.example.fqcapp.ui.components.ConnectionProgressDialog\nimport com.example.fqcapp.ui.components.DeviceSelectionDialog\nimport com.example.fqcapp.ui.components.FQCTopBar\nimport com.example.fqcapp.ui.components.PermissionRequestDialog\nimport com.example.fqcapp.ui.components.SerialPrefixSetupDialog\nimport com.example.fqcapp.ui.components.LongPressSpeedDialog\nimport com.example.fqcapp.ui.components.TestEligibilityDialog\nimport com.example.fqcapp.ui.components.SkeletonLoadingScreen\nimport com.example.fqcapp.services.DeviceEligibilityService\nimport com.example.fqcapp.utils.PermissionHandler\nimport com.example.fqcapp.utils.PreferencesManager\nimport com.example.fqcapp.core.UndoManager\nimport com.example.fqcapp.core.SolutionReminderManager\nimport kotlinx.coroutines.launch\nimport android.util.Log\nimport androidx.compose.foundation.rememberScrollState\nimport androidx.compose.foundation.verticalScroll\nimport androidx.compose.material3.Text\nimport androidx.compose.material3.MaterialTheme\nimport androidx.compose.runtime.rememberCoroutineScope\nimport androidx.compose.ui.text.font.FontFamily\nimport androidx.compose.ui.text.style.TextAlign\nimport androidx.compose.foundation.layout.padding\nimport kotlinx.coroutines.Dispatchers\nimport kotlinx.coroutines.withContext\nimport kotlinx.coroutines.flow.first\nimport androidx.compose.material.icons.filled.ExpandLess\nimport androidx.compose.material.icons.filled.ExpandMore\nimport androidx.compose.material.icons.filled.ArrowBack\nimport androidx.compose.material.icons.Icons\nimport androidx.compose.foundation.clickable\nimport androidx.compose.foundation.shape.RoundedCornerShape\nimport androidx.compose.material3.CircularProgressIndicator\nimport androidx.compose.material3.TopAppBar\nimport androidx.compose.material3.TopAppBarDefaults\nimport androidx.compose.material3.Icon\nimport androidx.compose.material3.IconButton\nimport androidx.compose.material3.Divider\nimport androidx.compose.material3.Surface\nimport androidx.compose.foundation.layout.Box\nimport androidx.compose.foundation.layout.Arrangement\nimport androidx.compose.foundation.layout.Row\nimport androidx.compose.ui.Alignment\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.text.font.FontWeight\nimport androidx.compose.ui.text.font.FontStyle\nimport androidx.compose.ui.unit.sp\n\nobject Routes {\n    const val LANDING = \"landing\"\n    const val SCANNER = \"scanner\"\n    const val REVIEW = \"review\"\n    const val DATABASE_VIEWER = \"database_viewer\"\n    const val TEST_SONGS = \"test_songs\"\n    const val FREQ_GEN = \"frequency_generator\"\n    const val FQC_REVIEW = \"fqc_review\"\n    const val DEVICE_CONFIG = \"device_config\"\n    const val DEVICE_INFORMATION = \"device_information\"\n    const val DRIVER_PAIRING = \"driver_pairing\"\n    const val CHANGED_PART = \"changed_part\"\n    const val OPERATOR_SELECTION = \"operator_selection\"\n    \n    // Helper function to build operator selection route with destination\n    fun operatorSelection(destination: String): String {\n        return \"$OPERATOR_SELECTION/$destination\"\n    }\n}\n\n@Composable\nfun AppNav(activity: ComponentActivity, operatorName: String, permissionHandler: PermissionHandler, onLogout: () -> Unit) {\n    val nav = rememberNavController()\n    val context = LocalContext.current\n    val database = remember { AppDatabase.getDatabase(context) }\n    val repository = remember { FQCRepository(database) }\n    val prefsManager = remember { PreferencesManager(context) }\n    val scope = rememberCoroutineScope()\n    val eligibilityService = remember { DeviceEligibilityService(repository, database) }\n    // MAC ID cache manager for reverse lookup (MAC ID -> Serial Number)\n    val macIdCacheManager = remember { MacIdCacheManager(\n        context,\n        repository.getMacIdCacheDao(),\n        GoogleSheetsAPI(context)\n    ) }\n    \n    // UndoManager for undo functionality\n    val undoManager = remember { UndoManager() }\n    \n    // SolutionReminderManager for tracking pending solutions\n    val solutionReminderManager = remember { SolutionReminderManager() }\n    \n    // Eligibility dialog state\n    var showEligibilityDialog by remember { mutableStateOf(false) }\n    var eligibilityMessage by remember { mutableStateOf(\"\") }\n    var eligibilityRequiresDriverPairing by remember { mutableStateOf(false) }\n    var eligibilityRequiresFrequencyTest by remember { mutableStateOf(false) }\n    var eligibilityRequiresSongTest by remember { mutableStateOf(false) }\n    var pendingNavigationRoute by remember { mutableStateOf<String?>(null) }\n    \n    // Load criteria from saved JSON file on startup\n    LaunchedEffect(Unit) {\n        Log.d(\"AppNav\", \" App starting - loading criteria from saved JSON file...\")\n        val loaded = com.example.fqcapp.core.CriteriaJsonStorage.loadFromFile(context)\n        if (loaded != null) {\n            com.example.fqcapp.core.CriteriaRepository.update(loaded)\n            Log.d(\"AppNav\", \" Criteria loaded on startup from JSON\")\n        } else {\n            Log.d(\"AppNav\", \" No saved criteria JSON file, using defaults\")\n        }\n    }\n    \n    // Initialize services with error handling\n    val sheetsService = remember {\n        try {\n            GoogleSheetsService(context, repository.getMacIdCacheDao())\n        } catch (e: Exception) {\n            e.printStackTrace()\n            null\n        }\n    }\n    val bluetoothService = remember {\n        try {\n            BluetoothService(context)\n        } catch (e: Exception) {\n            e.printStackTrace()\n            null\n        }\n    }\n    val connectionManager = remember {\n        try {\n            if (sheetsService != null && bluetoothService != null) {\n                ConnectionManager(bluetoothService, sheetsService)\n            } else null\n        } catch (e: Exception) {\n            e.printStackTrace()\n            null\n        }\n    }\n    \n    // Permission handler is now passed as parameter\n    \n    // Current session state\n    var currentSessionId by remember { mutableStateOf<Long?>(null) }\n    var currentSerialNumber by remember { mutableStateOf<String?>(null) }\n    var currentMacAddress by remember { mutableStateOf(\"\") }\n    var isReferenceSerial by remember { mutableStateOf(false) } // Track if serial is generated reference\n    var dataUploadStatus by remember { mutableStateOf(\"Unknown\") }\n    var connectedDeviceName by remember { mutableStateOf<String?>(null) }\n    \n    // Device data cache manager\n    val deviceDataCache = remember { com.example.fqcapp.core.DeviceDataCacheManager(context) }\n    \n    // Fetch device data from Supabase when serial number is set (with caching)\n    LaunchedEffect(currentSerialNumber) {\n        if (currentSerialNumber != null && currentSerialNumber!!.isNotBlank()) {\n            Log.d(\"Navigation\", \"\")\n            Log.d(\"Navigation\", \" [NAVIGATION] SERIAL NUMBER SCANNED/SET\")\n            Log.d(\"Navigation\", \"   Serial Number: ${currentSerialNumber}\")\n            Log.d(\"Navigation\", \"   MAC Address: $currentMacAddress\")\n            Log.d(\"Navigation\", \"   Device Name: ${connectedDeviceName ?: \"N/A\"}\")\n            Log.d(\"Navigation\", \"\")\n            \n            scope.launch {\n                try {\n                    // Check cache first\n                    val cachedData = deviceDataCache.getCachedData(currentSerialNumber!!)\n                    \n                    if (cachedData != null) {\n                        Log.d(\"Navigation\", \" [CACHE] Using cached device data (no API call)\")\n                        Log.d(\"Navigation\", \"   Device Status: ${cachedData.device_status}\")\n                        Log.d(\"Navigation\", \"   Current Stage: ${cachedData.current_stage}\")\n                        Log.d(\"Navigation\", \"   Max Iterations:\")\n                        Log.d(\"Navigation\", \"      Frequency: ${cachedData.max_frequency_iteration}\")\n                        Log.d(\"Navigation\", \"      Song: ${cachedData.max_song_iteration}\")\n                        Log.d(\"Navigation\", \"      FQC: ${cachedData.max_fqc_iteration}\")\n                        Log.d(\"Navigation\", \"      Driver Pairing: ${cachedData.max_driver_pairing_iteration}\")\n                        Log.d(\"Navigation\", \"      Changed Parts: ${cachedData.max_changed_parts_iteration}\")\n                        Log.d(\"Navigation\", \"\")\n                        return@launch\n                    }\n                    \n                    // Cache miss or expired - fetch from Supabase\n                    Log.d(\"Navigation\", \" [ACTION] Fetching device data from Supabase (cache miss/expired)...\")\n                    val deviceDataService = com.example.fqcapp.supabase.SupabaseDeviceDataService()\n                    val snapshot = deviceDataService.fetchDeviceData(currentSerialNumber!!)\n                    \n                    if (snapshot != null) {\n                        // Cache the fetched data\n                        deviceDataCache.setCachedData(currentSerialNumber!!, snapshot)\n                        \n                        Log.d(\"Navigation\", \"\")\n                        Log.d(\"Navigation\", \" [NAVIGATION] Device data fetched from Supabase\")\n                        Log.d(\"Navigation\", \"   Device Status: ${snapshot.device_status}\")\n                        Log.d(\"Navigation\", \"   Current Stage: ${snapshot.current_stage}\")\n                        Log.d(\"Navigation\", \"   Max Iterations:\")\n                        Log.d(\"Navigation\", \"      Frequency: ${snapshot.max_frequency_iteration}\")\n                        Log.d(\"Navigation\", \"      Song: ${snapshot.max_song_iteration}\")\n                        Log.d(\"Navigation\", \"      FQC: ${snapshot.max_fqc_iteration}\")\n                        Log.d(\"Navigation\", \"      Driver Pairing: ${snapshot.max_driver_pairing_iteration}\")\n                        Log.d(\"Navigation\", \"      Changed Parts: ${snapshot.max_changed_parts_iteration}\")\n                        Log.d(\"Navigation\", \"   Last Update: ${snapshot.last_update_timestamp}\")\n                        Log.d(\"Navigation\", \"\")\n                    } else {\n                        Log.w(\"Navigation\", \"\")\n                        Log.w(\"Navigation\", \" [NAVIGATION] No device data found in Supabase (new device)\")\n                        Log.w(\"Navigation\", \"   Serial Number: ${currentSerialNumber}\")\n                        Log.w(\"Navigation\", \"   This is a new device - no previous test data\")\n                        Log.w(\"Navigation\", \"\")\n                    }\n                } catch (e: Exception) {\n                    Log.e(\"Navigation\", \"\")\n                    Log.e(\"Navigation\", \" [NAVIGATION] Error fetching device data from Supabase\")\n                    Log.e(\"Navigation\", \"   Serial Number: ${currentSerialNumber}\")\n                    Log.e(\"Navigation\", \"   Error: ${e.message}\")\n                    Log.e(\"Navigation\", \"   Stack trace: ${e.stackTraceToString()}\")\n                    Log.e(\"Navigation\", \"\")\n                }\n            }\n        }\n    }\n    \n    // Callback function to update device info (for PCB change)\n    val updateDeviceInfoCallback: (String, String) -> Unit = { newSerialNumber, newMacId ->\n        currentMacAddress = newMacId\n        currentSerialNumber = newSerialNumber\n        android.util.Log.d(\"Navigation\", \" [PCB_UPDATE] Updated MAC ID to: $newMacId, Serial to: $newSerialNumber\")\n    }\n    \n    // Track current route to only run periodic checks on landing page\n    val navBackStackEntry by nav.currentBackStackEntryAsState()\n    val currentRoute = navBackStackEntry?.destination?.route ?: Routes.LANDING\n    \n    // Periodic Bluetooth device detection - ONLY on landing page\n    LaunchedEffect(bluetoothService, currentRoute) {\n        // Only start periodic checks if we're on the landing page\n        if (bluetoothService != null && currentRoute == Routes.LANDING) {\n            android.util.Log.d(\"Navigation\", \" Starting periodic Bluetooth check (on landing page: $currentRoute)\")\n            while (true) {\n                try {\n                    // Check current route at the start of each iteration\n                    val currentNavBackStackEntry = nav.currentBackStackEntry\n                    val actualRoute = currentNavBackStackEntry?.destination?.route ?: Routes.LANDING\n                    \n                    // If we're no longer on landing page, stop immediately\n                    if (actualRoute != Routes.LANDING) {\n                        android.util.Log.d(\"Navigation\", \" Stopping periodic Bluetooth check (navigated away from landing page: $actualRoute)\")\n                        break\n                    }\n                    \n                    // Check for connected device every 10 seconds\n                    val connectedDevice = bluetoothService.probeCurrentlyConnected()\n                    if (connectedDevice != null) {\n                        android.util.Log.d(\"Navigation\", \"Periodic check: Found connected device: ${connectedDevice.name} - ${connectedDevice.macAddress}\")\n                        \n                        // IMPORTANT: If MAC ID changed, clear previous serial number\n                        if (currentMacAddress.isNotBlank() && currentMacAddress != connectedDevice.macAddress) {\n                            android.util.Log.d(\"Navigation\", \" MAC ID changed from $currentMacAddress to ${connectedDevice.macAddress} - clearing previous serial\")\n                            currentSerialNumber = null\n                            isReferenceSerial = false\n                        }\n                        \n                        connectedDeviceName = connectedDevice.name\n                        currentMacAddress = connectedDevice.macAddress\n                        \n                        // If we don't have a serial number, try to look it up from MAC ID (reverse lookup)\n                        // This handles the case where device is connected manually without scanning QR code\n                        if (currentSerialNumber == null && connectedDevice.macAddress.isNotBlank()) {\n                            android.util.Log.d(\"Navigation\", \" Performing reverse lookup: MAC ID -> Serial Number\")\n                            android.util.Log.d(\"Navigation\", \"   MAC ID: ${connectedDevice.macAddress}\")\n                            try {\n                                val serialFromMac = macIdCacheManager.getSerialNumberByMacId(connectedDevice.macAddress)\n                                if (serialFromMac != null && serialFromMac.isNotBlank()) {\n                                    android.util.Log.d(\"Navigation\", \" Found serial number from MAC ID: $serialFromMac\")\n                                    // Directly set the serial number and MAC address\n                                    // The device is already connected, so we just need to update our state\n                                    currentSerialNumber = serialFromMac\n                                    isReferenceSerial = false\n                                    android.util.Log.d(\"Navigation\", \" Updated device info - Serial: $serialFromMac, MAC: ${connectedDevice.macAddress}\")\n                                } else {\n                                    // MAC ID not found - generate reference serial number\n                                    val referenceSerial = SerialGenerator.generateSystemSerial(connectedDevice.macAddress)\n                                    android.util.Log.w(\"Navigation\", \" Serial number not found for MAC ID: ${connectedDevice.macAddress}\")\n                                    android.util.Log.w(\"Navigation\", \"   Generating reference serial: $referenceSerial\")\n                                    currentSerialNumber = referenceSerial\n                                    isReferenceSerial = true\n                                    android.util.Log.d(\"Navigation\", \" Using reference serial: $referenceSerial for MAC: ${connectedDevice.macAddress}\")\n                                }\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"Navigation\", \" Error during MAC ID reverse lookup\", e)\n                                // On error, still generate reference serial\n                                val referenceSerial = SerialGenerator.generateSystemSerial(connectedDevice.macAddress)\n                                currentSerialNumber = referenceSerial\n                                isReferenceSerial = true\n                                android.util.Log.d(\"Navigation\", \" Generated reference serial on error: $referenceSerial\")\n                            }\n                        }\n                    } else {\n                        android.util.Log.d(\"Navigation\", \"Periodic check: No connected device found\")\n                        // Don't clear the current device info immediately - wait for user to scan new QR\n                    }\n                } catch (e: Exception) {\n                    android.util.Log.e(\"Navigation\", \"Error in periodic Bluetooth check\", e)\n                }\n                \n                // Wait 10 seconds before next check\n                kotlinx.coroutines.delay(10000)\n            }\n            android.util.Log.d(\"Navigation\", \" Periodic Bluetooth check loop ended\")\n        } else {\n            if (bluetoothService != null && currentRoute != Routes.LANDING) {\n                android.util.Log.d(\"Navigation\", \" Periodic Bluetooth check not started (not on landing page: $currentRoute)\")\n            } else if (bluetoothService == null) {\n                android.util.Log.d(\"Navigation\", \" Periodic Bluetooth check not started (bluetoothService is null)\")\n            }\n        }\n    }\n    \n    // Connection flow state\n    var showConnectionProgress by remember { mutableStateOf(false) }\n    var connectionStep by remember { mutableStateOf(ConnectionStep.SEARCHING_SHEET) }\n    var connectionData by remember { mutableStateOf<String?>(null) } // MAC ID or device name\n    var showConnectionError by remember { mutableStateOf(false) }\n    var errorMessage by remember { mutableStateOf(\"\") }\n    var showDeviceSelection by remember { mutableStateOf(false) }\n    var nearbyDevices by remember { mutableStateOf<List<BluetoothService.DeviceInfo>>(emptyList()) }\n    var pendingSerialNumber by remember { mutableStateOf<String?>(null) }\n    \n    // Permission state\n    var showPermissionRequest by remember { mutableStateOf(false) }\n    var missingPermissions by remember { mutableStateOf<List<String>>(emptyList()) }\n    \n    // Drawer state\n    val drawerState = rememberDrawerState(initialValue = DrawerValue.Closed)\n    var serialNumberPrefix by remember { mutableStateOf(prefsManager.getSerialNumberPrefix()) }\n    var showPrefixDialog by remember { mutableStateOf(false) }\n    var showUnpairConfirmDialog by remember { mutableStateOf(false) }\n    var showUnpairResultDialog by remember { mutableStateOf(false) }\n    var unpairResult by remember { mutableStateOf(\"\") }\n    \n    // Long press speed setting\n    var longPressSpeed by remember { mutableStateOf(prefsManager.getLongPressSpeed()) }\n    var showLongPressSpeedDialog by remember { mutableStateOf(false) }\n    \n    // Simulate data upload status updates\n    LaunchedEffect(currentSerialNumber) {\n        if (currentSerialNumber != null) {\n            dataUploadStatus = \"Pending\"\n            // Simulate upload process\n            kotlinx.coroutines.delay(3000) // 3 second delay\n            dataUploadStatus = \"Synced\"\n            android.util.Log.d(\"Navigation\", \"Data upload simulation completed for: $currentSerialNumber\")\n        }\n    }\n    \n    // Auto-refresh MAC ID cache on startup if older than 1 hour\n    LaunchedEffect(Unit) {\n        try {\n            if (macIdCacheManager.shouldRefreshCache()) {\n                android.util.Log.d(\"Navigation\", \"MAC ID cache is stale, refreshing...\")\n                val success = macIdCacheManager.refreshCache()\n                if (success) {\n                    android.util.Log.d(\"Navigation\", \" MAC ID cache refreshed successfully\")\n                } else {\n                    android.util.Log.w(\"Navigation\", \" Failed to refresh MAC ID cache\")\n                }\n            } else {\n                android.util.Log.d(\"Navigation\", \"MAC ID cache is up-to-date\")\n            }\n        } catch (e: Exception) {\n            android.util.Log.e(\"Navigation\", \"Error checking/refreshing MAC ID cache\", e)\n        }\n    }\n    \n    // Background sync for unsynced driver pairing entries\n    LaunchedEffect(Unit) {\n        try {\n            val driverPairingService = DriverPairingSheetsService(context)\n            val driverPairingCacheManager = DriverPairingCacheManager(\n                repository.getDriverPairingCacheDao(),\n                driverPairingService\n            )\n            \n            // Check for unsynced entries and sync in background\n            if (driverPairingCacheManager.hasUnsyncedEntries()) {\n                android.util.Log.d(\"Navigation\", \"Found unsynced driver pairing entries, syncing...\")\n                scope.launch {\n                    val syncedCount = driverPairingCacheManager.syncUnsyncedEntries()\n                    android.util.Log.d(\"Navigation\", \" Synced $syncedCount driver pairing entries to Google Sheets\")\n                }\n            }\n        } catch (e: Exception) {\n            android.util.Log.e(\"Navigation\", \"Error syncing driver pairing entries\", e)\n        }\n    }\n    \n    \n    \n    // Simple direct connection function - bypasses ConnectionManager complexity\n    fun simpleConnect(serialNumber: String, macIdOverride: String? = null) {\n        android.util.Log.d(\"Navigation\", \"Simple connect for serial: $serialNumber${if (macIdOverride != null) \" with MAC override: $macIdOverride\" else \"\"}\")\n        \n        if (sheetsService == null || bluetoothService == null) {\n            android.util.Log.w(\"Navigation\", \"Services not initialized\")\n            errorMessage = \"Services not initialized\"\n            showConnectionError = true\n            return\n        }\n        \n        showConnectionProgress = true\n        connectionStep = ConnectionStep.SEARCHING_SHEET\n        connectionData = null\n        \n        scope.launch {\n            try {\n                val macId: String?\n                \n                if (macIdOverride != null && macIdOverride.isNotBlank()) {\n                    // Use the provided MAC ID (from PCB change)\n                    android.util.Log.d(\"Navigation\", \"Step 1: Using provided MAC ID (PCB change): $macIdOverride\")\n                    macId = macIdOverride\n                    connectionStep = ConnectionStep.MAC_FOUND\n                    connectionData = macId\n                    currentMacAddress = macId\n                } else {\n                    // Step 1: Search Google Sheets for MAC ID\n                    android.util.Log.d(\"Navigation\", \"Step 1: Searching Google Sheets for serial: $serialNumber\")\n                    connectionStep = ConnectionStep.SEARCHING_SHEET\n                    connectionData = null\n                    \n                    macId = sheetsService.getMacIdBySerialNumber(serialNumber)\n                    \n                    if (macId == null) {\n                        android.util.Log.e(\"Navigation\", \"MAC ID not found for serial: $serialNumber\")\n                        errorMessage = \"Serial number '$serialNumber' not found in database\"\n                        showConnectionProgress = false\n                        showConnectionError = true\n                        return@launch\n                    }\n                    \n                    // Step 2: MAC ID Found - Display it\n                    android.util.Log.d(\"Navigation\", \"Step 2: MAC ID found: $macId\")\n                    connectionStep = ConnectionStep.MAC_FOUND\n                    connectionData = macId\n                    currentMacAddress = macId\n                }\n                \n                kotlinx.coroutines.delay(1000) // Show MAC ID for 1 second\n                \n                // Step 3: Search for Bluetooth device\n                android.util.Log.d(\"Navigation\", \"Step 3: Searching for Bluetooth device with MAC: $macId\")\n                connectionStep = ConnectionStep.SEARCHING_DEVICE\n                connectionData = macId\n                \n                val device = bluetoothService.findDeviceByMacId(macId)\n                \n                if (device == null) {\n                    android.util.Log.e(\"Navigation\", \"Bluetooth device not found for MAC: $macId\")\n                    errorMessage = \"Device not found with MAC address: $macId\"\n                    showConnectionProgress = false\n                    showConnectionError = true\n                    return@launch\n                }\n                \n                // Step 4: Connect to device\n                android.util.Log.d(\"Navigation\", \"Step 4: Connecting to device: ${device.name}\")\n                connectionStep = ConnectionStep.CONNECTING\n                connectionData = device.name\n                \n                val connected = bluetoothService.connectToDevice(device)\n                \n                if (!connected) {\n                    android.util.Log.e(\"Navigation\", \"Failed to connect to device: ${device.name}\")\n                    errorMessage = \"Failed to connect to device: ${device.name}\"\n                    showConnectionProgress = false\n                    showConnectionError = true\n                    return@launch\n                }\n                \n                // Success!\n                android.util.Log.d(\"Navigation\", \"Connection successful!\")\n                connectionStep = ConnectionStep.SUCCESS\n                kotlinx.coroutines.delay(500) // Show success message briefly\n                showConnectionProgress = false\n                \n                // Create session and navigate to landing\n                try {\n                    // Ensure Device and Operator records exist\n                    val existingDevice = repository.getDeviceBySerialNumber(serialNumber)\n                    if (existingDevice == null) {\n                        val today = java.text.SimpleDateFormat(\"yyyy-MM-dd\", java.util.Locale.US)\n                            .format(java.util.Date())\n                        // NOTE: macId is deprecated - MAC comes from active PCB link\n                        // Setting to empty string - MAC will be derived from PCB link when needed\n                        repository.insertDevice(Device(\n                            serialNumber = serialNumber,\n                            macId = \"\",  // Deprecated - MAC comes from active PCB link\n                            color = \"\",\n                            createdDate = today,\n                            finalStatus = \"IN_PROGRESS\",\n                            totalIterations = 0,\n                            totalTimeHours = 0.0,\n                            finalOperator = \"\",\n                            firstTestDate = today,\n                            finalShipDate = \"\",\n                            needsSync = true,\n                            lastSyncTimestamp = 0\n                        ))\n                    }\n                    \n                    val operatorId = prefsManager.getOperatorId()\n                    val existingOperator = repository.getOperatorById(operatorId)\n                    if (existingOperator == null) {\n                        repository.insertOperator(Operator(\n                            id = operatorId,\n                            name = operatorName\n                        ))\n                    }\n                    \n                    val sessionId = repository.insertSession(\n                        FQCSession(\n                            operatorId = operatorId,\n                            serialNumber = serialNumber,\n                            status = \"active\"\n                        )\n                    )\n                    currentSessionId = sessionId\n                    currentSerialNumber = serialNumber\n                    isReferenceSerial = false // Reset flag when real serial is scanned\n                    dataUploadStatus = \"Pending\"\n                    android.util.Log.d(\"Navigation\", \"Session created: $sessionId\")\n                } catch (e: Exception) {\n                    android.util.Log.e(\"Navigation\", \"Error creating session\", e)\n                }\n                \n            } catch (e: Exception) {\n                android.util.Log.e(\"Navigation\", \"Exception in simple connect\", e)\n                errorMessage = \"Connection error: ${e.message ?: \"Unknown error\"}\"\n                showConnectionProgress = false\n                showConnectionError = true\n            }\n        }\n    }\n\n    ModalNavigationDrawer(\n        drawerState = drawerState,\n        drawerContent = {\n            AppDrawer(\n                operatorName = operatorName,\n                serialNumberPrefix = serialNumberPrefix,\n                onSerialPrefixClick = {\n                    scope.launch {\n                        drawerState.close()\n                        showPrefixDialog = true\n                    }\n                },\n                onForgetDevicesClick = {\n                    scope.launch {\n                        drawerState.close()\n                        showUnpairConfirmDialog = true\n                    }\n                },\n                onLongPressSpeedClick = {\n                    scope.launch {\n                        drawerState.close()\n                        showLongPressSpeedDialog = true\n                    }\n                },\n                onSyncConfigClick = {\n                    scope.launch {\n                        drawerState.close()\n                        android.widget.Toast.makeText(context, \"Syncing config from Google Sheets...\", android.widget.Toast.LENGTH_SHORT).show()\n                        try {\n                            // Sync criteria\n                            val criteriaResult = com.example.fqcapp.core.CriteriaSync.syncFromGoogleSheets(\n                                context = context,\n                                sheetId = \"1pz_4jusyFCFZkg5Rkw5M3lkBmFlik14iu9tmtJezpD0\",\n                                sheetName = \"Test_parameters\"\n                            )\n                            \n                            // Sync operator credentials\n                            val operatorResult = com.example.fqcapp.core.OperatorCredentialSync.syncFromGoogleSheets(\n                                context = context,\n                                sheetId = \"1pz_4jusyFCFZkg5Rkw5M3lkBmFlik14iu9tmtJezpD0\",\n                                sheetName = \"Operator_Credentials\"\n                            )\n                            \n                            val criteriaSuccess = criteriaResult.isSuccess\n                            val operatorSuccess = operatorResult.isSuccess\n                            \n                            if (criteriaSuccess && operatorSuccess) {\n                                val operatorCount = operatorResult.getOrNull() ?: 0\n                                android.widget.Toast.makeText(context, \" Config synced! ($operatorCount operators)\", android.widget.Toast.LENGTH_SHORT).show()\n                                Log.d(\"Navigation\", \" Sync completed successfully - Criteria and $operatorCount operators\")\n                            } else {\n                                val errors = mutableListOf<String>()\n                                val errorDetails = mutableListOf<String>()\n                                if (!criteriaSuccess) {\n                                    errors.add(\"Criteria\")\n                                    val criteriaError = criteriaResult.exceptionOrNull()?.message ?: \"Unknown error\"\n                                    errorDetails.add(\"Criteria: $criteriaError\")\n                                }\n                                if (!operatorSuccess) {\n                                    errors.add(\"Operators\")\n                                    val operatorError = operatorResult.exceptionOrNull()?.message ?: \"Unknown error\"\n                                    errorDetails.add(\"Operators: $operatorError\")\n                                    Log.e(\"Navigation\", \" Operator sync error details: $operatorError\")\n                                }\n                                val errorMsg = errors.joinToString(\", \")\n                                val errorDetailMsg = errorDetails.joinToString(\"\\n\")\n                                android.widget.Toast.makeText(context, \" Partial sync: $errorMsg failed\\n$errorDetailMsg\", android.widget.Toast.LENGTH_LONG).show()\n                                Log.e(\"Navigation\", \" Partial sync failed: $errorMsg\")\n                                Log.e(\"Navigation\", \" Error details: $errorDetailMsg\")\n                            }\n                        } catch (e: Exception) {\n                            android.util.Log.e(\"Navigation\", \" Error syncing config\", e)\n                            android.widget.Toast.makeText(context, \"Config sync error: ${e.message}\", android.widget.Toast.LENGTH_LONG).show()\n                        }\n                    }\n                },\n                onSyncDataClick = {\n                    scope.launch {\n                        drawerState.close()\n                        dataUploadStatus = \"Syncing...\"\n                        android.widget.Toast.makeText(context, \"Starting hybrid data sync...\", android.widget.Toast.LENGTH_SHORT).show()\n                        \n                        try {\n                            // Use SQL-based sync service with current serial number and operator name\n                            val operatorName = prefsManager.getOperatorName() ?: \"Unknown\"\n                            val syncService = com.example.fqcapp.services.SQLDataSyncService(context, repository)\n                            val success = syncService.syncDeviceData(scannedSerialNumber = currentSerialNumber, operatorName = operatorName)\n                            \n                            if (success) {\n                                dataUploadStatus = \"Synced\"\n                                android.widget.Toast.makeText(context, \" Data sync completed successfully!\", android.widget.Toast.LENGTH_LONG).show()\n                            } else {\n                                dataUploadStatus = \"Failed\"\n                                android.widget.Toast.makeText(context, \" Data sync failed. Check logs for details.\", android.widget.Toast.LENGTH_LONG).show()\n                            }\n                            \n                        } catch (e: Exception) {\n                            android.util.Log.e(\"Navigation\", \"Manual sync failed\", e)\n                            dataUploadStatus = \"Failed\"\n                            android.widget.Toast.makeText(context, \"Sync failed: ${e.message}\", android.widget.Toast.LENGTH_LONG).show()\n                        }\n                    }\n                },\n                onSyncDriverPairClick = {\n                    scope.launch {\n                        drawerState.close()\n                        android.util.Log.d(\"Navigation\", \" [SYNC_DRIVER_PAIR] Manual sync Driver Pair button tapped\")\n                        android.widget.Toast.makeText(context, \"Syncing driver pairing data...\", android.widget.Toast.LENGTH_SHORT).show()\n                        \n                        try {\n                            android.util.Log.d(\"Navigation\", \" [SYNC_DRIVER_PAIR] Initializing services...\")\n                            val driverPairingService = DriverPairingSheetsService(context)\n                            val driverPairingCacheManager = DriverPairingCacheManager(\n                                repository.getDriverPairingCacheDao(),\n                                driverPairingService\n                            )\n                            \n                            android.util.Log.d(\"Navigation\", \" [SYNC_DRIVER_PAIR] Checking for unsynced entries...\")\n                            val hasUnsynced = driverPairingCacheManager.hasUnsyncedEntries()\n                            \n                            if (hasUnsynced) {\n                                android.util.Log.d(\"Navigation\", \" [SYNC_DRIVER_PAIR] Found unsynced entries, starting sync...\")\n                                val syncedCount = driverPairingCacheManager.syncUnsyncedEntries()\n                                android.util.Log.d(\"Navigation\", \" [SYNC_DRIVER_PAIR] Sync completed: $syncedCount entries synced\")\n                                \n                                if (syncedCount > 0) {\n                                    android.widget.Toast.makeText(context, \" Synced $syncedCount driver pairing entries!\", android.widget.Toast.LENGTH_SHORT).show()\n                                } else {\n                                    android.widget.Toast.makeText(context, \" No entries synced. Check logs for details.\", android.widget.Toast.LENGTH_LONG).show()\n                                }\n                            } else {\n                                android.util.Log.d(\"Navigation\", \" [SYNC_DRIVER_PAIR] No unsynced entries found\")\n                                android.widget.Toast.makeText(context, \" All driver pairing data is already synced!\", android.widget.Toast.LENGTH_SHORT).show()\n                            }\n                        } catch (e: Exception) {\n                            android.util.Log.e(\"Navigation\", \" [SYNC_DRIVER_PAIR] Error during sync\", e)\n                            android.widget.Toast.makeText(context, \" Sync failed: ${e.message}\", android.widget.Toast.LENGTH_LONG).show()\n                        }\n                    }\n                },\n                onTestUploadClick = {\n                    scope.launch {\n                        drawerState.close()\n                        android.widget.Toast.makeText(context, \"Generating test data...\", android.widget.Toast.LENGTH_SHORT).show()\n                        \n                        try {\n                            // Generate test data\n                            val testDataGenerator = com.example.fqcapp.utils.TestDataGenerator(context)\n                            val success = testDataGenerator.generateTestData()\n                            \n                            if (success) {\n                                android.widget.Toast.makeText(context, \"Test data generated! Now testing upload...\", android.widget.Toast.LENGTH_SHORT).show()\n                                \n                                // Test SQL sync\n                                val operatorName = prefsManager.getOperatorName() ?: \"TestOperator\"\n                                val syncService = com.example.fqcapp.services.SQLDataSyncService(context, repository)\n                                val success = syncService.syncDeviceData(scannedSerialNumber = currentSerialNumber, operatorName = operatorName)\n                                \n                                if (success) {\n                                    dataUploadStatus = \"Synced\"\n                                    android.widget.Toast.makeText(context, \" Test upload completed successfully!\", android.widget.Toast.LENGTH_LONG).show()\n                                } else {\n                                    dataUploadStatus = \"Failed\"\n                                    android.widget.Toast.makeText(context, \" Test upload failed\", android.widget.Toast.LENGTH_LONG).show()\n                                }\n                                \n                                // Show test data summary\n                                val summary = testDataGenerator.getTestDataSummary()\n                                android.util.Log.d(\"Navigation\", \"Test data summary:\\n$summary\")\n                                \n                            } else {\n                                android.widget.Toast.makeText(context, \"Failed to generate test data\", android.widget.Toast.LENGTH_LONG).show()\n                            }\n                        } catch (e: Exception) {\n                            android.util.Log.e(\"Navigation\", \"Error in test upload\", e)\n                            android.widget.Toast.makeText(context, \"Test upload failed: ${e.message}\", android.widget.Toast.LENGTH_LONG).show()\n                        }\n                    }\n                },\n                onTestGoogleSheetsClick = {\n                    scope.launch {\n                        drawerState.close()\n                        android.widget.Toast.makeText(context, \"Testing Google Sheets connection...\", android.widget.Toast.LENGTH_SHORT).show()\n                        \n                        try {\n                            if (sheetsService != null) {\n                                // Test general connection\n                                val success = sheetsService.testGoogleSheetsConnection()\n                                \n                                // Test specific serial number\n                                val testSerial = \"SLC251EG000641\"\n                                val macId = sheetsService.testSpecificSerial(testSerial)\n                                \n                                if (success && macId != null) {\n                                    android.widget.Toast.makeText(context, \" Google Sheets working! MAC for $testSerial: $macId\", android.widget.Toast.LENGTH_LONG).show()\n                                } else if (success) {\n                                    android.widget.Toast.makeText(context, \" Google Sheets connected but $testSerial not found\", android.widget.Toast.LENGTH_LONG).show()\n                                } else {\n                                    android.widget.Toast.makeText(context, \" Google Sheets connection failed. Using mock data.\", android.widget.Toast.LENGTH_LONG).show()\n                                }\n                            } else {\n                                android.widget.Toast.makeText(context, \" Google Sheets service not available\", android.widget.Toast.LENGTH_LONG).show()\n                            }\n                        } catch (e: Exception) {\n                            android.util.Log.e(\"Navigation\", \"Error testing Google Sheets\", e)\n                            android.widget.Toast.makeText(context, \" Error testing Google Sheets: ${e.message}\", android.widget.Toast.LENGTH_LONG).show()\n                        }\n                    }\n                },\n                onViewCSVClick = {\n                    scope.launch {\n                        drawerState.close()\n                        android.widget.Toast.makeText(context, \"Checking CSV data...\", android.widget.Toast.LENGTH_SHORT).show()\n                        \n                        try {\n                            // Simple CSV viewer - just show a message\n                            android.widget.Toast.makeText(context, \"CSV viewer feature coming soon!\", android.widget.Toast.LENGTH_LONG).show()\n                            \n                        } catch (e: Exception) {\n                            android.util.Log.e(\"Navigation\", \"Error viewing CSV data\", e)\n                            android.widget.Toast.makeText(context, \"Error viewing CSV: ${e.message}\", android.widget.Toast.LENGTH_LONG).show()\n                        }\n                    }\n                },\n                onViewDatabaseClick = {\n                    scope.launch {\n                        drawerState.close()\n                        nav.navigate(Routes.DATABASE_VIEWER)\n                    }\n                },\n                onClose = {\n                    scope.launch { drawerState.close() }\n                }\n            )\n        }\n    ) {\n        Scaffold { padding ->\n            AppNavGraph(\n                nav = nav,\n                operatorName = operatorName,\n                currentSerialNumber = currentSerialNumber,\n                currentMacAddress = currentMacAddress,\n                connectedDeviceName = connectedDeviceName,\n                serialNumberPrefix = serialNumberPrefix,\n                longPressSpeed = 10, // Default speed\n                onLogout = onLogout,\n                onOpenDrawer = {\n                    scope.launch { drawerState.open() }\n                },\n                onSerialNumberScanned = { serialNumber, macIdOverride ->\n                    // Check if this is a reference serial (starts with \"TMP-\")\n                    isReferenceSerial = serialNumber.startsWith(\"TMP-\")\n                    pendingSerialNumber = serialNumber\n                    if (permissionHandler != null && !permissionHandler.hasAllBluetoothPermissions()) {\n                        permissionHandler.requestBluetoothPermissions { granted ->\n                            if (granted) {\n                                simpleConnect(serialNumber, macIdOverride)\n                            } else {\n                                missingPermissions = permissionHandler.getMissingBluetoothPermissions()\n                                showPermissionRequest = true\n                            }\n                        }\n                    } else {\n                        simpleConnect(serialNumber, macIdOverride)\n                    }\n                },\n                currentSessionId = currentSessionId,\n                repository = repository,\n                paddingValues = padding,\n                activity = activity,\n                permissionHandler = permissionHandler,\n                bluetoothService = bluetoothService,\n                onMacDetected = { mac -> currentMacAddress = mac },\n                dataUploadStatus = dataUploadStatus,\n                macIdCacheManager = macIdCacheManager,\n                onForgetCurrentDevice = {\n                    scope.launch {\n                        // Clear current device info\n                        currentSerialNumber = null\n                        currentMacAddress = \"\"\n                        currentSessionId = null\n                        dataUploadStatus = \"Unknown\"\n                        \n                        // Unpair the device if Bluetooth service is available\n                        bluetoothService?.let { service ->\n                            try {\n                                val connectedDevice = service.getCurrentlyConnectedDevice()\n                                if (connectedDevice != null) {\n                                    val success = service.unpairDevice(connectedDevice.macAddress)\n                                    android.util.Log.d(\"Navigation\", \"Device unpair result: $success\")\n                                } else {\n                                    android.util.Log.d(\"Navigation\", \"No connected device to unpair\")\n                                }\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"Navigation\", \"Error unpairing device\", e)\n                            }\n                        }\n                        \n                        android.widget.Toast.makeText(context, \"Current device forgotten\", android.widget.Toast.LENGTH_SHORT).show()\n                    }\n                },\n                undoManager = undoManager,\n                solutionReminderManager = solutionReminderManager\n            )\n        }\n        \n        // Connection Progress Dialog\n        if (showConnectionProgress) {\n            ConnectionProgressDialog(\n                currentStep = connectionStep,\n                additionalData = connectionData,\n                onRescan = {\n                    // Cancel connection and go back to scanner\n                    showConnectionProgress = false\n                    connectionStep = ConnectionStep.SEARCHING_SHEET\n                    connectionData = null\n                    nav.navigate(Routes.SCANNER) {\n                        popUpTo(Routes.LANDING) { inclusive = false }\n                    }\n                },\n                onBack = {\n                    // Cancel connection and go back to landing page\n                    showConnectionProgress = false\n                    connectionStep = ConnectionStep.SEARCHING_SHEET\n                    connectionData = null\n                    nav.navigate(Routes.LANDING) {\n                        popUpTo(Routes.LANDING) { inclusive = true }\n                    }\n                }\n            )\n        }\n        \n        // Connection Error Dialog\n        if (showConnectionError) {\n            ConnectionErrorDialog(\n                errorMessage = errorMessage,\n                onRetry = {\n                    showConnectionError = false\n                    pendingSerialNumber?.let { serial ->\n                        if (connectionManager == null) {\n                            // Services failed, continue anyway\n                            scope.launch {\n                                val operatorId = prefsManager.getOperatorId()\n                                val sessionId = repository.insertSession(\n                                    FQCSession(\n                                        operatorId = operatorId,\n                                        serialNumber = serial,\n                                        status = \"active\"\n                                    )\n                                )\n                                currentSessionId = sessionId\n                                currentSerialNumber = serial\n                            }\n                            return@let\n                        }\n                        showConnectionProgress = true\n                        connectionStep = ConnectionStep.SEARCHING_SHEET\n                        connectionData = null\n                        scope.launch {\n                            // Use the original working method\n                            connectionManager.connectToDeviceBySerial(\n                                serialNumber = serial,\n                                onStepChange = { step, data ->\n                                    connectionStep = step\n                                    connectionData = data\n                                },\n                                onError = { error ->\n                                    errorMessage = error\n                                    showConnectionProgress = false\n                                    showConnectionError = true\n                                },\n                                onSuccess = {\n                                    showConnectionProgress = false\n                                    scope.launch {\n                                        val operatorId = prefsManager.getOperatorId()\n                                        val sessionId = repository.insertSession(\n                                            FQCSession(\n                                                operatorId = operatorId,\n                                                serialNumber = serial,\n                                                status = \"active\"\n                                            )\n                                        )\n                                        currentSessionId = sessionId\n                                        currentSerialNumber = serial\n                                    }\n                                }\n                            )\n                        }\n                    }\n                },\n                onContinueAnyway = {\n                    showConnectionError = false\n                    // Continue without Bluetooth connection\n                    pendingSerialNumber?.let { serial ->\n                        scope.launch {\n                            try {\n                                val operatorId = prefsManager.getOperatorId()\n                                \n                                // Ensure Device record exists\n                                // NOTE: macId is deprecated - MAC comes from active PCB link\n                                // Setting to empty string - MAC will be derived from PCB link when needed\n                                repository.insertDevice(\n                                    Device(\n                                        serialNumber = serial,\n                                        macId = \"\",  // Deprecated - MAC comes from active PCB link\n                                        color = \"Unknown\",\n                                        createdDate = java.text.SimpleDateFormat(\"yyyy-MM-dd\", java.util.Locale.getDefault()).format(java.util.Date()),\n                                        finalStatus = \"IN_PROGRESS\"\n                                    )\n                                )\n                                \n                                // Ensure Operator record exists\n                                val operator = repository.getOperatorById(operatorId)\n                                if (operator == null) {\n                                    repository.insertOperator(\n                                        Operator(\n                                            id = operatorId,\n                                            name = operatorName\n                                        )\n                                    )\n                                }\n                                \n                                val sessionId = repository.insertSession(\n                                    FQCSession(\n                                        operatorId = operatorId,\n                                        serialNumber = serial,\n                                        status = \"active\"\n                                    )\n                                )\n                                currentSessionId = sessionId\n                                currentSerialNumber = serial\n                                android.util.Log.d(\"Navigation\", \"Session created successfully: $sessionId\")\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"Navigation\", \"Error creating session\", e)\n                            }\n                        }\n                    }\n                },\n                onDismiss = { \n                    showConnectionError = false\n                    // Also show device selection option if error was device-related\n                    if (errorMessage.contains(\"not found nearby\", ignoreCase = true) && bluetoothService != null) {\n                        scope.launch {\n                            showDeviceSelection = true\n                            nearbyDevices = bluetoothService.getNearbyDevices(15)\n                        }\n                    }\n                }\n            )\n        }\n        \n        // Device Selection Dialog\n        if (showDeviceSelection) {\n            DeviceSelectionDialog(\n                devices = nearbyDevices,\n                onDeviceSelected = { macAddress ->\n                    showDeviceSelection = false\n                    if (connectionManager == null) {\n                        // Services failed, skip connection\n                        return@DeviceSelectionDialog\n                    }\n                    showConnectionProgress = true\n                    connectionStep = ConnectionStep.SEARCHING_DEVICE\n                    scope.launch {\n                        connectionManager.connectToDeviceByMac(\n                            macAddress = macAddress,\n                            onStepChange = { step, data ->\n                                connectionStep = step\n                                connectionData = data\n                            },\n                            onError = { error ->\n                                errorMessage = error\n                                showConnectionProgress = false\n                                showConnectionError = true\n                            },\n                            onSuccess = {\n                                showConnectionProgress = false\n                                pendingSerialNumber?.let { serial ->\n                                    scope.launch {\n                                        try {\n                                            val operatorId = prefsManager.getOperatorId()\n                                            \n                                            // Ensure Device record exists\n                                            repository.insertDevice(\n                                                Device(\n                                                    serialNumber = serial,\n                                                    macId = currentMacAddress.ifBlank { \"Unknown\" },\n                                                    color = \"Unknown\",\n                                                    createdDate = java.text.SimpleDateFormat(\"yyyy-MM-dd\", java.util.Locale.getDefault()).format(java.util.Date()),\n                                                    finalStatus = \"IN_PROGRESS\"\n                                                )\n                                            )\n                                            \n                                            // Ensure Operator record exists\n                                            val operator = repository.getOperatorById(operatorId)\n                                            if (operator == null) {\n                                                repository.insertOperator(\n                                                    Operator(\n                                                        id = operatorId,\n                                                        name = operatorName\n                                                    )\n                                                )\n                                            }\n                                            \n                                            val sessionId = repository.insertSession(\n                                                FQCSession(\n                                                    operatorId = operatorId,\n                                                    serialNumber = serial,\n                                                    status = \"active\"\n                                                )\n                                            )\n                                            currentSessionId = sessionId\n                                            currentSerialNumber = serial\n                                            android.util.Log.d(\"Navigation\", \"Session created successfully: $sessionId\")\n                                        } catch (e: Exception) {\n                                            android.util.Log.e(\"Navigation\", \"Error creating session\", e)\n                                        }\n                                    }\n                                }\n                            }\n                        )\n                    }\n                },\n                onDismiss = { showDeviceSelection = false }\n            )\n        }\n        \n        // Permission Request Dialog\n        if (showPermissionRequest && permissionHandler != null) {\n            PermissionRequestDialog(\n                missingPermissions = missingPermissions,\n                permissionExplanation = permissionHandler.getPermissionExplanation(missingPermissions),\n                onRequestPermissions = {\n                    permissionHandler.requestBluetoothPermissions { granted ->\n                        if (granted) {\n                            showPermissionRequest = false\n                            pendingSerialNumber?.let { serial ->\n                                simpleConnect(serial)\n                            }\n                        } else {\n                            // Permissions denied - show error\n                            showPermissionRequest = false\n                            errorMessage = \"Bluetooth permissions are required for automatic device connection.\\n\\nPlease grant Location permission from App Settings to enable this feature.\\n\\nYou can still use the app by selecting \\\"Continue Anyway\\\" when scanning.\"\n                            showConnectionError = true\n                        }\n                    }\n                },\n                onOpenSettings = {\n                    showPermissionRequest = false\n                    permissionHandler.openAppSettings()\n                },\n                onDismiss = {\n                    showPermissionRequest = false\n                    // Show error suggesting to continue without Bluetooth\n                    errorMessage = \"Bluetooth permissions not granted.\\n\\nYou can use \\\"Continue Anyway\\\" to skip automatic Bluetooth connection.\"\n                    showConnectionError = true\n                }\n            )\n        }\n        \n        // Serial Prefix Setup Dialog\n        if (showPrefixDialog) {\n            SerialPrefixSetupDialog(\n                currentPrefix = serialNumberPrefix,\n                onDismiss = { showPrefixDialog = false },\n                onSave = { prefix ->\n                    prefsManager.saveSerialNumberPrefix(prefix)\n                    serialNumberPrefix = prefix\n                }\n            )\n        }\n        \n        // Unpair Confirmation Dialog\n        if (showUnpairConfirmDialog) {\n            androidx.compose.material3.AlertDialog(\n                onDismissRequest = { showUnpairConfirmDialog = false },\n                icon = {\n                    androidx.compose.material3.Text(\"\", style = androidx.compose.material3.MaterialTheme.typography.headlineLarge)\n                },\n                title = { \n                    androidx.compose.material3.Text(\n                        \"Forget All Devices?\",\n                        fontWeight = androidx.compose.ui.text.font.FontWeight.Bold\n                    ) \n                },\n                text = { \n                    Column {\n                        androidx.compose.material3.Text(\n                            \"This will remove ALL paired Bluetooth devices from your phone's memory.\",\n                            style = androidx.compose.material3.MaterialTheme.typography.bodyMedium\n                        )\n                        Spacer(modifier = Modifier.height(12.dp))\n                        androidx.compose.material3.Text(\n                            \"Benefits:\",\n                            fontWeight = androidx.compose.ui.text.font.FontWeight.Bold,\n                            style = androidx.compose.material3.MaterialTheme.typography.bodyMedium\n                        )\n                        androidx.compose.material3.Text(\n                            \" Clears device storage limit\\n Fixes connection issues\\n Fresh start for new pairings\",\n                            style = androidx.compose.material3.MaterialTheme.typography.bodySmall\n                        )\n                        Spacer(modifier = Modifier.height(8.dp))\n                        androidx.compose.material3.Text(\n                            \"Are you sure?\",\n                            fontWeight = androidx.compose.ui.text.font.FontWeight.Bold,\n                            color = androidx.compose.ui.graphics.Color(0xFFFF5722)\n                        )\n                    }\n                },\n                confirmButton = {\n                    androidx.compose.material3.Button(\n                        onClick = {\n                            showUnpairConfirmDialog = false\n                            bluetoothService?.let { service ->\n                                val count = service.unpairAllDevices()\n                                unpairResult = if (count > 0) {\n                                    \" Successfully removed $count device(s) from memory!\\n\\nYour device storage is now clear and ready for new connections.\"\n                                } else {\n                                    \" No paired devices found.\\n\\nYour device memory is already clear!\"\n                                }\n                                showUnpairResultDialog = true\n                            } ?: run {\n                                unpairResult = \" Bluetooth service not available.\\n\\nPlease check Bluetooth permissions.\"\n                                showUnpairResultDialog = true\n                            }\n                        },\n                        colors = androidx.compose.material3.ButtonDefaults.buttonColors(\n                            containerColor = androidx.compose.ui.graphics.Color(0xFFFF5722)\n                        )\n                    ) {\n                        androidx.compose.material3.Text(\"Yes, Forget All\", fontWeight = androidx.compose.ui.text.font.FontWeight.Bold)\n                    }\n                },\n                dismissButton = {\n                    androidx.compose.material3.OutlinedButton(\n                        onClick = { showUnpairConfirmDialog = false }\n                    ) {\n                        androidx.compose.material3.Text(\"Cancel\")\n                    }\n                }\n            )\n        }\n        \n        // Unpair Result Dialog\n        if (showUnpairResultDialog) {\n            androidx.compose.material3.AlertDialog(\n                onDismissRequest = { showUnpairResultDialog = false },\n                title = { androidx.compose.material3.Text(\"Devices Removed\") },\n                text = { androidx.compose.material3.Text(unpairResult) },\n                confirmButton = {\n                    androidx.compose.material3.TextButton(\n                        onClick = { showUnpairResultDialog = false }\n                    ) {\n                        androidx.compose.material3.Text(\"OK\")\n                    }\n                }\n            )\n        }\n        \n        // Long Press Speed Dialog\n        if (showLongPressSpeedDialog) {\n            LongPressSpeedDialog(\n                currentSpeed = longPressSpeed,\n                onSpeedSelected = { newSpeed ->\n                    longPressSpeed = newSpeed\n                    prefsManager.saveLongPressSpeed(newSpeed)\n                },\n                onDismiss = { showLongPressSpeedDialog = false }\n            )\n        }\n    }\n}\n\n@OptIn(androidx.compose.material3.ExperimentalMaterial3Api::class)\n@Composable\nfun DatabaseViewerScreen(\n    repository: FQCRepository,\n    onBack: () -> Unit\n) {\n    val scope = rememberCoroutineScope()\n    val bgColor = Color(0xFF212121)\n    val surfaceColor = Color(0xFF2B2B2B)\n    val accentColor = Color(0xFFFFC107)\n    val textColor = Color.White\n    val dividerColor = Color(0xFF424242)\n    \n    var isLoading by remember { mutableStateOf(true) }\n    var expandedSections by remember { mutableStateOf<Set<String>>(setOf()) }\n    \n    // Data state\n    var devices by remember { mutableStateOf<List<Device>>(emptyList()) }\n    var operators by remember { mutableStateOf<List<Operator>>(emptyList()) }\n    var testSessions by remember { mutableStateOf<List<com.example.fqcapp.data.entities.TestSession>>(emptyList()) }\n    var frequencyTests by remember { mutableStateOf<List<com.example.fqcapp.data.entities.FrequencyTest>>(emptyList()) }\n    var songTests by remember { mutableStateOf<List<com.example.fqcapp.data.entities.SongTest>>(emptyList()) }\n    var fqcRecords by remember { mutableStateOf<List<com.example.fqcapp.data.entities.FQCRecord>>(emptyList()) }\n    var driverPairingRecords by remember { mutableStateOf<List<com.example.fqcapp.data.entities.DriverPairingRecord>>(emptyList()) }\n    var macIdCache by remember { mutableStateOf<List<com.example.fqcapp.data.entities.MacIdCache>>(emptyList()) }\n    var workflowEvents by remember { mutableStateOf<List<com.example.fqcapp.data.entities.DeviceWorkflow>>(emptyList()) }\n    \n    LaunchedEffect(Unit) {\n        scope.launch {\n            try {\n                withContext(Dispatchers.IO) {\n                    // Load all data\n                    devices = repository.getAllDevices().first()\n                    operators = repository.getAllOperators().first()\n                    testSessions = repository.getAllTestSessions()\n                    frequencyTests = repository.getAllFrequencyTests()\n                    songTests = repository.getAllSongTests()\n                    fqcRecords = repository.getAllFQCRecords()\n                    driverPairingRecords = repository.getAllDriverPairingRecords()\n                    macIdCache = repository.getAllCachedMacIds()\n                    // Load workflow events (get all, then sort by timestamp)\n                    workflowEvents = repository.getAllWorkflowEvents().sortedByDescending { it.timestamp }\n                    \n                    // Debug: Log loaded FQC records\n                    android.util.Log.d(\"DatabaseViewer\", \" Loaded ${fqcRecords.size} FQC records\")\n                    fqcRecords.forEachIndexed { index, record ->\n                        android.util.Log.d(\"DatabaseViewer\", \" FQC Record #${index + 1} (ID: ${record.fqcId}):\")\n                        android.util.Log.d(\"DatabaseViewer\", \"   Serial: '${record.serialNumber}'\")\n                        android.util.Log.d(\"DatabaseViewer\", \"   Operator: '${record.operatorName}'\")\n                        android.util.Log.d(\"DatabaseViewer\", \"   Final Quality Type: '${record.finalQualityType}'\")\n                        android.util.Log.d(\"DatabaseViewer\", \"   Criteria: '${record.criteriaChecked}'\")\n                        android.util.Log.d(\"DatabaseViewer\", \"   Entry: '${record.entryTimestamp}'\")\n                        android.util.Log.d(\"DatabaseViewer\", \"   Exit: '${record.exitTimestamp}'\")\n                        android.util.Log.d(\"DatabaseViewer\", \"   Time: '${record.totalTimeSpent}'\")\n                        android.util.Log.d(\"DatabaseViewer\", \"   Iteration: ${record.iterationNumber}\")\n                        android.util.Log.d(\"DatabaseViewer\", \"   FQC Type: '${record.fqcType}'\")\n                    }\n                }\n                isLoading = false\n            } catch (e: Exception) {\n                android.util.Log.e(\"DatabaseViewer\", \"Error loading database\", e)\n                isLoading = false\n            }\n        }\n    }\n    \n    Scaffold(\n        containerColor = bgColor,\n        topBar = {\n            TopAppBar(\n                title = { Text(\"Database Viewer\", color = textColor) },\n                navigationIcon = {\n                    IconButton(onClick = onBack) {\n                        Icon(\n                            imageVector = Icons.Filled.ArrowBack,\n                            contentDescription = \"Back\",\n                            tint = textColor\n                        )\n                    }\n                },\n                colors = TopAppBarDefaults.topAppBarColors(\n                    containerColor = surfaceColor,\n                    titleContentColor = textColor,\n                    navigationIconContentColor = textColor\n                )\n            )\n        }\n    ) { padding ->\n        if (isLoading) {\n            Box(\n                modifier = Modifier\n                    .fillMaxSize()\n                    .padding(padding),\n                contentAlignment = Alignment.Center\n            ) {\n                CircularProgressIndicator(color = accentColor)\n            }\n        } else {\n            Column(\n                modifier = Modifier\n                    .fillMaxSize()\n                    .padding(padding)\n                    .verticalScroll(rememberScrollState())\n                    .padding(16.dp),\n                verticalArrangement = Arrangement.spacedBy(12.dp)\n            ) {\n                // Summary Card\n                DatabaseSummaryCard(\n                    devices = devices,\n                    operators = operators,\n                    testSessions = testSessions,\n                    frequencyTests = frequencyTests,\n                    songTests = songTests,\n                    fqcRecords = fqcRecords,\n                    driverPairingRecords = driverPairingRecords,\n                    macIdCache = macIdCache,\n                    workflowEvents = workflowEvents,\n                    surfaceColor = surfaceColor,\n                    textColor = textColor\n                )\n                \n                // Devices Section\n                DatabaseSection(\n                    title = \"Devices\",\n                    count = devices.size,\n                    isExpanded = expandedSections.contains(\"devices\"),\n                    onExpandToggle = {\n                        expandedSections = if (expandedSections.contains(\"devices\")) {\n                            expandedSections - \"devices\"\n                        } else {\n                            expandedSections + \"devices\"\n                        }\n                    },\n                    surfaceColor = surfaceColor,\n                    textColor = textColor,\n                    accentColor = accentColor\n                ) {\n                    if (devices.isEmpty()) {\n                        Text(\"No devices found\", color = textColor.copy(alpha = 0.6f))\n                    } else {\n                        devices.forEach { device ->\n                            DeviceCard(device, surfaceColor, textColor)\n                        }\n                    }\n                }\n                \n                // Test Sessions Section\n                DatabaseSection(\n                    title = \"Test Sessions\",\n                    count = testSessions.size,\n                    isExpanded = expandedSections.contains(\"sessions\"),\n                    onExpandToggle = {\n                        expandedSections = if (expandedSections.contains(\"sessions\")) {\n                            expandedSections - \"sessions\"\n                        } else {\n                            expandedSections + \"sessions\"\n                        }\n                    },\n                    surfaceColor = surfaceColor,\n                    textColor = textColor,\n                    accentColor = accentColor\n                ) {\n                    if (testSessions.isEmpty()) {\n                        Text(\"No sessions found\", color = textColor.copy(alpha = 0.6f))\n                    } else {\n                        testSessions.forEach { session ->\n                            TestSessionCard(session, surfaceColor, textColor)\n                        }\n                    }\n                }\n                \n                // Frequency Tests Section\n                DatabaseSection(\n                    title = \"Frequency Tests\",\n                    count = frequencyTests.size,\n                    isExpanded = expandedSections.contains(\"frequency\"),\n                    onExpandToggle = {\n                        expandedSections = if (expandedSections.contains(\"frequency\")) {\n                            expandedSections - \"frequency\"\n                        } else {\n                            expandedSections + \"frequency\"\n                        }\n                    },\n                    surfaceColor = surfaceColor,\n                    textColor = textColor,\n                    accentColor = accentColor\n                ) {\n                    if (frequencyTests.isEmpty()) {\n                        Text(\"No frequency tests found\", color = textColor.copy(alpha = 0.6f))\n                    } else {\n                        frequencyTests.forEach { test ->\n                            FrequencyTestCard(test, surfaceColor, textColor)\n                        }\n                    }\n                }\n                \n                // Song Tests Section\n                DatabaseSection(\n                    title = \"Song Tests\",\n                    count = songTests.size,\n                    isExpanded = expandedSections.contains(\"songs\"),\n                    onExpandToggle = {\n                        expandedSections = if (expandedSections.contains(\"songs\")) {\n                            expandedSections - \"songs\"\n                        } else {\n                            expandedSections + \"songs\"\n                        }\n                    },\n                    surfaceColor = surfaceColor,\n                    textColor = textColor,\n                    accentColor = accentColor\n                ) {\n                    if (songTests.isEmpty()) {\n                        Text(\"No song tests found\", color = textColor.copy(alpha = 0.6f))\n                    } else {\n                        // Group song tests by serial number and iteration number\n                        val groupedTests = songTests.groupBy { \"${it.serialNumber}_${it.iterationNumber}\" }\n                        groupedTests.values.forEach { tests ->\n                            // Find overall review (isOverallResult = true)\n                            val overallReview = tests.find { it.isOverallResult }\n                            val individualSongs = tests.filter { !it.isOverallResult }.sortedByDescending { it.timestamp }\n                            \n                            if (overallReview != null) {\n                                // Display overall review with all details and individual songs\n                                SongTestCard(\n                                    overallReview = overallReview,\n                                    individualSongs = individualSongs,\n                                    surfaceColor = surfaceColor,\n                                    textColor = textColor\n                                )\n                                Spacer(modifier = Modifier.height(8.dp))\n                            } else {\n                                // If no overall review, just show individual songs\n                                individualSongs.forEach { song ->\n                                    IndividualSongCard(song, surfaceColor, textColor)\n                                    Spacer(modifier = Modifier.height(4.dp))\n                                }\n                            }\n                        }\n                    }\n                }\n                \n                // FQC Records Section\n                DatabaseSection(\n                    title = \"FQC Records\",\n                    count = fqcRecords.size,\n                    isExpanded = expandedSections.contains(\"fqc\"),\n                    onExpandToggle = {\n                        expandedSections = if (expandedSections.contains(\"fqc\")) {\n                            expandedSections - \"fqc\"\n                        } else {\n                            expandedSections + \"fqc\"\n                        }\n                    },\n                    surfaceColor = surfaceColor,\n                    textColor = textColor,\n                    accentColor = accentColor\n                ) {\n                    if (fqcRecords.isEmpty()) {\n                        Text(\"No FQC records found\", color = textColor.copy(alpha = 0.6f))\n                    } else {\n                        fqcRecords.forEach { record ->\n                            FQCRecordCard(record, surfaceColor, textColor)\n                        }\n                    }\n                }\n                \n                // Driver Pairing Records Section\n                DatabaseSection(\n                    title = \"Driver Pairing Records\",\n                    count = driverPairingRecords.size,\n                    isExpanded = expandedSections.contains(\"driverPairing\"),\n                    onExpandToggle = {\n                        expandedSections = if (expandedSections.contains(\"driverPairing\")) {\n                            expandedSections - \"driverPairing\"\n                        } else {\n                            expandedSections + \"driverPairing\"\n                        }\n                    },\n                    surfaceColor = surfaceColor,\n                    textColor = textColor,\n                    accentColor = accentColor\n                ) {\n                    if (driverPairingRecords.isEmpty()) {\n                        Text(\"No driver pairing records found\", color = textColor.copy(alpha = 0.6f))\n                    } else {\n                        driverPairingRecords.forEach { record ->\n                            DriverPairingRecordCard(record, surfaceColor, textColor)\n                        }\n                    }\n                }\n                \n                // Workflow Events Section (NEW - Shows audit trail)\n                DatabaseSection(\n                    title = \"Workflow Events (Audit Trail)\",\n                    count = workflowEvents.size,\n                    isExpanded = expandedSections.contains(\"workflow\"),\n                    onExpandToggle = {\n                        expandedSections = if (expandedSections.contains(\"workflow\")) {\n                            expandedSections - \"workflow\"\n                        } else {\n                            expandedSections + \"workflow\"\n                        }\n                    },\n                    surfaceColor = surfaceColor,\n                    textColor = textColor,\n                    accentColor = accentColor\n                ) {\n                    if (workflowEvents.isEmpty()) {\n                        Text(\"No workflow events found\", color = textColor.copy(alpha = 0.6f))\n                    } else {\n                        // Group by device serial for easier viewing\n                        val groupedByDevice = workflowEvents.groupBy { it.serialNumber }\n                        groupedByDevice.forEach { (serial, events) ->\n                            Text(\n                                \"Device: $serial (${events.size} events)\",\n                                color = accentColor,\n                                fontWeight = FontWeight.Bold,\n                                fontSize = 13.sp,\n                                modifier = Modifier.padding(vertical = 8.dp)\n                            )\n                            events.forEach { event ->\n                                WorkflowEventCard(event, surfaceColor, textColor)\n                            }\n                            Spacer(modifier = Modifier.height(8.dp))\n                        }\n                    }\n                }\n                \n                // Operators Section\n                DatabaseSection(\n                    title = \"Operators\",\n                    count = operators.size,\n                    isExpanded = expandedSections.contains(\"operators\"),\n                    onExpandToggle = {\n                        expandedSections = if (expandedSections.contains(\"operators\")) {\n                            expandedSections - \"operators\"\n                        } else {\n                            expandedSections + \"operators\"\n                        }\n                    },\n                    surfaceColor = surfaceColor,\n                    textColor = textColor,\n                    accentColor = accentColor\n                ) {\n                    if (operators.isEmpty()) {\n                        Text(\"No operators found\", color = textColor.copy(alpha = 0.6f))\n                    } else {\n                        operators.forEach { operator ->\n                            OperatorCard(operator, surfaceColor, textColor)\n                        }\n                    }\n                }\n                \n                // MAC ID Cache Section\n                DatabaseSection(\n                    title = \"MAC ID Cache\",\n                    count = macIdCache.size,\n                    isExpanded = expandedSections.contains(\"mac\"),\n                    onExpandToggle = {\n                        expandedSections = if (expandedSections.contains(\"mac\")) {\n                            expandedSections - \"mac\"\n                        } else {\n                            expandedSections + \"mac\"\n                        }\n                    },\n                    surfaceColor = surfaceColor,\n                    textColor = textColor,\n                    accentColor = accentColor\n                ) {\n                    if (macIdCache.isEmpty()) {\n                        Text(\"No MAC ID cache entries\", color = textColor.copy(alpha = 0.6f))\n                    } else {\n                        macIdCache.forEach { cache ->\n                            MacIdCacheCard(cache, surfaceColor, textColor)\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n@Composable\nfun DatabaseSummaryCard(\n    devices: List<Device>,\n    operators: List<Operator>,\n    testSessions: List<com.example.fqcapp.data.entities.TestSession>,\n    frequencyTests: List<com.example.fqcapp.data.entities.FrequencyTest>,\n    songTests: List<com.example.fqcapp.data.entities.SongTest>,\n    fqcRecords: List<com.example.fqcapp.data.entities.FQCRecord>,\n    driverPairingRecords: List<com.example.fqcapp.data.entities.DriverPairingRecord>,\n    macIdCache: List<com.example.fqcapp.data.entities.MacIdCache>,\n    workflowEvents: List<com.example.fqcapp.data.entities.DeviceWorkflow>,\n    surfaceColor: Color,\n    textColor: Color\n) {\n    Surface(\n        modifier = Modifier.fillMaxWidth(),\n        color = surfaceColor,\n        shape = RoundedCornerShape(12.dp)\n    ) {\n        Column(modifier = Modifier.padding(16.dp)) {\n            Text(\n                text = \"Database Summary\",\n                style = MaterialTheme.typography.titleLarge,\n                color = textColor,\n                fontWeight = FontWeight.Bold\n            )\n            Spacer(modifier = Modifier.height(12.dp))\n            DatabaseSummaryRow(\"Devices\", devices.size.toString(), textColor)\n            DatabaseSummaryRow(\"Test Sessions\", testSessions.size.toString(), textColor)\n            DatabaseSummaryRow(\"Frequency Tests\", frequencyTests.size.toString(), textColor)\n            DatabaseSummaryRow(\"Song Tests\", songTests.size.toString(), textColor)\n            DatabaseSummaryRow(\"FQC Records\", fqcRecords.size.toString(), textColor)\n            DatabaseSummaryRow(\"Driver Pairing Records\", driverPairingRecords.size.toString(), textColor)\n            DatabaseSummaryRow(\"Workflow Events\", workflowEvents.size.toString(), textColor)\n            DatabaseSummaryRow(\"Operators\", operators.size.toString(), textColor)\n            DatabaseSummaryRow(\"MAC ID Cache\", macIdCache.size.toString(), textColor)\n        }\n    }\n}\n\n@Composable\nfun DatabaseSummaryRow(label: String, value: String, textColor: Color) {\n    Row(\n        modifier = Modifier\n            .fillMaxWidth()\n            .padding(vertical = 4.dp),\n        horizontalArrangement = Arrangement.SpaceBetween\n    ) {\n        Text(label, color = textColor.copy(alpha = 0.7f))\n        Text(value, color = textColor, fontWeight = FontWeight.Bold)\n    }\n}\n\n@Composable\nfun DatabaseSection(\n    title: String,\n    count: Int,\n    isExpanded: Boolean,\n    onExpandToggle: () -> Unit,\n    surfaceColor: Color,\n    textColor: Color,\n    accentColor: Color,\n    content: @Composable () -> Unit\n) {\n    val dividerColor = Color(0xFF424242)\n    Surface(\n        modifier = Modifier.fillMaxWidth(),\n        color = surfaceColor,\n        shape = RoundedCornerShape(12.dp)\n    ) {\n        Column {\n            Row(\n                modifier = Modifier\n                    .fillMaxWidth()\n                    .clickable(onClick = onExpandToggle)\n                    .padding(16.dp),\n                horizontalArrangement = Arrangement.SpaceBetween,\n                verticalAlignment = Alignment.CenterVertically\n            ) {\n                Text(\n                    text = \"$title ($count)\",\n                    style = MaterialTheme.typography.titleMedium,\n                    color = textColor,\n                    fontWeight = FontWeight.Bold\n                )\n                Icon(\n                    imageVector = if (isExpanded) Icons.Filled.ExpandLess else Icons.Filled.ExpandMore,\n                    contentDescription = if (isExpanded) \"Collapse\" else \"Expand\",\n                    tint = accentColor\n                )\n            }\n            \n            if (isExpanded) {\n                Divider(color = dividerColor)\n                Column(\n                    modifier = Modifier\n                        .fillMaxWidth()\n                        .padding(12.dp),\n                    verticalArrangement = Arrangement.spacedBy(8.dp)\n                ) {\n                    content()\n                }\n            }\n        }\n    }\n}\n\n@Composable\nfun DeviceCard(\n    device: Device, \n    surfaceColor: Color, \n    textColor: Color,\n    macId: String? = null  // Optional MAC ID (derived from active PCB link if provided)\n) {\n    Surface(\n        modifier = Modifier.fillMaxWidth(),\n        color = surfaceColor.copy(alpha = 0.5f),\n        shape = RoundedCornerShape(8.dp)\n    ) {\n        Column(modifier = Modifier.padding(12.dp)) {\n            Text(\n                text = device.serialNumber,\n                style = MaterialTheme.typography.titleSmall,\n                color = textColor,\n                fontWeight = FontWeight.Bold\n            )\n            Spacer(modifier = Modifier.height(4.dp))\n            // Use provided MAC ID (from PCB link) or fallback to deprecated device.macId\n            val displayMacId = macId ?: (if (device.macId.isNotBlank()) device.macId else \"N/A\")\n            Text(\"MAC: $displayMacId\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n            Text(\"Color: ${device.color}\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n            Text(\"Status: ${device.finalStatus}\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n            Text(\"Iterations: ${device.totalIterations}\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n        }\n    }\n}\n\n@Composable\nfun TestSessionCard(session: com.example.fqcapp.data.entities.TestSession, surfaceColor: Color, textColor: Color) {\n    Surface(\n        modifier = Modifier.fillMaxWidth(),\n        color = surfaceColor.copy(alpha = 0.5f),\n        shape = RoundedCornerShape(8.dp)\n    ) {\n        Column(modifier = Modifier.padding(12.dp)) {\n            Text(\n                text = \"Session #${session.sessionId}\",\n                style = MaterialTheme.typography.titleSmall,\n                color = textColor,\n                fontWeight = FontWeight.Bold\n            )\n            Spacer(modifier = Modifier.height(4.dp))\n            Text(\"Serial: ${session.serialNumber}\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n            Text(\"Operator: ${session.operatorName}\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n            Text(\"Status: ${session.status}\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n            Text(\"Start: ${session.startTimestamp}\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n            session.endTimestamp?.let {\n                Text(\"End: $it\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n            }\n            if (session.hasTestSubmission) {\n                Text(\" Has Submission\", color = Color(0xFF4CAF50), fontSize = 12.sp, fontWeight = FontWeight.Bold)\n            }\n        }\n    }\n}\n\n@Composable\nfun FrequencyTestCard(test: com.example.fqcapp.data.entities.FrequencyTest, surfaceColor: Color, textColor: Color) {\n    Surface(\n        modifier = Modifier.fillMaxWidth(),\n        color = surfaceColor.copy(alpha = 0.5f),\n        shape = RoundedCornerShape(8.dp)\n    ) {\n        Column(modifier = Modifier.padding(12.dp)) {\n            Row(\n                modifier = Modifier.fillMaxWidth(),\n                horizontalArrangement = Arrangement.SpaceBetween,\n                verticalAlignment = Alignment.CenterVertically\n            ) {\n                Text(\n                    text = \"Test #${test.testId}\",\n                    style = MaterialTheme.typography.titleSmall,\n                    color = textColor,\n                    fontWeight = FontWeight.Bold\n                )\n                Text(\n                    text = test.result,\n                    color = if (test.result == \"PASS\") Color(0xFF4CAF50) else Color(0xFFFF5722),\n                    fontWeight = FontWeight.Bold,\n                    fontSize = 12.sp\n                )\n            }\n            Spacer(modifier = Modifier.height(4.dp))\n            Text(\"Serial: ${test.serialNumber}\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n            Text(\"Operator: ${test.operatorName}\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n            Text(\"Entry: ${test.entryTimestamp}\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n            Text(\"Exit: ${test.exitTimestamp}\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n            Text(\"Time Spent: ${test.totalTimeSpent}\", color = textColor.copy(alpha = 0.9f), fontSize = 13.sp, fontWeight = FontWeight.Medium)\n            Text(\"Iteration: ${test.iterationNumber}\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n            Text(\"Result: ${test.result}\", color = if (test.result == \"PASS\") Color(0xFF4CAF50) else if (test.result == \"CAN_BE_PASSED\") Color(0xFFFFC107) else Color(0xFFFF5722), fontSize = 12.sp, fontWeight = FontWeight.Medium)\n            if (test.issues.isNotBlank()) {\n                Text(\"Issues: ${test.issues}\", color = textColor.copy(alpha = 0.7f), fontSize = 11.sp, maxLines = 2)\n            }\n            if (test.solutions.isNotBlank()) {\n                Text(\"Solutions: ${test.solutions}\", color = textColor.copy(alpha = 0.7f), fontSize = 11.sp, maxLines = 2)\n            }\n            if (test.remark.isNotBlank()) {\n                Text(\"Remark: ${test.remark}\", color = textColor.copy(alpha = 0.7f), fontSize = 11.sp, maxLines = 2)\n            }\n        }\n    }\n}\n\n@Composable\nfun SongTestCard(\n    overallReview: com.example.fqcapp.data.entities.SongTest,\n    individualSongs: List<com.example.fqcapp.data.entities.SongTest>,\n    surfaceColor: Color,\n    textColor: Color\n) {\n    Surface(\n        modifier = Modifier.fillMaxWidth(),\n        color = surfaceColor.copy(alpha = 0.5f),\n        shape = RoundedCornerShape(8.dp)\n    ) {\n        Column(modifier = Modifier.padding(12.dp)) {\n            // Overall Review Header\n            Row(\n                modifier = Modifier.fillMaxWidth(),\n                horizontalArrangement = Arrangement.SpaceBetween,\n                verticalAlignment = Alignment.CenterVertically\n            ) {\n                Text(\n                    text = \"OVERALL HEADPHONE REVIEW\",\n                    style = MaterialTheme.typography.titleSmall,\n                    color = textColor,\n                    fontWeight = FontWeight.Bold\n                )\n                Text(\n                    text = overallReview.result,\n                    color = when (overallReview.result.uppercase()) {\n                        \"PASS\" -> Color(0xFF4CAF50)\n                        \"CAN_BE_PASSED\", \"CAN_PASS\" -> Color(0xFFFFC107)\n                        else -> Color(0xFFFF5722)\n                    },\n                    fontWeight = FontWeight.Bold,\n                    fontSize = 12.sp\n                )\n            }\n            \n            Divider(modifier = Modifier.padding(vertical = 8.dp), color = textColor.copy(alpha = 0.3f))\n            \n            // Basic Info\n            Text(\"Serial: ${overallReview.serialNumber}\", color = textColor.copy(alpha = 0.9f), fontSize = 12.sp, fontWeight = FontWeight.Medium)\n            Text(\"Operator: ${overallReview.operatorName}\", color = textColor.copy(alpha = 0.9f), fontSize = 12.sp, fontWeight = FontWeight.Medium)\n            Text(\"Iteration: ${overallReview.iterationNumber}\", color = textColor.copy(alpha = 0.9f), fontSize = 12.sp, fontWeight = FontWeight.Medium)\n            \n            Spacer(modifier = Modifier.height(4.dp))\n            \n            // Entry/Exit Timestamps and Total Time\n            if (overallReview.entryTimestamp.isNotBlank()) {\n                Text(\"Entry: ${overallReview.entryTimestamp}\", color = textColor.copy(alpha = 0.8f), fontSize = 11.sp)\n            }\n            if (overallReview.exitTimestamp.isNotBlank()) {\n                Text(\"Exit: ${overallReview.exitTimestamp}\", color = textColor.copy(alpha = 0.8f), fontSize = 11.sp)\n            }\n            if (overallReview.totalTimeSpent.isNotBlank() && overallReview.totalTimeSpent != \"00:00:00\") {\n                Text(\"Time Spent: ${overallReview.totalTimeSpent}\", color = textColor.copy(alpha = 0.8f), fontSize = 11.sp, fontWeight = FontWeight.Medium)\n            }\n            \n            Spacer(modifier = Modifier.height(4.dp))\n            \n            // Result\n            Text(\"Result: ${overallReview.result}\", \n                color = when (overallReview.result.uppercase()) {\n                    \"PASS\" -> Color(0xFF4CAF50)\n                    \"CAN_BE_PASSED\", \"CAN_PASS\" -> Color(0xFFFFC107)\n                    else -> Color(0xFFFF5722)\n                },\n                fontSize = 12.sp,\n                fontWeight = FontWeight.Bold\n            )\n            \n            // Issues\n            if (overallReview.issues.isNotBlank() && overallReview.issues != \"[]\") {\n                Spacer(modifier = Modifier.height(4.dp))\n                Text(\"Issues:\", color = textColor.copy(alpha = 0.9f), fontSize = 11.sp, fontWeight = FontWeight.Medium)\n                Text(overallReview.issues, color = textColor.copy(alpha = 0.8f), fontSize = 11.sp)\n            }\n            \n            // Solutions\n            if (overallReview.solutions.isNotBlank() && overallReview.solutions != \"[]\") {\n                Spacer(modifier = Modifier.height(4.dp))\n                Text(\"Solutions:\", color = textColor.copy(alpha = 0.9f), fontSize = 11.sp, fontWeight = FontWeight.Medium)\n                Text(overallReview.solutions, color = textColor.copy(alpha = 0.8f), fontSize = 11.sp)\n            }\n            \n            // Remark\n            if (overallReview.remark.isNotBlank()) {\n                Spacer(modifier = Modifier.height(4.dp))\n                Text(\"Remark:\", color = textColor.copy(alpha = 0.9f), fontSize = 11.sp, fontWeight = FontWeight.Medium)\n                Text(overallReview.remark, color = textColor.copy(alpha = 0.8f), fontSize = 11.sp)\n            }\n            \n            // Individual Songs Tested\n            if (individualSongs.isNotEmpty()) {\n                Spacer(modifier = Modifier.height(8.dp))\n                Divider(modifier = Modifier.padding(vertical = 4.dp), color = textColor.copy(alpha = 0.3f))\n                Text(\n                    \"Individual Songs Tested (${individualSongs.size}):\",\n                    color = textColor.copy(alpha = 0.9f),\n                    fontSize = 12.sp,\n                    fontWeight = FontWeight.Bold\n                )\n                Spacer(modifier = Modifier.height(4.dp))\n                individualSongs.forEachIndexed { index, song ->\n                    IndividualSongCard(song, surfaceColor.copy(alpha = 0.3f), textColor)\n                    if (index < individualSongs.size - 1) {\n                        Spacer(modifier = Modifier.height(4.dp))\n                    }\n                }\n            } else {\n                Spacer(modifier = Modifier.height(4.dp))\n                Text(\"No individual songs tested\", color = textColor.copy(alpha = 0.5f), fontSize = 11.sp, fontStyle = FontStyle.Italic)\n            }\n        }\n    }\n}\n\n@Composable\nfun IndividualSongCard(song: com.example.fqcapp.data.entities.SongTest, surfaceColor: Color, textColor: Color) {\n    Surface(\n        modifier = Modifier.fillMaxWidth(),\n        color = surfaceColor,\n        shape = RoundedCornerShape(6.dp)\n    ) {\n        Column(modifier = Modifier.padding(8.dp)) {\n            Row(\n                modifier = Modifier.fillMaxWidth(),\n                horizontalArrangement = Arrangement.SpaceBetween,\n                verticalAlignment = Alignment.CenterVertically\n            ) {\n                Text(\n                    text = \" ${song.songName}\",\n                    style = MaterialTheme.typography.bodySmall,\n                    color = textColor,\n                    fontWeight = FontWeight.SemiBold,\n                    fontSize = 11.sp\n                )\n                Text(\n                    text = song.result,\n                    color = when (song.result.uppercase()) {\n                        \"PASS\" -> Color(0xFF4CAF50)\n                        \"CAN_BE_PASSED\", \"CAN_PASS\" -> Color(0xFFFFC107)\n                        else -> Color(0xFFFF5722)\n                    },\n                    fontWeight = FontWeight.Bold,\n                    fontSize = 10.sp\n                )\n            }\n            if (song.issues.isNotBlank() && song.issues != \"[]\") {\n                Spacer(modifier = Modifier.height(2.dp))\n                Text(\"Issues: ${song.issues}\", color = textColor.copy(alpha = 0.7f), fontSize = 10.sp)\n            }\n        }\n    }\n}\n\n@Composable\nfun FQCRecordCard(record: com.example.fqcapp.data.entities.FQCRecord, surfaceColor: Color, textColor: Color) {\n    Surface(\n        modifier = Modifier.fillMaxWidth(),\n        color = surfaceColor.copy(alpha = 0.5f),\n        shape = RoundedCornerShape(8.dp)\n    ) {\n        Column(modifier = Modifier.padding(12.dp)) {\n            Row(\n                modifier = Modifier.fillMaxWidth(),\n                horizontalArrangement = Arrangement.SpaceBetween,\n                verticalAlignment = Alignment.CenterVertically\n            ) {\n                Column {\n                    Text(\n                        text = \"FQC #${record.fqcId}\",\n                        style = MaterialTheme.typography.titleSmall,\n                        color = textColor,\n                        fontWeight = FontWeight.Bold\n                    )\n                    // Display Final Headphone Quality in header if available\n                    if (record.finalQualityType.isNotBlank()) {\n                        Text(\n                            text = \"Final Headphone Quality: ${record.finalQualityType}\",\n                            color = when (record.finalQualityType.uppercase()) {\n                                \"REVIEWER\" -> Color(0xFF4CAF50)\n                                \"CUSTOMER\" -> Color(0xFFFFC107)\n                                \"INTERNATIONAL\" -> Color(0xFF2196F3)\n                                \"MARKETING\" -> Color(0xFF9C27B0)\n                                else -> textColor.copy(alpha = 0.8f)\n                            },\n                            fontSize = 11.sp,\n                            fontWeight = FontWeight.SemiBold\n                        )\n                    }\n                }\n                Text(\n                    text = record.overallResult,\n                    color = if (record.overallResult == \"PASS\") Color(0xFF4CAF50) else Color(0xFFFF5722),\n                    fontWeight = FontWeight.Bold,\n                    fontSize = 12.sp\n                )\n            }\n            \n            Divider(modifier = Modifier.padding(vertical = 8.dp), color = textColor.copy(alpha = 0.3f))\n            \n            // Basic Info\n            Text(\"Serial: ${record.serialNumber}\", color = textColor.copy(alpha = 0.9f), fontSize = 12.sp, fontWeight = FontWeight.Medium)\n            Text(\"Operator: ${record.operatorName}\", color = textColor.copy(alpha = 0.9f), fontSize = 12.sp, fontWeight = FontWeight.Medium)\n            if (record.iterationNumber > 0) {\n                Text(\"Iteration: ${record.iterationNumber}\", color = textColor.copy(alpha = 0.9f), fontSize = 12.sp, fontWeight = FontWeight.Medium)\n            }\n            \n            Spacer(modifier = Modifier.height(4.dp))\n            \n            // Entry/Exit Timestamps and Total Time\n            if (record.entryTimestamp.isNotBlank()) {\n                Text(\"Entry: ${record.entryTimestamp}\", color = textColor.copy(alpha = 0.8f), fontSize = 11.sp)\n            }\n            if (record.exitTimestamp.isNotBlank()) {\n                Text(\"Exit: ${record.exitTimestamp}\", color = textColor.copy(alpha = 0.8f), fontSize = 11.sp)\n            }\n            if (record.totalTimeSpent.isNotBlank() && record.totalTimeSpent != \"00:00:00\") {\n                Text(\"Time Spent: ${record.totalTimeSpent}\", color = textColor.copy(alpha = 0.8f), fontSize = 11.sp, fontWeight = FontWeight.Medium)\n            }\n            \n            Spacer(modifier = Modifier.height(4.dp))\n            \n            // Final Headphone Quality (also displayed in header, but show here again for clarity)\n            if (record.finalQualityType.isNotBlank()) {\n                Text(\n                    \"Final Headphone Quality: ${record.finalQualityType}\",\n                    color = when (record.finalQualityType.uppercase()) {\n                        \"REVIEWER\" -> Color(0xFF4CAF50)\n                        \"CUSTOMER\" -> Color(0xFFFFC107)\n                        \"INTERNATIONAL\" -> Color(0xFF2196F3)\n                        \"MARKETING\" -> Color(0xFF9C27B0)\n                        else -> textColor\n                    },\n                    fontSize = 13.sp,\n                    fontWeight = FontWeight.Bold\n                )\n                Spacer(modifier = Modifier.height(4.dp))\n            } else {\n                Text(\"Final Headphone Quality: Not Set\", color = textColor.copy(alpha = 0.6f), fontSize = 12.sp, fontStyle = FontStyle.Italic)\n                Spacer(modifier = Modifier.height(4.dp))\n            }\n            \n            // Criteria Checked\n            if (record.criteriaChecked.isNotBlank() && record.criteriaChecked != \"[]\") {\n                Spacer(modifier = Modifier.height(4.dp))\n                Text(\"Criteria Checked:\", color = textColor.copy(alpha = 0.9f), fontSize = 11.sp, fontWeight = FontWeight.Medium)\n                Text(record.criteriaChecked, color = textColor.copy(alpha = 0.8f), fontSize = 11.sp)\n            }\n            \n            // Legacy fields (for backward compatibility)\n            if (record.fqcType.isNotBlank()) {\n                Spacer(modifier = Modifier.height(4.dp))\n                Text(\"Type: ${record.fqcType}\", color = textColor.copy(alpha = 0.7f), fontSize = 11.sp)\n            }\n            if (record.timestamp.isNotBlank()) {\n                Text(\"Timestamp: ${record.timestamp}\", color = textColor.copy(alpha = 0.7f), fontSize = 11.sp)\n            }\n        }\n    }\n}\n\n@Composable\nfun DriverPairingRecordCard(record: com.example.fqcapp.data.entities.DriverPairingRecord, surfaceColor: Color, textColor: Color) {\n    Surface(\n        modifier = Modifier.fillMaxWidth(),\n        color = surfaceColor.copy(alpha = 0.5f),\n        shape = RoundedCornerShape(8.dp)\n    ) {\n        Column(modifier = Modifier.padding(12.dp)) {\n            Row(\n                modifier = Modifier.fillMaxWidth(),\n                horizontalArrangement = Arrangement.SpaceBetween,\n                verticalAlignment = Alignment.CenterVertically\n            ) {\n                Text(\n                    text = \"Driver Pairing #${record.recordId}\",\n                    style = MaterialTheme.typography.titleSmall,\n                    color = textColor,\n                    fontWeight = FontWeight.Bold\n                )\n                if (record.iterationNumber > 0) {\n                    Text(\n                        text = \"Iteration ${record.iterationNumber}\",\n                        color = textColor.copy(alpha = 0.7f),\n                        fontSize = 11.sp,\n                        fontWeight = FontWeight.Medium\n                    )\n                }\n            }\n            \n            Divider(modifier = Modifier.padding(vertical = 8.dp), color = textColor.copy(alpha = 0.3f))\n            \n            // Basic Info\n            Text(\"Serial: ${record.serialNumber}\", color = textColor.copy(alpha = 0.9f), fontSize = 12.sp, fontWeight = FontWeight.Medium)\n            Text(\"Operator: ${record.operatorName}\", color = textColor.copy(alpha = 0.9f), fontSize = 12.sp, fontWeight = FontWeight.Medium)\n            \n            Spacer(modifier = Modifier.height(4.dp))\n            \n            // Entry/Exit Timestamps and Total Time\n            if (record.entryTimestamp.isNotBlank()) {\n                Text(\"Entry: ${record.entryTimestamp}\", color = textColor.copy(alpha = 0.8f), fontSize = 11.sp)\n            }\n            if (record.exitTimestamp.isNotBlank()) {\n                Text(\"Exit: ${record.exitTimestamp}\", color = textColor.copy(alpha = 0.8f), fontSize = 11.sp)\n            }\n            if (record.totalTimeSpent.isNotBlank() && record.totalTimeSpent != \"00:00:00\") {\n                Text(\"Time Spent: ${record.totalTimeSpent}\", color = textColor.copy(alpha = 0.8f), fontSize = 11.sp, fontWeight = FontWeight.Medium)\n            }\n            \n            // Driver Data\n            if (record.driverData.isNotBlank() && record.driverData != \"[]\") {\n                Spacer(modifier = Modifier.height(4.dp))\n                Text(\"Driver Pairs:\", color = textColor.copy(alpha = 0.9f), fontSize = 11.sp, fontWeight = FontWeight.Medium)\n                Text(record.driverData, color = textColor.copy(alpha = 0.8f), fontSize = 11.sp)\n            }\n            \n            // Legacy timestamp (for backward compatibility)\n            if (record.timestamp.isNotBlank()) {\n                Spacer(modifier = Modifier.height(4.dp))\n                Text(\"Timestamp: ${record.timestamp}\", color = textColor.copy(alpha = 0.7f), fontSize = 10.sp)\n            }\n        }\n    }\n}\n\n@Composable\nfun OperatorCard(operator: Operator, surfaceColor: Color, textColor: Color) {\n    Surface(\n        modifier = Modifier.fillMaxWidth(),\n        color = surfaceColor.copy(alpha = 0.5f),\n        shape = RoundedCornerShape(8.dp)\n    ) {\n        Row(\n            modifier = Modifier\n                .fillMaxWidth()\n                .padding(12.dp),\n            horizontalArrangement = Arrangement.SpaceBetween,\n            verticalAlignment = Alignment.CenterVertically\n        ) {\n            Text(\n                text = operator.name,\n                style = MaterialTheme.typography.titleSmall,\n                color = textColor,\n                fontWeight = FontWeight.Bold\n            )\n            Text(\n                text = \"ID: ${operator.id}\",\n                color = textColor.copy(alpha = 0.7f),\n                fontSize = 12.sp\n            )\n        }\n    }\n}\n\n@Composable\nfun MacIdCacheCard(cache: com.example.fqcapp.data.entities.MacIdCache, surfaceColor: Color, textColor: Color) {\n    Surface(\n        modifier = Modifier.fillMaxWidth(),\n        color = surfaceColor.copy(alpha = 0.5f),\n        shape = RoundedCornerShape(8.dp)\n    ) {\n        Column(modifier = Modifier.padding(12.dp)) {\n            Text(\n                text = cache.serialNumber,\n                style = MaterialTheme.typography.titleSmall,\n                color = textColor,\n                fontWeight = FontWeight.Bold\n            )\n            Spacer(modifier = Modifier.height(4.dp))\n            Text(\"MAC: ${cache.macAddress}\", color = textColor.copy(alpha = 0.7f), fontSize = 12.sp)\n        }\n    }\n}\n\n@Composable\nfun WorkflowEventCard(event: com.example.fqcapp.data.entities.DeviceWorkflow, surfaceColor: Color, textColor: Color) {\n    Surface(\n        modifier = Modifier.fillMaxWidth(),\n        color = surfaceColor.copy(alpha = 0.5f),\n        shape = RoundedCornerShape(8.dp)\n    ) {\n        Column(modifier = Modifier.padding(12.dp)) {\n            Row(\n                modifier = Modifier.fillMaxWidth(),\n                horizontalArrangement = Arrangement.SpaceBetween,\n                verticalAlignment = Alignment.CenterVertically\n            ) {\n                Column {\n                    Text(\n                        text = event.stage,\n                        style = MaterialTheme.typography.titleSmall,\n                        color = textColor,\n                        fontWeight = FontWeight.Bold\n                    )\n                    Text(\n                        text = event.action,\n                        color = when (event.action) {\n                            \"STARTED\" -> Color(0xFF2196F3) // Blue\n                            \"COMPLETED\" -> Color(0xFF4CAF50) // Green\n                            \"FAILED\" -> Color(0xFFFF5722) // Red\n                            else -> textColor.copy(alpha = 0.7f)\n                        },\n                        fontSize = 11.sp,\n                        fontWeight = FontWeight.Medium\n                    )\n                }\n                if (event.result != null) {\n                    Text(\n                        text = event.result,\n                        color = when (event.result.uppercase()) {\n                            \"PASS\" -> Color(0xFF4CAF50) // Green\n                            \"FAIL\" -> Color(0xFFFF5722) // Red\n                            \"CAN_PASS\", \"CAN_BE_PASSED\" -> Color(0xFFFFC107) // Yellow\n                            else -> textColor\n                        },\n                        fontSize = 12.sp,\n                        fontWeight = FontWeight.Bold\n                    )\n                }\n            }\n            \n            Spacer(modifier = Modifier.height(4.dp))\n            Divider(color = textColor.copy(alpha = 0.3f))\n            Spacer(modifier = Modifier.height(4.dp))\n            \n            // Operator and Serial\n            Text(\"Operator: ${event.operatorName}\", color = textColor.copy(alpha = 0.9f), fontSize = 12.sp, fontWeight = FontWeight.Medium)\n            Text(\"Serial: ${event.serialNumber}\", color = textColor.copy(alpha = 0.9f), fontSize = 12.sp, fontWeight = FontWeight.Medium)\n            \n            Spacer(modifier = Modifier.height(4.dp))\n            \n            // Iteration and Timestamp\n            if (event.iterationNumber > 0) {\n                Text(\"Iteration: ${event.iterationNumber}\", color = textColor.copy(alpha = 0.8f), fontSize = 11.sp)\n            }\n            \n            // Format timestamp\n            val timestampFormat = java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.getDefault())\n            val timestampStr = timestampFormat.format(java.util.Date(event.timestamp))\n            Text(\"Time: $timestampStr\", color = textColor.copy(alpha = 0.7f), fontSize = 11.sp)\n            \n            // Milestone Status (if available)\n            if (event.milestoneStatus != null) {\n                Spacer(modifier = Modifier.height(4.dp))\n                Text(\n                    text = \"Milestone: ${event.milestoneStatus}\",\n                    color = when (event.milestoneStatus) {\n                        \"pass\" -> Color(0xFF4CAF50)\n                        \"fail\" -> Color(0xFFFF5722)\n                        \"can_pass\" -> Color(0xFFFFC107)\n                        else -> textColor.copy(alpha = 0.6f)\n                    },\n                    fontSize = 11.sp,\n                    fontWeight = FontWeight.Medium\n                )\n            }\n            \n            // Record ID (if available)\n            if (event.recordId != null) {\n                Text(\"Record ID: ${event.recordId}\", color = textColor.copy(alpha = 0.6f), fontSize = 10.sp)\n            }\n            \n            // Sync status\n            if (event.syncedToSupabase) {\n                Text(\" Synced to Supabase\", color = Color(0xFF4CAF50), fontSize = 10.sp)\n            } else {\n                Text(\" Not synced\", color = Color(0xFFFFC107), fontSize = 10.sp)\n            }\n        }\n    }\n}\n\n@Composable\nprivate fun AppNavGraph(\n    nav: NavHostController,\n    operatorName: String,\n    currentSerialNumber: String?,\n    currentMacAddress: String,\n    connectedDeviceName: String?,\n    serialNumberPrefix: String,\n    longPressSpeed: Int,\n    onLogout: () -> Unit,\n    onOpenDrawer: () -> Unit,\n    onSerialNumberScanned: (String, String?) -> Unit,  // (serialNumber, macIdOverride)\n    currentSessionId: Long?,\n    repository: FQCRepository,\n    paddingValues: androidx.compose.foundation.layout.PaddingValues,\n    activity: ComponentActivity,\n    permissionHandler: PermissionHandler?,\n    bluetoothService: BluetoothService?,\n    onMacDetected: (String) -> Unit,\n    dataUploadStatus: String,\n    macIdCacheManager: MacIdCacheManager,\n    onForgetCurrentDevice: () -> Unit,\n    undoManager: com.example.fqcapp.core.UndoManager,\n    solutionReminderManager: SolutionReminderManager\n) {\n    val context = LocalContext.current\n    val database = remember { AppDatabase.getDatabase(context) }\n    val prefsManager = remember { PreferencesManager(context) }\n    val scope = rememberCoroutineScope()\n    val eligibilityService = remember { DeviceEligibilityService(repository, database) }\n    // Create DriverPairingCacheManager for centralized Google Sheets access\n    val driverPairingSheetsService = remember { DriverPairingSheetsService(context) }\n    val driverPairingCacheManager = remember { DriverPairingCacheManager(\n        database.driverPairingCacheDao(),\n        driverPairingSheetsService\n    ) }\n    \n    // Capture callback for use in LaunchedEffect\n    val onSerialScanned = onSerialNumberScanned\n    \n    // Track current route for loading state management\n    val navBackStackEntry by nav.currentBackStackEntryAsState()\n    val currentRoute = navBackStackEntry?.destination?.route ?: Routes.LANDING\n    \n    // Eligibility dialog state\n    var showEligibilityDialog by remember { mutableStateOf(false) }\n    var eligibilityMessage by remember { mutableStateOf(\"\") }\n    var eligibilityRequiresDriverPairing by remember { mutableStateOf(false) }\n    var eligibilityRequiresFrequencyTest by remember { mutableStateOf(false) }\n    var eligibilityRequiresSongTest by remember { mutableStateOf(false) }\n    var pendingNavigationRoute by remember { mutableStateOf<String?>(null) }\n    \n    // Loading state for skeleton screen (only for FQC eligibility check)\n    var isLoadingFQC by remember { mutableStateOf(false) }\n    \n    // Shared state for authenticated operators\n    var authenticatedOperatorForDriverPairing by remember { mutableStateOf<com.example.fqcapp.data.entities.OperatorCredential?>(null) }\n    var authenticatedOperatorForChangedPart by remember { mutableStateOf<com.example.fqcapp.data.entities.OperatorCredential?>(null) }\n    var authenticatedOperatorForFreqGen by remember { mutableStateOf<com.example.fqcapp.data.entities.OperatorCredential?>(null) }\n    var authenticatedOperatorForTestSongs by remember { mutableStateOf<com.example.fqcapp.data.entities.OperatorCredential?>(null) }\n    var authenticatedOperatorForFQC by remember { mutableStateOf<com.example.fqcapp.data.entities.OperatorCredential?>(null) }\n    \n    // Authentication dialog states\n    var showAuthDialogForFreqGen by remember { mutableStateOf(false) }\n    var showAuthDialogForTestSongs by remember { mutableStateOf(false) }\n    var showAuthDialogForFQC by remember { mutableStateOf(false) }\n    \n    // Helper function to create operator credential from preferences (when password lock is disabled)\n    fun createOperatorFromPreferences(): com.example.fqcapp.data.entities.OperatorCredential? {\n        val operatorName = prefsManager.getOperatorName()\n        val operatorId = prefsManager.getOperatorId()\n        return if (operatorName != null && operatorName.isNotBlank() && operatorId != -1L) {\n            com.example.fqcapp.data.entities.OperatorCredential(\n                operatorId = operatorId.toString(),\n                operatorName = operatorName,\n                password = \"\" // Not needed when password lock is disabled\n            )\n        } else {\n            null\n        }\n    }\n    \n    // Authentication dialogs (only when password lock is ON - shown as overlay)\n    // When password lock is OFF, we navigate to OPERATOR_SELECTION route instead\n    val passwordLockEnabled = prefsManager.isPasswordLockEnabled()\n    android.util.Log.d(\"Navigation\", \" Checking password lock: enabled=$passwordLockEnabled, showFreqGen=$showAuthDialogForFreqGen, showTestSongs=$showAuthDialogForTestSongs, showFQC=$showAuthDialogForFQC\")\n    \n    // Only show dialogs when password lock is enabled\n    if (showAuthDialogForFreqGen && passwordLockEnabled) {\n        android.util.Log.d(\"Navigation\", \" Showing auth dialog for FreqGen (password lock ON)\")\n        com.example.fqcapp.ui.OperatorAuthenticationDialog(\n            onAuthenticated = { operator ->\n                authenticatedOperatorForFreqGen = operator\n                showAuthDialogForFreqGen = false\n                // Navigate directly - no eligibility check needed for Frequency\n                nav.navigate(Routes.FREQ_GEN)\n            },\n            onCancel = {\n                showAuthDialogForFreqGen = false\n            },\n            requirePassword = true\n        )\n    }\n    \n    if (showAuthDialogForTestSongs && passwordLockEnabled) {\n        android.util.Log.d(\"Navigation\", \" Showing auth dialog for TestSongs (password lock ON)\")\n        com.example.fqcapp.ui.OperatorAuthenticationDialog(\n            onAuthenticated = { operator ->\n                authenticatedOperatorForTestSongs = operator\n                showAuthDialogForTestSongs = false\n                // Navigate directly - no eligibility check needed for Test Songs\n                nav.navigate(Routes.TEST_SONGS)\n            },\n            onCancel = {\n                showAuthDialogForTestSongs = false\n            },\n            requirePassword = true\n        )\n    }\n    \n    if (showAuthDialogForFQC && passwordLockEnabled) {\n        android.util.Log.d(\"Navigation\", \" Showing auth dialog for FQC (password lock ON)\")\n        com.example.fqcapp.ui.OperatorAuthenticationDialog(\n            onAuthenticated = { operator ->\n                authenticatedOperatorForFQC = operator\n                showAuthDialogForFQC = false\n                // Check eligibility before navigating\n                val serialNumber = currentSerialNumber ?: connectedDeviceName ?: \"\"\n                if (serialNumber.isNotBlank()) {\n                    isLoadingFQC = true\n                    scope.launch {\n                        try {\n                            val eligibility = eligibilityService.canEnterTestPage(serialNumber, \"fqc\", currentMacAddress, connectedDeviceName, driverPairingCacheManager)\n                            isLoadingFQC = false\n                            if (eligibility.canProceed) {\n                                nav.navigate(Routes.DEVICE_CONFIG)\n                            } else {\n                                eligibilityMessage = eligibility.reason ?: \"Test not available.\"\n                                eligibilityRequiresDriverPairing = eligibility.requiresDriverPairing\n                                eligibilityRequiresFrequencyTest = eligibility.requiresFrequencyTest\n                                eligibilityRequiresSongTest = eligibility.requiresSongTest\n                                pendingNavigationRoute = Routes.DEVICE_CONFIG\n                                showEligibilityDialog = true\n                            }\n                        } catch (e: Exception) {\n                            isLoadingFQC = false\n                            android.util.Log.e(\"Navigation\", \"Error checking eligibility\", e)\n                        }\n                    }\n                } else {\n                    nav.navigate(Routes.DEVICE_CONFIG)\n                }\n            },\n            onCancel = {\n                showAuthDialogForFQC = false\n                isLoadingFQC = false\n            },\n            requirePassword = true\n        )\n    }\n    \n    // Eligibility dialog\n    if (showEligibilityDialog) {\n        TestEligibilityDialog(\n            message = eligibilityMessage,\n            requiresDriverPairing = eligibilityRequiresDriverPairing,\n            requiresFrequencyTest = eligibilityRequiresFrequencyTest,\n            requiresSongTest = eligibilityRequiresSongTest,\n            onEnterDriverPairing = {\n                nav.navigate(Routes.DRIVER_PAIRING)\n            },\n            onEnterFrequencyTest = if (eligibilityRequiresFrequencyTest) {\n                {\n                    if (prefsManager.isPasswordLockEnabled()) {\n                        showAuthDialogForFreqGen = true\n                    } else {\n                        nav.navigate(\"${Routes.OPERATOR_SELECTION}/${Routes.FREQ_GEN}\")\n                    }\n                }\n            } else null,\n            onEnterSongTest = if (eligibilityRequiresSongTest) {\n                {\n                    if (prefsManager.isPasswordLockEnabled()) {\n                        showAuthDialogForTestSongs = true\n                    } else {\n                        nav.navigate(\"${Routes.OPERATOR_SELECTION}/${Routes.TEST_SONGS}\")\n                    }\n                }\n            } else null,\n            onDismiss = {\n                showEligibilityDialog = false\n                pendingNavigationRoute = null\n                // Clear loading state when dialog is dismissed\n                isLoadingFQC = false\n            }\n        )\n    }\n    \n    // Clear loading state when navigation happens\n    LaunchedEffect(currentRoute) {\n        if (currentRoute == Routes.DEVICE_CONFIG || currentRoute == Routes.FQC_REVIEW) {\n            isLoadingFQC = false\n        }\n    }\n    \n    // Wrap NavHost and skeleton screen in Box for proper overlay\n    Box(modifier = Modifier.fillMaxSize()) {\n        NavHost(navController = nav, startDestination = Routes.LANDING) {\n        // Database Viewer\n        composable(Routes.DATABASE_VIEWER) {\n            DatabaseViewerScreen(\n                repository = repository,\n                onBack = { nav.popBackStack() }\n            )\n        }\n        \n        // Landing\n        composable(Routes.LANDING) {\n            var hasPermissions by remember {\n                mutableStateOf(permissionHandler?.hasAllBluetoothPermissions() ?: true)\n            }\n            \n            // Workaround: Use a local state that tracks isReferenceSerial\n            // Since isReferenceSerial is not accessible directly, we'll derive it from currentSerialNumber\n            val isRefSerial = remember(currentSerialNumber) {\n                currentSerialNumber?.startsWith(\"TMP-\") ?: false\n            }\n            \n            // Probe existing BT connection on first composition\n            LaunchedEffect(Unit) {\n                if (bluetoothService != null) {\n                    android.util.Log.d(\"Navigation\", \"Probing for currently connected device on startup...\")\n                    val connected = bluetoothService.probeCurrentlyConnected()\n                    if (connected != null) {\n                        android.util.Log.d(\"Navigation\", \"Found connected device on startup: ${connected.name} - ${connected.macAddress}\")\n                        onMacDetected(connected.macAddress)\n                        // Perform reverse lookup: MAC ID -> Serial Number\n                        val currentSerial = currentSerialNumber\n                        if (currentSerial == null && connected.macAddress.isNotBlank()) {\n                            android.util.Log.d(\"Navigation\", \" Performing reverse lookup on startup: MAC ID -> Serial Number\")\n                            android.util.Log.d(\"Navigation\", \"   MAC ID: ${connected.macAddress}\")\n                            try {\n                                // Step 1: Check MAC ID cache (for printed serials)\n                                val serialFromMac = macIdCacheManager.getSerialNumberByMacId(connected.macAddress)\n                                if (serialFromMac != null && serialFromMac.isNotBlank()) {\n                                    android.util.Log.d(\"Navigation\", \" Found serial number from MAC ID cache: $serialFromMac\")\n                                    onSerialNumberScanned(serialFromMac, null)\n                                } else {\n                                    // Step 2: Check PCB links (for devices after PCB replacement)\n                                    // This handles case where PCB was replaced - MAC changed but device is same\n                                    val deviceFromPcbLink = repository.getDeviceByMacIdThroughPcbLink(connected.macAddress)\n                                    if (deviceFromPcbLink != null) {\n                                        android.util.Log.d(\"Navigation\", \" Found existing device through PCB link: ${deviceFromPcbLink.serialNumber}\")\n                                        android.util.Log.d(\"Navigation\", \"   Device was found via PCB link (PCB may have been replaced)\")\n                                        // Use existing device serial (could be printed or reference serial)\n                                        onSerialNumberScanned(deviceFromPcbLink.serialNumber, null)\n                                    } else {\n                                        // Step 3: Device doesn't exist - generate new reference serial\n                                        val referenceSerial = SerialGenerator.generateSystemSerial(connected.macAddress)\n                                        android.util.Log.w(\"Navigation\", \" Serial number not found for MAC ID: ${connected.macAddress}\")\n                                        android.util.Log.w(\"Navigation\", \"   Generating new reference serial: $referenceSerial\")\n                                        // Use onSerialNumberScanned - it will detect TMP- prefix and set isReferenceSerial = true\n                                        onSerialNumberScanned(referenceSerial, connected.macAddress)\n                                        android.util.Log.d(\"Navigation\", \" Using new reference serial on startup: $referenceSerial\")\n                                    }\n                                }\n                            } catch (e: Exception) {\n                                android.util.Log.e(\"Navigation\", \" Error during MAC ID reverse lookup on startup\", e)\n                                // On error, try PCB link lookup as fallback\n                                try {\n                                    val deviceFromPcbLink = repository.getDeviceByMacIdThroughPcbLink(connected.macAddress)\n                                    if (deviceFromPcbLink != null) {\n                                        android.util.Log.d(\"Navigation\", \" Found device through PCB link (fallback): ${deviceFromPcbLink.serialNumber}\")\n                                        onSerialNumberScanned(deviceFromPcbLink.serialNumber, null)\n                                    } else {\n                                        // Last resort: generate reference serial\n                                        val referenceSerial = SerialGenerator.generateSystemSerial(connected.macAddress)\n                                        onSerialNumberScanned(referenceSerial, connected.macAddress)\n                                        android.util.Log.d(\"Navigation\", \" Generated reference serial on error: $referenceSerial\")\n                                    }\n                                } catch (e2: Exception) {\n                                    android.util.Log.e(\"Navigation\", \" Error in PCB link lookup fallback\", e2)\n                                    val referenceSerial = SerialGenerator.generateSystemSerial(connected.macAddress)\n                                    onSerialNumberScanned(referenceSerial, connected.macAddress)\n                                    android.util.Log.d(\"Navigation\", \" Generated reference serial on error: $referenceSerial\")\n                                }\n                            }\n                        }\n                    } else {\n                        android.util.Log.d(\"Navigation\", \"No connected device found on startup\")\n                    }\n                }\n            }\n            \n            LandingScreen(\n                operatorName = operatorName,\n                currentSerialNumber = currentSerialNumber,\n                currentMacAddress = currentMacAddress,\n                currentDeviceName = connectedDeviceName,\n                isReferenceSerial = isRefSerial,\n                onOpenScanner = { nav.navigate(Routes.SCANNER) },\n                onOpenFreqGen = { \n                    // Navigate directly - no eligibility check needed for Frequency\n                    if (prefsManager.isPasswordLockEnabled()) {\n                        showAuthDialogForFreqGen = true\n                    } else {\n                        nav.navigate(\"${Routes.OPERATOR_SELECTION}/${Routes.FREQ_GEN}\")\n                    }\n                },\n                onOpenTestSongs = { \n                    // Navigate directly - no eligibility check needed for Test Songs\n                    if (prefsManager.isPasswordLockEnabled()) {\n                        showAuthDialogForTestSongs = true\n                    } else {\n                        nav.navigate(\"${Routes.OPERATOR_SELECTION}/${Routes.TEST_SONGS}\")\n                    }\n                },\n                onOpenReview = { nav.navigate(Routes.REVIEW) },\n                onOpenMore = { \n                    // Only use actual serial number, not device name\n                    val serialNumber = currentSerialNumber ?: \"\"\n                    if (serialNumber.isBlank()) {\n                        // No serial number - allow navigation (will be handled by screen)\n                        if (prefsManager.isPasswordLockEnabled()) {\n                            showAuthDialogForFQC = true\n                        } else {\n                            nav.navigate(\"${Routes.OPERATOR_SELECTION}/${Routes.DEVICE_CONFIG}\")\n                        }\n                    } else {\n                        // Show skeleton loading screen\n                        isLoadingFQC = true\n                        // Check eligibility before navigation\n                        scope.launch {\n                            try {\n                                val eligibility = eligibilityService.canEnterTestPage(serialNumber, \"fqc\", currentMacAddress, connectedDeviceName, driverPairingCacheManager)\n                                isLoadingFQC = false // Hide loading once check completes\n                                if (eligibility.canProceed) {\n                                    if (prefsManager.isPasswordLockEnabled()) {\n                                        showAuthDialogForFQC = true\n                                    } else {\n                                        nav.navigate(\"${Routes.OPERATOR_SELECTION}/${Routes.DEVICE_CONFIG}\")\n                                    }\n                                } else {\n                                    eligibilityMessage = eligibility.reason ?: \"Test not available.\"\n                                    eligibilityRequiresDriverPairing = eligibility.requiresDriverPairing\n                                    eligibilityRequiresFrequencyTest = eligibility.requiresFrequencyTest\n                                    eligibilityRequiresSongTest = eligibility.requiresSongTest\n                                    pendingNavigationRoute = Routes.DEVICE_CONFIG\n                                    showEligibilityDialog = true\n                                }\n                            } catch (e: Exception) {\n                                isLoadingFQC = false // Hide loading on error\n                                android.util.Log.e(\"Navigation\", \"Error checking eligibility for FQC\", e)\n                                eligibilityMessage = \"Error checking eligibility: ${e.message}\"\n                                showEligibilityDialog = true\n                            }\n                        }\n                    }\n                },\n                onOpenDeviceInfo = {\n                    if (currentSerialNumber != null || currentMacAddress.isNotBlank()) {\n                        nav.navigate(Routes.DEVICE_INFORMATION)\n                    }\n                },\n                onLogout = onLogout,\n                onOpenDrawer = onOpenDrawer,\n                paddingValues = paddingValues,\n                hasBluetoothPermissions = hasPermissions,\n                onRequestPermissions = {\n                    permissionHandler?.requestBluetoothPermissions { granted ->\n                        hasPermissions = granted\n                    }\n                },\n                dataUploadStatus = dataUploadStatus,\n                onForgetCurrentDevice = onForgetCurrentDevice,\n                undoManager = undoManager,\n                solutionReminderManager = solutionReminderManager,\n                onNavigateToDriverPairing = {\n                    // Navigate to Driver Pairing screen\n                    nav.navigate(Routes.DRIVER_PAIRING) {\n                        popUpTo(Routes.LANDING) { inclusive = false }\n                    }\n                },\n                onNavigateToChangedParts = {\n                    // Navigate to Changed Parts screen\n                    nav.navigate(Routes.CHANGED_PART) {\n                        popUpTo(Routes.LANDING) { inclusive = false }\n                    }\n                }\n            )\n        }\n\n        // Operator Selection Screen (used when password lock is OFF)\n        composable(\"${Routes.OPERATOR_SELECTION}/{destination}\") { backStackEntry ->\n            val destination = backStackEntry.arguments?.getString(\"destination\") ?: Routes.LANDING\n            android.util.Log.d(\"Navigation\", \" OperatorSelection route: destination=$destination\")\n            \n            com.example.fqcapp.ui.OperatorSelectionScreen(\n                onOperatorSelected = { operator ->\n                    android.util.Log.d(\"Navigation\", \" Operator selected: ${operator.operatorName}, navigating to: $destination\")\n                    // Set the authenticated operator based on destination\n                    when (destination) {\n                        Routes.FREQ_GEN -> authenticatedOperatorForFreqGen = operator\n                        Routes.TEST_SONGS -> authenticatedOperatorForTestSongs = operator\n                        Routes.FQC_REVIEW, Routes.DEVICE_CONFIG -> authenticatedOperatorForFQC = operator\n                        Routes.DRIVER_PAIRING, \"driver_pairing\" -> authenticatedOperatorForDriverPairing = operator\n                        Routes.CHANGED_PART, \"changed_part\" -> authenticatedOperatorForChangedPart = operator\n                    }\n                    // Navigate to the destination, replacing operator selection in back stack\n                    nav.navigate(destination) {\n                        popUpTo(Routes.OPERATOR_SELECTION) { inclusive = true }\n                    }\n                },\n                onCancel = {\n                    android.util.Log.d(\"Navigation\", \" Cancelled operator selection, going back\")\n                    nav.popBackStack()\n                }\n            )\n        }\n        \n        // Scanner with dialog\n        composable(Routes.SCANNER) {\n            // Track MAC ID override for PCB changes\n            var pcbChangeMacId by remember { mutableStateOf<String?>(null) }\n            \n            ScannerScreen(\n                serialNumberPrefix = serialNumberPrefix,\n                onBack = { nav.popBackStack() },\n                onScanned = { serialNumber, macIdOverride ->\n                    // Use MAC ID override if provided (from PCB change), otherwise null (will lookup from Sheets)\n                    val macIdToUse = macIdOverride ?: pcbChangeMacId\n                    if (macIdToUse != null) {\n                        android.util.Log.d(\"Navigation\", \" [PCB_CHANGE] Using new MAC ID: $macIdToUse for serial: $serialNumber\")\n                        pcbChangeMacId = null // Reset after use\n                    }\n                    onSerialNumberScanned(serialNumber, macIdToUse)\n                    nav.popBackStack() // Return to landing after scanning\n                },\n                onMacIdUpdate = { newMacId ->\n                    // Store MAC ID for PCB change - will be used when onScanned is called\n                    pcbChangeMacId = newMacId\n                    android.util.Log.d(\"Navigation\", \" [PCB_CHANGE] MAC ID stored for use: $newMacId\")\n                }\n            )\n        }\n\n        // Review screen\n        composable(Routes.REVIEW) {\n            ReviewScreen(\n                scannedData = currentSerialNumber,\n                onBack = { nav.popBackStack() }\n            )\n        }\n\n        // Test Songs\n        composable(Routes.TEST_SONGS) {\n            TestSongScreen(\n                currentSessionId = currentSessionId,\n                repository = repository,\n                currentSerialNumber = currentSerialNumber ?: \"\",\n                currentOperatorName = operatorName,\n                authenticatedOperator = authenticatedOperatorForTestSongs,\n                connectedDeviceName = connectedDeviceName,\n                onBack = { \n                    authenticatedOperatorForTestSongs = null\n                    nav.popBackStack() \n                },\n                onNavigateToLanding = {\n                    // Explicitly navigate to Landing Page, clearing back stack\n                    nav.navigate(Routes.LANDING) {\n                        popUpTo(Routes.LANDING) { inclusive = true }\n                    }\n                },\n                onNavigateToTestSongs = {\n                    // Explicitly navigate to Test Songs screen (used for undo navigation)\n                    nav.navigate(Routes.TEST_SONGS) {\n                        // Clear back stack to Landing Page to ensure clean navigation\n                        popUpTo(Routes.LANDING) { inclusive = false }\n                    }\n                },\n                undoManager = undoManager,\n                solutionReminderManager = solutionReminderManager\n            )\n        }\n\n        // Frequency Generator\n        composable(Routes.FREQ_GEN) {\n            FrequencyGeneratorScreen(\n                currentSessionId = currentSessionId,\n                repository = repository,\n                initialSerialNumber = currentSerialNumber, // Pass serial number from Navigation\n                authenticatedOperator = authenticatedOperatorForFreqGen,\n                connectedDeviceName = connectedDeviceName, // Pass device name from Bluetooth\n                onBack = { \n                    authenticatedOperatorForFreqGen = null\n                    nav.popBackStack() \n                },\n                onNavigateToLanding = {\n                    // Explicitly navigate to Landing Page, clearing back stack\n                    nav.navigate(Routes.LANDING) {\n                        popUpTo(Routes.LANDING) { inclusive = true }\n                    }\n                },\n                onNavigateToFreqGen = {\n                    // Explicitly navigate to Frequency Generator (used for undo navigation)\n                    nav.navigate(Routes.FREQ_GEN) {\n                        // Clear back stack to Landing Page to ensure clean navigation\n                        popUpTo(Routes.LANDING) { inclusive = false }\n                    }\n                },\n                undoManager = undoManager,\n                solutionReminderManager = solutionReminderManager\n            )\n        }\n\n        // Device Config (before FQC)\n        composable(Routes.DEVICE_CONFIG) {\n            val initialSerialNumber = currentSerialNumber ?: connectedDeviceName ?: \"\"\n            val initialMacId = currentMacAddress\n            \n            android.util.Log.d(\"Navigation\", \" [DEVICE_CONFIG] Navigating to Device Config with serial: '$initialSerialNumber'\")\n            \n            DeviceConfigScreen(\n                serialNumber = initialSerialNumber,\n                macId = initialMacId,\n                operatorName = operatorName,\n                authenticatedOperator = authenticatedOperatorForFQC,\n                onBack = {\n                    authenticatedOperatorForFQC = null\n                    nav.popBackStack()\n                },\n                onNext = { deviceType, remark ->\n                    // Store device type and remark temporarily (can be passed to FQC or stored)\n                    android.util.Log.d(\"Navigation\", \" [DEVICE_CONFIG] Device Type: $deviceType, Remark: $remark\")\n                    // Navigate to FQC Review\n                    nav.navigate(Routes.FQC_REVIEW) {\n                        // Pass device type and remark as arguments or store in state\n                        // For now, we'll just navigate - FQC can access these if needed\n                    }\n                }\n            )\n        }\n        \n        // FQC Review (from More button)\n        composable(Routes.FQC_REVIEW) {\n            // Use currentSerialNumber, with fallback to connectedDeviceName\n            // The FQCReviewScreen will handle validation and logging if serial is empty\n            val initialSerialNumber = currentSerialNumber ?: connectedDeviceName ?: \"\"\n            \n            android.util.Log.d(\"Navigation\", \" [FQC] Navigating to FQC Review with serial: '$initialSerialNumber'\")\n            \n            FQCReviewScreen(\n                operatorName = operatorName,\n                serialNumber = initialSerialNumber,\n                authenticatedOperator = authenticatedOperatorForFQC,\n                solutionReminderManager = solutionReminderManager,\n                onBack = { \n                    authenticatedOperatorForFQC = null\n                    nav.popBackStack() \n                },\n                onSuccess = {\n                    authenticatedOperatorForFQC = null\n                    nav.navigate(Routes.LANDING) {\n                        popUpTo(Routes.LANDING) { inclusive = true }\n                    }\n                }\n            )\n        }\n        \n        // Device Information Screen\n        composable(Routes.DEVICE_INFORMATION) {\n            DeviceInformationScreen(\n                serialNumber = currentSerialNumber ?: \"\",\n                macId = currentMacAddress,\n                deviceName = connectedDeviceName,\n                onBack = { nav.popBackStack() },\n                onNavigateToDriverPairing = { operator ->\n                    authenticatedOperatorForDriverPairing = operator\n                    nav.navigate(Routes.DRIVER_PAIRING)\n                },\n                onNavigateToChangedPart = { operator ->\n                    authenticatedOperatorForChangedPart = operator\n                    nav.navigate(Routes.CHANGED_PART)\n                },\n                passwordLockEnabled = prefsManager.isPasswordLockEnabled(),\n                onNavigateToOperatorSelection = { destination ->\n                    // Navigate to operator selection route when password lock is OFF\n                    nav.navigate(\"${Routes.OPERATOR_SELECTION}/$destination\")\n                }\n            )\n        }\n        \n        // Driver Pairing Information\n        composable(Routes.DRIVER_PAIRING) {\n            DriverPairingScreen(\n                serialNumber = currentSerialNumber ?: \"\",\n                macId = currentMacAddress,\n                deviceName = connectedDeviceName,\n                authenticatedOperator = authenticatedOperatorForDriverPairing,\n                onBack = { \n                    authenticatedOperatorForDriverPairing = null // Clear on back\n                    nav.popBackStack() \n                },\n                onSave = { drivers ->\n                    // Data is already saved to Google Sheets in DriverPairingScreen\n                    // This callback is called after successful save\n                    android.util.Log.d(\"Navigation\", \" Driver pairing data saved successfully\")\n                },\n                onNavigateToChangedPart = {},\n                solutionReminderManager = solutionReminderManager\n            )\n        }\n        \n        // Changed Part Screen\n        composable(Routes.CHANGED_PART) {\n            val localContext = LocalContext.current\n            val localScope = rememberCoroutineScope()\n            \n            ChangedPartScreen(\n                serialNumber = currentSerialNumber ?: \"\",\n                authenticatedOperator = authenticatedOperatorForChangedPart,\n                onBack = { \n                    authenticatedOperatorForChangedPart = null // Clear on back\n                    nav.popBackStack() \n                },\n                onPcbSerialNumberChanged = { newSerialNumber ->\n                    // Update MAC ID when PCB serial number changes\n                    localScope.launch {\n                        try {\n                            android.util.Log.d(\"Navigation\", \" [PCB_CHANGE] Updating MAC ID for new serial: $newSerialNumber\")\n                            val sheetsService = GoogleSheetsService(localContext, repository.getMacIdCacheDao())\n                            val newMacId = sheetsService.getMacIdBySerialNumber(newSerialNumber)\n                            \n                            if (newMacId != null) {\n                                android.util.Log.d(\"Navigation\", \" [PCB_CHANGE] New MAC ID: $newMacId\")\n                                // Note: State update will require screen refresh\n                                // The MAC ID lookup is successful, user should navigate back and reconnect\n                                android.widget.Toast.makeText(\n                                    localContext,\n                                    \"PCB changed! New MAC ID: $newMacId. Please navigate back and reconnect to see updated data.\",\n                                    android.widget.Toast.LENGTH_LONG\n                                ).show()\n                            } else {\n                                android.util.Log.w(\"Navigation\", \" [PCB_CHANGE] MAC ID not found for serial: $newSerialNumber\")\n                                android.widget.Toast.makeText(\n                                    localContext,\n                                    \"Warning: MAC ID not found for new serial number\",\n                                    android.widget.Toast.LENGTH_LONG\n                                ).show()\n                            }\n                        } catch (e: Exception) {\n                            android.util.Log.e(\"Navigation\", \" [PCB_CHANGE] Error updating MAC ID\", e)\n                        }\n                    }\n                },\n                solutionReminderManager = solutionReminderManager\n            )\n        }\n        } // Close NavHost\n        \n        // Skeleton loading screen - show while checking FQC eligibility (overlay on top)\n        if (isLoadingFQC) {\n            SkeletonLoadingScreen()\n        }\n    }\n}\n",
        "firstEditBubbleId": "22ab7cb9-184b-4bb6-954d-07a2d11911ec",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/IMPLEMENTATION_VERIFICATION.md": {
        "content": "# Implementation Verification - DATA_FLOW_AND_STORAGE_PLAN.md\r\n\r\n##  COMPLETED - App Front Implementation\r\n\r\n### 1. Supabase Device Data Service \r\n- **File**: `app/src/main/java/com/example/fqcapp/supabase/SupabaseDeviceDataService.kt`\r\n- **Status**:  COMPLETE\r\n- **Features**:\r\n  - `fetchDeviceData(serialNumber)` - Queries all Supabase tables\r\n  - `getNextIterationNumber(serialNumber, testType)` - Gets iteration per test type\r\n  - Returns `DeviceDataSnapshot` with all device history\r\n  - Independent iteration counters per test type\r\n\r\n### 2. Session Timestamp Manager \r\n- **File**: `app/src/main/java/com/example/fqcapp/core/SessionTimestampManager.kt`\r\n- **Status**:  COMPLETE\r\n- **Features**:\r\n  - `getSessionEntryTimestamp(serialNumber)` - Gets/creates ISO8601 session timestamp\r\n  - Persists across tests in same session\r\n  - Stored in SharedPreferences\r\n\r\n### 3. Device Workflow Service Updates \r\n- **File**: `app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt`\r\n- **Status**:  COMPLETE\r\n- **New Methods**:\r\n  - `getNextFrequencyTestIteration(serialNumber)` \r\n  - `getNextSongTestIteration(serialNumber)` \r\n  - `getNextFQCIteration(serialNumber)` \r\n  - `getNextDriverPairingIteration(serialNumber)` \r\n  - `getNextChangedPartsIteration(serialNumber)` \r\n  - All query Supabase directly (not local DB)\r\n\r\n### 4. Device Information Screen \r\n- **File**: `app/src/main/java/com/example/fqcapp/DeviceInformationScreen.kt`\r\n- **Status**:  COMPLETE\r\n- **Features**:\r\n  - Fetches device data from Supabase when serial is scanned\r\n  - Creates/retrieves session timestamp\r\n  - Stores `DeviceDataSnapshot` in state\r\n\r\n### 5. Driver Pairing Screen \r\n- **File**: `app/src/main/java/com/example/fqcapp/DriverPairingScreen.kt`\r\n- **Status**:  COMPLETE\r\n- **Updates**:\r\n  - Uses `workflowService.getNextDriverPairingIteration()` \r\n  - Uses `sessionTimestampManager.getSessionEntryTimestamp()` \r\n  - Uses ISO8601 format timestamps \r\n  - Uses authenticated operator name \r\n\r\n### 6. Frequency Generator Screen \r\n- **File**: `app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt`\r\n- **Status**:  PARTIALLY COMPLETE\r\n- **Completed**:\r\n  - Uses `workflowService.getNextFrequencyTestIteration()` in main flow \r\n  - Uses `sessionTimestampManager.getSessionEntryTimestamp()` \r\n  - Uses ISO8601 format timestamps \r\n- **Remaining**:\r\n  - 2 places still use `repository.getNextIterationNumber()` (lines 2758, 2873)\r\n  - These are in undo/restore flows - should be updated\r\n\r\n### 7. Test Song Screen \r\n- **File**: `app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt`\r\n- **Status**:  NEEDS UPDATE\r\n- **Missing**:\r\n  - Still uses `repository.getNextSongIterationNumber()` (lines 182, 1464)\r\n  - No `SessionTimestampManager` integration\r\n  - Should use `workflowService.getNextSongTestIteration()`\r\n  - Should use session timestamp for `entry_timestamp`\r\n\r\n### 8. FQC Review Screen \r\n- **File**: `app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt`\r\n- **Status**:  NEEDS UPDATE\r\n- **Missing**:\r\n  - Still uses `workflowService.getNextIterationNumber()` (old method, line 105)\r\n  - Should use `workflowService.getNextFQCIteration()`\r\n  - No `SessionTimestampManager` integration\r\n  - Should use session timestamp for `entry_timestamp`\r\n\r\n### 9. Changed Part Screen \r\n- **File**: `app/src/main/java/com/example/fqcapp/ChangedPartScreen.kt`\r\n- **Status**:  NEEDS UPDATE\r\n- **Missing**:\r\n  - Still uses `repository.getNextChangedPartsIterationNumber()` (line 399)\r\n  - Should use `workflowService.getNextChangedPartsIteration()`\r\n  - No `SessionTimestampManager` integration\r\n  - Should use session timestamp for `entry_timestamp`\r\n\r\n### 10. Operator Name Verification \r\n- **Status**:  VERIFIED\r\n- **All screens** prioritize `authenticatedOperator` parameter\r\n- Fallback to preferences only when authenticated operator not provided\r\n- No device operator name fallbacks found\r\n\r\n---\r\n\r\n##  SUPABASE FRONT - What Needs to Be Done\r\n\r\n### 1. Database Schema Verification\r\n\r\nEnsure all tables have the following standardized fields:\r\n\r\n#### A. `devices` Table\r\n```sql\r\n- serial_number (PRIMARY KEY, TEXT)\r\n- mac_address (TEXT, nullable)\r\n- color (TEXT, nullable)\r\n- status (TEXT) -- \"IN_PROGRESS\", \"PASSED\", \"FAILED\"\r\n- created_at (TIMESTAMP)\r\n- updated_at (TIMESTAMP)\r\n```\r\n\r\n#### B. `frequency_tests` Table\r\n```sql\r\n- test_id (PRIMARY KEY, BIGSERIAL)\r\n- serial_number (TEXT, FOREIGN KEY  devices.serial_number)\r\n- operator_name (TEXT)\r\n- operator_id (TEXT, nullable)\r\n- entry_timestamp (TEXT) -- ISO8601 format\r\n- exit_timestamp (TEXT) -- ISO8601 format\r\n- total_time_spent (TEXT) -- \"HH:MM:SS\" format\r\n- result (TEXT) -- \"PASS\", \"FAIL\", \"CAN_BE_PASSED\"\r\n- remark (TEXT)\r\n- iteration_number (INTEGER) -- Per test type counter\r\n- timestamp (TEXT) -- ISO8601 (backward compatibility)\r\n```\r\n\r\n#### C. `song_tests` Table\r\n```sql\r\n- test_id (PRIMARY KEY, BIGSERIAL)\r\n- serial_number (TEXT, FOREIGN KEY  devices.serial_number)\r\n- operator_name (TEXT)\r\n- operator_id (TEXT, nullable)\r\n- entry_timestamp (TEXT) -- ISO8601 format\r\n- exit_timestamp (TEXT) -- ISO8601 format\r\n- total_time_spent (TEXT) -- \"HH:MM:SS\" format\r\n- song_name (TEXT)\r\n- result (TEXT) -- \"PASS\", \"FAIL\"\r\n- remark (TEXT)\r\n- iteration_number (INTEGER) -- Per test type counter (only count overall results)\r\n- is_overall_result (BOOLEAN) -- true for overall, false for individual\r\n- timestamp (TEXT) -- ISO8601\r\n```\r\n\r\n#### D. `fqc_records` Table\r\n```sql\r\n- fqc_id (PRIMARY KEY, BIGSERIAL)\r\n- serial_number (TEXT, FOREIGN KEY  devices.serial_number)\r\n- operator_name (TEXT)\r\n- operator_id (TEXT, nullable)\r\n- entry_timestamp (TEXT) -- ISO8601 format\r\n- exit_timestamp (TEXT) -- ISO8601 format\r\n- total_time_spent (TEXT) -- \"HH:MM:SS\" format\r\n- fqc_type (TEXT) -- \"INITIAL\", \"REWORK\", \"FINAL_PASS\"\r\n- overall_result (TEXT) -- \"PASS\", \"FAIL\"\r\n- final_quality_type (TEXT) -- \"REVIEWER\", \"CUSTOMER\", \"INTERNATIONAL\", \"MARKETING\"\r\n- iteration_number (INTEGER) -- Per test type counter\r\n- fqc_duration_sec (INTEGER)\r\n- latest_freq_result (TEXT, nullable)\r\n- latest_song_result (TEXT, nullable)\r\n- remark (TEXT, nullable)\r\n- major_issues (TEXT, nullable)\r\n- timestamp (TEXT) -- ISO8601\r\n```\r\n\r\n#### E. `driver_pairing_records` Table\r\n```sql\r\n- record_id (PRIMARY KEY, BIGSERIAL)\r\n- serial_number (TEXT, FOREIGN KEY  devices.serial_number)\r\n- operator_name (TEXT)\r\n- operator_id (TEXT, nullable)\r\n- entry_timestamp (TEXT) -- ISO8601 format\r\n- exit_timestamp (TEXT) -- ISO8601 format\r\n- total_time_spent (TEXT) -- \"HH:MM:SS\" format\r\n- driver_data (JSONB) -- [{\"driver1\":\"...\", \"driver2\":\"...\"}]\r\n- iteration_number (INTEGER) -- Per test type counter\r\n- mac_id (TEXT, nullable)\r\n- timestamp (TEXT) -- ISO8601\r\n```\r\n\r\n#### F. `changed_part_records` Table\r\n```sql\r\n- record_id (PRIMARY KEY, BIGSERIAL)\r\n- serial_number (TEXT, FOREIGN KEY  devices.serial_number)\r\n- operator_name (TEXT)\r\n- operator_id (TEXT, nullable)\r\n- entry_timestamp (TEXT) -- ISO8601 format\r\n- exit_timestamp (TEXT) -- ISO8601 format\r\n- total_time_spent (TEXT) -- \"HH:MM:SS\" format\r\n- iteration_number (INTEGER) -- Per test type counter\r\n- timestamp (TEXT) -- ISO8601\r\n```\r\n\r\n### 2. Indexes Required\r\n\r\nFor performance, create indexes on:\r\n```sql\r\n-- Indexes for iteration number queries\r\nCREATE INDEX idx_frequency_tests_serial_iteration ON frequency_tests(serial_number, iteration_number);\r\nCREATE INDEX idx_song_tests_serial_iteration ON song_tests(serial_number, iteration_number) WHERE is_overall_result = true;\r\nCREATE INDEX idx_fqc_records_serial_iteration ON fqc_records(serial_number, iteration_number);\r\nCREATE INDEX idx_driver_pairing_serial_iteration ON driver_pairing_records(serial_number, iteration_number);\r\nCREATE INDEX idx_changed_parts_serial_iteration ON changed_part_records(serial_number, iteration_number);\r\n\r\n-- Indexes for timestamp queries\r\nCREATE INDEX idx_frequency_tests_entry_timestamp ON frequency_tests(entry_timestamp);\r\nCREATE INDEX idx_song_tests_entry_timestamp ON song_tests(entry_timestamp);\r\nCREATE INDEX idx_fqc_records_entry_timestamp ON fqc_records(entry_timestamp);\r\n```\r\n\r\n### 3. Materialized Views (Already Created per Plan)\r\n\r\nVerify these exist and are refreshed:\r\n1. `device_test_events_mv` - Unified view of all test events\r\n2. `device_stage_summary_mv` - Current stage per device\r\n3. `dashboard_stage_counts_mv` - Stage counts for dashboard\r\n\r\n### 4. Row Level Security (RLS)\r\n\r\nEnsure RLS policies allow:\r\n- **Read**: App can read all device data for a serial number\r\n- **Write**: App can insert/update records for any serial number\r\n- **Dashboard**: Dashboard can read all data\r\n\r\n### 5. Data Validation\r\n\r\nEnsure:\r\n- `iteration_number` starts from 1 (not 0) for each test type\r\n- `entry_timestamp` and `exit_timestamp` are in ISO8601 format\r\n- `serial_number` is always present (NOT NULL)\r\n- Foreign key constraints are properly set up\r\n\r\n### 6. Testing Checklist\r\n\r\nBefore going live, test:\r\n- [ ] Serial scan fetches device data correctly\r\n- [ ] Iteration numbers increment correctly per test type\r\n- [ ] Session timestamps are shared across tests\r\n- [ ] Data uploads use correct field names (snake_case)\r\n- [ ] Dashboard queries work with new data structure\r\n- [ ] Materialized views refresh correctly\r\n\r\n---\r\n\r\n## Summary\r\n\r\n**App Front**: Core infrastructure is complete. Some screens (TestSongScreen, FQCReviewScreen, ChangedPartScreen) still need minor updates to use Supabase iteration numbers and session timestamps, but the main implementation is done.\r\n\r\n**Supabase Front**: Schema verification, indexes, and RLS policies need to be checked/created. Materialized views should already exist per the plan.\r\n\r\n",
        "firstEditBubbleId": "cdc18af7-6d4b-4fc7-8fff-825e841f5b35",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/SUPABASE_API_REQUESTS_EXPLANATION.md": {
        "content": "",
        "firstEditBubbleId": "df68ea81-38b6-40cf-9170-0c2e9feda353",
        "isNewlyCreated": true,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt": {
        "content": "package com.example.fqcapp.services\n\nimport android.util.Log\nimport com.example.fqcapp.data.FQCRepository\nimport com.example.fqcapp.data.entities.DeviceWorkflow\nimport com.example.fqcapp.data.entities.MilestoneEntry\nimport kotlinx.coroutines.CancellationException\nimport kotlinx.coroutines.CoroutineScope\nimport kotlinx.coroutines.Dispatchers\nimport kotlinx.coroutines.SupervisorJob\nimport kotlinx.coroutines.launch\nimport kotlinx.coroutines.withContext\n\n/**\n * Service to log device workflow events and integrate with milestones.\n * \n * This service:\n * 1. Logs workflow events (who did what, when)\n * 2. Updates milestones automatically\n * 3. Syncs to Supabase (when implemented)\n */\nclass DeviceWorkflowService(\n    private val repository: FQCRepository\n) {\n    companion object {\n        private const val TAG = \"DeviceWorkflow\"\n        \n        // Independent scope for Supabase sync that survives composition cancellation\n        private val supabaseSyncScope = CoroutineScope(SupervisorJob() + Dispatchers.IO)\n        \n        // Stage constants\n        const val STAGE_DRIVER_PAIRING = \"DRIVER_PAIRING\"\n        const val STAGE_CHANGED_PARTS = \"CHANGED_PARTS\"\n        const val STAGE_FREQUENCY_TEST = \"FREQUENCY_TEST\"\n        const val STAGE_SONG_TEST = \"SONG_TEST\"\n        const val STAGE_FQC = \"FQC\"\n        \n        // Action constants\n        const val ACTION_STARTED = \"STARTED\"\n        const val ACTION_COMPLETED = \"COMPLETED\"\n        const val ACTION_FAILED = \"FAILED\"\n        const val ACTION_RETRY = \"RETRY\"\n        \n        // Result constants\n        const val RESULT_PASS = \"PASS\"\n        const val RESULT_FAIL = \"FAIL\"\n        const val RESULT_CAN_PASS = \"CAN_PASS\"\n        const val RESULT_CAN_BE_PASSED = \"CAN_BE_PASSED\"\n    }\n    \n    /**\n     * Log a workflow event and update milestone if needed\n     */\n    suspend fun logWorkflow(\n        serialNumber: String,\n        stage: String,\n        operatorName: String,\n        action: String,\n        result: String? = null,\n        iterationNumber: Int = 1,\n        recordId: Long? = null,\n        details: String = \"{}\"\n    ) = withContext(Dispatchers.IO) {\n        try {\n            Log.d(TAG, \" [LOG_WORKFLOW] Logging workflow event:\")\n            Log.d(TAG, \"   Serial: $serialNumber\")\n            Log.d(TAG, \"   Stage: $stage\")\n            Log.d(TAG, \"   Operator: $operatorName\")\n            Log.d(TAG, \"   Action: $action\")\n            Log.d(TAG, \"   Result: $result\")\n            Log.d(TAG, \"   Iteration: $iterationNumber\")\n            \n            // Map result to milestone status\n            val milestoneStatus = when {\n                action == ACTION_COMPLETED && result != null -> {\n                    mapResultToMilestoneStatus(result)\n                }\n                else -> null\n            }\n            \n            Log.d(TAG, \"   Milestone Status: $milestoneStatus\")\n            \n            // Create workflow event\n            val workflow = DeviceWorkflow(\n                serialNumber = serialNumber,\n                stage = stage,\n                operatorName = operatorName,\n                action = action,\n                result = result,\n                iterationNumber = iterationNumber,\n                recordId = recordId,\n                milestoneStatus = milestoneStatus,\n                details = details,\n                timestamp = System.currentTimeMillis(),\n                syncedToSupabase = false,\n                supabaseSyncTimestamp = 0\n            )\n            \n            // Save to local database\n            val workflowId = repository.insertDeviceWorkflow(workflow)\n            Log.d(TAG, \" [LOG_WORKFLOW] Workflow event saved with ID: $workflowId\")\n            \n            // Update milestone if action is COMPLETED\n            if (action == ACTION_COMPLETED && milestoneStatus != null) {\n                updateMilestoneFromWorkflow(serialNumber, stage, milestoneStatus, iterationNumber)\n            }\n            \n            // Sync to Supabase in independent scope (fire-and-forget)\n            // This ensures sync continues even if the calling composable is disposed\n            supabaseSyncScope.launch {\n                try {\n                    val supabaseService = com.example.fqcapp.supabase.SupabaseDeviceWorkflowService()\n                    val supabaseId = supabaseService.saveDeviceWorkflow(workflow.copy(workflowId = workflowId))\n                    if (supabaseId != null) {\n                        Log.d(TAG, \" [SUPABASE] Device workflow saved to Supabase with ID: $supabaseId\")\n                        // Mark as synced in Room DB\n                        repository.markWorkflowAsSynced(workflowId, System.currentTimeMillis())\n                    } else {\n                        Log.w(TAG, \" [SUPABASE] Failed to save to Supabase (will retry later)\")\n                    }\n                } catch (e: CancellationException) {\n                    // Re-throw cancellation to respect coroutine cancellation\n                    throw e\n                } catch (e: Exception) {\n                    Log.e(TAG, \" [SUPABASE] Error saving device workflow to Supabase\", e)\n                    // Don't fail the whole operation if Supabase save fails\n                }\n            }\n            \n            workflowId\n        } catch (e: Exception) {\n            Log.e(TAG, \" [LOG_WORKFLOW] Error logging workflow event\", e)\n            throw e\n        }\n    }\n    \n    /**\n     * Map result to milestone status\n     */\n    private fun mapResultToMilestoneStatus(result: String): String {\n        return when (result.uppercase()) {\n            RESULT_PASS -> \"pass\"\n            RESULT_FAIL -> \"fail\"\n            RESULT_CAN_PASS, RESULT_CAN_BE_PASSED -> \"can_pass\"\n            else -> \"default\"\n        }\n    }\n    \n    /**\n     * Update milestone based on workflow event\n     * Uses MilestoneUpdateService to ensure proper milestone creation logic\n     */\n    private suspend fun updateMilestoneFromWorkflow(\n        serialNumber: String,\n        stage: String,\n        milestoneStatus: String,\n        iterationNumber: Int\n    ) {\n        try {\n            Log.d(TAG, \" [UPDATE_MILESTONE] Updating milestone from workflow:\")\n            Log.d(TAG, \"   Serial: $serialNumber\")\n            Log.d(TAG, \"   Stage: $stage\")\n            Log.d(TAG, \"   Status: $milestoneStatus\")\n            Log.d(TAG, \"   Iteration: $iterationNumber\")\n            \n            // Get all milestones for this device\n            val allMilestones = repository.getMilestonesForSerial(serialNumber)\n            \n            // Find milestone for this iteration, or create if doesn't exist\n            val milestone = allMilestones.find { it.iterationIndex == iterationNumber }\n                ?: run {\n                    // Create new milestone for this specific iteration\n                    Log.d(TAG, \" [UPDATE_MILESTONE] Creating new milestone iteration: $iterationNumber\")\n                    val newMilestone = MilestoneEntry(\n                        serialNumber = serialNumber,\n                        iterationIndex = iterationNumber\n                    )\n                    repository.upsertMilestone(newMilestone)\n                    // Fetch it back to get the ID\n                    repository.getMilestonesForSerial(serialNumber)\n                        .find { it.iterationIndex == iterationNumber }\n                        ?: newMilestone\n                }\n            \n            // Update the appropriate stage\n            val updatedMilestone = updateMilestoneStage(milestone, stage, milestoneStatus)\n            \n            // Save updated milestone\n            repository.upsertMilestone(updatedMilestone)\n            Log.d(TAG, \" [UPDATE_MILESTONE] Milestone updated successfully\")\n            \n        } catch (e: Exception) {\n            Log.e(TAG, \" [UPDATE_MILESTONE] Error updating milestone\", e)\n        }\n    }\n    \n    /**\n     * Update specific stage in milestone\n     */\n    private fun updateMilestoneStage(\n        milestone: MilestoneEntry,\n        stage: String,\n        status: String\n    ): MilestoneEntry {\n        return when (stage) {\n            STAGE_DRIVER_PAIRING -> milestone.copy(driverInfoStatus = status)\n            STAGE_FREQUENCY_TEST -> milestone.copy(frequencyStatus = status)\n            STAGE_SONG_TEST -> milestone.copy(testSongStatus = status)\n            STAGE_FQC -> milestone.copy(finalQcStatus = status)\n            else -> milestone\n        }\n    }\n    \n    /**\n     * Get workflow history for a device\n     */\n    suspend fun getDeviceWorkflowHistory(serialNumber: String): List<DeviceWorkflow> {\n        return withContext(Dispatchers.IO) {\n            try {\n                repository.getDeviceWorkflowHistory(serialNumber)\n            } catch (e: Exception) {\n                Log.e(TAG, \" Error getting device workflow history\", e)\n                emptyList()\n            }\n        }\n    }\n    \n    /**\n     * Get workflow history for a device at a specific stage\n     */\n    suspend fun getDeviceWorkflowForStage(\n        serialNumber: String,\n        stage: String\n    ): List<DeviceWorkflow> {\n        return withContext(Dispatchers.IO) {\n            try {\n                repository.getDeviceWorkflowForStage(serialNumber, stage)\n            } catch (e: Exception) {\n                Log.e(TAG, \" Error getting device workflow for stage\", e)\n                emptyList()\n            }\n        }\n    }\n    \n    /**\n     * Get latest workflow event for a device at a stage\n     */\n    suspend fun getLatestWorkflowForStage(\n        serialNumber: String,\n        stage: String\n    ): DeviceWorkflow? {\n        return withContext(Dispatchers.IO) {\n            try {\n                repository.getLatestWorkflowForStage(serialNumber, stage)\n            } catch (e: Exception) {\n                Log.e(TAG, \" Error getting latest workflow for stage\", e)\n                null\n            }\n        }\n    }\n    \n    /**\n     * Get next iteration number for a stage (DEPRECATED - use test-specific methods)\n     * This method is kept for backward compatibility but now queries Supabase.\n     */\n    suspend fun getNextIterationNumber(\n        serialNumber: String,\n        stage: String\n    ): Int {\n        return withContext(Dispatchers.IO) {\n            try {\n                // Map stage to test type\n                val testType = when (stage) {\n                    STAGE_FREQUENCY_TEST -> \"frequency\"\n                    STAGE_SONG_TEST -> \"song\"\n                    STAGE_FQC -> \"fqc\"\n                    STAGE_DRIVER_PAIRING -> \"driver_pairing\"\n                    STAGE_CHANGED_PARTS -> \"changed_parts\"\n                    else -> {\n                        // Fallback to local DB for unknown stages\n                        Log.w(TAG, \" Unknown stage: $stage, falling back to local DB\")\n                        return@withContext repository.getMaxWorkflowIterationForStage(serialNumber, stage) + 1\n                    }\n                }\n                \n                // Use Supabase-based method\n                getNextIterationFromSupabase(serialNumber, testType)\n            } catch (e: Exception) {\n                Log.e(TAG, \" Error getting next iteration number\", e)\n                // Fallback to local DB\n                try {\n                    repository.getMaxWorkflowIterationForStage(serialNumber, stage) + 1\n                } catch (e2: Exception) {\n                    1\n                }\n            }\n        }\n    }\n    \n    /**\n     * Get next iteration number from Supabase for a specific test type.\n     * This is the new standard method that queries Supabase directly.\n     * \n     * @param serialNumber The device serial number\n     * @param testType One of: \"frequency\", \"song\", \"fqc\", \"driver_pairing\", \"changed_parts\"\n     * @return Next iteration number (maxIteration + 1, or 1 if no records exist)\n     */\n    suspend fun getNextIterationFromSupabase(\n        serialNumber: String,\n        testType: String\n    ): Int {\n        return withContext(Dispatchers.IO) {\n            try {\n                // Validate serial number - don't query Supabase with device names or MAC addresses\n                val normalizedSerial = serialNumber.trim()\n                val isLikelyDeviceName = normalizedSerial.matches(Regex(\"^BT-.*\", RegexOption.IGNORE_CASE))\n                val isLikelyMacAddress = normalizedSerial.matches(Regex(\"^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$\"))\n                val isTooShort = normalizedSerial.length < 10\n                \n                if (isLikelyDeviceName || isLikelyMacAddress || isTooShort) {\n                    Log.w(TAG, \"\")\n                    Log.w(TAG, \" [WORKFLOW] Invalid serial number format - skipping Supabase query\")\n                    Log.w(TAG, \"   Serial Number: '$serialNumber'\")\n                    Log.w(TAG, \"   Reason: ${when {\n                        isLikelyDeviceName -> \"Looks like device name\"\n                        isLikelyMacAddress -> \"Looks like MAC address\"\n                        isTooShort -> \"Too short (< 10 chars)\"\n                        else -> \"Unknown\"\n                    }}\")\n                    Log.w(TAG, \"   Returning iteration 1 (fallback - no Supabase query)\")\n                    Log.w(TAG, \"\")\n                    return@withContext 1 // Return iteration 1 immediately - don't query Supabase\n                }\n                \n                Log.d(TAG, \"\")\n                Log.d(TAG, \" [WORKFLOW] GETTING NEXT ITERATION FROM SUPABASE\")\n                Log.d(TAG, \"   Serial Number: $serialNumber\")\n                Log.d(TAG, \"   Test Type: $testType\")\n                Log.d(TAG, \"\")\n                \n                val deviceDataService = com.example.fqcapp.supabase.SupabaseDeviceDataService()\n                val nextIteration = deviceDataService.getNextIterationNumber(serialNumber, testType)\n                \n                Log.d(TAG, \"\")\n                Log.d(TAG, \" [WORKFLOW] ITERATION NUMBER RETRIEVED\")\n                Log.d(TAG, \"   Serial Number: $serialNumber\")\n                Log.d(TAG, \"   Test Type: $testType\")\n                Log.d(TAG, \"   Next Iteration: $nextIteration\")\n                Log.d(TAG, \"\")\n                \n                return@withContext nextIteration\n            } catch (e: Exception) {\n                Log.e(TAG, \"\")\n                Log.e(TAG, \" [WORKFLOW] ERROR GETTING ITERATION FROM SUPABASE\")\n                Log.e(TAG, \"   Serial Number: $serialNumber\")\n                Log.e(TAG, \"   Test Type: $testType\")\n                Log.e(TAG, \"   Error: ${e.message}\")\n                Log.e(TAG, \"   Stack trace: ${e.stackTraceToString()}\")\n                Log.e(TAG, \"    Falling back to iteration 1\")\n                Log.e(TAG, \"\")\n                // Fallback: return 1 if Supabase query fails\n                return@withContext 1\n            }\n        }\n    }\n    \n    /**\n     * Get next iteration number for frequency test.\n     * Queries Supabase frequency_tests table.\n     */\n    suspend fun getNextFrequencyTestIteration(serialNumber: String): Int {\n        return getNextIterationFromSupabase(serialNumber, \"frequency\")\n    }\n    \n    /**\n     * Get next iteration number for song test.\n     * Queries Supabase song_tests table (only overall results).\n     */\n    suspend fun getNextSongTestIteration(serialNumber: String): Int {\n        return getNextIterationFromSupabase(serialNumber, \"song\")\n    }\n    \n    /**\n     * Get next iteration number for FQC record.\n     * Queries Supabase fqc_records table.\n     */\n    suspend fun getNextFQCIteration(serialNumber: String): Int {\n        return getNextIterationFromSupabase(serialNumber, \"fqc\")\n    }\n    \n    /**\n     * Get next iteration number for driver pairing.\n     * Queries Supabase driver_pairing_records table.\n     */\n    suspend fun getNextDriverPairingIteration(serialNumber: String): Int {\n        return getNextIterationFromSupabase(serialNumber, \"driver_pairing\")\n    }\n    \n    /**\n     * Get next iteration number for changed parts.\n     * Queries Supabase changed_part_records table.\n     */\n    suspend fun getNextChangedPartsIteration(serialNumber: String): Int {\n        return getNextIterationFromSupabase(serialNumber, \"changed_parts\")\n    }\n}\n\n",
        "firstEditBubbleId": "f94c03ab-535f-4a2b-a49f-04e33e8cceda",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/SUPABASE_SYNC_REMOVAL_SUMMARY.md": {
        "content": "",
        "firstEditBubbleId": "ec50dbc0-dbd9-4836-96b1-aef4b58dbe5e",
        "isNewlyCreated": true,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt": {
        "content": "package com.example.fqcapp.services\r\n\r\nimport android.content.Context\r\nimport android.util.Log\r\nimport com.example.fqcapp.data.dao.MacIdCacheDao\r\nimport com.example.fqcapp.data.entities.MacIdCache\r\nimport kotlinx.coroutines.Dispatchers\r\nimport kotlinx.coroutines.withContext\r\n\r\nclass MacIdCacheManager(\r\n    private val context: Context,\r\n    private val macIdCacheDao: MacIdCacheDao,\r\n    private val googleSheetsAPI: GoogleSheetsAPI\r\n) {\r\n    companion object {\r\n        private const val TAG = \"MacIdCacheManager\"\r\n        private const val CACHE_EXPIRY_MS = 60 * 60 * 1000L // 1 hour\r\n    }\r\n    \r\n    /**\r\n     * Check if cache needs refresh (older than 1 hour)\r\n     */\r\n    suspend fun shouldRefreshCache(): Boolean = withContext(Dispatchers.IO) {\r\n        try {\r\n            val lastUpdateTime = macIdCacheDao.getLastUpdateTime()\r\n            if (lastUpdateTime == null) {\r\n                Log.d(TAG, \"Cache is empty, needs refresh\")\r\n                return@withContext true\r\n            }\r\n            \r\n            val currentTime = System.currentTimeMillis()\r\n            val timeDiff = currentTime - lastUpdateTime\r\n            val needsRefresh = timeDiff > CACHE_EXPIRY_MS\r\n            \r\n            Log.d(TAG, \"Cache last updated: ${lastUpdateTime}, current: ${currentTime}, diff: ${timeDiff}ms, needs refresh: ${needsRefresh}\")\r\n            return@withContext needsRefresh\r\n        } catch (e: Exception) {\r\n            Log.e(TAG, \"Error checking cache expiry\", e)\r\n            return@withContext true // Refresh on error\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Download Sheet2 and merge with existing cache\r\n     */\r\n    suspend fun refreshCache(): Boolean = withContext(Dispatchers.IO) {\r\n        try {\r\n            Log.d(TAG, \"Starting cache refresh...\")\r\n            \r\n            // Fetch all rows from Sheet2 (columns A:C)\r\n            val sheetData = googleSheetsAPI.fetchMacLookupData()\r\n            \r\n            if (sheetData.isEmpty()) {\r\n                Log.e(TAG, \"No data received from Google Sheets\")\r\n                return@withContext false\r\n            }\r\n            \r\n            Log.d(TAG, \"Downloaded ${sheetData.size} entries from Google Sheets\")\r\n            \r\n            // Parse and filter valid entries (non-blank, no #REF!)\r\n            val validData = sheetData.filter { row ->\r\n                row.size >= 3 && \r\n                row[1].isNotBlank() && // Serial Number (Column B) must not be empty\r\n                row[2].isNotBlank() && // MAC ID (Column C) must not be empty\r\n                !row[1].contains(\"#REF!\") && // Filter out #REF! errors in serial number\r\n                !row[2].contains(\"#REF!\") // Filter out #REF! errors in MAC ID\r\n            }\r\n            \r\n            Log.d(TAG, \"Filtered to ${validData.size} valid entries\")\r\n            \r\n            if (validData.isEmpty()) {\r\n                Log.w(TAG, \"No valid entries found after filtering\")\r\n                return@withContext false\r\n            }\r\n            \r\n            // Get existing cache entries\r\n            val existingEntries = macIdCacheDao.getAllCachedEntries()\r\n            val existingSerialNumbers = existingEntries.map { it.serialNumber }.toSet()\r\n            \r\n            Log.d(TAG, \"Found ${existingEntries.size} existing cache entries\")\r\n            \r\n            // Create new cache entries\r\n            val currentTime = System.currentTimeMillis()\r\n            val newCacheEntries = validData.map { row ->\r\n                MacIdCache(\r\n                    serialNumber = row[1], // Column B - Serial Number\r\n                    macAddress = row[2],   // Column C - MAC ID\r\n                    lastUpdated = currentTime\r\n                )\r\n            }\r\n            \r\n            // Merge: keep existing + add new (no duplicates)\r\n            val entriesToInsert = mutableListOf<MacIdCache>()\r\n            \r\n            // Add existing entries that are not in the new data\r\n            existingEntries.forEach { existing ->\r\n                if (!newCacheEntries.any { it.serialNumber == existing.serialNumber }) {\r\n                    entriesToInsert.add(existing)\r\n                }\r\n            }\r\n            \r\n            // Add all new entries (this will replace existing ones with same serial)\r\n            entriesToInsert.addAll(newCacheEntries)\r\n            \r\n            Log.d(TAG, \"Merged cache: ${entriesToInsert.size} total entries (${existingEntries.size} existing + ${newCacheEntries.size} new)\")\r\n            \r\n            // Insert all entries (REPLACE strategy handles duplicates)\r\n            macIdCacheDao.insertAll(entriesToInsert)\r\n            \r\n            Log.d(TAG, \" Cache refresh completed successfully\")\r\n            return@withContext true\r\n            \r\n        } catch (e: Exception) {\r\n            Log.e(TAG, \"Error refreshing cache\", e)\r\n            e.printStackTrace()\r\n            return@withContext false\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get MAC ID from cache, refresh if not found\r\n     */\r\n    suspend fun getMacId(serialNumber: String): String? = withContext(Dispatchers.IO) {\r\n        try {\r\n            Log.d(TAG, \"Looking up MAC for serial: $serialNumber\")\r\n            \r\n            // Query local cache first\r\n            val cachedEntry = macIdCacheDao.getMacBySerial(serialNumber)\r\n            \r\n            if (cachedEntry != null) {\r\n                Log.d(TAG, \" Found MAC in cache: ${cachedEntry.macAddress} for serial: $serialNumber\")\r\n                return@withContext cachedEntry.macAddress\r\n            }\r\n            \r\n            Log.d(TAG, \"Serial not found in cache, refreshing cache...\")\r\n            \r\n            // If not found, refresh cache and try again\r\n            val refreshSuccess = refreshCache()\r\n            \r\n            if (refreshSuccess) {\r\n                // Try again after refresh\r\n                val refreshedEntry = macIdCacheDao.getMacBySerial(serialNumber)\r\n                if (refreshedEntry != null) {\r\n                    Log.d(TAG, \" Found MAC after cache refresh: ${refreshedEntry.macAddress} for serial: $serialNumber\")\r\n                    return@withContext refreshedEntry.macAddress\r\n                }\r\n            }\r\n            \r\n            Log.w(TAG, \" Serial number $serialNumber not found even after cache refresh\")\r\n            return@withContext null\r\n            \r\n        } catch (e: Exception) {\r\n            Log.e(TAG, \"Error getting MAC ID\", e)\r\n            e.printStackTrace()\r\n            return@withContext null\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get serial number by MAC ID (reverse lookup)\r\n     */\r\n    suspend fun getSerialNumberByMacId(macId: String): String? = withContext(Dispatchers.IO) {\r\n        try {\r\n            Log.d(TAG, \"Looking up serial for MAC: $macId\")\r\n            \r\n            // Query local cache first\r\n            val cachedEntry = macIdCacheDao.getSerialByMac(macId)\r\n            \r\n            if (cachedEntry != null) {\r\n                Log.d(TAG, \" Found serial in cache: ${cachedEntry.serialNumber} for MAC: $macId\")\r\n                return@withContext cachedEntry.serialNumber\r\n            }\r\n            \r\n            Log.d(TAG, \"MAC not found in cache, refreshing cache...\")\r\n            \r\n            // If not found, refresh cache and try again\r\n            val refreshSuccess = refreshCache()\r\n            \r\n            if (refreshSuccess) {\r\n                // Try again after refresh\r\n                val refreshedEntry = macIdCacheDao.getSerialByMac(macId)\r\n                if (refreshedEntry != null) {\r\n                    Log.d(TAG, \" Found serial after cache refresh: ${refreshedEntry.serialNumber} for MAC: $macId\")\r\n                    return@withContext refreshedEntry.serialNumber\r\n                }\r\n            }\r\n            \r\n            Log.w(TAG, \" MAC ID $macId not found even after cache refresh\")\r\n            return@withContext null\r\n            \r\n        } catch (e: Exception) {\r\n            Log.e(TAG, \"Error getting serial number\", e)\r\n            e.printStackTrace()\r\n            return@withContext null\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get cache statistics for debugging\r\n     */\r\n    suspend fun getCacheStats(): Map<String, Any?> = withContext(Dispatchers.IO) {\r\n        try {\r\n            val cacheSize = macIdCacheDao.getCacheSize()\r\n            val lastUpdateTime = macIdCacheDao.getLastUpdateTime()\r\n            val needsRefresh = shouldRefreshCache()\r\n            \r\n            mapOf(\r\n                \"cacheSize\" to cacheSize,\r\n                \"lastUpdateTime\" to (lastUpdateTime ?: 0L),\r\n                \"needsRefresh\" to needsRefresh,\r\n                \"lastUpdateFormatted\" to if (lastUpdateTime != null) {\r\n                    java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", java.util.Locale.US)\r\n                        .format(java.util.Date(lastUpdateTime))\r\n                } else \"Never\"\r\n            )\r\n        } catch (e: Exception) {\r\n            Log.e(TAG, \"Error getting cache stats\", e)\r\n            mapOf(\"error\" to (e.message ?: \"Unknown error\"))\r\n        }\r\n    }\r\n}\r\n",
        "firstEditBubbleId": "286b17df-418d-44e0-a416-8d359ebba644",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/RELIABILITY_FIXES_SUMMARY.md": {
        "content": "",
        "firstEditBubbleId": "dae47d9d-51af-425f-9216-c4e06aea0c79",
        "isNewlyCreated": true,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DriverPairingCacheManager.kt": {
        "content": "package com.example.fqcapp.services\n\nimport android.content.Context\nimport android.util.Log\nimport com.example.fqcapp.data.dao.DriverPairingCacheDao\nimport com.example.fqcapp.data.entities.DriverPairingCache\nimport kotlinx.coroutines.Dispatchers\nimport kotlinx.coroutines.withContext\nimport kotlinx.coroutines.CompletableDeferred\nimport kotlinx.coroutines.sync.Mutex\nimport kotlinx.coroutines.sync.withLock\nimport org.json.JSONArray\n\nclass DriverPairingCacheManager(\n    private val driverPairingCacheDao: DriverPairingCacheDao,\n    private val driverPairingSheetsService: DriverPairingSheetsService\n) {\n    companion object {\n        private const val TAG = \"DriverPairingCacheManager\"\n        private const val CACHE_EXPIRY_MS = 15 * 60 * 1000L // 15 minutes\n        private const val WORK_START_HOUR = 9 // 9 AM\n        private const val WORK_END_HOUR = 20 // 8 PM\n    }\n    \n    // Request deduplication: track ongoing requests to prevent duplicate API calls\n    private val ongoingRequests = mutableMapOf<String, CompletableDeferred<DriverPairingData?>>()\n    private val requestsMutex = Mutex()\n    \n    /**\n     * Check if current time is within work hours (9am - 8pm)\n     */\n    private fun isWithinWorkHours(): Boolean {\n        val calendar = java.util.Calendar.getInstance()\n        val currentHour = calendar.get(java.util.Calendar.HOUR_OF_DAY)\n        val result = currentHour >= WORK_START_HOUR && currentHour < WORK_END_HOUR\n        Log.d(TAG, \" [WORK_HOURS_CHECK] Current hour: $currentHour, within work hours (9am-8pm): $result\")\n        return result\n    }\n    \n    /**\n     * Check if cache needs refresh based on 15-minute rule during work hours\n     */\n    private suspend fun shouldRefreshCache(cached: DriverPairingCache?): Boolean = withContext(Dispatchers.IO) {\n        if (cached == null) {\n            Log.d(TAG, \" [CACHE_CHECK] No cache exists, needs refresh\")\n            return@withContext true\n        }\n        \n        // Outside work hours: use longer expiry (1 hour)\n        if (!isWithinWorkHours()) {\n            val timeDiff = System.currentTimeMillis() - cached.lastUpdated\n            val needsRefresh = timeDiff > (60 * 60 * 1000L) // 1 hour outside work hours\n            Log.d(TAG, \" [CACHE_CHECK] Outside work hours - timeDiff: ${timeDiff}ms, needs refresh: $needsRefresh\")\n            return@withContext needsRefresh\n        }\n        \n        // Within work hours: 15-minute expiry\n        val timeDiff = System.currentTimeMillis() - cached.lastUpdated\n        val needsRefresh = timeDiff > CACHE_EXPIRY_MS\n        Log.d(TAG, \" [CACHE_CHECK] Within work hours (9am-8pm) - timeDiff: ${timeDiff}ms (${timeDiff / 1000 / 60} mins), needs refresh (15min): $needsRefresh\")\n        return@withContext needsRefresh\n    }\n    \n    /**\n     * Get driver data - Uses cache-first approach with 15-minute refresh interval\n     * Only fetches from Google Sheets if cache is missing or stale (> 15 minutes)\n     * Implements request deduplication to prevent concurrent duplicate API calls\n     * This reduces API calls while still maintaining reasonable data freshness\n     * \n     * @param serialNumber Serial number to search for\n     * @param macId MAC ID to use as fallback if serial number search fails\n     */\n    suspend fun getDriverData(serialNumber: String, macId: String = \"\"): DriverPairingData? = withContext(Dispatchers.IO) {\n        try {\n            Log.d(TAG, \" [GET_DATA] Getting driver data for serial: $serialNumber, MAC: $macId\")\n            \n            // Step 1: Check cache first (cache-first approach)\n            // #region agent log\n            try {\n                val logFile = java.io.File(\"c:\\\\Users\\\\pc\\\\Desktop\\\\.cursor\\\\debug.log\")\n                val logEntry = org.json.JSONObject().apply {\n                    put(\"sessionId\", \"debug-session\")\n                    put(\"runId\", \"run1\")\n                    put(\"hypothesisId\", \"E\")\n                    put(\"location\", \"DriverPairingCacheManager.kt:78\")\n                    put(\"message\", \"Checking cache for driver data\")\n                    put(\"data\", org.json.JSONObject().apply {\n                        put(\"serialNumber\", serialNumber)\n                        put(\"macId\", macId)\n                        put(\"serialNumberIsBlank\", serialNumber.isBlank())\n                    })\n                    put(\"timestamp\", System.currentTimeMillis())\n                }\n                logFile.appendText(logEntry.toString() + \"\\n\")\n            } catch (e: Exception) {}\n            // #endregion\n            val cached = if (serialNumber.isNotBlank()) {\n                driverPairingCacheDao.getBySerialNumber(serialNumber)\n            } else {\n                null\n            }\n            // #region agent log\n            try {\n                val logFile = java.io.File(\"c:\\\\Users\\\\pc\\\\Desktop\\\\.cursor\\\\debug.log\")\n                val logEntry = org.json.JSONObject().apply {\n                    put(\"sessionId\", \"debug-session\")\n                    put(\"runId\", \"run1\")\n                    put(\"hypothesisId\", \"E\")\n                    put(\"location\", \"DriverPairingCacheManager.kt:82-result\")\n                    put(\"message\", \"Cache lookup result\")\n                    put(\"data\", org.json.JSONObject().apply {\n                        put(\"serialNumber\", serialNumber)\n                        put(\"cachedFound\", cached != null)\n                        put(\"cachedSerial\", cached?.serialNumber ?: \"null\")\n                        put(\"cachedMacId\", cached?.macId ?: \"null\")\n                        put(\"cachedLastUpdated\", cached?.lastUpdated?.toString() ?: \"null\")\n                    })\n                    put(\"timestamp\", System.currentTimeMillis())\n                }\n                logFile.appendText(logEntry.toString() + \"\\n\")\n            } catch (e: Exception) {}\n            // #endregion\n            \n            // Step 2: If cache exists and is fresh (< 15 minutes), return cached data immediately\n            val shouldRefresh = if (cached != null) shouldRefreshCache(cached) else true\n            // #region agent log\n            try {\n                val logFile = java.io.File(\"c:\\\\Users\\\\pc\\\\Desktop\\\\.cursor\\\\debug.log\")\n                val logEntry = org.json.JSONObject().apply {\n                    put(\"sessionId\", \"debug-session\")\n                    put(\"runId\", \"run1\")\n                    put(\"hypothesisId\", \"E\")\n                    put(\"location\", \"DriverPairingCacheManager.kt:85\")\n                    put(\"message\", \"Cache freshness check\")\n                    put(\"data\", org.json.JSONObject().apply {\n                        put(\"cachedFound\", cached != null)\n                        put(\"shouldRefresh\", shouldRefresh)\n                        put(\"willUseCache\", cached != null && !shouldRefresh)\n                    })\n                    put(\"timestamp\", System.currentTimeMillis())\n                }\n                logFile.appendText(logEntry.toString() + \"\\n\")\n            } catch (e: Exception) {}\n            // #endregion\n            if (cached != null && !shouldRefresh) {\n                Log.d(TAG, \" [GET_DATA] Using fresh cached data (age: ${(System.currentTimeMillis() - cached.lastUpdated) / 1000 / 60} minutes)\")\n                val drivers = try {\n                    JSONArray(cached.driverData).let { jsonArray ->\n                        (0 until jsonArray.length()).map { jsonArray.getString(it) }\n                    }\n                } catch (e: Exception) {\n                    Log.w(TAG, \" [GET_DATA] Error parsing cached driver data\", e)\n                    emptyList<String>()\n                }\n                if (drivers.isNotEmpty()) {\n                    return@withContext DriverPairingData(\n                        serialNumber = cached.serialNumber,\n                        macId = cached.macId,\n                        drivers = drivers\n                    )\n                }\n            }\n            \n            // Step 3: Check for ongoing request (request deduplication)\n            val requestKey = serialNumber.ifBlank { macId }\n            if (requestKey.isNotBlank()) {\n                val existingRequest = requestsMutex.withLock {\n                    ongoingRequests[requestKey]\n                }\n                \n                if (existingRequest != null) {\n                    Log.d(TAG, \" [GET_DATA] Waiting for ongoing request for key: $requestKey\")\n                    val result = existingRequest.await()\n                    Log.d(TAG, \" [GET_DATA] Received result from ongoing request\")\n                    return@withContext result\n                }\n            }\n            \n            // Step 4: Create new request and track it\n            val deferred = if (requestKey.isNotBlank()) {\n                CompletableDeferred<DriverPairingData?>().also { deferred ->\n                    requestsMutex.withLock {\n                        ongoingRequests[requestKey] = deferred\n                    }\n                }\n            } else {\n                null\n            }\n            \n            try {\n                // Step 5: Cache is missing or stale - fetch from Google Sheets\n                // #region agent log\n                try {\n                    val logFile = java.io.File(\"c:\\\\Users\\\\pc\\\\Desktop\\\\.cursor\\\\debug.log\")\n                    val logEntry = org.json.JSONObject().apply {\n                        put(\"sessionId\", \"debug-session\")\n                        put(\"runId\", \"run1\")\n                        put(\"hypothesisId\", \"F\")\n                        put(\"location\", \"DriverPairingCacheManager.kt:132\")\n                        put(\"message\", \"Calling Google Sheets API\")\n                        put(\"data\", org.json.JSONObject().apply {\n                            put(\"serialNumber\", serialNumber)\n                            put(\"macId\", macId)\n                            put(\"cachedExists\", cached != null)\n                            put(\"reason\", if (cached != null) \"cache_stale\" else \"cache_missing\")\n                        })\n                        put(\"timestamp\", System.currentTimeMillis())\n                    }\n                    logFile.appendText(logEntry.toString() + \"\\n\")\n                } catch (e: Exception) {}\n                // #endregion\n                if (cached != null) {\n                    Log.d(TAG, \" [GET_DATA] Cache is stale (age: ${(System.currentTimeMillis() - cached.lastUpdated) / 1000 / 60} minutes), fetching from Google Sheets\")\n                } else {\n                    Log.d(TAG, \" [GET_DATA] No cache found, fetching from Google Sheets\")\n                }\n                \n                var sheetsData: DriverPairingData? = null\n                \n                // Try serial number search first if available\n                if (serialNumber.isNotBlank()) {\n                    sheetsData = driverPairingSheetsService.getDriverDataBySerial(serialNumber)\n                }\n                \n                // Step 6: If serial number search fails (or serial is blank) and MAC ID is available, try MAC ID search\n                if (sheetsData == null && macId.isNotBlank()) {\n                    Log.d(TAG, \" [GET_DATA] Serial number search ${if (serialNumber.isBlank()) \"not attempted (blank)\" else \"failed\"}, trying MAC ID search: $macId\")\n                    sheetsData = driverPairingSheetsService.getDriverDataByMacId(macId)\n                    if (sheetsData != null) {\n                        Log.d(TAG, \" [GET_DATA] Found data by MAC ID: ${sheetsData.drivers.size} driver entries\")\n                    }\n                }\n                \n                if (sheetsData != null) {\n                    Log.d(TAG, \" [GET_DATA] Fetched fresh data from Google Sheets: ${sheetsData.drivers.size} driver entries\")\n                    Log.d(TAG, \" [GET_DATA] Serial: ${sheetsData.serialNumber}, MAC: ${sheetsData.macId}\")\n                    \n                    // Update cache with fresh data\n                    val driverDataJson = JSONArray(sheetsData.drivers).toString()\n                    val cacheEntry = DriverPairingCache(\n                        serialNumber = sheetsData.serialNumber,\n                        macId = sheetsData.macId,\n                        driverData = driverDataJson,\n                        lastUpdated = System.currentTimeMillis(),\n                        lastSyncedToSheets = System.currentTimeMillis() // Just fetched, so in sync\n                    )\n                    driverPairingCacheDao.insert(cacheEntry)\n                    Log.d(TAG, \" [GET_DATA] Updated cache with Google Sheets data\")\n                    \n                    // Complete deferred request\n                    deferred?.complete(sheetsData)\n                    return@withContext sheetsData\n                }\n                \n                // Step 7: If Google Sheets fetch fails, try to return cached data as fallback (even if stale)\n                if (cached != null) {\n                    Log.w(TAG, \" [GET_DATA] Google Sheets fetch failed, using cached data as fallback (may be stale)\")\n                    val drivers = try {\n                        JSONArray(cached.driverData).let { jsonArray ->\n                            (0 until jsonArray.length()).map { jsonArray.getString(it) }\n                        }\n                    } catch (e: Exception) {\n                        emptyList<String>()\n                    }\n                    if (drivers.isNotEmpty()) {\n                        val result = DriverPairingData(\n                            serialNumber = cached.serialNumber,\n                            macId = cached.macId,\n                            drivers = drivers\n                        )\n                        deferred?.complete(result)\n                        return@withContext result\n                    }\n                }\n                \n                Log.w(TAG, \" [GET_DATA] No data found in Google Sheets or cache\")\n                deferred?.complete(null)\n                return@withContext null\n                \n            } catch (e: Exception) {\n                Log.e(TAG, \" [GET_DATA] Error getting driver data\", e)\n                // Try cache as fallback on error\n                try {\n                    val cached = driverPairingCacheDao.getBySerialNumber(serialNumber)\n                    if (cached != null) {\n                        Log.d(TAG, \" [GET_DATA] Using cached data as fallback after error\")\n                        val drivers = try {\n                            JSONArray(cached.driverData).let { jsonArray ->\n                                (0 until jsonArray.length()).map { jsonArray.getString(it) }\n                            }\n                        } catch (ex: Exception) {\n                            emptyList<String>()\n                        }\n                        val result = DriverPairingData(\n                            serialNumber = cached.serialNumber,\n                            macId = cached.macId,\n                            drivers = drivers\n                        )\n                        deferred?.complete(result)\n                        return@withContext result\n                    }\n                } catch (ex: Exception) {\n                    Log.e(TAG, \" [GET_DATA] Error getting cached data\", ex)\n                }\n                deferred?.complete(null)\n                return@withContext null\n            } finally {\n                // Remove from ongoing requests\n                if (requestKey.isNotBlank()) {\n                    requestsMutex.withLock {\n                        ongoingRequests.remove(requestKey)\n                    }\n                }\n            }\n        } catch (e: Exception) {\n            Log.e(TAG, \" [GET_DATA] Unexpected error\", e)\n            return@withContext null\n        }\n    }\n    \n    /**\n     * Save driver data - updates cache immediately, syncs to Google Sheets\n     */\n    suspend fun saveDriverData(\n        serialNumber: String,\n        macId: String,\n        row1Driver1: String,\n        row1Driver2: String,\n        additionalRows: List<Pair<String, String>>\n    ): Boolean = withContext(Dispatchers.IO) {\n        try {\n            Log.d(TAG, \" Saving driver data for serial: $serialNumber\")\n            \n            // Build driver data list\n            val drivers = mutableListOf<String>()\n            drivers.add(row1Driver1)\n            drivers.add(row1Driver2)\n            additionalRows.forEach { (driver1, driver2) ->\n                drivers.add(driver1)\n                drivers.add(driver2)\n            }\n            \n            // 1. Update local cache immediately (optimistic update)\n            val driverDataJson = JSONArray(drivers).toString()\n            val currentTime = System.currentTimeMillis()\n            val cacheEntry = DriverPairingCache(\n                serialNumber = serialNumber,\n                macId = macId,\n                driverData = driverDataJson,\n                lastUpdated = currentTime,\n                lastSyncedToSheets = 0L // Mark as unsynced until successful\n            )\n            driverPairingCacheDao.insert(cacheEntry)\n            Log.d(TAG, \" Updated local cache\")\n            \n            // 2. Sync to Google Sheets in background\n            try {\n                val syncSuccess = driverPairingSheetsService.saveDriverData(\n                    serialNumber = serialNumber,\n                    macId = macId,\n                    row1Driver1 = row1Driver1,\n                    row1Driver2 = row1Driver2,\n                    additionalRows = additionalRows\n                )\n                \n                if (syncSuccess) {\n                    // Update sync timestamp\n                    val updatedCache = cacheEntry.copy(\n                        lastSyncedToSheets = System.currentTimeMillis()\n                    )\n                    driverPairingCacheDao.update(updatedCache)\n                    Log.d(TAG, \" Synced to Google Sheets successfully\")\n                } else {\n                    Log.w(TAG, \" Failed to sync to Google Sheets, but cache is updated\")\n                }\n                \n                return@withContext syncSuccess\n            } catch (e: Exception) {\n                Log.e(TAG, \"Error syncing to Google Sheets\", e)\n                // Cache is still updated, so return true (local save succeeded)\n                return@withContext true\n            }\n            \n        } catch (e: Exception) {\n            Log.e(TAG, \"Error saving driver data\", e)\n            return@withContext false\n        }\n    }\n    \n    /**\n     * Delete driver data (local cache and Google Sheets)\n     */\n    suspend fun deleteDriverData(serialNumber: String): Boolean = withContext(Dispatchers.IO) {\n        try {\n            Log.d(TAG, \" [DELETE] Deleting driver data for serial: $serialNumber\")\n            \n            // 1. Delete from local cache\n            driverPairingCacheDao.deleteBySerial(serialNumber)\n            Log.d(TAG, \" [DELETE] Deleted from local cache\")\n            \n            // 2. Delete from Google Sheets\n            val deleteSuccess = driverPairingSheetsService.deleteDriverData(serialNumber)\n            if (deleteSuccess) {\n                Log.d(TAG, \" [DELETE] Deleted from Google Sheets\")\n            } else {\n                Log.w(TAG, \" [DELETE] Failed to delete from Google Sheets (but local cache deleted)\")\n            }\n            \n            return@withContext deleteSuccess\n        } catch (e: Exception) {\n            Log.e(TAG, \" [DELETE] Error deleting driver data\", e)\n            return@withContext false\n        }\n    }\n    \n    /**\n     * Check if there are unsynced entries that need to be synced to Google Sheets\n     */\n    suspend fun hasUnsyncedEntries(): Boolean = withContext(Dispatchers.IO) {\n        try {\n            val unsynced = driverPairingCacheDao.getUnsyncedEntries(System.currentTimeMillis())\n            return@withContext unsynced.isNotEmpty()\n        } catch (e: Exception) {\n            Log.e(TAG, \"Error checking unsynced entries\", e)\n            return@withContext false\n        }\n    }\n    \n    /**\n     * Sync all unsynced entries to Google Sheets\n     */\n    suspend fun syncUnsyncedEntries(): Int = withContext(Dispatchers.IO) {\n        try {\n            Log.d(TAG, \" [SYNC_START] Starting manual sync of unsynced driver pairing entries...\")\n            val unsynced = driverPairingCacheDao.getUnsyncedEntries(System.currentTimeMillis())\n            Log.d(TAG, \" [SYNC_CHECK] Found ${unsynced.size} unsynced entries\")\n            \n            if (unsynced.isEmpty()) {\n                Log.d(TAG, \" [SYNC_EMPTY] No unsynced entries found, sync complete\")\n                return@withContext 0\n            }\n            \n            var successCount = 0\n            var failureCount = 0\n            unsynced.forEachIndexed { index, cache ->\n                try {\n                    Log.d(TAG, \" [SYNC_ENTRY] Syncing entry ${index + 1}/${unsynced.size}: Serial=${cache.serialNumber}, MAC=${cache.macId}\")\n                    \n                    // Parse driver data\n                    val drivers = JSONArray(cache.driverData).let { jsonArray ->\n                        (0 until jsonArray.length()).map { jsonArray.getString(it) }\n                    }\n                    \n                    Log.d(TAG, \" [SYNC_PARSE] Parsed ${drivers.size} driver entries from cache\")\n                    \n                    if (drivers.size >= 2) {\n                        val row1Driver1 = drivers[0]\n                        val row1Driver2 = drivers[1]\n                        val additionalRows = mutableListOf<Pair<String, String>>()\n                        \n                        var i = 2\n                        while (i < drivers.size - 1) {\n                            additionalRows.add(Pair(drivers[i], drivers[i + 1]))\n                            i += 2\n                        }\n                        \n                        Log.d(TAG, \" [SYNC_SAVE] Saving to Google Sheets - Row1: Driver1='$row1Driver1', Driver2='$row1Driver2', Additional rows: ${additionalRows.size}\")\n                        \n                        val success = driverPairingSheetsService.saveDriverData(\n                            serialNumber = cache.serialNumber,\n                            macId = cache.macId,\n                            row1Driver1 = row1Driver1,\n                            row1Driver2 = row1Driver2,\n                            additionalRows = additionalRows\n                        )\n                        \n                        if (success) {\n                            Log.d(TAG, \" [SYNC_SUCCESS] Successfully synced entry: ${cache.serialNumber}\")\n                            val updatedCache = cache.copy(\n                                lastSyncedToSheets = System.currentTimeMillis()\n                            )\n                            driverPairingCacheDao.update(updatedCache)\n                            successCount++\n                        } else {\n                            Log.w(TAG, \" [SYNC_FAIL] Failed to sync entry: ${cache.serialNumber}\")\n                            failureCount++\n                        }\n                    } else {\n                        Log.w(TAG, \" [SYNC_INVALID] Entry ${cache.serialNumber} has invalid driver data (${drivers.size} entries, need at least 2)\")\n                        failureCount++\n                    }\n                } catch (e: Exception) {\n                    Log.e(TAG, \" [SYNC_ERROR] Error syncing entry ${cache.serialNumber}\", e)\n                    failureCount++\n                }\n            }\n            \n            Log.d(TAG, \" [SYNC_COMPLETE] Sync finished: $successCount successful, $failureCount failed out of ${unsynced.size} total\")\n            return@withContext successCount\n        } catch (e: Exception) {\n            Log.e(TAG, \"Error syncing unsynced entries\", e)\n            return@withContext 0\n        }\n    }\n}\n\n",
        "firstEditBubbleId": "b4fcf342-8e5c-4606-a173-c7962cbe7598",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/DriverPairingScreen.kt": {
        "content": "package com.example.fqcapp\n\nimport androidx.compose.foundation.clickable\nimport androidx.compose.foundation.layout.*\nimport androidx.compose.foundation.rememberScrollState\nimport androidx.compose.foundation.shape.CircleShape\nimport androidx.compose.foundation.shape.RoundedCornerShape\nimport androidx.compose.foundation.text.KeyboardOptions\nimport androidx.compose.foundation.verticalScroll\nimport androidx.compose.material.icons.Icons\nimport androidx.compose.material.icons.filled.Add\nimport androidx.compose.material.icons.filled.ArrowBack\nimport androidx.compose.material.icons.filled.Delete\nimport androidx.compose.material3.*\nimport androidx.compose.runtime.*\nimport androidx.compose.ui.Alignment\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.text.font.FontWeight\nimport androidx.compose.ui.text.input.KeyboardType\nimport androidx.compose.ui.unit.dp\nimport androidx.compose.ui.unit.sp\nimport androidx.compose.ui.window.Dialog\nimport androidx.compose.ui.platform.LocalContext\nimport com.example.fqcapp.services.DriverPairingSheetsService\nimport com.example.fqcapp.services.DriverPairingCacheManager\nimport com.example.fqcapp.services.DriverPairingData\nimport com.example.fqcapp.ui.components.TestStageSelector\nimport org.json.JSONArray\nimport kotlinx.coroutines.launch\nimport android.widget.Toast\nimport android.util.Log\n\ndata class DriverRow(\n    val driver1: String = \"\",\n    val driver2: String = \"\",\n    val rowType: String = \"\" // \"interchange\", \"change\", \"other\"\n)\n\nenum class RowActionType {\n    INTERCHANGE,\n    CHANGE,\n    OTHER\n}\n\n@OptIn(ExperimentalMaterial3Api::class)\n@Composable\nfun DriverPairingScreen(\n    serialNumber: String,\n    macId: String,\n    deviceName: String?,\n    authenticatedOperator: com.example.fqcapp.data.entities.OperatorCredential? = null,\n    onBack: () -> Unit,\n    onSave: (List<String>) -> Unit,\n    onNavigateToChangedPart: () -> Unit = {},\n    solutionReminderManager: com.example.fqcapp.core.SolutionReminderManager? = null\n) {\n    val context = LocalContext.current\n    val scope = rememberCoroutineScope()\n    val bgColor = Color(0xFF121212)\n    val surfaceColor = Color(0xFF2B2B2B)\n    val accentColor = Color(0xFFFFC107) // Yellow - App theme color\n    val textColor = Color.White\n    val dangerColor = Color(0xFFEF4444) // Red for delete\n    \n    // Row 1 - Always visible and editable\n    var driver1Row1 by remember { mutableStateOf(\"\") }\n    var driver2Row1 by remember { mutableStateOf(\"\") }\n    \n    // Dynamic rows (Row 2 onwards)\n    var dynamicRows by remember { mutableStateOf<List<DriverRow>>(emptyList()) }\n    \n    // Dialog state\n    var showAddRowDialog by remember { mutableStateOf(false) }\n    \n    // Loading state\n    var isLoading by remember { mutableStateOf(true) }\n    var isSaving by remember { mutableStateOf(false) }\n    \n    // Track entry time for driver pairing\n    var sessionStartTime by remember { mutableStateOf<Long?>(null) }\n    \n    // Test stage selector state - start as null to force selection\n    var selectedTestStage by remember { mutableStateOf<String?>(null) }\n    \n    // Show alert dialog when trying to submit without selecting test stage\n    var showTestStageRequiredDialog by remember { mutableStateOf(false) }\n    \n    // Get operator name - use authenticated operator if available, otherwise fallback to preferences\n    val prefsManager = remember { com.example.fqcapp.utils.PreferencesManager(context) }\n    var operatorName by remember { mutableStateOf(\"Unknown\") }\n    var operatorId by remember { mutableStateOf(\"\") }\n    \n    // Use authenticated operator if provided\n    LaunchedEffect(authenticatedOperator) {\n        if (authenticatedOperator != null) {\n            operatorName = authenticatedOperator.operatorName\n            operatorId = authenticatedOperator.operatorId\n            Log.d(\"DriverPairing\", \" Using authenticated operator: $operatorName (ID: $operatorId)\")\n        } else {\n            operatorName = prefsManager.getOperatorName() ?: \"Unknown\"\n            Log.d(\"DriverPairing\", \" No authenticated operator, using preferences: $operatorName\")\n        }\n    }\n    \n    // Database and Cache Manager\n    val database = remember { com.example.fqcapp.data.AppDatabase.getDatabase(context) }\n    val repository = remember { com.example.fqcapp.data.FQCRepository(database) }\n    val driverPairingSheetsService = remember { DriverPairingSheetsService(context) }\n    val cacheManager = remember {\n        DriverPairingCacheManager(\n            repository.getDriverPairingCacheDao(),\n            driverPairingSheetsService\n        )\n    }\n    \n    // Device Workflow Service\n    val workflowService = remember { com.example.fqcapp.services.DeviceWorkflowService(repository) }\n    \n    // Session timestamp manager\n    val sessionTimestampManager = remember { com.example.fqcapp.core.SessionTimestampManager(context) }\n    \n    // Capture entry time when screen opens and get session timestamp\n    LaunchedEffect(Unit) {\n        Log.d(\"DriverPairing\", \"\")\n        Log.d(\"DriverPairing\", \" [SCREEN] DRIVER PAIRING SCREEN OPENED\")\n        Log.d(\"DriverPairing\", \"   Serial Number: $serialNumber\")\n        Log.d(\"DriverPairing\", \"   MAC ID: $macId\")\n        Log.d(\"DriverPairing\", \"   Operator: $operatorName\")\n        Log.d(\"DriverPairing\", \"   Operator ID: $operatorId\")\n        Log.d(\"DriverPairing\", \"\")\n        \n        sessionStartTime = System.currentTimeMillis()\n        Log.d(\"DriverPairing\", \" [TIMING] Entry time captured: $sessionStartTime\")\n        // Operator name is set by the authenticatedOperator LaunchedEffect above\n        \n        // Get or create session timestamp\n        if (serialNumber.isNotBlank()) {\n            Log.d(\"DriverPairing\", \" [ACTION] Getting/creating session timestamp...\")\n            val sessionEntryTimestamp = sessionTimestampManager.getSessionEntryTimestamp(serialNumber)\n            Log.d(\"DriverPairing\", \"    Session entry timestamp: $sessionEntryTimestamp\")\n            \n            // Log workflow: Driver Pairing STARTED\n            Log.d(\"DriverPairing\", \" [ACTION] Getting next iteration number from Supabase...\")\n            try {\n                val iterationNumber = workflowService.getNextDriverPairingIteration(serialNumber)\n                Log.d(\"DriverPairing\", \"    Next iteration: $iterationNumber\")\n                \n                Log.d(\"DriverPairing\", \" [ACTION] Logging workflow event...\")\n                workflowService.logWorkflow(\n                    serialNumber = serialNumber,\n                    stage = com.example.fqcapp.services.DeviceWorkflowService.STAGE_DRIVER_PAIRING,\n                    operatorName = operatorName,\n                    action = com.example.fqcapp.services.DeviceWorkflowService.ACTION_STARTED,\n                    iterationNumber = iterationNumber\n                )\n                Log.d(\"DriverPairing\", \"    [WORKFLOW] Logged DRIVER_PAIRING STARTED with iteration: $iterationNumber\")\n            } catch (e: Exception) {\n                Log.e(\"DriverPairing\", \"    [WORKFLOW] Error logging workflow STARTED: ${e.message}\")\n                Log.e(\"DriverPairing\", \"   Stack trace: ${e.stackTraceToString()}\")\n            }\n        }\n        Log.d(\"DriverPairing\", \"\")\n    }\n    \n    // Load data from Google Sheets EVERY TIME screen opens (for multi-user sync)\n    // Using serialNumber and macId as keys ensures it reloads when these change or when navigating to screen\n    LaunchedEffect(serialNumber, macId) {\n        Log.d(\"DriverPairing\", \" [SCREEN_OPEN] DriverPairingScreen opened for serial: $serialNumber, MAC: $macId\")\n        // Load data if we have either serial number OR MAC ID\n        if (serialNumber.isNotBlank() || macId.isNotBlank()) {\n            isLoading = true\n            try {\n                Log.d(\"DriverPairing\", \" [LOAD_START] Starting to load driver data from Google Sheets (force refresh for multi-user sync)\")\n                // Always fetch fresh data from Google Sheets (forceRefresh = true by default)\n                // Pass MAC ID as fallback in case serial number search fails\n                // If serial number is blank, use MAC ID for search\n                val searchSerial = if (serialNumber.isNotBlank()) serialNumber else \"\"\n                val data = cacheManager.getDriverData(searchSerial, macId)\n                if (data != null) {\n                    Log.d(\"DriverPairing\", \" [LOAD_SUCCESS] Found existing data with ${data.drivers.size} driver entries\")\n                    \n                    // Set Row 1 drivers (indices 0, 1)\n                    if (data.drivers.size >= 2) {\n                        driver1Row1 = data.drivers[0]\n                        driver2Row1 = data.drivers[1]\n                        Log.d(\"DriverPairing\", \" [DATA_LOADED] Row 1 - Driver1: '${data.drivers[0]}', Driver2: '${data.drivers[1]}'\")\n                    } else {\n                        // Clear Row 1 if no data\n                        driver1Row1 = \"\"\n                        driver2Row1 = \"\"\n                        Log.d(\"DriverPairing\", \" [DATA_LOADED] Row 1 - No data, cleared fields\")\n                    }\n                    \n                    // Load additional rows (pairs starting from index 2)\n                    val additionalRows = mutableListOf<DriverRow>()\n                    var i = 2\n                    var rowIndex = 2\n                    while (i < data.drivers.size - 1) {\n                        val row = DriverRow(\n                            driver1 = data.drivers[i],\n                            driver2 = data.drivers[i + 1],\n                            rowType = \"\" // Could be stored separately if needed\n                        )\n                        additionalRows.add(row)\n                        Log.d(\"DriverPairing\", \" [DATA_LOADED] Row $rowIndex - Driver1: '${data.drivers[i]}', Driver2: '${data.drivers[i + 1]}'\")\n                        i += 2\n                        rowIndex++\n                    }\n                    dynamicRows = additionalRows\n                    Log.d(\"DriverPairing\", \" [LOAD_COMPLETE] Loaded ${additionalRows.size} additional rows\")\n                    \n                    Toast.makeText(context, \"Loaded driver data from Google Sheets\", Toast.LENGTH_SHORT).show()\n                } else {\n                    Log.d(\"DriverPairing\", \" [LOAD_EMPTY] No existing data found in Google Sheets, starting fresh\")\n                    // Clear all fields if no data found\n                    driver1Row1 = \"\"\n                    driver2Row1 = \"\"\n                    dynamicRows = emptyList()\n                    // If serial not found, we'll insert it when saving\n                }\n            } catch (e: Exception) {\n                Log.e(\"DriverPairing\", \" [LOAD_ERROR] Error loading data\", e)\n                Toast.makeText(context, \"Error loading data: ${e.message}\", Toast.LENGTH_LONG).show()\n            } finally {\n                isLoading = false\n                Log.d(\"DriverPairing\", \" [LOAD_FINISHED] Loading state set to false\")\n            }\n        } else {\n            Log.w(\"DriverPairing\", \" [LOAD_SKIP] Serial number is blank, skipping load\")\n            isLoading = false\n        }\n    }\n    \n    Scaffold(\n        containerColor = bgColor,\n        topBar = {\n            TopAppBar(\n                title = {\n                    Text(\n                        \"Driver Pairing\",\n                        color = accentColor,\n                        fontSize = 18.sp,\n                        fontWeight = FontWeight.Bold\n                    )\n                },\n                navigationIcon = {\n                    IconButton(onClick = {\n                        Log.d(\"DriverPairing\", \" [BACK_BUTTON] Back button tapped\")\n                        onBack()\n                    }) {\n                        Icon(\n                            Icons.Filled.ArrowBack,\n                            contentDescription = \"Back\",\n                            tint = textColor\n                        )\n                    }\n                },\n                colors = TopAppBarDefaults.topAppBarColors(\n                    containerColor = bgColor\n                )\n            )\n        },\n        floatingActionButton = {\n            FloatingActionButton(\n                onClick = {\n                    Log.d(\"DriverPairing\", \" [FAB_TAP] + button tapped, opening Add Row dialog\")\n                    Log.d(\"DriverPairing\", \" [FAB_STATE] Current rows: ${dynamicRows.size + 1} total (1 static + ${dynamicRows.size} dynamic)\")\n                    showAddRowDialog = true\n                },\n                modifier = Modifier.padding(16.dp),\n                containerColor = accentColor,\n                contentColor = bgColor,\n                shape = CircleShape\n            ) {\n                Icon(\n                    Icons.Filled.Add,\n                    contentDescription = \"Add Row\",\n                    tint = bgColor\n                )\n            }\n        }\n    ) { padding ->\n        if (isLoading) {\n            Box(\n                modifier = Modifier\n                    .fillMaxSize()\n                    .padding(padding),\n                contentAlignment = Alignment.Center\n            ) {\n                CircularProgressIndicator(color = accentColor)\n            }\n        } else {\n            Box(\n                modifier = Modifier\n                    .fillMaxSize()\n                    .padding(padding)\n            ) {\n                Column(\n                    modifier = Modifier\n                        .fillMaxSize()\n                        .verticalScroll(rememberScrollState())\n                        .padding(16.dp),\n                    verticalArrangement = Arrangement.spacedBy(16.dp)\n                ) {\n                    // Test Stage Selector\n                    Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {\n                        Text(\n                            \"Test Result Review\",\n                            style = MaterialTheme.typography.headlineMedium,\n                            fontWeight = FontWeight.Bold,\n                            color = Color.White\n                        )\n                        Text(\n                            \"Select the test stage and result below\",\n                            style = MaterialTheme.typography.bodyMedium,\n                            color = Color.White.copy(alpha = 0.7f)\n                        )\n                        TestStageSelector(\n                            selectedStage = selectedTestStage,\n                            onStageSelected = { selectedTestStage = it }\n                        )\n                    }\n                    // Device Information Card\n                    Card(\n                        modifier = Modifier.fillMaxWidth(),\n                        colors = CardDefaults.cardColors(containerColor = surfaceColor),\n                        shape = RoundedCornerShape(12.dp)\n                    ) {\n                        Column(\n                            modifier = Modifier.padding(16.dp),\n                            verticalArrangement = Arrangement.spacedBy(12.dp)\n                        ) {\n                            Text(\n                                text = \"Device Information\",\n                                style = MaterialTheme.typography.titleMedium,\n                                color = accentColor,\n                                fontWeight = FontWeight.Bold\n                            )\n                            \n                            HorizontalDivider(color = Color(0xFF424242))\n                            \n                            // Serial Number\n                            Row(\n                                modifier = Modifier.fillMaxWidth(),\n                                horizontalArrangement = Arrangement.SpaceBetween\n                            ) {\n                                Text(\n                                    \"Serial Number:\",\n                                    color = textColor.copy(alpha = 0.7f),\n                                    fontSize = 14.sp\n                                )\n                                Text(\n                                    serialNumber.ifBlank { \"Not found\" },\n                                    color = accentColor,\n                                    fontSize = 14.sp,\n                                    fontWeight = FontWeight.Medium\n                                )\n                            }\n                            \n                            // MAC ID\n                            Row(\n                                modifier = Modifier.fillMaxWidth(),\n                                horizontalArrangement = Arrangement.SpaceBetween\n                            ) {\n                                Text(\n                                    \"MAC ID:\",\n                                    color = textColor.copy(alpha = 0.7f),\n                                    fontSize = 14.sp\n                                )\n                                Text(\n                                    macId.ifBlank { \"Unknown\" },\n                                    color = accentColor,\n                                    fontSize = 14.sp,\n                                    fontWeight = FontWeight.Medium\n                                )\n                            }\n                            \n                            // Device Name (if available)\n                            if (deviceName != null) {\n                                Row(\n                                    modifier = Modifier.fillMaxWidth(),\n                                    horizontalArrangement = Arrangement.SpaceBetween\n                                ) {\n                                    Text(\n                                        \"Device Name:\",\n                                        color = textColor.copy(alpha = 0.7f),\n                                        fontSize = 14.sp\n                                    )\n                                    Text(\n                                        deviceName,\n                                        color = textColor,\n                                        fontSize = 14.sp,\n                                        fontWeight = FontWeight.Medium\n                                    )\n                                }\n                            }\n                        }\n                    }\n                    \n                    // Driver Information Section\n                    Card(\n                        modifier = Modifier.fillMaxWidth(),\n                        colors = CardDefaults.cardColors(containerColor = surfaceColor),\n                        shape = RoundedCornerShape(12.dp)\n                    ) {\n                        Column(\n                            modifier = Modifier.padding(16.dp),\n                            verticalArrangement = Arrangement.spacedBy(16.dp)\n                        ) {\n                            Text(\n                                text = \"Driver Information\",\n                                style = MaterialTheme.typography.titleMedium,\n                                color = accentColor,\n                                fontWeight = FontWeight.Bold\n                            )\n                            \n                            HorizontalDivider(color = Color(0xFF424242))\n                            \n                            // Row 1: Driver 1 and Driver 2 (Always visible)\n                            DriverRowInput(\n                                label = \"Row 1\",\n                                driver1 = driver1Row1,\n                                driver2 = driver2Row1,\n                                onDriver1Change = {\n                                    Log.d(\"DriverPairing\", \" [ROW1_DRIVER1_CHANGE] Changed from '$driver1Row1' to '$it'\")\n                                    driver1Row1 = it\n                                },\n                                onDriver2Change = {\n                                    Log.d(\"DriverPairing\", \" [ROW1_DRIVER2_CHANGE] Changed from '$driver2Row1' to '$it'\")\n                                    driver2Row1 = it\n                                },\n                                textColor = textColor,\n                                bgColor = bgColor,\n                                accentColor = accentColor,\n                                showDelete = false\n                            )\n                            \n                            // Dynamic rows (Row 2 onwards)\n                            dynamicRows.forEachIndexed { index, row ->\n                                DriverRowInput(\n                                    label = \"Row ${index + 2}\",\n                                    driver1 = row.driver1,\n                                    driver2 = row.driver2,\n                                    onDriver1Change = {\n                                        val rowNum = index + 2\n                                        Log.d(\"DriverPairing\", \" [ROW${rowNum}_DRIVER1_CHANGE] Row $rowNum Driver1 changed from '${row.driver1}' to '$it'\")\n                                        dynamicRows = dynamicRows.mapIndexed { i, r ->\n                                            if (i == index) r.copy(driver1 = it) else r\n                                        }\n                                    },\n                                    onDriver2Change = {\n                                        val rowNum = index + 2\n                                        Log.d(\"DriverPairing\", \" [ROW${rowNum}_DRIVER2_CHANGE] Row $rowNum Driver2 changed from '${row.driver2}' to '$it'\")\n                                        dynamicRows = dynamicRows.mapIndexed { i, r ->\n                                            if (i == index) r.copy(driver2 = it) else r\n                                        }\n                                    },\n                                    textColor = textColor,\n                                    bgColor = bgColor,\n                                    accentColor = accentColor,\n                                    rowType = row.rowType,\n                                    showDelete = true,\n                                    onDelete = {\n                                        val rowNum = index + 2\n                                        Log.d(\"DriverPairing\", \" [ROW_DELETE] Delete button tapped for Row $rowNum (Driver1: '${row.driver1}', Driver2: '${row.driver2}')\")\n                                        dynamicRows = dynamicRows.filterIndexed { i, _ -> i != index }\n                                        Log.d(\"DriverPairing\", \" [ROW_DELETE] After deletion: ${dynamicRows.size} dynamic rows remaining\")\n                                    }\n                                )\n                            }\n                        }\n                    }\n                    \n                    Spacer(modifier = Modifier.height(80.dp)) // Space for FAB\n                    \n                    // Save Entry Button\n                    Button(\n                        onClick = {\n                            Log.d(\"DriverPairing\", \" [SAVE_BUTTON] Save Entry button tapped\")\n                            \n                            // Validate test stage is selected\n                            if (selectedTestStage == null) {\n                                showTestStageRequiredDialog = true\n                                return@Button\n                            }\n                            Log.d(\"DriverPairing\", \" [SAVE_DATA] Serial: $serialNumber, MAC: $macId\")\n                            Log.d(\"DriverPairing\", \" [SAVE_DATA] Row 1 - Driver1: '$driver1Row1', Driver2: '$driver2Row1'\")\n                            Log.d(\"DriverPairing\", \" [SAVE_DATA] Additional rows: ${dynamicRows.size}\")\n                            dynamicRows.forEachIndexed { index, row ->\n                                Log.d(\"DriverPairing\", \" [SAVE_DATA] Row ${index + 2} - Driver1: '${row.driver1}', Driver2: '${row.driver2}', Type: '${row.rowType}'\")\n                            }\n                            \n                            scope.launch {\n                                isSaving = true\n                                Log.d(\"DriverPairing\", \" [SAVE_START] Starting save process...\")\n                                try {\n                                    val additionalRows = dynamicRows.map { \n                                        Pair(it.driver1, it.driver2) \n                                    }\n                                    Log.d(\"DriverPairing\", \" [SAVE_PROCESS] Calling cacheManager.saveDriverData...\")\n                                    \n                                    // Use cache manager which handles cache + Google Sheets sync\n                                    val success = cacheManager.saveDriverData(\n                                        serialNumber = serialNumber,\n                                        macId = macId,\n                                        row1Driver1 = driver1Row1,\n                                        row1Driver2 = driver2Row1,\n                                        additionalRows = additionalRows\n                                    )\n                                    \n                                    Log.d(\"DriverPairing\", \" [SAVE_RESULT] Save operation result: $success\")\n                                    \n                                    if (success) {\n                                        Log.d(\"DriverPairing\", \" [SAVE_SUCCESS] Driver data saved to Google Sheets successfully!\")\n                                        \n                                        // Now save to structured database record\n                                        try {\n                                            // Calculate exit time and total time spent\n                                            val exitTime = System.currentTimeMillis()\n                                            val entryTimeMillis = sessionStartTime ?: exitTime\n                                            val totalTimeSpentMs = exitTime - entryTimeMillis\n                                            val totalTimeSpentSeconds = totalTimeSpentMs / 1000\n                                            val hours = totalTimeSpentSeconds / 3600\n                                            val minutes = (totalTimeSpentSeconds % 3600) / 60\n                                            val seconds = totalTimeSpentSeconds % 60\n                                            val totalTimeSpentFormatted = String.format(\"%02d:%02d:%02d\", hours, minutes, seconds)\n                                            \n                                            // Format timestamps in IST (Indian Standard Time)\n                                            val timestampUtils = com.example.fqcapp.utils.TimestampUtils\n                                            val entryTimestampIST = timestampUtils.formatTimestampIST(entryTimeMillis)\n                                            val exitTimestampIST = timestampUtils.formatTimestampIST(exitTime)\n                                            \n                                            // Build driver data as JSON array (including solution/rowType)\n                                            val driverPairs = mutableListOf<Map<String, String>>()\n                                            // Add Row 1 (no solution/rowType for first row)\n                                            driverPairs.add(mapOf(\"driver1\" to driver1Row1, \"driver2\" to driver2Row1))\n                                            // Add additional rows with solution/rowType\n                                            dynamicRows.forEach { row ->\n                                                val pairMap = mutableMapOf(\"driver1\" to row.driver1, \"driver2\" to row.driver2)\n                                                // Add solution if rowType is set\n                                                if (row.rowType.isNotBlank()) {\n                                                    pairMap[\"solution\"] = row.rowType\n                                                }\n                                                driverPairs.add(pairMap)\n                                            }\n                                            \n                                            // Convert to JSON array string (including solution field)\n                                            val driverDataJson = driverPairs.joinToString(\", \", prefix = \"[\", postfix = \"]\") { pair ->\n                                                val driver1 = pair[\"driver1\"] ?: \"\"\n                                                val driver2 = pair[\"driver2\"] ?: \"\"\n                                                val solution = pair[\"solution\"]\n                                                if (solution != null) {\n                                                    \"\"\"{\"driver1\":\"$driver1\",\"driver2\":\"$driver2\",\"solution\":\"$solution\"}\"\"\"\n                                                } else {\n                                                    \"\"\"{\"driver1\":\"$driver1\",\"driver2\":\"$driver2\"}\"\"\"\n                                                }\n                                            }\n                                            \n                                            // Check for duplicates BEFORE saving\n                                            Log.d(\"DriverPairing\", \" [ACTION] Checking for duplicate driver pairs...\")\n                                            try {\n                                                val existingRecords = repository.getDriverPairingRecordsBySerial(serialNumber)\n                                                if (existingRecords.isNotEmpty()) {\n                                                    // Normalize new pairs (handle interchange)\n                                                    fun normalizePair(d1: String, d2: String): Pair<String, String> {\n                                                        val d1Trim = d1.trim()\n                                                        val d2Trim = d2.trim()\n                                                        return if (d1Trim <= d2Trim) Pair(d1Trim, d2Trim) else Pair(d2Trim, d1Trim)\n                                                    }\n                                                    \n                                                    val normalizedNewPairs = driverPairs.mapNotNull { pair ->\n                                                        val d1 = pair[\"driver1\"]?.trim() ?: \"\"\n                                                        val d2 = pair[\"driver2\"]?.trim() ?: \"\"\n                                                        if (d1.isNotBlank() || d2.isNotBlank()) {\n                                                            normalizePair(d1, d2)\n                                                        } else null\n                                                    }.toSet()\n                                                    \n                                                    // Check existing records for duplicates\n                                                    val normalizedExistingPairs = mutableSetOf<Pair<String, String>>()\n                                                    existingRecords.forEach { record ->\n                                                        try {\n                                                            val existingJson = JSONArray(record.driverData)\n                                                            for (i in 0 until existingJson.length()) {\n                                                                val pairObj = existingJson.getJSONObject(i)\n                                                                val d1 = pairObj.optString(\"driver1\", \"\").trim()\n                                                                val d2 = pairObj.optString(\"driver2\", \"\").trim()\n                                                                if (d1.isNotBlank() || d2.isNotBlank()) {\n                                                                    normalizedExistingPairs.add(normalizePair(d1, d2))\n                                                                }\n                                                            }\n                                                        } catch (e: Exception) {\n                                                            Log.w(\"DriverPairing\", \"    Error parsing existing record: ${e.message}\")\n                                                        }\n                                                    }\n                                                    \n                                                    val duplicates = normalizedNewPairs.intersect(normalizedExistingPairs)\n                                                    if (duplicates.isNotEmpty()) {\n                                                        Log.w(\"DriverPairing\", \"    DUPLICATE DRIVER PAIRS DETECTED:\")\n                                                        duplicates.forEach { pair ->\n                                                            Log.w(\"DriverPairing\", \"      - Driver1: ${pair.first}, Driver2: ${pair.second}\")\n                                                        }\n                                                        Toast.makeText(\n                                                            context,\n                                                            \" Duplicate driver pairs detected!\\nThe same driver pairs already exist for this device.\\nPlease check your input.\",\n                                                            Toast.LENGTH_LONG\n                                                        ).show()\n                                                        return@launch // Stop saving\n                                                    }\n                                                }\n                                                Log.d(\"DriverPairing\", \"    No duplicates found in local DB\")\n                                            } catch (e: Exception) {\n                                                Log.w(\"DriverPairing\", \"    Error checking duplicates in local DB: ${e.message}\")\n                                                // Continue with save if check fails\n                                            }\n                                            \n                                            // Get next iteration number from Supabase\n                                            Log.d(\"DriverPairing\", \" [ACTION] Getting next iteration number from Supabase...\")\n                                            val nextIteration = workflowService.getNextDriverPairingIteration(serialNumber)\n                                            Log.d(\"DriverPairing\", \"    Next iteration: $nextIteration\")\n                                            \n                                            // Create DriverPairingRecord\n                                            Log.d(\"DriverPairing\", \" [ACTION] Creating DriverPairingRecord...\")\n                                            // Use IST timestamps for both local DB and Supabase\n                                            val driverRecord = com.example.fqcapp.data.entities.DriverPairingRecord(\n                                                serialNumber = serialNumber,\n                                                operatorName = operatorName,\n                                                entryTimestamp = entryTimestampIST, // IST format: \"yyyy-MM-dd HH:mm:ss\"\n                                                exitTimestamp = exitTimestampIST, // IST format: \"yyyy-MM-dd HH:mm:ss\"\n                                                totalTimeSpent = totalTimeSpentFormatted,\n                                                driverData = driverDataJson,\n                                                iterationNumber = nextIteration,\n                                                testStage = selectedTestStage!!,\n                                                timestamp = entryTimestampIST, // IST format for Supabase\n                                                needsSync = true,\n                                                lastSyncTimestamp = 0\n                                            )\n                                            \n                                            // Save to database\n                                            val recordId = repository.insertDriverPairingRecord(driverRecord)\n                                            \n                                            Log.d(\"DriverPairing\", \" Saving Driver Pairing Record:\")\n                                            Log.d(\"DriverPairing\", \"  Serial: $serialNumber\")\n                                            Log.d(\"DriverPairing\", \"  Operator: $operatorName\")\n                                            Log.d(\"DriverPairing\", \"  Entry Timestamp (IST): $entryTimestampIST\")\n                                            Log.d(\"DriverPairing\", \"  Exit Timestamp (IST): $exitTimestampIST\")\n                                            Log.d(\"DriverPairing\", \"  Total Time Spent: $totalTimeSpentFormatted\")\n                                            Log.d(\"DriverPairing\", \"  Driver Pairs: ${driverPairs.size}\")\n                                            Log.d(\"DriverPairing\", \"  Driver Data JSON: $driverDataJson\")\n                                            Log.d(\"DriverPairing\", \"  Iteration Number: $nextIteration\")\n                                            Log.d(\"DriverPairing\", \" Driver pairing record saved with ID: $recordId\")\n                                            \n                                            // Mark solution reminders as completed if applicable\n                                            if (solutionReminderManager != null && serialNumber.isNotBlank()) {\n                                                try {\n                                                    // Check if any row is an interchange (check dynamicRows which have rowType)\n                                                    val hasInterchange = dynamicRows.any { it.rowType == \"interchange\" }\n                                                    if (hasInterchange) {\n                                                        solutionReminderManager.markSolutionCompleted(\n                                                            serialNumber = serialNumber,\n                                                            solution = \"INTERCHANGE\",\n                                                            reminderType = com.example.fqcapp.core.ReminderType.DRIVER_PAIRING\n                                                        )\n                                                        Log.d(\"DriverPairing\", \" Marked INTERCHANGE solution as completed\")\n                                                    }\n                                                    \n                                                    // Check if BC driver was replaced (rowType contains \"change\" and driver2 is not empty)\n                                                    // Also check driverPairs map for solution field\n                                                    val hasBCDriverReplacement = dynamicRows.any { \n                                                        it.rowType == \"change\" && it.driver2.isNotBlank()\n                                                    } || driverPairs.any { \n                                                        (it[\"solution\"]?.contains(\"change\", ignoreCase = true) == true) && \n                                                        (it[\"driver2\"]?.isNotBlank() == true)\n                                                    }\n                                                    if (hasBCDriverReplacement) {\n                                                        solutionReminderManager.markSolutionCompleted(\n                                                            serialNumber = serialNumber,\n                                                            solution = \"Replace BC Driver\",\n                                                            reminderType = com.example.fqcapp.core.ReminderType.DRIVER_PAIRING\n                                                        )\n                                                        Log.d(\"DriverPairing\", \" Marked Replace BC Driver solution as completed\")\n                                                    }\n                                                } catch (e: Exception) {\n                                                    Log.e(\"DriverPairing\", \" Error marking solution reminders as completed\", e)\n                                                }\n                                            }\n                                            \n                                            // Log workflow: Driver Pairing COMPLETED\n                                            try {\n                                                workflowService.logWorkflow(\n                                                    serialNumber = serialNumber,\n                                                    stage = com.example.fqcapp.services.DeviceWorkflowService.STAGE_DRIVER_PAIRING,\n                                                    operatorName = operatorName,\n                                                    action = com.example.fqcapp.services.DeviceWorkflowService.ACTION_COMPLETED,\n                                                    result = com.example.fqcapp.services.DeviceWorkflowService.RESULT_PASS, // Driver pairing always passes if saved\n                                                    iterationNumber = nextIteration,\n                                                    recordId = recordId\n                                                )\n                                                Log.d(\"DriverPairing\", \" [WORKFLOW] Logged DRIVER_PAIRING COMPLETED\")\n                                            } catch (e: Exception) {\n                                                Log.e(\"DriverPairing\", \" [WORKFLOW] Error logging workflow COMPLETED\", e)\n                                            }\n                                            \n                                            // Save to Supabase\n                                            Log.d(\"DriverPairing\", \" [ACTION] Uploading to Supabase...\")\n                                            try {\n                                                val supabaseService = com.example.fqcapp.supabase.SupabaseDriverPairingService()\n                                                val operatorId = authenticatedOperator?.operatorId ?: \"\"\n                                                if (operatorId.isBlank()) {\n                                                    Log.w(\"DriverPairing\", \" [WARNING] operatorId is empty for operator: ${driverRecord.operatorName}\")\n                                                }\n                                                val supabaseRecordId = supabaseService.saveDriverPairing(\n                                                    record = driverRecord,\n                                                    operatorId = operatorId,\n                                                    macId = macId\n                                                )\n                                                if (supabaseRecordId != null) {\n                                                    Log.d(\"DriverPairing\", \"    [SUPABASE] Upload successful - Record ID: $supabaseRecordId\")\n                                                    // Mark as synced in Room DB\n                                                    repository.markDriverPairingAsSynced(recordId, System.currentTimeMillis())\n                                                    Log.d(\"DriverPairing\", \"    [LOCAL] Marked as synced in Room DB\")\n                                                } else {\n                                                    Log.w(\"DriverPairing\", \"    [SUPABASE] Upload failed (will retry later)\")\n                                                }\n                                            } catch (e: IllegalStateException) {\n                                                // Duplicate detection error - show user-friendly message\n                                                Log.e(\"DriverPairing\", \"    [DUPLICATE] ${e.message}\")\n                                                Toast.makeText(\n                                                    context,\n                                                    \" Duplicate driver pairs detected!\\nThe same driver pairs already exist for this device.\\nPlease check your input.\",\n                                                    Toast.LENGTH_LONG\n                                                ).show()\n                                                // Don't mark as synced since save was blocked\n                                            } catch (e: Exception) {\n                                                Log.e(\"DriverPairing\", \"    [SUPABASE] Error uploading to Supabase: ${e.message}\")\n                                                Log.e(\"DriverPairing\", \"   Stack trace: ${e.stackTraceToString()}\")\n                                                // Don't fail the whole operation if Supabase save fails\n                                            }\n                                            \n                                        } catch (e: Exception) {\n                                            Log.e(\"DriverPairing\", \" Error saving driver pairing record\", e)\n                                        }\n                                        \n                                        Toast.makeText(context, \" Driver data saved successfully!\", Toast.LENGTH_SHORT).show()\n                                        \n                                        // Call onSave callback with driver list\n                                        val drivers = mutableListOf<String>()\n                                        drivers.add(driver1Row1)\n                                        drivers.add(driver2Row1)\n                                        dynamicRows.forEach { row ->\n                                            drivers.add(row.driver1)\n                                            drivers.add(row.driver2)\n                                        }\n                                        Log.d(\"DriverPairing\", \" [SAVE_CALLBACK] Calling onSave with ${drivers.size} driver entries\")\n                                        onSave(drivers)\n                                        \n                                        // Navigate back after short delay\n                                        kotlinx.coroutines.delay(500)\n                                        Log.d(\"DriverPairing\", \" [SAVE_NAVIGATE] Navigating back to landing page\")\n                                        onBack()\n                                    } else {\n                                        Log.e(\"DriverPairing\", \" [SAVE_FAILED] Failed to save driver data\")\n                                        Toast.makeText(context, \" Failed to save driver data\", Toast.LENGTH_LONG).show()\n                                    }\n                                } catch (e: Exception) {\n                                    Log.e(\"DriverPairing\", \" [SAVE_ERROR] Exception during save\", e)\n                                    Toast.makeText(context, \"Error: ${e.message}\", Toast.LENGTH_LONG).show()\n                                } finally {\n                                    isSaving = false\n                                    Log.d(\"DriverPairing\", \" [SAVE_FINISHED] Save process completed, isSaving set to false\")\n                                }\n                            }\n                        },\n                        modifier = Modifier\n                            .fillMaxWidth()\n                            .height(50.dp),\n                        enabled = !isSaving,\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = accentColor,\n                            contentColor = bgColor\n                        ),\n                        shape = RoundedCornerShape(12.dp)\n                    ) {\n                        if (isSaving) {\n                            CircularProgressIndicator(\n                                modifier = Modifier.size(20.dp),\n                                color = bgColor,\n                                strokeWidth = 2.dp\n                            )\n                        } else {\n                            Text(\n                                \"Save Entry\",\n                                fontSize = 16.sp,\n                                fontWeight = FontWeight.Bold\n                            )\n                        }\n                    }\n                }\n            }\n        }\n        \n        // Add Row Dialog\n        if (showAddRowDialog) {\n            AddRowDialog(\n                onDismiss = {\n                    Log.d(\"DriverPairing\", \" [DIALOG_DISMISS] Add Row dialog dismissed without action\")\n                    showAddRowDialog = false\n                },\n                onActionSelected = { actionType, otherText ->\n                    Log.d(\"DriverPairing\", \" [DIALOG_ACTION] Action selected: $actionType, otherText: '$otherText'\")\n                    val previousRow = if (dynamicRows.isEmpty()) {\n                        Log.d(\"DriverPairing\", \" [DIALOG_PREV] Using Row 1 as previous row (Driver1: '$driver1Row1', Driver2: '$driver2Row1')\")\n                        DriverRow(driver1Row1, driver2Row1)\n                    } else {\n                        val lastRow = dynamicRows.last()\n                        Log.d(\"DriverPairing\", \" [DIALOG_PREV] Using last dynamic row as previous (Row ${dynamicRows.size + 1}, Driver1: '${lastRow.driver1}', Driver2: '${lastRow.driver2}')\")\n                        lastRow\n                    }\n                    \n                    val newRow = when (actionType) {\n                        RowActionType.INTERCHANGE -> {\n                            Log.d(\"DriverPairing\", \" [DIALOG_INTERCHANGE] Creating interchange row - swapping drivers\")\n                            // Swap Driver 1 and Driver 2 from previous row\n                            DriverRow(\n                                driver1 = previousRow.driver2,\n                                driver2 = previousRow.driver1,\n                                rowType = \"interchange\"\n                            )\n                        }\n                        RowActionType.CHANGE -> {\n                            Log.d(\"DriverPairing\", \" [DIALOG_CHANGE] Creating change row with blank drivers\")\n                            DriverRow(\n                                driver1 = \"\",\n                                driver2 = \"\",\n                                rowType = \"change\"\n                            )\n                        }\n                        RowActionType.OTHER -> {\n                            Log.d(\"DriverPairing\", \" [DIALOG_OTHER] Creating other row with notes: '$otherText'\")\n                            DriverRow(\n                                driver1 = \"\",\n                                driver2 = \"\",\n                                rowType = \"other: $otherText\"\n                            )\n                        }\n                    }\n                    \n                    Log.d(\"DriverPairing\", \" [DIALOG_ADD] Adding new row: Driver1='${newRow.driver1}', Driver2='${newRow.driver2}', Type='${newRow.rowType}'\")\n                    dynamicRows = dynamicRows + newRow\n                    Log.d(\"DriverPairing\", \" [DIALOG_ADD] Total rows after add: ${dynamicRows.size + 1} (1 static + ${dynamicRows.size} dynamic)\")\n                    showAddRowDialog = false\n                },\n                bgColor = bgColor,\n                surfaceColor = surfaceColor,\n                accentColor = accentColor,\n                textColor = textColor\n            )\n        }\n        \n        // Alert dialog for test stage requirement\n        if (showTestStageRequiredDialog) {\n            AlertDialog(\n                onDismissRequest = { showTestStageRequiredDialog = false },\n                title = { Text(\"Test Stage Required\", fontWeight = FontWeight.Bold) },\n                text = { Text(\"Please select a test stage (Primary Test, Secondary Test, or Final Test) before saving.\") },\n                confirmButton = {\n                    Button(onClick = { showTestStageRequiredDialog = false }) {\n                        Text(\"OK\")\n                    }\n                },\n                containerColor = Color(0xFF2B2B2B),\n                titleContentColor = Color.White,\n                textContentColor = Color.White.copy(alpha = 0.8f)\n            )\n        }\n    }\n}\n\n@Composable\nfun DriverRowInput(\n    label: String,\n    driver1: String,\n    driver2: String,\n    onDriver1Change: (String) -> Unit,\n    onDriver2Change: (String) -> Unit,\n    textColor: Color,\n    bgColor: Color,\n    accentColor: Color,\n    rowType: String = \"\",\n    showDelete: Boolean = false,\n    onDelete: () -> Unit = {}\n) {\n    Row(\n        modifier = Modifier.fillMaxWidth(),\n        horizontalArrangement = Arrangement.spacedBy(12.dp),\n        verticalAlignment = Alignment.CenterVertically\n    ) {\n        // Driver 1\n        Column(modifier = Modifier.weight(1f)) {\n            Row(verticalAlignment = Alignment.CenterVertically) {\n                Text(\n                    \"Driver 1\",\n                    color = textColor.copy(alpha = 0.7f),\n                    fontSize = 12.sp,\n                    modifier = Modifier.padding(bottom = 4.dp)\n                )\n                if (rowType.isNotEmpty()) {\n                    Spacer(modifier = Modifier.width(4.dp))\n                    Text(\n                        \"($rowType)\",\n                        color = accentColor.copy(alpha = 0.6f),\n                        fontSize = 10.sp\n                    )\n                }\n            }\n            TextField(\n                value = driver1,\n                onValueChange = onDriver1Change,\n                modifier = Modifier.fillMaxWidth(),\n                placeholder = {\n                    Text(\n                        \"Enter Driver 1\",\n                        color = textColor.copy(alpha = 0.5f),\n                        fontSize = 12.sp\n                    )\n                },\n                colors = TextFieldDefaults.colors(\n                    focusedTextColor = textColor,\n                    unfocusedTextColor = textColor,\n                    focusedContainerColor = bgColor,\n                    unfocusedContainerColor = bgColor,\n                    focusedIndicatorColor = accentColor,\n                    unfocusedIndicatorColor = Color(0xFF424242),\n                    cursorColor = accentColor\n                ),\n                textStyle = MaterialTheme.typography.bodyMedium.copy(fontSize = 14.sp),\n                singleLine = true,\n                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Text)\n            )\n        }\n        \n        // Driver 2\n        Column(modifier = Modifier.weight(1f)) {\n            Text(\n                \"Driver 2\",\n                color = textColor.copy(alpha = 0.7f),\n                fontSize = 12.sp,\n                modifier = Modifier.padding(bottom = 4.dp)\n            )\n            TextField(\n                value = driver2,\n                onValueChange = onDriver2Change,\n                modifier = Modifier.fillMaxWidth(),\n                placeholder = {\n                    Text(\n                        \"Enter Driver 2\",\n                        color = textColor.copy(alpha = 0.5f),\n                        fontSize = 12.sp\n                    )\n                },\n                colors = TextFieldDefaults.colors(\n                    focusedTextColor = textColor,\n                    unfocusedTextColor = textColor,\n                    focusedContainerColor = bgColor,\n                    unfocusedContainerColor = bgColor,\n                    focusedIndicatorColor = accentColor,\n                    unfocusedIndicatorColor = Color(0xFF424242),\n                    cursorColor = accentColor\n                ),\n                textStyle = MaterialTheme.typography.bodyMedium.copy(fontSize = 14.sp),\n                singleLine = true,\n                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Text)\n            )\n        }\n        \n        // Delete Button (only for dynamic rows)\n        if (showDelete) {\n            Spacer(modifier = Modifier.width(8.dp))\n            IconButton(\n                onClick = onDelete,\n                modifier = Modifier.size(40.dp)\n            ) {\n                Icon(\n                    Icons.Filled.Delete,\n                    contentDescription = \"Delete Row\",\n                    tint = Color(0xFFEF4444),\n                    modifier = Modifier.size(24.dp)\n                )\n            }\n        }\n    }\n}\n\n@Composable\nfun AddRowDialog(\n    onDismiss: () -> Unit,\n    onActionSelected: (RowActionType, String) -> Unit,\n    bgColor: Color,\n    surfaceColor: Color,\n    accentColor: Color,\n    textColor: Color\n) {\n    var selectedAction by remember { mutableStateOf<RowActionType?>(null) }\n    var otherText by remember { mutableStateOf(\"\") }\n    \n    Dialog(onDismissRequest = onDismiss) {\n        Card(\n            modifier = Modifier\n                .fillMaxWidth()\n                .padding(16.dp),\n            colors = CardDefaults.cardColors(containerColor = surfaceColor),\n            shape = RoundedCornerShape(16.dp)\n        ) {\n            Column(\n                modifier = Modifier.padding(24.dp),\n                verticalArrangement = Arrangement.spacedBy(16.dp)\n            ) {\n                Text(\n                    \"Select Action\",\n                    style = MaterialTheme.typography.titleLarge,\n                    color = accentColor,\n                    fontWeight = FontWeight.Bold\n                )\n                \n                HorizontalDivider(color = Color(0xFF424242))\n                \n                // Driver Interchange Option\n                Row(\n                    modifier = Modifier\n                        .fillMaxWidth()\n                        .clickable {\n                            Log.d(\"DriverPairing\", \" [DIALOG_OPTION] Driver Interchange option tapped\")\n                            selectedAction = RowActionType.INTERCHANGE\n                        }\n                        .padding(12.dp),\n                    verticalAlignment = Alignment.CenterVertically\n                ) {\n                    RadioButton(\n                        selected = selectedAction == RowActionType.INTERCHANGE,\n                        onClick = {\n                            Log.d(\"DriverPairing\", \" [DIALOG_RADIO] Driver Interchange radio button clicked\")\n                            selectedAction = RowActionType.INTERCHANGE\n                        },\n                        colors = RadioButtonDefaults.colors(\n                            selectedColor = accentColor,\n                            unselectedColor = textColor.copy(alpha = 0.6f)\n                        )\n                    )\n                    Spacer(modifier = Modifier.width(8.dp))\n                    Text(\n                        \"Driver Interchange\",\n                        color = textColor,\n                        fontSize = 16.sp\n                    )\n                }\n                \n                // Driver Change Option\n                Row(\n                    modifier = Modifier\n                        .fillMaxWidth()\n                        .clickable {\n                            Log.d(\"DriverPairing\", \" [DIALOG_OPTION] Driver Change option tapped\")\n                            selectedAction = RowActionType.CHANGE\n                        }\n                        .padding(12.dp),\n                    verticalAlignment = Alignment.CenterVertically\n                ) {\n                    RadioButton(\n                        selected = selectedAction == RowActionType.CHANGE,\n                        onClick = {\n                            Log.d(\"DriverPairing\", \" [DIALOG_RADIO] Driver Change radio button clicked\")\n                            selectedAction = RowActionType.CHANGE\n                        },\n                        colors = RadioButtonDefaults.colors(\n                            selectedColor = accentColor,\n                            unselectedColor = textColor.copy(alpha = 0.6f)\n                        )\n                    )\n                    Spacer(modifier = Modifier.width(8.dp))\n                    Text(\n                        \"Driver Change\",\n                        color = textColor,\n                        fontSize = 16.sp\n                    )\n                }\n                \n                // Others Option\n                Row(\n                    modifier = Modifier\n                        .fillMaxWidth()\n                        .clickable {\n                            Log.d(\"DriverPairing\", \" [DIALOG_OPTION] Others option tapped\")\n                            selectedAction = RowActionType.OTHER\n                        }\n                        .padding(12.dp),\n                    verticalAlignment = Alignment.CenterVertically\n                ) {\n                    RadioButton(\n                        selected = selectedAction == RowActionType.OTHER,\n                        onClick = {\n                            Log.d(\"DriverPairing\", \" [DIALOG_RADIO] Others radio button clicked\")\n                            selectedAction = RowActionType.OTHER\n                        },\n                        colors = RadioButtonDefaults.colors(\n                            selectedColor = accentColor,\n                            unselectedColor = textColor.copy(alpha = 0.6f)\n                        )\n                    )\n                    Spacer(modifier = Modifier.width(8.dp))\n                    Text(\n                        \"Others\",\n                        color = textColor,\n                        fontSize = 16.sp\n                    )\n                }\n                \n                // Text box for \"Others\" option\n                if (selectedAction == RowActionType.OTHER) {\n                    TextField(\n                        value = otherText,\n                        onValueChange = {\n                            Log.d(\"DriverPairing\", \" [DIALOG_OTHER_TEXT] Other text changed from '$otherText' to '$it'\")\n                            otherText = it\n                        },\n                        modifier = Modifier.fillMaxWidth(),\n                        placeholder = {\n                            Text(\n                                \"Enter details...\",\n                                color = textColor.copy(alpha = 0.5f)\n                            )\n                        },\n                        colors = TextFieldDefaults.colors(\n                            focusedTextColor = textColor,\n                            unfocusedTextColor = textColor,\n                            focusedContainerColor = bgColor,\n                            unfocusedContainerColor = bgColor,\n                            focusedIndicatorColor = accentColor,\n                            unfocusedIndicatorColor = Color(0xFF424242)\n                        ),\n                        singleLine = false,\n                        maxLines = 3\n                    )\n                }\n                \n                Spacer(modifier = Modifier.height(8.dp))\n                \n                // Action Buttons\n                Row(\n                    modifier = Modifier.fillMaxWidth(),\n                    horizontalArrangement = Arrangement.spacedBy(12.dp)\n                ) {\n                    OutlinedButton(\n                        onClick = {\n                            Log.d(\"DriverPairing\", \" [DIALOG_CANCEL] Cancel button tapped\")\n                            onDismiss()\n                        },\n                        modifier = Modifier.weight(1f),\n                        colors = ButtonDefaults.outlinedButtonColors(\n                            contentColor = textColor\n                        )\n                    ) {\n                        Text(\"Cancel\")\n                    }\n                    \n                    Button(\n                        onClick = {\n                            Log.d(\"DriverPairing\", \" [DIALOG_ADD_BUTTON] Add Row button tapped, selectedAction: $selectedAction\")\n                            if (selectedAction != null) {\n                                Log.d(\"DriverPairing\", \" [DIALOG_ADD_BUTTON] Calling onActionSelected with action: $selectedAction, otherText: '$otherText'\")\n                                onActionSelected(selectedAction!!, otherText)\n                            } else {\n                                Log.w(\"DriverPairing\", \" [DIALOG_ADD_BUTTON] Add Row button tapped but no action selected\")\n                            }\n                        },\n                        modifier = Modifier.weight(1f),\n                        enabled = selectedAction != null,\n                        colors = ButtonDefaults.buttonColors(\n                            containerColor = accentColor,\n                            contentColor = bgColor\n                        )\n                    ) {\n                        Text(\"Add Row\")\n                    }\n                }\n            }\n        }\n    }\n}\n",
        "firstEditBubbleId": "56e78a6e-95ad-4141-8042-a90a1f5800d2",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseSongTestService.kt": {
        "content": "package com.example.fqcapp.supabase\n\nimport android.util.Log\nimport com.example.fqcapp.data.entities.SongTest\nimport io.github.jan.supabase.postgrest.from\nimport io.github.jan.supabase.postgrest.query.Columns\nimport io.github.jan.supabase.postgrest.query.Order\nimport kotlinx.coroutines.Dispatchers\nimport kotlinx.coroutines.withContext\nimport kotlinx.serialization.Serializable\n\n/**\n * Data transfer object for Supabase song_tests table.\n * This matches the structure of the SongTest entity but uses snake_case for Supabase.\n */\n@Serializable\ndata class SupabaseSongTest(\n    val test_id: Long? = null, // Auto-generated, nullable for inserts\n    val serial_number: String,\n    val operator_name: String,\n    val operator_id: Long? = null, // Operator ID (bigint in Supabase) - nullable\n    val entry_timestamp: String,\n    val exit_timestamp: String,\n    val total_time_spent: String,\n    val song_name: String,\n    val result: String,\n    val remark: String? = null, // Nullable because Supabase may return null\n    val iteration_number: Int = 1,\n    val test_stage: String = \"Primary Test\", // \"Primary Test\", \"Secondary Test\", or \"Final Test\"\n    val is_overall_result: Boolean = false,\n    val timestamp: String = \"\"\n)\n\n/**\n * Data transfer object for Supabase song_test_issues table.\n */\n@Serializable\ndata class SupabaseSongTestIssue(\n    val test_id: Long,\n    val issue_text: String\n)\n\n/**\n * Data transfer object for Supabase song_test_solutions table.\n */\n@Serializable\ndata class SupabaseSongTestSolution(\n    val test_id: Long,\n    val solution_text: String\n)\n\n/**\n * Service for saving and retrieving song test data from Supabase.\n */\nclass SupabaseSongTestService {\n    private val TAG = \"SupabaseSongTest\"\n    private val deviceService = SupabaseDeviceService()\n    \n    /**\n     * Save a song test (overall review or individual song) to Supabase.\n     * Returns the inserted test ID if successful, null otherwise.\n     * \n     * Also saves issues and solutions to normalized tables.\n     * \n     * @param test The song test entity\n     * @param operatorId The operator ID (unique identifier) - can be empty/null\n     */\n    suspend fun saveSongTest(test: SongTest, operatorId: String): Long? = withContext(Dispatchers.IO) {\n        val client = SupabaseConfig.getClient()\n        if (client == null) {\n            Log.w(TAG, \" Supabase client not configured, skipping save\")\n            return@withContext null\n        }\n        \n        try {\n            Log.d(TAG, \"\")\n            Log.d(TAG, \" [SUPABASE] UPLOADING SONG TEST\")\n            Log.d(TAG, \"   Serial Number: ${test.serialNumber}\")\n            Log.d(TAG, \"   Operator: ${test.operatorName}\")\n            Log.d(TAG, \"   Song Name: ${test.songName}\")\n            Log.d(TAG, \"   Result: ${test.result}\")\n            Log.d(TAG, \"   Iteration: ${test.iterationNumber}\")\n            Log.d(TAG, \"   Is Overall: ${test.isOverallResult}\")\n            Log.d(TAG, \"   Entry Timestamp: ${test.entryTimestamp}\")\n            Log.d(TAG, \"   Exit Timestamp: ${test.exitTimestamp}\")\n            Log.d(TAG, \"   Total Time: ${test.totalTimeSpent}\")\n            Log.d(TAG, \"\")\n            \n            // CRITICAL: Ensure device exists in Supabase before inserting test data\n            Log.d(TAG, \" [STEP 1/3] Ensuring device exists in Supabase...\")\n            val deviceExists = deviceService.ensureDeviceExists(\n                serialNumber = test.serialNumber,\n                macAddress = null, // MAC address not available in SongTest entity\n                color = null\n            )\n            \n            if (!deviceExists) {\n                Log.e(TAG, \"    [ERROR] Failed to ensure device exists, cannot save song test\")\n                Log.e(TAG, \"\")\n                return@withContext null\n            }\n            Log.d(TAG, \"    [SUCCESS] Device exists or created successfully\")\n            \n            // Convert to Supabase format\n            Log.d(TAG, \" [STEP 2/3] Preparing data for upload...\")\n            // Convert operatorId string to Long? - null if empty or invalid\n            val operatorIdLong = try {\n                if (operatorId.isBlank()) {\n                    null\n                } else {\n                    operatorId.toLongOrNull()\n                }\n            } catch (e: Exception) {\n                Log.w(TAG, \" Could not convert operatorId '$operatorId' to Long, using null\", e)\n                null\n            }\n            \n            val insertData = SupabaseSongTest(\n                serial_number = test.serialNumber,\n                operator_name = test.operatorName,\n                operator_id = operatorIdLong, // Now Long? instead of String\n                entry_timestamp = test.entryTimestamp,\n                exit_timestamp = test.exitTimestamp,\n                total_time_spent = test.totalTimeSpent,\n                song_name = test.songName,\n                result = test.result,\n                remark = test.remark,\n                iteration_number = test.iterationNumber,\n                test_stage = test.testStage,\n                is_overall_result = test.isOverallResult,\n                timestamp = test.timestamp\n            )\n            \n            Log.d(TAG, \"    [UPLOAD] Data prepared:\")\n            Log.d(TAG, \"      - serial_number: ${insertData.serial_number}\")\n            Log.d(TAG, \"      - operator_name: ${insertData.operator_name}\")\n            Log.d(TAG, \"      - operator_id: ${insertData.operator_id}\")\n            Log.d(TAG, \"      - song_name: ${insertData.song_name}\")\n            Log.d(TAG, \"      - result: ${insertData.result}\")\n            Log.d(TAG, \"      - entry_timestamp: ${insertData.entry_timestamp}\")\n            Log.d(TAG, \"      - exit_timestamp: ${insertData.exit_timestamp}\")\n            Log.d(TAG, \"      - total_time_spent: ${insertData.total_time_spent}\")\n            Log.d(TAG, \"      - iteration_number: ${insertData.iteration_number}\")\n            Log.d(TAG, \"      - is_overall_result: ${insertData.is_overall_result}\")\n            \n            Log.d(TAG, \" [STEP 3/3] Inserting into song_tests table...\")\n            Log.d(TAG, \"    [QUERY] INSERT INTO song_tests (...) VALUES (...)\")\n            \n            // Insert song test\n            val response = client.from(\"song_tests\")\n                .insert(insertData) {\n                    select(Columns.ALL)\n                }\n            \n            val insertedTest = response.decodeSingle<SupabaseSongTest>()\n            val testId = insertedTest.test_id ?: return@withContext null\n            \n            Log.d(TAG, \"\")\n            Log.d(TAG, \" [SUPABASE] SONG TEST UPLOADED SUCCESSFULLY\")\n            Log.d(TAG, \"   Test ID: $testId\")\n            Log.d(TAG, \"   Serial Number: ${test.serialNumber}\")\n            Log.d(TAG, \"   Song: ${test.songName}\")\n            Log.d(TAG, \"   Iteration: ${test.iterationNumber}\")\n            Log.d(TAG, \"   Result: ${test.result}\")\n            Log.d(TAG, \"\")\n            \n            // Save issues to normalized table (if any)\n            // IMPORTANT: For PASS results, checklist items (No Distortion, Balance OK, No Noise) \n            // are NOT saved as issues - they are implicit in a PASS result.\n            // Only actual problems (for FAIL/CAN_BE_PASSED) should be saved as issues.\n            // A PASS means all checklists were checked, so storing them separately is redundant.\n            if (test.issues.isNotBlank() && test.result.uppercase() != \"PASS\") {\n                try {\n                    saveIssues(testId, test.issues)\n                } catch (e: Exception) {\n                    Log.e(TAG, \" Failed to save issues to normalized table\", e)\n                    // Don't fail the whole operation if issues save fails\n                }\n            } else if (test.result.uppercase() == \"PASS\") {\n                Log.d(TAG, \" Skipping issues save for PASS result - checklist items are implicit in PASS\")\n            }\n            \n            // Save solutions to normalized table (if any, only for overall review)\n            if (test.isOverallResult && test.solutions.isNotBlank()) {\n                try {\n                    saveSolutions(testId, test.solutions)\n                } catch (e: Exception) {\n                    Log.e(TAG, \" Failed to save solutions to normalized table\", e)\n                    // Don't fail the whole operation if solutions save fails\n                }\n            }\n            \n            return@withContext testId\n            \n        } catch (e: Exception) {\n            Log.e(TAG, \" Failed to save song test to Supabase\", e)\n            Log.e(TAG, \"Error details: ${e.message}\")\n            e.printStackTrace()\n            return@withContext null\n        }\n    }\n    \n    /**\n     * Save multiple individual songs (latest 3) for an iteration.\n     * This is called after the overall review is saved.\n     */\n    suspend fun saveIndividualSongs(\n        serialNumber: String,\n        iterationNumber: Int,\n        individualSongs: List<SongTest>,\n        operatorId: String\n    ): Boolean = withContext(Dispatchers.IO) {\n        val client = SupabaseConfig.getClient()\n        if (client == null) {\n            Log.w(TAG, \" Supabase client not configured, skipping save\")\n            return@withContext false\n        }\n        \n        try {\n            // Ensure device exists\n            val deviceExists = deviceService.ensureDeviceExists(\n                serialNumber = serialNumber,\n                macAddress = null,\n                color = null\n            )\n            \n            if (!deviceExists) {\n                Log.e(TAG, \" Failed to ensure device exists, cannot save individual songs\")\n                return@withContext false\n            }\n            \n            // Only save latest 3 individual songs\n            val songsToSave = individualSongs.take(3)\n            \n            if (songsToSave.isEmpty()) {\n                Log.d(TAG, \" No individual songs to save\")\n                return@withContext true\n            }\n            \n            Log.d(TAG, \" Saving ${songsToSave.size} individual songs to Supabase for serial=$serialNumber, iteration=$iterationNumber\")\n            \n            // Convert to Supabase format\n            // Convert operatorId string to Long? - null if empty or invalid\n            val operatorIdLong = try {\n                if (operatorId.isBlank()) {\n                    null\n                } else {\n                    operatorId.toLongOrNull()\n                }\n            } catch (e: Exception) {\n                Log.w(TAG, \" Could not convert operatorId '$operatorId' to Long, using null\", e)\n                null\n            }\n            \n            val insertDataList = songsToSave.map { song ->\n                SupabaseSongTest(\n                    serial_number = song.serialNumber,\n                    operator_name = song.operatorName,\n                    operator_id = operatorIdLong, // Now Long? instead of String\n                    entry_timestamp = song.entryTimestamp,\n                    exit_timestamp = song.exitTimestamp,\n                    total_time_spent = song.totalTimeSpent,\n                    song_name = song.songName,\n                    result = song.result,\n                    remark = song.remark,\n                    iteration_number = song.iterationNumber,\n                    test_stage = song.testStage,\n                    is_overall_result = false, // Individual songs are never overall\n                    timestamp = song.timestamp\n                )\n            }\n            \n            // Bulk insert individual songs\n            val response = client.from(\"song_tests\")\n                .insert(insertDataList) {\n                    select(Columns.ALL)\n                }\n            \n            val insertedTests = response.decodeList<SupabaseSongTest>()\n            \n            // Save issues for each individual song\n            // IMPORTANT: For PASS results, checklist items are NOT saved as issues\n            insertedTests.forEachIndexed { index, insertedTest ->\n                val originalSong = songsToSave[index]\n                val testId = insertedTest.test_id ?: return@forEachIndexed\n                \n                // Only save issues for FAIL/CAN_BE_PASSED - PASS results don't need issues saved\n                if (originalSong.issues.isNotBlank() && originalSong.result.uppercase() != \"PASS\") {\n                    try {\n                        saveIssues(testId, originalSong.issues)\n                    } catch (e: Exception) {\n                        Log.e(TAG, \" Failed to save issues for individual song ${originalSong.songName}\", e)\n                    }\n                } else if (originalSong.result.uppercase() == \"PASS\") {\n                    Log.d(TAG, \" Skipping issues save for individual song ${originalSong.songName} - PASS result\")\n                }\n            }\n            \n            Log.d(TAG, \" Successfully saved ${insertedTests.size} individual songs to Supabase\")\n            return@withContext true\n            \n        } catch (e: Exception) {\n            Log.e(TAG, \" Failed to save individual songs to Supabase\", e)\n            Log.e(TAG, \"Error details: ${e.message}\")\n            e.printStackTrace()\n            return@withContext false\n        }\n    }\n    \n    /**\n     * Save issues to normalized song_test_issues table.\n     * Parses issues string (can be JSON array or plain text) and saves each issue separately.\n     */\n    private suspend fun saveIssues(testId: Long, issuesString: String) {\n        val client = SupabaseConfig.getClient() ?: return\n        \n        try {\n            // Parse issues - could be JSON array or plain text\n            val issuesList = parseIssuesOrSolutions(issuesString)\n            \n            if (issuesList.isEmpty()) {\n                return\n            }\n            \n            // Convert to DTOs\n            val issuesData = issuesList.map { issueText ->\n                SupabaseSongTestIssue(\n                    test_id = testId,\n                    issue_text = issueText\n                )\n            }\n            \n            // Bulk insert all issues at once\n            if (issuesData.isNotEmpty()) {\n                client.from(\"song_test_issues\")\n                    .insert(issuesData) {\n                        select(Columns.ALL)\n                    }\n            }\n            \n            Log.d(TAG, \" Saved ${issuesList.size} issues to normalized table for test_id=$testId\")\n            \n        } catch (e: Exception) {\n            Log.e(TAG, \" Error saving issues to normalized table\", e)\n            throw e\n        }\n    }\n    \n    /**\n     * Save solutions to normalized song_test_solutions table.\n     * Parses solutions string (can be JSON array or plain text) and saves each solution separately.\n     */\n    private suspend fun saveSolutions(testId: Long, solutionsString: String) {\n        val client = SupabaseConfig.getClient() ?: return\n        \n        try {\n            // Parse solutions - could be JSON array or plain text\n            val solutionsList = parseIssuesOrSolutions(solutionsString)\n            \n            if (solutionsList.isEmpty()) {\n                return\n            }\n            \n            // Convert to DTOs\n            val solutionsData = solutionsList.map { solutionText ->\n                SupabaseSongTestSolution(\n                    test_id = testId,\n                    solution_text = solutionText\n                )\n            }\n            \n            // Bulk insert all solutions at once\n            if (solutionsData.isNotEmpty()) {\n                client.from(\"song_test_solutions\")\n                    .insert(solutionsData) {\n                        select(Columns.ALL)\n                    }\n            }\n            \n            Log.d(TAG, \" Saved ${solutionsList.size} solutions to normalized table for test_id=$testId\")\n            \n        } catch (e: Exception) {\n            Log.e(TAG, \" Error saving solutions to normalized table\", e)\n            throw e\n        }\n    }\n    \n    /**\n     * Parse issues or solutions string.\n     * Handles both JSON array format ([\"Issue 1\", \"Issue 2\"]) and plain text.\n     */\n    private fun parseIssuesOrSolutions(text: String): List<String> {\n        if (text.isBlank()) {\n            return emptyList()\n        }\n        \n        return try {\n            // Try to parse as JSON array\n            if (text.trim().startsWith(\"[\")) {\n                val json = kotlinx.serialization.json.Json\n                val jsonElement = json.parseToJsonElement(text)\n                if (jsonElement is kotlinx.serialization.json.JsonArray) {\n                    jsonElement.map { element ->\n                        if (element is kotlinx.serialization.json.JsonPrimitive) {\n                            element.content\n                        } else {\n                            element.toString()\n                        }\n                    }\n                } else {\n                    listOf(text.trim())\n                }\n            } else {\n                // Plain text - split by comma or newline, or return as single item\n                text.split(Regex(\"[,;\\\\n]\"))\n                    .map { it.trim() }\n                    .filter { it.isNotBlank() }\n                    .ifEmpty { listOf(text.trim()) } // If no delimiters, return as single item\n            }\n        } catch (e: Exception) {\n            // If parsing fails, treat as plain text\n            Log.w(TAG, \" Failed to parse as JSON, treating as plain text: $text\")\n            listOf(text.trim())\n        }\n    }\n    \n    /**\n     * Get song tests for a specific serial number.\n     */\n    suspend fun getSongTestsForSerial(serialNumber: String): List<SongTest> = withContext(Dispatchers.IO) {\n        val client = SupabaseConfig.getClient()\n        if (client == null) {\n            Log.w(TAG, \" Supabase client not configured, cannot get song tests\")\n            return@withContext emptyList()\n        }\n        \n        try {\n            val response = client.from(\"song_tests\")\n                .select {\n                    filter {\n                        eq(\"serial_number\", serialNumber)\n                    }\n                    order(\"entry_timestamp\", Order.DESCENDING)\n                }\n            \n            val supabaseTests = response.decodeList<SupabaseSongTest>()\n            \n            return@withContext supabaseTests.map { supabaseTest ->\n                SongTest(\n                    testId = supabaseTest.test_id ?: 0,\n                    serialNumber = supabaseTest.serial_number,\n                    operatorName = supabaseTest.operator_name,\n                    entryTimestamp = supabaseTest.entry_timestamp,\n                    exitTimestamp = supabaseTest.exit_timestamp,\n                    totalTimeSpent = supabaseTest.total_time_spent,\n                    songName = supabaseTest.song_name,\n                    result = supabaseTest.result,\n                    issues = \"\", // Issues are in normalized table, would need separate query\n                    solutions = \"\", // Solutions are in normalized table, would need separate query\n                    remark = supabaseTest.remark ?: \"\", // Handle null from Supabase\n                    timestamp = supabaseTest.timestamp,\n                    iterationNumber = supabaseTest.iteration_number,\n                    isOverallResult = supabaseTest.is_overall_result,\n                    needsSync = false, // Already synced\n                    lastSyncTimestamp = System.currentTimeMillis()\n                )\n            }\n        } catch (e: Exception) {\n            Log.e(TAG, \" Failed to get song tests from Supabase\", e)\n            return@withContext emptyList()\n        }\n    }\n}\n\n",
        "firstEditBubbleId": "1c69a70f-f047-43b9-bb01-743c2605038f",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      },
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseFrequencyTestService.kt": {
        "content": "package com.example.fqcapp.supabase\n\nimport android.util.Log\nimport com.example.fqcapp.data.entities.FrequencyTest\nimport io.github.jan.supabase.postgrest.from\nimport io.github.jan.supabase.postgrest.query.Columns\nimport io.github.jan.supabase.postgrest.query.Order\nimport kotlinx.coroutines.Dispatchers\nimport kotlinx.coroutines.withContext\nimport kotlinx.serialization.Serializable\nimport org.json.JSONArray\n\n/**\n * Data transfer object for Supabase frequency_tests table.\n * This matches the structure of the FrequencyTest entity but uses snake_case for Supabase.\n */\n@Serializable\ndata class SupabaseFrequencyTest(\n    val test_id: Long? = null, // Auto-generated, nullable for inserts\n    val serial_number: String,\n    val operator_name: String,\n    @Serializable(with = IntOrStringSerializer::class)\n    val operator_id: String = \"\", // Operator ID (unique identifier) - handles Int or String from Supabase\n    val entry_timestamp: String, // When user entered/started the frequency test\n    val exit_timestamp: String, // When user exited/completed the frequency test\n    val total_time_spent: String, // Total time in HH:MM:SS format (e.g., \"00:05:30\")\n    val result: String, // \"PASS\" or \"FAIL\"\n    val issues: String? = null, // JSON array string (nullable for backward compatibility)\n    val solutions: String? = null, // JSON array string (nullable for backward compatibility)\n    val remark: String,\n    val iteration_number: Int = 1,\n    val test_stage: String = \"Primary Test\", // \"Primary Test\", \"Secondary Test\", or \"Final Test\"\n    val timestamp: String = \"\", // ISO format (kept for backward compatibility)\n    val needs_sync: Boolean? = null, // Not needed in Supabase as it's always synced\n    val last_sync_timestamp: Long? = null // Not needed in Supabase\n)\n\n/**\n * Minimal DTO for inserts (excludes issues/solutions if columns don't exist in schema).\n * This is used when the table doesn't have issues/solutions columns yet.\n */\n@Serializable\ndata class SupabaseFrequencyTestInsert(\n    val serial_number: String,\n    val operator_name: String,\n    @Serializable(with = IntOrStringSerializer::class)\n    val operator_id: String = \"\", // Operator ID (unique identifier) - handles Int or String from Supabase\n    val entry_timestamp: String,\n    val exit_timestamp: String,\n    val total_time_spent: String,\n    val result: String,\n    val remark: String,\n    val iteration_number: Int = 1,\n    val test_stage: String = \"Primary Test\", // \"Primary Test\", \"Secondary Test\", or \"Final Test\"\n    val timestamp: String = \"\"\n)\n\n/**\n * Data transfer object for Supabase frequency_test_issues table (normalized).\n */\n@Serializable\ndata class SupabaseFrequencyTestIssue(\n    val issue_id: Long? = null, // Auto-generated, nullable for inserts\n    val test_id: Long,\n    val issue_text: String\n)\n\n/**\n * Data transfer object for Supabase frequency_test_solutions table (normalized).\n */\n@Serializable\ndata class SupabaseFrequencyTestSolution(\n    val solution_id: Long? = null, // Auto-generated, nullable for inserts\n    val test_id: Long,\n    val solution_text: String\n)\n\n/**\n * Service for saving and retrieving frequency test data from Supabase.\n */\nclass SupabaseFrequencyTestService {\n    private val TAG = \"SupabaseFreqTest\"\n    private val deviceService = SupabaseDeviceService()\n    \n    /**\n     * Convert FrequencyTest entity to Supabase DTO.\n     * Note: issues and solutions are stored as empty strings if not in schema,\n     * they will be saved to normalized tables separately.\n     */\n    private fun toSupabaseFormat(test: FrequencyTest, operatorId: String): SupabaseFrequencyTest {\n        return SupabaseFrequencyTest(\n            test_id = if (test.testId > 0) test.testId else null, // Only include if already has ID\n            serial_number = test.serialNumber,\n            operator_name = test.operatorName,\n            operator_id = operatorId,\n            entry_timestamp = test.entryTimestamp,\n            exit_timestamp = test.exitTimestamp,\n            total_time_spent = test.totalTimeSpent,\n            result = test.result,\n            issues = test.issues, // Will be empty string if column doesn't exist\n            solutions = test.solutions, // Will be empty string if column doesn't exist\n            remark = test.remark,\n            iteration_number = test.iterationNumber,\n            test_stage = test.testStage,\n            timestamp = test.timestamp, // For backward compatibility\n            needs_sync = false, // Not relevant for Supabase\n            last_sync_timestamp = null // Not relevant for Supabase\n        )\n    }\n    \n    /**\n     * Save a frequency test to Supabase.\n     * Returns the inserted test ID if successful, null otherwise.\n     * \n     * Note: Uses minimal insert DTO (without issues/solutions) to avoid schema errors\n     * if those columns don't exist. Issues/solutions will be saved to normalized tables separately.\n     * \n     * @param test The frequency test entity\n     * @param operatorId The operator ID (unique identifier) - must be provided\n     */\n    suspend fun saveFrequencyTest(test: FrequencyTest, operatorId: String): Long? = withContext(Dispatchers.IO) {\n        val client = SupabaseConfig.getClient()\n        if (client == null) {\n            Log.w(TAG, \" Supabase client not configured, skipping save\")\n            return@withContext null\n        }\n        \n        try {\n            Log.d(TAG, \"\")\n            Log.d(TAG, \" [SUPABASE] UPLOADING FREQUENCY TEST\")\n            Log.d(TAG, \"   Serial Number: ${test.serialNumber}\")\n            Log.d(TAG, \"   Operator: ${test.operatorName}\")\n            Log.d(TAG, \"   Result: ${test.result}\")\n            Log.d(TAG, \"   Iteration: ${test.iterationNumber}\")\n            Log.d(TAG, \"   Entry Timestamp: ${test.entryTimestamp}\")\n            Log.d(TAG, \"   Exit Timestamp: ${test.exitTimestamp}\")\n            Log.d(TAG, \"   Total Time: ${test.totalTimeSpent}\")\n            Log.d(TAG, \"\")\n            \n            // CRITICAL: Ensure device exists in Supabase before inserting test data\n            // This is required because of the foreign key constraint\n            Log.d(TAG, \" [STEP 1/3] Ensuring device exists in Supabase...\")\n            val deviceExists = deviceService.ensureDeviceExists(\n                serialNumber = test.serialNumber,\n                macAddress = null, // MAC address not available in FrequencyTest entity\n                color = null\n            )\n            \n            if (!deviceExists) {\n                Log.e(TAG, \"    [ERROR] Failed to ensure device exists, cannot save frequency test\")\n                Log.e(TAG, \"\")\n                return@withContext null\n            }\n            Log.d(TAG, \"    [SUCCESS] Device exists or created successfully\")\n            \n            // Use minimal insert DTO (excludes issues/solutions to avoid schema errors)\n            Log.d(TAG, \" [STEP 2/3] Preparing data for upload...\")\n            \n            // Map result values to database-compatible values\n            // Database constraint only allows \"PASS\" or \"FAIL\"\n            // Map \"CAN_BE_PASSED\" and \"CAN_PASS\" to \"FAIL\" (since they're not a pass)\n            // Preserve original result in remark if it's different\n            val originalResult = test.result.uppercase()\n            val dbResult = when (originalResult) {\n                \"PASS\" -> \"PASS\"\n                \"FAIL\" -> \"FAIL\"\n                \"CAN_BE_PASSED\", \"CAN_PASS\", \"CAN_PASSED\" -> {\n                    Log.d(TAG, \"    [MAPPING] Mapping '${test.result}' to 'FAIL' for database constraint\")\n                    \"FAIL\"\n                }\n                \"TEST_NOT_DONE\" -> {\n                    Log.d(TAG, \"    [MAPPING] Mapping 'TEST_NOT_DONE' to 'FAIL' for database constraint\")\n                    \"FAIL\"\n                }\n                else -> {\n                    Log.w(TAG, \"    [MAPPING] Unknown result '${test.result}', mapping to 'FAIL'\")\n                    \"FAIL\"\n                }\n            }\n            \n            // Preserve original result in remark if it was mapped\n            val remarkWithOriginalResult = if (originalResult != dbResult && !test.remark.contains(\"Original Result:\")) {\n                val originalResultNote = \"Original Result: ${test.result}\"\n                if (test.remark.isBlank()) {\n                    originalResultNote\n                } else {\n                    \"$originalResultNote | ${test.remark}\"\n                }\n            } else {\n                test.remark\n            }\n            \n            val insertData = SupabaseFrequencyTestInsert(\n                serial_number = test.serialNumber,\n                operator_name = test.operatorName,\n                operator_id = operatorId,\n                entry_timestamp = test.entryTimestamp,\n                exit_timestamp = test.exitTimestamp,\n                total_time_spent = test.totalTimeSpent,\n                result = dbResult, // Use mapped result\n                remark = remarkWithOriginalResult, // Include original result in remark\n                iteration_number = test.iterationNumber,\n                timestamp = test.timestamp\n            )\n            \n            Log.d(TAG, \"    [UPLOAD] Data prepared:\")\n            Log.d(TAG, \"      - serial_number: ${insertData.serial_number}\")\n            Log.d(TAG, \"      - operator_name: ${insertData.operator_name}\")\n            Log.d(TAG, \"      - operator_id: ${insertData.operator_id}\")\n            Log.d(TAG, \"      - entry_timestamp: ${insertData.entry_timestamp}\")\n            Log.d(TAG, \"      - exit_timestamp: ${insertData.exit_timestamp}\")\n            Log.d(TAG, \"      - total_time_spent: ${insertData.total_time_spent}\")\n            Log.d(TAG, \"      - result: ${insertData.result}\")\n            Log.d(TAG, \"      - iteration_number: ${insertData.iteration_number}\")\n            Log.d(TAG, \"      - remark: ${insertData.remark}\")\n            \n            Log.d(TAG, \" [STEP 3/3] Inserting into frequency_tests table...\")\n            Log.d(TAG, \"    [QUERY] INSERT INTO frequency_tests (...) VALUES (...)\")\n            \n            val response = client.from(\"frequency_tests\")\n                .insert(insertData) {\n                    select(Columns.ALL)\n                }\n            \n            // Parse the response to get the inserted ID\n            val inserted = response.decodeSingle<SupabaseFrequencyTest>()\n            val insertedId = inserted.test_id ?: return@withContext null\n            \n            Log.d(TAG, \"\")\n            Log.d(TAG, \" [SUPABASE] FREQUENCY TEST UPLOADED SUCCESSFULLY\")\n            Log.d(TAG, \"   Test ID: $insertedId\")\n            Log.d(TAG, \"   Serial Number: ${test.serialNumber}\")\n            Log.d(TAG, \"   Iteration: ${test.iterationNumber}\")\n            Log.d(TAG, \"   Result: ${test.result}\")\n            Log.d(TAG, \"\")\n            \n            // Save issues to normalized table (if any)\n            // IMPORTANT: For PASS results, checklist items are NOT saved as issues\n            // Only actual problems (for FAIL/CAN_BE_PASSED) should be saved as issues.\n            Log.d(TAG, \" [NORMALIZED] Checking if issues need to be saved...\")\n            Log.d(TAG, \"   Test result: ${test.result}\")\n            Log.d(TAG, \"   Issues string: '${test.issues}' (length: ${test.issues.length})\")\n            Log.d(TAG, \"   Issues isBlank: ${test.issues.isBlank()}\")\n            Log.d(TAG, \"   Result is PASS: ${test.result.uppercase() == \"PASS\"}\")\n            \n            if (test.issues.isNotBlank() && test.result.uppercase() != \"PASS\") {\n                try {\n                    Log.d(TAG, \" [NORMALIZED] Saving issues to frequency_test_issues table...\")\n                    Log.d(TAG, \"   Test ID: $insertedId\")\n                    Log.d(TAG, \"   Issues JSON: ${test.issues}\")\n                    saveIssues(insertedId, test.issues)\n                    Log.d(TAG, \"    Issues saved successfully\")\n                } catch (e: Exception) {\n                    Log.e(TAG, \"    [ERROR] Failed to save issues to normalized table\")\n                    Log.e(TAG, \"   Error message: ${e.message}\")\n                    Log.e(TAG, \"   Error type: ${e.javaClass.simpleName}\")\n                    Log.e(TAG, \"   Stack trace: ${e.stackTraceToString()}\")\n                    // Don't fail the whole operation if issues save fails\n                }\n            } else if (test.result.uppercase() == \"PASS\") {\n                Log.d(TAG, \"    [SKIP] Skipping issues save for PASS result - checklist items are implicit in PASS\")\n            } else {\n                Log.d(TAG, \"    [INFO] No issues to save (empty or PASS result)\")\n            }\n            \n            // Save solutions to normalized table (if any)\n            Log.d(TAG, \" [NORMALIZED] Checking if solutions need to be saved...\")\n            Log.d(TAG, \"   Solutions string: '${test.solutions}' (length: ${test.solutions.length})\")\n            Log.d(TAG, \"   Solutions isBlank: ${test.solutions.isBlank()}\")\n            \n            if (test.solutions.isNotBlank() && test.result.uppercase() != \"PASS\") {\n                try {\n                    Log.d(TAG, \" [NORMALIZED] Saving solutions to frequency_test_solutions table...\")\n                    Log.d(TAG, \"   Test ID: $insertedId\")\n                    Log.d(TAG, \"   Solutions JSON: ${test.solutions}\")\n                    saveSolutions(insertedId, test.solutions)\n                    Log.d(TAG, \"    Solutions saved successfully\")\n                } catch (e: Exception) {\n                    Log.e(TAG, \"    [ERROR] Failed to save solutions to normalized table\")\n                    Log.e(TAG, \"   Error message: ${e.message}\")\n                    Log.e(TAG, \"   Error type: ${e.javaClass.simpleName}\")\n                    Log.e(TAG, \"   Stack trace: ${e.stackTraceToString()}\")\n                    // Don't fail the whole operation if solutions save fails\n                }\n            } else if (test.result.uppercase() == \"PASS\") {\n                Log.d(TAG, \"    [SKIP] Skipping solutions save for PASS result - checklist items are implicit in PASS\")\n            } else {\n                Log.d(TAG, \"    [INFO] No solutions to save (empty or PASS result)\")\n            }\n            \n            return@withContext insertedId\n            \n        } catch (e: Exception) {\n            Log.e(TAG, \" Failed to save frequency test to Supabase\", e)\n            Log.e(TAG, \"Error details: ${e.message}\")\n            e.printStackTrace()\n            return@withContext null\n        }\n    }\n    \n    /**\n     * Update an existing frequency test in Supabase.\n     */\n    suspend fun updateFrequencyTest(test: FrequencyTest): Boolean = withContext(Dispatchers.IO) {\n        val client = SupabaseConfig.getClient()\n        if (client == null) {\n            Log.w(TAG, \" Supabase client not configured, skipping update\")\n            return@withContext false\n        }\n        \n        if (test.testId <= 0) {\n            Log.w(TAG, \" Test ID is invalid (${test.testId}), cannot update\")\n            return@withContext false\n        }\n        \n        try {\n            // Note: operatorId is not available in update context, using empty string as fallback\n            // This should be fixed by passing operatorId when calling update\n            val supabaseTest = toSupabaseFormat(test, \"\")\n            \n            Log.d(TAG, \" Updating frequency test in Supabase: ID=${test.testId}, serial=${test.serialNumber}\")\n            \n            client.from(\"frequency_tests\")\n                .update(supabaseTest) {\n                    filter {\n                        eq(\"test_id\", test.testId)\n                    }\n                }\n            \n            Log.d(TAG, \" Successfully updated frequency test in Supabase\")\n            return@withContext true\n            \n        } catch (e: Exception) {\n            Log.e(TAG, \" Failed to update frequency test in Supabase\", e)\n            Log.e(TAG, \"Error details: ${e.message}\")\n            e.printStackTrace()\n            return@withContext false\n        }\n    }\n    \n    /**\n     * Get frequency tests for a specific serial number from Supabase.\n     */\n    suspend fun getFrequencyTestsForSerial(serialNumber: String): List<FrequencyTest> = withContext(Dispatchers.IO) {\n        val client = SupabaseConfig.getClient()\n        if (client == null) {\n            Log.w(TAG, \" Supabase client not configured, returning empty list\")\n            return@withContext emptyList()\n        }\n        \n        try {\n            val response = client.from(\"frequency_tests\")\n                .select {\n                    filter {\n                        eq(\"serial_number\", serialNumber)\n                    }\n                    order(\"entry_timestamp\", Order.DESCENDING)\n                }\n            \n            val supabaseTests = response.decodeList<SupabaseFrequencyTest>()\n            \n            // Convert back to FrequencyTest entities\n            return@withContext supabaseTests.map { supabaseTest ->\n                FrequencyTest(\n                    testId = supabaseTest.test_id ?: 0,\n                    serialNumber = supabaseTest.serial_number,\n                    operatorName = supabaseTest.operator_name,\n                    entryTimestamp = supabaseTest.entry_timestamp,\n                    exitTimestamp = supabaseTest.exit_timestamp,\n                    totalTimeSpent = supabaseTest.total_time_spent,\n                    result = supabaseTest.result,\n                    issues = supabaseTest.issues ?: \"\", // Handle nullable issues\n                    solutions = supabaseTest.solutions ?: \"\", // Handle nullable solutions\n                    remark = supabaseTest.remark,\n                    iterationNumber = supabaseTest.iteration_number,\n                    timestamp = supabaseTest.timestamp, // For backward compatibility\n                    needsSync = false,\n                    lastSyncTimestamp = supabaseTest.last_sync_timestamp ?: 0\n                )\n            }\n            \n        } catch (e: Exception) {\n            Log.e(TAG, \" Failed to fetch frequency tests from Supabase\", e)\n            Log.e(TAG, \"Error details: ${e.message}\")\n            e.printStackTrace()\n            return@withContext emptyList()\n        }\n    }\n    \n    /**\n     * Save issues to normalized frequency_test_issues table.\n     */\n    private suspend fun saveIssues(testId: Long, issuesString: String) {\n        val client = SupabaseConfig.getClient() ?: return\n        \n        try {\n            // Parse issues - could be JSON array or plain text\n            val issuesList = parseIssuesOrSolutions(issuesString)\n            \n            if (issuesList.isEmpty()) {\n                return\n            }\n            \n            // Convert to DTOs\n            val issuesData = issuesList.map { issueText ->\n                SupabaseFrequencyTestIssue(\n                    test_id = testId,\n                    issue_text = issueText\n                )\n            }\n            \n            // Bulk insert all issues at once\n            if (issuesData.isNotEmpty()) {\n                client.from(\"frequency_test_issues\")\n                    .insert(issuesData) {\n                        select(Columns.ALL)\n                    }\n            }\n            \n            Log.d(TAG, \" Saved ${issuesList.size} issues to normalized table for test_id=$testId\")\n            \n        } catch (e: Exception) {\n            Log.e(TAG, \" Error saving issues to normalized table\", e)\n            throw e\n        }\n    }\n    \n    /**\n     * Save solutions to normalized frequency_test_solutions table.\n     */\n    private suspend fun saveSolutions(testId: Long, solutionsString: String) {\n        val client = SupabaseConfig.getClient() ?: return\n        \n        try {\n            // Parse solutions - could be JSON array or plain text\n            val solutionsList = parseIssuesOrSolutions(solutionsString)\n            \n            if (solutionsList.isEmpty()) {\n                return\n            }\n            \n            // Convert to DTOs\n            val solutionsData = solutionsList.map { solutionText ->\n                SupabaseFrequencyTestSolution(\n                    test_id = testId,\n                    solution_text = solutionText\n                )\n            }\n            \n            // Bulk insert all solutions at once\n            if (solutionsData.isNotEmpty()) {\n                client.from(\"frequency_test_solutions\")\n                    .insert(solutionsData) {\n                        select(Columns.ALL)\n                    }\n            }\n            \n            Log.d(TAG, \" Saved ${solutionsList.size} solutions to normalized table for test_id=$testId\")\n            \n        } catch (e: Exception) {\n            Log.e(TAG, \" Error saving solutions to normalized table\", e)\n            throw e\n        }\n    }\n    \n    /**\n     * Parse issues or solutions string (JSON array or plain text) into a list of strings.\n     */\n    private fun parseIssuesOrSolutions(text: String): List<String> {\n        if (text.isBlank()) {\n            return emptyList()\n        }\n        \n        return try {\n            // Try to parse as JSON array\n            if (text.trim().startsWith(\"[\")) {\n                val jsonArray = JSONArray(text)\n                val result = mutableListOf<String>()\n                for (i in 0 until jsonArray.length()) {\n                    val item = jsonArray.getString(i)\n                    if (item.isNotBlank()) {\n                        result.add(item.trim())\n                    }\n                }\n                result\n            } else {\n                // Plain text - split by comma or newline\n                text.split(\",\", \"\\n\")\n                    .map { it.trim() }\n                    .filter { it.isNotBlank() }\n            }\n        } catch (e: Exception) {\n            Log.w(TAG, \" Failed to parse as JSON, treating as plain text: $text\", e)\n            // Fallback: treat as plain text\n            text.split(\",\", \"\\n\")\n                .map { it.trim() }\n                .filter { it.isNotBlank() }\n        }\n    }\n}\n",
        "firstEditBubbleId": "d703a755-7888-4282-a6d1-f155cd8c20ec",
        "isNewlyCreated": false,
        "newlyCreatedFolders": []
      }
    },
    "newlyCreatedFiles": [],
    "newlyCreatedFolders": [],
    "lastUpdatedAt": 1768202665099,
    "createdAt": 1767866567902,
    "hasChangedContext": true,
    "activeTabsShouldBeReactive": true,
    "capabilities": [
      {
        "type": 30,
        "data": {}
      },
      {
        "type": 34,
        "data": {}
      },
      {
        "type": 15,
        "data": {
          "bubbleDataMap": "{}"
        }
      },
      {
        "type": 22,
        "data": {}
      },
      {
        "type": 18,
        "data": {}
      },
      {
        "type": 19,
        "data": {}
      },
      {
        "type": 33,
        "data": {}
      },
      {
        "type": 32,
        "data": {}
      },
      {
        "type": 23,
        "data": {}
      },
      {
        "type": 16,
        "data": {}
      },
      {
        "type": 24,
        "data": {}
      },
      {
        "type": 25,
        "data": {}
      },
      {
        "type": 21,
        "data": {}
      },
      {
        "type": 31,
        "data": {}
      },
      {
        "type": 29,
        "data": {}
      }
    ],
    "name": "Android app project transfer and setup",
    "isFileListExpanded": false,
    "browserChipManuallyDisabled": false,
    "browserChipManuallyEnabled": false,
    "unifiedMode": "agent",
    "forceMode": "edit",
    "usageData": {},
    "contextUsagePercent": 70.69300079345703,
    "allAttachedFileCodeChunksUris": [
      "file:///k%3A/FQC-Tracking-App/PROJECT_STATUS_SUMMARY.md",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/Navigation.kt",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/FQCRepository.kt",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FQCReviewScreen.kt",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/AppDatabase.kt",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/LandingScreen.kt",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/ui/TestSongScreen.kt",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/UnsyncedDataSyncService.kt",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/FrequencyGeneratorScreen.kt",
      "file:///k%3A/FQC-Tracking-App/SUPABASE_API_REQUESTS_EXPLANATION.md",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DeviceWorkflowService.kt",
      "file:///k%3A/FQC-Tracking-App/SUPABASE_SYNC_REMOVAL_SUMMARY.md",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/MacIdCacheManager.kt",
      "file:///k%3A/FQC-Tracking-App/RELIABILITY_FIXES_SUMMARY.md",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/services/DriverPairingCacheManager.kt",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/FrequencyTestDao.kt",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/data/dao/SongTestDao.kt",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/DriverPairingScreen.kt",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseSongTestService.kt",
      "file:///k%3A/FQC-Tracking-App/app/src/main/java/com/example/fqcapp/supabase/SupabaseFrequencyTestService.kt"
    ],
    "modelConfig": {
      "modelName": "composer-1",
      "maxMode": false
    },
    "subComposerIds": [
      "d9ab2c61-7e99-4761-80f2-8e0ac9842c55"
    ],
    "capabilityContexts": [],
    "todos": [],
    "isQueueExpanded": true,
    "hasUnreadMessages": false,
    "gitHubPromptDismissed": false,
    "totalLinesAdded": 0,
    "totalLinesRemoved": 0,
    "addedFiles": 0,
    "removedFiles": 0,
    "isArchived": false,
    "isDraft": false,
    "isCreatingWorktree": false,
    "isApplyingWorktree": false,
    "isUndoingWorktree": false,
    "applied": false,
    "pendingCreateWorktree": false,
    "isBestOfNSubcomposer": false,
    "isBestOfNParent": true,
    "bestOfNJudgeStatus": "done",
    "bestOfNJudgeWinner": false,
    "isSpec": false,
    "isSpecSubagentDone": false,
    "stopHookLoopCount": 0,
    "speculativeSummarizationEncryptionKey": "MyG7E7DJ2otkALZc8wIbSuYfpe+IGJoxYQtaaujPbRY=",
    "isNAL": false,
    "planModeSuggestionUsed": false,
    "debugModeSuggestionUsed": false,
    "conversationState": "",
    "latestChatGenerationUUID": "577e61e0-e40a-4771-b40b-2b4e8642cb85",
    "isAgentic": true,
    "subtitle": "PROJECT_STATUS_SUMMARY.md, COMPREHENSIVE_ANALYSIS.md, COMPLETE_SCREEN_DATA_FLOW.md, WORKFLOW_REQUIREMENTS_SUMMARY.md, UnsyncedDataSyncService.kt",
    "filesChangedCount": 0,
    "gitWorktree": {
      "worktreePath": "C:\\Users\\pc\\.cursor\\worktrees\\Desktop\\kjg",
      "commitHash": "2433510194c0375d89f4a09e7c75ea60223f69ff",
      "branchName": "fqc6-kjg"
    },
    "selectedSubComposerId": "d9ab2c61-7e99-4761-80f2-8e0ac9842c55",
    "initialBestOfNAgentRequestId": "577e61e0-e40a-4771-b40b-2b4e8642cb85"
  },
  "extracted_at": "2026-01-17T20:43:00.670432"
}